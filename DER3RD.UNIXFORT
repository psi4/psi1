      SUBROUTINE AODMUL(DC,DD,DAO,LO,ITYPE)
      IMPLICIT REAL*8 (A-H,O-Z)
      LOGICAL BOTH1,BOTH2
      DIMENSION DAO(IMEM4),LO(IMEM4*5),ITYPE(IMEM4)
     *,         DC(NUMIJ*NTYPES),DD(NUMIJ,NTYPES)
      COMMON/CALQN/ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/ORBIN/IORB1,JORB1,KORB1,LORB1,NUMI,NUMJ,NUMK,NUML
      COMMON/MINFO/ALP(10,10),BET(10,10)
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/TOLER/TOL(10)
      COMMON/TWINF/ISHELL,JSHELL,KSHELL,LSHELL
C
      RETURN
C
      ENTRY AODEN(BOTH1,BOTH2,ISKIP)
C
      ICNT=0
      IORBMX=IORB1 -1 + NUMI
      JORBMX=JORB1 -1 + NUMJ
C
      GO TO (50,70,70,90),ISTYPE
C
C::::::::::::::::::
C:::CLOSED-SHELL:::
C::::::::::::::::::
C
   50 CONTINUE
      DO 400 IORB=IORB1,IORBMX
        IF(BOTH1) JORBMX=IORB
        DO 300 JORB=JORB1,JORBMX
          IJ=IOFF(MAX0(IORB,JORB)) + MIN0(IORB,JORB)
          KORBMX=KORB1 -1 + NUMK
          LORBMX=LORB1 -1 + NUML
          IF(ISHELL.EQ.KSHELL) KORBMX=IORB
          DO 200 KORB=KORB1,KORBMX
            IF(BOTH2) LORBMX=KORB
            DO 100 LORB=LORB1,LORBMX
              KL=IOFF(MAX0(KORB,LORB)) + MIN0(KORB,LORB)
              IF(KL .GT. IJ) GO TO 200
              ICNT=ICNT + 1
              IK=IOFF(MAX0(IORB,KORB)) + MIN0(IORB,KORB)
              JL=IOFF(MAX0(JORB,LORB)) + MIN0(JORB,LORB)
              IL=IOFF(MAX0(IORB,LORB)) + MIN0(IORB,LORB)
              JK=IOFF(MAX0(JORB,KORB)) + MIN0(JORB,KORB)
              DENS= DC(IJ)*DC(KL)*16.0D0 -  4.0D0*DC(IK)*DC(JL)
     *        - 4.0D0*DC(IL)*DC(JK)
              IF(IORB .EQ. JORB) DENS=DENS*0.5D0
              IF(KORB .EQ. LORB) DENS=DENS*0.5D0
              IF(IORB .EQ. KORB .AND. JORB .EQ. LORB) DENS=DENS*0.5D0
              DAO(ICNT)=DENS
              IF(ABS(DENS) .GT. TOL(5)) ISKIP=ISKIP + 1
              IX=0
              CALL INTYPE(IORB,JORB,KORB,LORB,IX)
              IJUNK=(ICNT-1)*5 +1
              LO(IJUNK)=IX
              LO(IJUNK+1)=IORB
              LO(IJUNK+2)=JORB
              LO(IJUNK+3)=KORB
              LO(IJUNK+4)=LORB
  100       CONTINUE
  200     CONTINUE
C
  300   CONTINUE
  400 CONTINUE
      GOTO 1000
C
C::::::::::::::::::::::::::::::::::
C:::GENERAL OPEN-SHELL AND TCSCF:::
C::::::::::::::::::::::::::::::::::
C
   70 CONTINUE
      DO 450 IORB=IORB1,IORBMX
        IF(BOTH1) JORBMX=IORB
        DO 350 JORB=JORB1,JORBMX
          IJ=IOFF(MAX0(IORB,JORB)) + MIN0(IORB,JORB)
          KORBMX=KORB1 -1 + NUMK
          LORBMX=LORB1 -1 + NUML
          IF(ISHELL.EQ.KSHELL) KORBMX=IORB
          DO 250 KORB=KORB1,KORBMX
            IF(BOTH2) LORBMX=KORB
            DO 150 LORB=LORB1,LORBMX
              KL=IOFF(MAX0(KORB,LORB)) + MIN0(KORB,LORB)
              IF(KL .GT. IJ) GO TO 250
              ICNT=ICNT + 1
              IK=IOFF(MAX0(IORB,KORB)) + MIN0(IORB,KORB)
              JL=IOFF(MAX0(JORB,LORB)) + MIN0(JORB,LORB)
              IL=IOFF(MAX0(IORB,LORB)) + MIN0(IORB,LORB)
              JK=IOFF(MAX0(JORB,KORB)) + MIN0(JORB,KORB)
              DEN1=0.0D0
              DEN2=0.0D0
              DO 125 ITYP=1,NTYPES
                DO 122 JTYP=1,NTYPES
                  DEN1= DEN1 + DD(IJ,ITYP)*DD(KL,JTYP)*ALP(ITYP,JTYP)
                  DEN2= DEN2 + (DD(IK,ITYP)*DD(JL,JTYP)
     *                      +   DD(IL,ITYP)*DD(JK,JTYP))*BET(ITYP,JTYP)
  122           CONTINUE
  125         CONTINUE
              DENS=8.0D0*DEN1 + 4.0D0*DEN2
              IF(IORB .EQ. JORB) DENS=DENS*0.5D0
              IF(KORB .EQ. LORB) DENS=DENS*0.5D0
              IF(IORB .EQ. KORB .AND. JORB .EQ. LORB) DENS=DENS*0.5D0
              DAO(ICNT)=DENS
              IF(ABS(DENS) .GT. TOL(5)) ISKIP=ISKIP + 1
              IX=0
              CALL INTYPE(IORB,JORB,KORB,LORB,IX)
              IJUNK=(ICNT-1)*5 +1
              LO(IJUNK)=IX
              LO(IJUNK+1)=IORB
              LO(IJUNK+2)=JORB
              LO(IJUNK+3)=KORB
              LO(IJUNK+4)=LORB
  150       CONTINUE
  250     CONTINUE
C
  350   CONTINUE
  450 CONTINUE
      GOTO 1000
C
C:::::::::::::::::::::::::::::
C:::MULTI-CONFIGURATION SCF:::
C:::::::::::::::::::::::::::::
C
   90 CONTINUE
 1000 CONTINUE
      IF(ICNT .EQ. 0) ISKIP=0
C
      RETURN
      END
      SUBROUTINE ARRAY(KST)
      IMPLICIT INTEGER (A-Z)
      DIMENSION KST(NS,NS,NS),I1(3),II2(6),III3(10)
      DIMENSION J1(3),IJ2(9),IIJ3(18),IJJ3(18),IJK3(27)
      COMMON/INDEX/IX(84),IY(84),IZ(84),JX(84),JY(84),JZ(84)
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR5/IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL
      COMMON/IPAR6/IMTOT
      COMMON/SIGNS/IOFF(256),IPRNT
C
C   SET UP THE KST ARRAY FOR THIRD DERIVATIVES
C
      KTOT=1
      IADD=10
      KST(1,1,1)=1
      DO 300 I=2,NS
        DO 200 J=1,I
          DO 100 K=1,J
            KST(I,J,K)=KTOT + IADD
            IF(I .EQ. J) THEN
              IF(I .EQ. K) THEN
                IADD=10
              ELSE
                IADD=18
              END IF
            ELSE
              IF(J .EQ. K) THEN
                IADD=18
              ELSE
                IADD=27
              END IF
            END IF
            KTOT=KST(I,J,K)
  100     CONTINUE
  200   CONTINUE
  300 CONTINUE
C
C   SET UP THE IX,IY,AND IZ ARRAYS
C
      DO 400 I=1,IMTOT
        IX(I)=IANG*JX(I) + 1
        IY(I)=IANG*JY(I) + 1
        IZ(I)=IANG*JZ(I) + 1
  400 CONTINUE
      RETURN
C
      ENTRY IARRY(IC,I1,II2,III3)
      I1(1)=(IC-1)*3 + 1
      I1(2)=I1(1) + 1
      I1(3)=I1(2) + 1
C
      ICNT=0
      DO 550 I=1,3
        DO 500 J=1,I
          ICNT=ICNT + 1
          II2(ICNT)=IOFF(I1(I)) + I1(J)
  500   CONTINUE
  550 CONTINUE
C
      III3(1)=KST(IC,IC,IC)
      DO 600 I=2,10
        III3(I)=III3(I-1) + 1
  600 CONTINUE
C
      RETURN
C
      ENTRY IJARRY(IC,JC,I1,J1,IJ2,IIJ3,IJJ3)
C
      ICNT=0
      DO 750 I=1,3
        DO 700 J=1,3
          ICNT=ICNT + 1
          IJ2(ICNT)=IOFF(I1(I)) + J1(J)
  700   CONTINUE
  750 CONTINUE
C
      IIJ3(1)=KST(IC,IC,JC)
      DO 800 I=2,18
        IIJ3(I)=IIJ3(I-1) + 1
  800 CONTINUE
C
      IJJ3(1)=KST(IC,JC,JC)
      DO 900 I=2,18
        IJJ3(I)=IJJ3(I-1) + 1
  900 CONTINUE
C
      RETURN
C
      ENTRY IJKARY(IC,JC,KC,IJK3)
C
      IJK3(1)=KST(IC,JC,KC)
      DO 950 I=2,27
        IJK3(I)=IJK3(I-1) + 1
  950 CONTINUE
C
      RETURN
      END
      BLOCK DATA
      COMMON/EINFO/IPLACE(49),ISAME(49)
      COMMON/INDEX/IX(84),IY(84),IZ(84),JX(84),JY(84),JZ(84)
      COMMON/NARRY/N2II(6,2),N2IK(9),N2KI(9),N2IK2(9,3),N3III(10,3)
      COMMON/NARR2/N3IIK(18,4),N3IKK(18,3),N3IJK(27,6),N3JKK(18,2)
      COMMON/NARR3/N3LLI(18,6),N3LLL(10,6),N3ABC(27,4)
C
C   FIRST ROW CONTAINS S,P, AND D INDICES
C   SECOND ROW CONTAINS F
C   THIRD ROW CONTAINS G
C   FOURTH AND FIFTH ROWS CONTAIN  H
C   SIXTH AND SEVENTH ROWS CONTAIN  I
C
      DATA JX / 0, 1, 0, 0, 2, 0, 0, 1, 1, 0,
     *3, 0, 0, 2, 2, 1, 0, 1, 0, 1,
     *4, 0, 0, 3, 3, 1, 0, 1, 0, 2, 2, 0, 2, 1, 1,
     *5, 0, 0, 4, 4, 1, 0, 1, 0, 3, 3, 2, 0, 2, 0, 3, 1, 1, 2,
     *1, 2,
     *6, 0, 0, 5, 5, 1, 0, 1, 0, 4, 4, 2, 0, 2, 0, 3, 3, 0, 5,
     *1, 1, 3, 3, 2, 1, 2, 1, 2/
      DATA JY / 0, 0, 1, 0, 0, 2, 0, 1, 0, 1,
     *0, 3, 0, 1, 0, 2, 2, 0, 1, 1,
     *0, 4, 0, 1, 0, 3, 3, 0, 1, 2, 0, 2, 1, 2, 1,
     *0, 5, 0, 1, 0, 4, 4, 0, 1, 2, 0, 3, 3, 0, 2, 1, 3, 1, 2,
     *2, 1,
     *0, 6, 0, 1, 0, 5, 5, 0, 1, 2, 0, 4, 4, 0, 2, 3, 0, 3, 1,
     *5, 1, 2, 1, 3, 3, 1, 2, 2/
      DATA JZ / 0, 0, 0, 1, 0, 0, 2, 0, 1, 1,
     *0, 0, 3, 0, 1, 0, 1, 2, 2, 1,
     *0, 0, 4, 0, 1, 0, 1, 3, 3, 0, 2, 2, 1, 1, 2,
     *0, 0, 5, 0, 1, 0, 1, 4, 4, 0, 2, 0, 2, 3, 3, 1, 1, 3, 1,
     *2, 2,
     *0, 0, 6, 0, 1, 0, 1, 5, 5, 0, 2, 0, 2, 4, 4, 0, 3, 3, 1,
     *1, 4, 1, 2, 1, 2, 3, 3, 2/
      DATA IPLACE /  1,  3, 10, 29, 66,127,218,
     *               2,  6, 16, 37, 76,139,232,
     *               9, 15, 23, 47, 88,153,248,
     *              28, 36, 46, 58,102,169,266,
     *              65, 75, 87,101,117,187,286,
     *             126,138,152,168,186,206,308,
     *             217,231,247,265,285,307,331/
      DATA ISAME / 0,0,0,0,0,0,0,
     *             0,1,0,0,0,0,0,
     *             0,0,1,0,0,0,0,
     *             0,0,0,1,0,0,0,
     *             0,0,0,0,1,0,0,
     *             0,0,0,0,0,1,0,
     *             0,0,0,0,0,0,1/
      DATA N2II / 1,2,5,3,6,9,1,4,5,7,8,9/
      DATA N2IK / 1,2,4,2,3,5,4,5,6/
      DATA N3III / 1,4,5,11,7,6,14,9,15,18,1,4,5,11,7,13,14,9,15,18,
     *             1,2,10,11,3,8,12,16,17,18/
      DATA N2IK2 / 1,2,4,2,3,5,4,5,6,1,2,3,2,5,6,3,6,9,
     *             1,4,7,4,5,8,7,8,9/
      DATA N2KI / 1,4,7,2,5,8,3,6,9/
      DATA N3IIK / 1,2,5,2, 3, 6,5, 6, 8, 3, 4, 7, 6, 7, 9, 8, 9,10,
     *             1,4,7,4, 5, 6,7, 6, 9, 5,11,14, 6,14,15, 9,15,18,
     *             1,4,7,4, 5, 8,7, 8, 9, 5,11,14, 8,14,15, 9,15,18,
     *             1,2,3,2,10,13,3,13,16,10,11,12,13,12,17,16,17,18/
      DATA N3IKK / 1,4,7,4, 5, 8,7, 6, 9, 5,11,14, 6,14,15, 9,15,18,
     *             1,4,7,2,10,13,3,13,16, 5,11,14, 8,12,17, 9,15,18,
     *             1,2,3,4, 5, 6,7, 8, 9,10,11,12,13,14,15,16,17,18/
      DATA N3IJK / 1, 4, 7,2, 5, 8,3, 6, 9,4,10,13,5,11,14,6,12,15,
     *             7,13,16,8,14,17,9,15,18,
     *             1,4,7,4,10,13,7,13,16,2,5,8,5,11,14,8,14,17,
     *             3,6,9,6,12,15,9,15,18,
     *             1,2,3, 4, 5, 6, 7, 8, 9,4,5,6,10,11,12,13,14,15,
     *             7,8,9,13,14,15,16,17,18,
     *             1,4,7,4,10,13,7,13,16,2,5,8,5,11,14,8,14,17,
     *             3,6,9,6,12,15,9,15,18,
     *             1,2,3, 4, 5, 6, 7, 8, 9,4,5,6,10,11,12,13,14,15,
     *             7,8,9,13,14,15,16,17,18,
     *             1, 4, 7,2, 5, 8,3, 6, 9,4,10,13,5,11,14,6,12,15,
     *             7,13,16,8,14,17,9,15,18/
      DATA N3JKK / 1,4,7,2,10,13,3, 6, 9,5,11,14,6,12,15,9,15,18,
     *             1,4,7,4, 5, 8,7,13,16,5,11,14,8,14,17,9,15,18/
      DATA N3LLI / 1,10,19, 2,13,20, 7,16,25, 5,14,23, 6,15,24, 9,18,27,
     *             1,10,19, 4,11,22, 3,12,21, 5,14,23, 8,17,26, 9,18,27,
     *             1, 4, 7,10,13, 8,19,22,25,11,14,17,20,23,26,21,24,27,
     *             1, 4, 7, 2, 5,16, 3, 6, 9,11,14,17,12,15,18,21,24,27,
     *             1, 2, 3,10,11, 6,19,20,21,13,14,15,22,23,24,25,26,27,
     *             1, 2, 3, 4, 5,12, 7, 8, 9,13,14,15,16,17,18,25,26,27/
      DATA N3LLL / 1, 2, 5,14,19, 6,23, 9,18,27,
     *             1, 4,13,14, 7, 8,17,21,24,27,
     *             1,10,13,14, 7,12,17,21,24,27,
     *             1, 2, 5,14,19,20,23, 9,18,27,
     *             1, 4,11,14, 3,16,15,25,26,27,
     *             1,10,11,14, 3,22,15,25,26,27/
      DATA N3ABC / 1, 4, 7, 2, 5, 8, 3, 6, 9,10,13,16,11,14,17,12,15,18,
     *            19,22,25,20,23,26,21,24,27,
     *             1,10,19, 2,11,20, 3,12,21, 4,13,22, 5,14,23, 6,15,24,
     *             7,16,25, 8,17,26, 9,18,27,
     *             1,10,19, 4,13,22, 7,16,25, 2,11,20, 5,14,23, 8,17,26,
     *             3,12,21, 6,15,24, 9,18,27,
     *             1, 4, 7,10,13,16,19,22,25, 2, 5, 8,11,14,17,20,23,26,
     *             3, 6, 9,12,15,18,21,24,27/
C
      END
      SUBROUTINE BRIDGE(AI,IA,MAXCOR)
      IMPLICIT INTEGER (B-Z)
      IMPLICIT REAL*8 (A)
      DIMENSION AI(1),IA(1)
      COMMON/CALQN/ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET
      COMMON/DATAS/NS,N3N,I2N3N,I3N3N,NBFAO,NUMIJ,NUMIJ2
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/IADRS/IPASS(35)
      COMMON/KEEPS/IDRVT,IDRVF
      COMMON/SIZES/INA,INAB,INABC,ISA,ISAB,ISABC
      COMMON/WORKS/JTAPE1,JTAPE2
    1 FORMAT(/,' SORRY, BUT THIS CAN NOT FIT INTO THE PRESENT MACHINE.'
     *,        ' INCREASE MAXCOR AND THE DIMENSION OF BLANK COMMON.'/
     *,        ' ITOTAL = ',I10,5X,' MAXCOR = ',I10/)
    2 FORMAT(/,2X,' ITOTAL = ',I10,5X,' MAXCOR = ',I10/)
C
C   READ IN SIZES AND POINTERS ON THE JTAPE1 FILE
C
      CALL SREW(JTAPE1)
      CALL RREAD(JTAPE1,IPASS,35,1)
      NS=IPASS(1)
      NUMIJ=IPASS(2)
      NUMIJ2=NUMIJ*2
      N3N=NS*3
      NBFAO=IPASS(3)
      I2N3N=IPASS(4)
      I3N3N=IPASS(5)
      INA=IPASS(6)
      INAB=IPASS(7)
      INABC=IPASS(8)
      ISA=IPASS(9)
      ISAB=IPASS(10)
      ISABC=IPASS(11)
C
C   NOW DIVIDE THE ARRAY AI
C
      REP1=1
      REP2=REP1 + N3N
      REP3=REP2 + I2N3N
      EONE1=REP3 + I3N3N
      EONE2=EONE1 + N3N
      EONE3=EONE2 + I2N3N
      S1LAG=EONE3 + I3N3N
      S2LAG=S1LAG + N3N
      S3LAG=S2LAG + I2N3N
      ETWO1=S3LAG + I3N3N
      ETWO2=ETWO1 + N3N
      ETWO3=ETWO2 + I2N3N
      EA=ETWO3 + I3N3N
      EAB=EA + N3N
      EABC=EAB + I2N3N
      E2A=EABC + I3N3N
      B=E2A + N3N*N3N
      BB=B
      IBMAT=N3N+I2N3N
      IF(IDRVF.EQ.3) THEN
        IBMAT=N3N+I2N3N+I3N3N
      END IF
      SX=BB + IBMAT*NUMIJ*NTYPES
      KST=SX + NUMIJ
      IKST=KST+KST-1
      ITOTAL=KST + NS*NS*NS
C
C   MAKE SURE THIS ALL FITS INTO THE MACHINE
C
      IF(ITOTAL .GT. MAXCOR) THEN
        WRITE(IOUT,1) ITOTAL,MAXCOR
        STOP
      END IF
      WRITE(IOUT,2) ITOTAL,MAXCOR
C
C   SO, LET'S DO THE WORK!
C
      CALL MKFILE(AI(REP1),AI(REP2),AI(REP3)
     *,           AI(EONE1),AI(EONE2),AI(EONE3)
     *,           AI(S1LAG),AI(S2LAG),AI(S3LAG)
     *,           AI(ETWO1),AI(ETWO2),AI(ETWO3)
     *,           AI(EA),AI(EAB),AI(EABC),AI(E2A)
     *,           AI(B),AI(BB),IBMAT,AI(SX),IA(IKST))
C
      RETURN
      END
C***********************************************************************
C
C   DERIVATIVES ARE CALCULATED ON ALL CENTERS (EXCEPT CENTER 4)
C
C***********************************************************************
      SUBROUTINE CEN123(GT,GU,GV,XX0,XY0,XZ0,XXFIR,XYFIR,XZFIR
     *,                 XXSEC,XYSEC,XZSEC,XXMXFF,XYMXFF,XZMXFF,GMXFIR
     *,                 GMXSEC,GMXFF,LO,XXTHR,XYTHR,XZTHR
     *,                 XXFFF,XYFFF,XZFFF,XXFSMX,XYFSMX,XZFSMX,GMXTHR
     *,                 GMXFFF,GMXFS)
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER GSPOT
      LOGICAL BOTH1,BOTH2
      LOGICAL EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      DIMENSION YX(8,14),YY(8,14),YZ(8,14)
      DIMENSION GT(I4LARL,I2LARL),GU(I4LARL,I2LARL)
      DIMENSION GV(I4LARL,I2LARL)
      DIMENSION ITEST(10)
      DIMENSION YYX(8,18),YYY(8,18),YYZ(8,18)
      DIMENSION XX0(IANGSQ,IANGSQ),XY0(IANGSQ,IANGSQ),XZ0(IANGSQ,IANGSQ)
      DIMENSION XXFIR(IANGSQ,IANGSQ,3),XYFIR(IANGSQ,IANGSQ,3)
      DIMENSION XZFIR(IANGSQ,IANGSQ,3),XXSEC(IANGSQ,IANGSQ,3)
      DIMENSION XYSEC(IANGSQ,IANGSQ,3),XZSEC(IANGSQ,IANGSQ,3)
      DIMENSION XXMXFF(IANGSQ,IANGSQ,3),XYMXFF(IANGSQ,IANGSQ,3)
      DIMENSION XZMXFF(IANGSQ,IANGSQ,3),GMXFIR(IMEM4,3,3)
      DIMENSION GMXSEC(IMEM4,6,3),GMXFF(IMEM4,9,3)
      DIMENSION LO(IMEM4*5)
      DIMENSION XXTHR(IANGSQ,IANGSQ,3),XYTHR(IANGSQ,IANGSQ,3)
     *,         XZTHR(IANGSQ,IANGSQ,3),XXFFF(IANGSQ,IANGSQ)
     *,         XYFFF(IANGSQ,IANGSQ),XZFFF(IANGSQ,IANGSQ)
      DIMENSION XXFSMX(IANGSQ,IANGSQ,6),XYFSMX(IANGSQ,IANGSQ,6)
     *,         XZFSMX(IANGSQ,IANGSQ,6)
      DIMENSION GMXTHR(IMEM4,10,3),GMXFFF(IMEM4,27),GMXFS(IMEM4,18,6)
      COMMON/CALQN/ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET
      COMMON/EINFO/IPLACE(49),ISAME(49)
      COMMON/EXYZS/EX(686),EY(686),EZ(686)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/IPAR5/IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL
      COMMON/LOGIC/EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      COMMON/ORBIN/IORB1,JORB1,KORB1,LORB1,NUMI,NUMJ,NUMK,NUML
      COMMON/PASS /II,JJ,KK,LL
      COMMON/POSNS/IJX(50),IJY(50),IJZ(50),KLX(50),KLY(50),KLZ(50)
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/TWINF/ISHELL,JSHELL,KSHELL,LSHELL
C
      ISIZ=   7
      ISIZ2= 14
      ISIZ3= 21
      IESZ=343
C
      RETURN
C
      ENTRY DER123(BOTH1,BOTH2,IQN,JQN,KQN,LQN,IGCNT,NROOT0,AA,BB,CC,DD,
     *ITEST)
C
CCC   WRITE(6,*) ' BOTH1,BOTH2 AFTER DER123 LINE'
CCC   WRITE(6,*)   BOTH1,BOTH2
CCC   WRITE(6,*) ' IQN,JQN,KQN,LQN,IGCNT,NROOT0'
CCC   WRITE(6,*)   IQN,JQN,KQN,LQN,IGCNT,NROOT0
CCC   WRITE(6,*) ' AA,BB,CC,DD'
CCC   WRITE(6,*)   AA,BB,CC,DD
CCC   WRITE(6,*) ' ITEST'
CCC   WRITE(6,*)   ITEST
CCC   WRITE(6,*) ' ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET IN DER123'
CCC   WRITE(6,*)   ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET
CCC   WRITE(6,*) ' IOUT,INPUT,IDBG IN DER123'
CCC   WRITE(6,*)   IOUT,INPUT,IDBG
CCC   WRITE(6,*) ' NS,N3N,I2N3N,I3N3N IN DER123'
CCC   WRITE(6,*)   NS,N3N,I2N3N,I3N3N
CCC   WRITE(6,*) ' NBFAO,NUMIJ,NUMNUM IN DER123'
CCC   WRITE(6,*)   NBFAO,NUMIJ,NUMNUM
CCC   WRITE(6,*) ' TSHELL,TPRIM,LARGL,LARGL2 IN DER123'
CCC   WRITE(6,*)   TSHELL,TPRIM,LARGL,LARGL2
CCC   WRITE(6,*) ' I2LARL,I4LARL,IANG,IESZ IN DER123'
CCC   WRITE(6,*)   I2LARL,I4LARL,IANG,IESZ
CCC   WRITE(6,*) ' IMTOT,IMEM,IANGSQ,IMEM4,IMEM2 IN DER123'
CCC   WRITE(6,*)   IMTOT,IMEM,IANGSQ,IMEM4,IMEM2
CCC   WRITE(6,*) ' EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5 IN DER123'
CCC   WRITE(6,*)   EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
CCC   WRITE(6,*) ' IORB1,JORB1,KORB1,LORB1,NUMI,NUMJ,NUMK,NUML '
CCC   WRITE(6,*)   IORB1,JORB1,KORB1,LORB1,NUMI,NUMJ,NUMK,NUML
CCC   WRITE(6,*) ' II,JJ,KK,LL IN DER123'
CCC   WRITE(6,*)   II,JJ,KK,LL
CCC   WRITE(6,*) ' ISHELL,JSHELL,KSHELL,LSHELL IN DER123'
CCC   WRITE(6,*)   ISHELL,JSHELL,KSHELL,LSHELL
CCC   WRITE(6,*) ' IPLACE'
CCC   WRITE(6,*)   IPLACE
CCC   WRITE(6,*) ' ISAME'
CCC   WRITE(6,*)   ISAME
C
      AA2=AA + AA
      BB2=BB + BB
      CC2=CC + CC
      DD2=DD + DD
      A4=AA2 * AA2
      B4=BB2 * BB2
      C4=CC2 * CC2
      D4=DD2 * DD2
      A8=A4 * AA2
      B8=B4 * BB2
      C8=C4 * CC2
      D8=D4 * DD2
      AB4=AA2*BB2
      CD4=CC2*DD2
      AC4=AA2*CC2
      AD4=AA2*DD2
      BD4=BB2*DD2
      BC4=BB2*CC2
      AAB8=AB4 * AA2
      BBA8=AB4 * BB2
      CCD8=CD4 * CC2
      DDC8=CD4 * DD2
      AAD8=AD4 * AA2
      DDA8=AD4 * DD2
      AAC8=AC4 * AA2
      CCA8=AC4 * CC2
      BBD8=BD4 * BB2
      DDB8=BD4 * DD2
      BBC8=BC4 * BB2
      CCB8=BC4 * CC2
      NROOT=NROOT0 + NDERIV
CCC   WRITE(6,*) ' NROOT0,NDERIV,NROOT'
CCC   WRITE(6,*)   NROOT0,NDERIV,NROOT
C
      KLQN=KQN+LQN -1
      KLQNP1=KLQN + 1
      KLQNP2=KLQN + 2
      KLQNP3=KLQN + 3
      MAX=KLQN + IQN + JQN -1
C
C*********************
C***LOOP OVER IROOT***
C*********************
      DO 10000 IROOT=1,NROOT
        IN=-IANG
        IM=-ISIZ
C
C:::::::::::::::::::::::::::
C:::LOOP OVER INO AND JNO:::
C:::::::::::::::::::::::::::
        DO 9000 INO=1,IQN
          IN=IN + IANG
          IM=IM + ISIZ
          DUMI=DBLE(INO-1)
          DUMIM1=DBLE((INO-1)*(INO-2))
          DUMI2=DBLE(2*INO -1)
          A2DI=AA2*DUMI2
          C2DI=CC2*DUMI
          D2DI=DD2*DUMI
          A12DI=3.0D0*A4*DBLE(INO)
          A6DI=3.0D0*AA2*DUMI*DUMI
          DO 8000 JNO=1,JQN
C
CCC         WRITE(6,*) ' IROOT,INO,JNO,IANG,ISIZ'
CCC         WRITE(6,*)   IROOT,INO,JNO,IANG,ISIZ
            JN=JNO + IN
            JM=JNO + IM
C
            DUMJ=DBLE(JNO-1)
            DUMJM1=DBLE((JNO-1)*(JNO-2))
            DUMJ2=DBLE(2*JNO -1)
            B2DJ=BB2*DUMJ2
            B2DI=BB2*DUMI
            A2DJ=AA2*DUMJ
            D2DJ=DD2*DUMJ
            C2DJ=CC2*DUMJ
            B12DJ=3.0D0*B4*DBLE(JNO)
            B6DJ=3.0D0*BB2*DUMJ*DUMJ
            DIDJ=DUMI*DUMJ
C
CCC   WRITE(6,*) ' IPLACE'
CCC   WRITE(6,*)   IPLACE
CCC   WRITE(6,*) ' ISAME'
CCC   WRITE(6,*)   ISAME
C
            IPL=IPLACE(JM)
CCC         WRITE(6,*) ' IPL',IPL
            ITWO=2
            IF(ISAME(JM) .EQ. 1) ITWO=1
C
            JP0P1=JM + 1
            IP0P1=IPLACE(JP0P1)
            I2P0P1=2
            IF(ISAME(JP0P1) .EQ. 1) I2P0P1=1
            JP0P2=JM + 2
            IP0P2=IPLACE(JP0P2)
            I2P0P2=2
            IF(ISAME(JP0P2) .EQ. 1) I2P0P2=1
            JP0P3=JM + 3
            IP0P3=IPLACE(JP0P3)
            I2P0P3=2
            IF(ISAME(JP0P3) .EQ. 1) I2P0P3=1
            IF(JNO .GT. 1) THEN
              JM0M1=JM-1
              IM0M1=IPLACE(JM0M1)
              I2M0M1=2
              IF(ISAME(JM0M1) .EQ. 1) I2M0M1=1
              IF(JNO .GT. 2) THEN
                JM0M2=JM - 2
                IM0M2=IPLACE(JM0M2)
                I2M0M2=2
                IF(ISAME(JM0M2) .EQ. 1) I2M0M2=1
              END IF
            END IF
C
            JP1P0=JM + ISIZ
            IP1P0=IPLACE(JP1P0)
            I2P1P0=2
            IF(ISAME(JP1P0) .EQ. 1) I2P1P0=1
            JP2P0=JM + ISIZ2
            IP2P0=IPLACE(JP2P0)
            I2P2P0=2
            IF(ISAME(JP2P0) .EQ. 1) I2P2P0=1
            JP3P0=JM + ISIZ3
            IP3P0=IPLACE(JP3P0)
            I2P3P0=2
            IF(ISAME(JP3P0) .EQ. 1) I2P3P0=1
            IF(INO .GT. 1) THEN
              JM1M0=JM - ISIZ
              IM1M0=IPLACE(JM1M0)
              I2M1M0=2
              IF(ISAME(JM1M0) .EQ. 1) I2M1M0=1
              IF(INO .GT. 2) THEN
                JM2M0=JM -ISIZ2
                IM2M0=IPLACE(JM2M0)
                I2M2M0=2
                IF(ISAME(JM2M0) .EQ. 1) I2M2M0=1
              END IF
            END IF
C
            JP1P1=JM + ISIZ + 1
            IP1P1=IPLACE(JP1P1)
            I2P1P1=2
            IF(ISAME(JP1P1) .EQ. 1) I2P1P1=1
            JP2P1=JM + ISIZ2 + 1
            IP2P1=IPLACE(JP2P1)
            I2P2P1=2
            IF(ISAME(JP2P1) .EQ. 1) I2P2P1=1
            JP1P2=JM + ISIZ + 2
            IP1P2=IPLACE(JP1P2)
            I2P1P2=2
            IF(ISAME(JP1P2) .EQ. 1) I2P1P2=1
            IF(INO .GT. 1) THEN
              JM1P1=JM - ISIZ + 1
              IM1P1=IPLACE(JM1P1)
              I2M1P1=2
              IF(ISAME(JM1P1) .EQ. 1) I2M1P1=1
              JM1P2=JM - ISIZ + 2
              IM1P2=IPLACE(JM1P2)
              I2M1P2=2
              IF(ISAME(JM1P2) .EQ. 1) I2M1P2=1
              IF(JNO .GT. 1) THEN
                JM1M1=JM - ISIZ - 1
                IM1M1=IPLACE(JM1M1)
                I2M1M1=2
                IF(ISAME(JM1M1) .EQ. 1) I2M1M1=1
                IF(JNO .GT. 2) THEN
                  JM1M2=JM - ISIZ - 2
                  IM1M2=IPLACE(JM1M2)
                  I2M1M2=2
                  IF(ISAME(JM1M2) .EQ. 1) I2M1M2=1
                END IF
              END IF
              IF(INO .GT. 2) THEN
                JM2P1=JM - ISIZ2 + 1
                IM2P1=IPLACE(JM2P1)
                I2M2P1=2
                IF(ISAME(JM2P1) .EQ. 1) I2M2P1=1
              END IF
            END IF
            IF(JNO .GT. 1) THEN
              JP1M1=JM + ISIZ - 1
              IP1M1=IPLACE(JP1M1)
              I2P1M1=2
              IF(ISAME(JP1M1) .EQ. 1) I2P1M1=1
              JP2M1=JM + ISIZ2 - 1
              IP2M1=IPLACE(JP2M1)
              I2P2M1=2
              IF(ISAME(JP2M1) .EQ. 1) I2P2M1=1
              IF(INO .GT. 2) THEN
                JM2M1=JM - ISIZ2 - 1
                IM2M1=IPLACE(JM2M1)
                I2M2M1=2
                IF(ISAME(JM2M1) .EQ. 1) I2M2M1=1
              END IF
              IF(JNO .GT. 2) THEN
                JP1M2=JM + ISIZ - 2
                IP1M2=IPLACE(JP1M2)
                I2P1M2=2
                IF(ISAME(JP1M2) .EQ. 1) I2P1M2=1
              END IF
            END IF
C
            IT=INO + JNO - 1
            ITM1=IT-1
            ITM2=IT-2
            ITM3=IT-3
            ITZERO=IT
            ITFIR=IT + 1
            ITSEC=IT + 2
            ITTHR=IT + 3
            ITMAX=ITTHR
CCC   WRITE(6,*) ' IPLACE'
CCC   WRITE(6,*)   IPLACE
CCC   WRITE(6,*) ' ISAME'
CCC   WRITE(6,*)   ISAME
C
C   ZEROTH ORDER SECTION
C
            DO 150 IKL=1,KLQN
              YX0=0.0D0
              YY0=0.0D0
              YZ0=0.0D0
              DO 100 IJ=1,IT
                IJM1=IJ-1
                ISPOT=IPL + IJM1*ITWO
                GSPOT=IKL + IJ -1
CCC         WRITE(6,*) ' 150,IKL,KLQN,100,IJ,IT,IJM1,ISPOT,GSPOT'
CCC         WRITE(6,*) IKL,KLQN,IJ,IT,IJM1,ISPOT,GSPOT
                YX0=YX0 + EX(ISPOT)*GT(GSPOT,IROOT)
                YY0=YY0 + EY(ISPOT)*GU(GSPOT,IROOT)
                YZ0=YZ0 + EZ(ISPOT)*GV(GSPOT,IROOT)
  100         CONTINUE
C
              YX(IKL,1)=YX0
              YY(IKL,1)=YY0
              YZ(IKL,1)=YZ0
C
  150       CONTINUE
C
              DO 300 IKL=1,KLQN
CCC           WRITE(6,*) ' 300,IKL,KLQN ',IKL,KLQN
                YX0=YX(IKL,1)
                YY0=YY(IKL,1)
                YZ0=YZ(IKL,1)
                  YXA1=0.0D0
                  YYA1=0.0D0
                  YZA1=0.0D0
                  YXA2=0.0D0
                  YYA2=0.0D0
                  YZA2=0.0D0
                  YX2A1=0.0D0
                  YY2A1=0.0D0
                  YZ2A1=0.0D0
                  YX2A2=0.0D0
                  YY2A2=0.0D0
                  YZ2A2=0.0D0
                  YX3A1=0.0D0
                  YY3A1=0.0D0
                  YZ3A1=0.0D0
                  YXB1=0.0D0
                  YYB1=0.0D0
                  YZB1=0.0D0
                  YXB2=0.0D0
                  YYB2=0.0D0
                  YZB2=0.0D0
                  YX2B1=0.0D0
                  YY2B1=0.0D0
                  YZ2B1=0.0D0
                  YX2B2=0.0D0
                  YY2B2=0.0D0
                  YZ2B2=0.0D0
                  YX3B1=0.0D0
                  YY3B1=0.0D0
                  YZ3B1=0.0D0
                  YXAB1=0.0D0
                  YXAB2=0.0D0
                  YXAB3=0.0D0
                  YXAB4=0.0D0
                  YYAB1=0.0D0
                  YYAB2=0.0D0
                  YYAB3=0.0D0
                  YYAB4=0.0D0
                  YZAB1=0.0D0
                  YZAB2=0.0D0
                  YZAB3=0.0D0
                  YZAB4=0.0D0
                  YXSF1=0.0D0
                  YYSF1=0.0D0
                  YZSF1=0.0D0
                  YXSF2=0.0D0
                  YYSF2=0.0D0
                  YZSF2=0.0D0
                  YXSF3=0.0D0
                  YYSF3=0.0D0
                  YZSF3=0.0D0
                  YXSF4=0.0D0
                  YYSF4=0.0D0
                  YZSF4=0.0D0
                  YXFS1=0.0D0
                  YYFS1=0.0D0
                  YZFS1=0.0D0
                  YXFS2=0.0D0
                  YYFS2=0.0D0
                  YZFS2=0.0D0
                  YXFS3=0.0D0
                  YYFS3=0.0D0
                  YZFS3=0.0D0
                  YXFS4=0.0D0
                  YYFS4=0.0D0
                  YZFS4=0.0D0
                DO 200 IJ=1,ITTHR
                  IJM1=IJ-1
                  GSPOT=IKL + IJ -1
CCC             WRITE(6,*) ' 200,IJ,ITTHR,IJM1,GSPOT'
CCC             WRITE(6,*) IJ,ITTHR,IJM1,GSPOT
C
C   FIRST DERIVATIVE SECTION
C
                  IF(IJ .GT. ITFIR) GO TO 160
                    ISPOT=IP0P1 +  IJM1*I2P0P1
                    YXB1=YXB1 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YYB1=YYB1 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZB1=YZB1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                    IF(JNO .GT. 1) THEN
                      IF(IJ .LE. ITM1) THEN
                        ISPOT=IM0M1 + IJM1*I2M0M1
                        YXB2=YXB2 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YYB2=YYB2 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZB2=YZB2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                    END IF
C
                    ISPOT=IP1P0 + IJM1*I2P1P0
                    YXA1=YXA1 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YYA1=YYA1 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZA1=YZA1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                    IF(INO .GT. 1) THEN
                      IF(IJ .LE. ITM1) THEN
                        ISPOT=IM1M0 + IJM1*I2M1M0
                        YXA2=YXA2 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YYA2=YYA2 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZA2=YZA2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                    END IF
  160             CONTINUE
C
C   SECOND DERIVATIVE SECTION
C
                  IF(IJ .GT. ITSEC) GO TO 170
                    ISPOT=IP2P0 + IJM1*I2P2P0
                    YX2A1=YX2A1 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YY2A1=YY2A1 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZ2A1=YZ2A1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                    IF(INO .GT. 2) THEN
                      IF(IJ .LE. ITM2) THEN
                        ISPOT=IM2M0 + IJM1*I2M2M0
                        YX2A2=YX2A2 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YY2A2=YY2A2 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZ2A2=YZ2A2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                    END IF
C
C
                    ISPOT=IP0P2 + IJM1*I2P0P2
                    YX2B1=YX2B1 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YY2B1=YY2B1 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZ2B1=YZ2B1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                    IF(JNO .GT. 2) THEN
                      IF(IJ .LE. ITM2) THEN
                        ISPOT=IM0M2 + IJM1*I2M0M2
                        YX2B2=YX2B2 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YY2B2=YY2B2 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZ2B2=YZ2B2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                    END IF
C
C
C   CENTER 1 AND CENTER 2 MIXED DERIVATIVES
C
                    ISPOT=IP1P1 + IJM1*I2P1P1
                    YXAB1=YXAB1 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YYAB1=YYAB1 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZAB1=YZAB1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                    IF(INO .GT. 1) THEN
                      IF(IJ .LE. IT) THEN
                        ISPOT=IM1P1 + IJM1*I2M1P1
                        YXAB2=YXAB2 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YYAB2=YYAB2 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZAB2=YZAB2 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                        IF(JNO .GT. 1) THEN
                          IF(IJ .LE. ITM2) THEN
                            ISPOT=IM1M1 + IJM1*I2M1M1
                            YXAB3=YXAB3 + EX(ISPOT)*GT(GSPOT,
     *                      IROOT)
                            YYAB3=YYAB3 + EY(ISPOT)*GU(GSPOT,
     *                      IROOT)
                            YZAB3=YZAB3 + EZ(ISPOT)*GV(GSPOT,
     *                      IROOT)
                          END IF
                        END IF
                      END IF
                    END IF
C
                    IF(JNO .GT. 1) THEN
                      IF(IJ .LE. IT) THEN
                        ISPOT=IP1M1 + IJM1*I2P1M1
                        YXAB4=YXAB4 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YYAB4=YYAB4 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZAB4=YZAB4 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                    END IF
C
  170             CONTINUE
C
C   THIRD DERIVATIVES
C
                    ISPOT=IP3P0 + IJM1*I2P3P0
                    YX3A1=YX3A1 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YY3A1=YY3A1 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZ3A1=YZ3A1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                    ISPOT=IP0P3 + IJM1*I2P0P3
                    YX3B1=YX3B1 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YY3B1=YY3B1 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZ3B1=YZ3B1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                    ISPOT=IP2P1 + IJM1*I2P2P1
                    YXSF1=YXSF1 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YYSF1=YYSF1 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZSF1=YZSF1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                    ISPOT=IP1P2 + IJM1*I2P1P2
                    YXFS1=YXFS1 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YYFS1=YYFS1 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZFS1=YZFS1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                    IF(INO .GT. 2) THEN
                      IF(IJ .LE. ITM1) THEN
                        ISPOT=IM2P1 + IJM1*I2M2P1
                        YXSF2=YXSF2 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YYSF2=YYSF2 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZSF2=YZSF2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                      IF(JNO .GT. 1) THEN
                        IF(IJ .LE. ITM3) THEN
                          ISPOT=IM2M1 + IJM1*I2M2M1
                          YXSF3=YXSF3 + EX(ISPOT)*GT(GSPOT,IROOT)
                          YYSF3=YYSF3 + EY(ISPOT)*GU(GSPOT,IROOT)
                          YZSF3=YZSF3 + EZ(ISPOT)*GV(GSPOT,IROOT)
                        END IF
                      END IF
                    END IF
C
                    IF(JNO .GT. 1) THEN
                      IF(IJ .LE. ITFIR) THEN
                        ISPOT=IP2M1 + IJM1*I2P2M1
                        YXSF4=YXSF4 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YYSF4=YYSF4 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZSF4=YZSF4 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                    END IF
C
                    IF(JNO .GT. 2) THEN
                      IF(IJ .LE. ITM1) THEN
                        ISPOT=IP1M2 + IJM1*I2P1M2
                        YXFS2=YXFS2 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YYFS2=YYFS2 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZFS2=YZFS2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                      IF(INO .GT. 1) THEN
                        IF(IJ .LE. ITM3) THEN
                          ISPOT=IM1M2 + IJM1*I2M1M2
                          YXFS3=YXFS3 + EX(ISPOT)*GT(GSPOT,IROOT)
                          YYFS3=YYFS3 + EY(ISPOT)*GU(GSPOT,IROOT)
                          YZFS3=YZFS3 + EZ(ISPOT)*GV(GSPOT,IROOT)
                        END IF
                      END IF
                    END IF
C
                    IF(INO .GT. 1) THEN
                      IF(IJ .LE. ITFIR) THEN
                        ISPOT=IM1P2 + IJM1*I2M1P2
                        YXFS4=YXFS4 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YYFS4=YYFS4 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZFS4=YZFS4 + EZ(ISPOT)*GV(GSPOT,IROOT)
                       END IF
                     END IF
C
  200           CONTINUE
C
                  YX(IKL,2)=YXA1*AA2 - DUMI*YXA2
                  YY(IKL,2)=YYA1*AA2 - DUMI*YYA2
                  YZ(IKL,2)=YZA1*AA2 - DUMI*YZA2
C
                  YX(IKL,3)=YX2A1*A4 - A2DI*YX0 + DUMIM1*YX2A2
                  YY(IKL,3)=YY2A1*A4 - A2DI*YY0 + DUMIM1*YY2A2
                  YZ(IKL,3)=YZ2A1*A4 - A2DI*YZ0 + DUMIM1*YZ2A2
C
                  YX(IKL,9)=YX3A1*A8 - A12DI*YXA1 + YXA2*A6DI
                  YY(IKL,9)=YY3A1*A8 - A12DI*YYA1 + YYA2*A6DI
                  YZ(IKL,9)=YZ3A1*A8 - A12DI*YZA1 + YZA2*A6DI
C
                    YYX(IKL,17)=YXA1
                    YYY(IKL,17)=YYA1
                    YYZ(IKL,17)=YZA1
C
                    YYX(IKL,18)=YXA2
                    YYY(IKL,18)=YYA2
                    YYZ(IKL,18)=YZA2
C
                  YX(IKL,4)=YXB1*BB2 - DUMJ*YXB2
                  YY(IKL,4)=YYB1*BB2 - DUMJ*YYB2
                  YZ(IKL,4)=YZB1*BB2 - DUMJ*YZB2
C
                  YX(IKL,5)=YX2B1*B4 - B2DJ*YX0 + DUMJM1*YX2B2
                  YY(IKL,5)=YY2B1*B4 - B2DJ*YY0 + DUMJM1*YY2B2
                  YZ(IKL,5)=YZ2B1*B4 - B2DJ*YZ0 + DUMJM1*YZ2B2
C
                  YX(IKL,10)=YX3B1*B8 - B12DJ*YXB1 + YXB2*B6DJ
                  YY(IKL,10)=YY3B1*B8 - B12DJ*YYB1 + YYB2*B6DJ
                  YZ(IKL,10)=YZ3B1*B8 - B12DJ*YZB1 + YZB2*B6DJ
C
                    YYX(IKL,15)=YXB1
                    YYY(IKL,15)=YYB1
                    YYZ(IKL,15)=YZB1
C
                    YYX(IKL,16)=YXB2
                    YYY(IKL,16)=YYB2
                    YYZ(IKL,16)=YZB2
C
                  YX(IKL,6)=AB4*YXAB1 - B2DI*YXAB2 + DIDJ*YXAB3 - A2DJ*
     *            YXAB4
                  YY(IKL,6)=AB4*YYAB1 - B2DI*YYAB2 + DIDJ*YYAB3 - A2DJ*
     *            YYAB4
                  YZ(IKL,6)=AB4*YZAB1 - B2DI*YZAB2 + DIDJ*YZAB3 - A2DJ*
     *            YZAB4
C
                  YX(IKL,11)=AAB8*YXSF1 - AB4*DUMI2*YXB1 + BB2*DUMIM1*
     *                     YXSF2 - A4*DUMJ*YXSF4 + AA2*DUMJ*DUMI2*YXB2
     *                   - DUMIM1*DUMJ*YXSF3
                  YY(IKL,11)=AAB8*YYSF1 - AB4*DUMI2*YYB1 + BB2*DUMIM1*
     *                     YYSF2 - A4*DUMJ*YYSF4 + AA2*DUMJ*DUMI2*YYB2
     *                   - DUMIM1*DUMJ*YYSF3
                  YZ(IKL,11)=AAB8*YZSF1 - AB4*DUMI2*YZB1 + BB2*DUMIM1*
     *                     YZSF2 - A4*DUMJ*YZSF4 + AA2*DUMJ*DUMI2*YZB2
     *                   - DUMIM1*DUMJ*YZSF3
C
                  YX(IKL,12)=BBA8*YXFS1 - AB4*DUMJ2*YXA1 + AA2*DUMJM1*
     *                     YXFS2 - B4*DUMI*YXFS4 + BB2*DUMI*DUMJ2*YXA2
     *                   - DUMJM1*DUMI*YXFS3
                  YY(IKL,12)=BBA8*YYFS1 - AB4*DUMJ2*YYA1 + AA2*DUMJM1*
     *                     YYFS2 - B4*DUMI*YYFS4 + BB2*DUMI*DUMJ2*YYA2
     *                   - DUMJM1*DUMI*YYFS3
                  YZ(IKL,12)=BBA8*YZFS1 - AB4*DUMJ2*YZA1 + AA2*DUMJM1*
     *                     YZFS2 - B4*DUMI*YZFS4 + BB2*DUMI*DUMJ2*YZA2
     *                   - DUMJM1*DUMI*YZFS3
  300         CONTINUE
C
            KLQNP1=KLQN + 1
            KLQNP2=KLQN + 2
            DO 375 IKL=1,KLQNP3
              YX3=0.0D0
              YY3=0.0D0
              YZ3=0.0D0
              DO 350 IJ=1,IT
                IJM1=IJ-1
                ISPOT=IPL + IJM1*ITWO
                GSPOT=IKL + IJM1
CCC         WRITE(6,*) ' 375,IKL,KLQNP3,350,IJ,IT,IJM1,ISPOT,GSPOT'
CCC         WRITE(6,*) IKL,KLQNP3,IJ,IT,IJM1,ISPOT,GSPOT
                YX3=YX3 + EX(ISPOT)*GT(GSPOT,IROOT)
                YY3=YY3 + EY(ISPOT)*GU(GSPOT,IROOT)
                YZ3=YZ3 + EZ(ISPOT)*GV(GSPOT,IROOT)
  350         CONTINUE
              IF(IKL .LE. KLQNP1) THEN
                YX(IKL,7)=YX3
                YY(IKL,7)=YY3
                YZ(IKL,7)=YZ3
              END IF
              IF(IKL .LE. KLQNP2) THEN
                YX(IKL,8)=YX3
                YY(IKL,8)=YY3
                YZ(IKL,8)=YZ3
              END IF
              YX(IKL,13)=YX3
              YY(IKL,13)=YY3
              YZ(IKL,13)=YZ3
  375       CONTINUE
C
              DO 450 IKL=1,KLQNP1
                YXAB1=0.0D0
                YXAB2=0.0D0
                YXAB3=0.0D0
                YXAB4=0.0D0
                YYAB1=0.0D0
                YYAB2=0.0D0
                YYAB3=0.0D0
                YYAB4=0.0D0
                YZAB1=0.0D0
                YZAB2=0.0D0
                YZAB3=0.0D0
                YZAB4=0.0D0
                DO 400 IJ=1,ITSEC
                  IJM1=IJ-1
                  GSPOT=IKL + IJM1
                  ISPOT=IP1P1 + IJM1*I2P1P1
CCC        WRITE(6,*) ' 450,IKL,KLQNP1,400,IJ,ITSEC,IJM1,GSPOT,ISPOT'
CCC        WRITE(6,*) IKL,KLQNP1,IJ,ITSEC,IJM1,GSPOT,ISPOT
                  YXAB1=YXAB1 + EX(ISPOT)*GT(GSPOT,IROOT)
                  YYAB1=YYAB1 + EY(ISPOT)*GU(GSPOT,IROOT)
                  YZAB1=YZAB1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                  IF(INO .GT. 1) THEN
                    IF(IJ .LE. IT) THEN
                      ISPOT=IM1P1 + IJM1*I2M1P1
                      YXAB2=YXAB2 + EX(ISPOT)*GT(GSPOT,IROOT)
                      YYAB2=YYAB2 + EY(ISPOT)*GU(GSPOT,IROOT)
                      YZAB2=YZAB2 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                      IF(JNO .GT. 1) THEN
                        IF(IJ .LE. ITM2) THEN
                          ISPOT=IM1M1 + IJM1*I2M1M1
                          YXAB3=YXAB3 + EX(ISPOT)*GT(GSPOT,
     *                    IROOT)
                          YYAB3=YYAB3 + EY(ISPOT)*GU(GSPOT,
     *                    IROOT)
                          YZAB3=YZAB3 + EZ(ISPOT)*GV(GSPOT,
     *                    IROOT)
                        END IF
                      END IF
                    END IF
                  END IF
C
                  IF(JNO .GT. 1) THEN
                    IF(IJ .LE. IT) THEN
                      ISPOT=IP1M1 + IJM1*I2P1M1
                      YXAB4=YXAB4 + EX(ISPOT)*GT(GSPOT,IROOT)
                      YYAB4=YYAB4 + EY(ISPOT)*GU(GSPOT,IROOT)
                      YZAB4=YZAB4 + EZ(ISPOT)*GV(GSPOT,IROOT)
                    END IF
                  END IF
  400           CONTINUE
                YX(IKL,14)=AB4*YXAB1 - B2DI*YXAB2 + DIDJ*YXAB3 - A2DJ*
     *                    YXAB4
                YY(IKL,14)=AB4*YYAB1 - B2DI*YYAB2 + DIDJ*YYAB3 - A2DJ*
     *                    YYAB4
                YZ(IKL,14)=AB4*YZAB1 - B2DI*YZAB2 + DIDJ*YZAB3 - A2DJ*
     *                    YZAB4
  450         CONTINUE
C
C   MIXED CENTER DERIVATIVES
C
              DO 500 IKL=1,KLQNP2
                  YXA1=0.0D0
                  YYA1=0.0D0
                  YZA1=0.0D0
                  YXA2=0.0D0
                  YYA2=0.0D0
                  YZA2=0.0D0
                  YXA3=0.0D0
                  YYA3=0.0D0
                  YZA3=0.0D0
                  YXA4=0.0D0
                  YYA4=0.0D0
                  YZA4=0.0D0
                  YXA5=0.0D0
                  YYA5=0.0D0
                  YZA5=0.0D0
                  YXA6=0.0D0
                  YYA6=0.0D0
                  YZA6=0.0D0
                  YXB1=0.0D0
                  YYB1=0.0D0
                  YZB1=0.0D0
                  YXB2=0.0D0
                  YYB2=0.0D0
                  YZB2=0.0D0
                  YXB3=0.0D0
                  YYB3=0.0D0
                  YZB3=0.0D0
                  YXB4=0.0D0
                  YYB4=0.0D0
                  YZB4=0.0D0
                  YXB5=0.0D0
                  YYB5=0.0D0
                  YZB5=0.0D0
                  YXB6=0.0D0
                  YYB6=0.0D0
                  YZB6=0.0D0
                DO 490 IJ=1,ITSEC
                  IJM1=IJ - 1
                  GSPOT=IJM1 + IKL
C
CCC          WRITE(6,*) ' 500,IKL,KLQNP2,490,IJ,ITSEC,IJM1,GSPOT'
CCC          WRITE(6,*) IKL,KLQNP2,IJ,ITSEC,IJM1,GSPOT
CCC          WRITE(6,*) ' ITFIR ',ITFIR
                    IF(IJ .GT. ITFIR) GO TO 470
                    ISPOT=IP1P0 + IJM1*I2P1P0
                    EXCNST=EX(ISPOT)*GT(GSPOT,IROOT)
                    EYCNST=EY(ISPOT)*GU(GSPOT,IROOT)
                    EZCNST=EZ(ISPOT)*GV(GSPOT,IROOT)
                    IF(IKL .LE. KLQNP1) THEN
                      YXA1=YXA1 + EXCNST
                      YYA1=YYA1 + EYCNST
                      YZA1=YZA1 + EZCNST
                    END IF
                    YXA3=YXA3 + EXCNST
                    YYA3=YYA3 + EYCNST
                    YZA3=YZA3 + EZCNST
C
                    IF(INO .GT. 1) THEN
                      IF(IJ .LE. ITM1) THEN
                        ISPOT=IM1M0 + IJM1*I2M1M0
                        EXCNST=EX(ISPOT)*GT(GSPOT,IROOT)
                        EYCNST=EY(ISPOT)*GU(GSPOT,IROOT)
                        EZCNST=EZ(ISPOT)*GV(GSPOT,IROOT)
                        IF(IKL .LE. KLQNP1) THEN
                          YXA2=YXA2 + EXCNST
                          YYA2=YYA2 + EYCNST
                          YZA2=YZA2 + EZCNST
                        END IF
                        YXA4=YXA4 + EXCNST
                        YYA4=YYA4 + EYCNST
                        YZA4=YZA4 + EZCNST
                      END IF
                    END IF
C
  470               CONTINUE
CCC                 WRITE(6,*) ' AFTER 470'
CCC                 WRITE(6,*) ' IKL,KLQNP1 ',IKL,KLQNP1
                    IF(IKL .GT. KLQNP1) GO TO 475
                    ISPOT=IP2P0 + IJM1*I2P2P0
                    YXA5=YXA5 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YYA5=YYA5 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZA5=YZA5 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                    IF(INO .GT. 2) THEN
                      IF(IJ .LE. ITM2) THEN
                        ISPOT=IM2M0 + IJM1*I2M2M0
                        YXA6=YXA6 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YYA6=YYA6 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZA6=YZA6 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                    END IF
C
  475               CONTINUE
CCC                 WRITE(6,*) ' AFTER 475'
CCC                 WRITE(6,*) ' IJ,ITFIR ',IJ,ITFIR
C
C
                    IF(IJ .GT. ITFIR) GO TO 480
                    ISPOT=IP0P1 + IJM1*I2P0P1
                    EXCNST=EX(ISPOT)*GT(GSPOT,IROOT)
                    EYCNST=EY(ISPOT)*GU(GSPOT,IROOT)
                    EZCNST=EZ(ISPOT)*GV(GSPOT,IROOT)
                    IF(IKL .LE. KLQNP1) THEN
                      YXB1=YXB1 + EXCNST
                      YYB1=YYB1 + EYCNST
                      YZB1=YZB1 + EZCNST
                    END IF
                    YXB3=YXB3 + EXCNST
                    YYB3=YYB3 + EYCNST
                    YZB3=YZB3 + EZCNST
C
                    IF(JNO .GT. 1) THEN
                      IF(IJ .LE. ITM1) THEN
                        ISPOT=IM0M1 + IJM1*I2M0M1
                        EXCNST=EX(ISPOT)*GT(GSPOT,IROOT)
                        EYCNST=EY(ISPOT)*GU(GSPOT,IROOT)
                        EZCNST=EZ(ISPOT)*GV(GSPOT,IROOT)
                        IF(IKL .LE. KLQNP1) THEN
                          YXB2=YXB2 + EXCNST
                          YYB2=YYB2 + EYCNST
                          YZB2=YZB2 + EZCNST
                        END IF
                        YXB4=YXB4 + EXCNST
                        YYB4=YYB4 + EYCNST
                        YZB4=YZB4 + EZCNST
                      END IF
                    END IF
C
  480               CONTINUE
CCC                 WRITE(6,*) ' AFTER 480'
CCC                 WRITE(6,*) ' IKL,KLQNP1 ',IKL,KLQNP1
                    IF(IKL .GT. KLQNP1) GO TO 485
                    ISPOT=IP0P2 + IJM1*I2P0P2
                    YXB5=YXB5 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YYB5=YYB5 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZB5=YZB5 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                    IF(JNO .GT. 2) THEN
                      IF(IJ .LE. ITM2) THEN
                        ISPOT=IM0M2 + IJM1*I2M0M2
                        YXB6=YXB6 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YYB6=YYB6 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZB6=YZB6 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                    END IF
  485               CONTINUE
CCC               WRITE(6,*) ' AFTER 485 AND BEFORE 490'
  490           CONTINUE
CCC               WRITE(6,*) ' AFTER 490'
C
                  YYX(IKL,1)=YXA1
                  YYY(IKL,1)=YYA1
                  YYZ(IKL,1)=YZA1
C
                  YYX(IKL,2)=YXA2
                  YYY(IKL,2)=YYA2
                  YYZ(IKL,2)=YZA2
C
                  YYX(IKL,5)=YXA3
                  YYY(IKL,5)=YYA3
                  YYZ(IKL,5)=YZA3
C
                  YYX(IKL,6)=YXA4
                  YYY(IKL,6)=YYA4
                  YYZ(IKL,6)=YZA4
C
                  YYX(IKL,9)=YXA5
                  YYY(IKL,9)=YYA5
                  YYZ(IKL,9)=YZA5
C
                  YYX(IKL,10)=YXA6
                  YYY(IKL,10)=YYA6
                  YYZ(IKL,10)=YZA6
                  YYX(IKL,3)=YXB1
                  YYY(IKL,3)=YYB1
                  YYZ(IKL,3)=YZB1
C
                  YYX(IKL,4)=YXB2
                  YYY(IKL,4)=YYB2
                  YYZ(IKL,4)=YZB2
C
                  YYX(IKL,7)=YXB3
                  YYY(IKL,7)=YYB3
                  YYZ(IKL,7)=YZB3
C
                  YYX(IKL,8)=YXB4
                  YYY(IKL,8)=YYB4
                  YYZ(IKL,8)=YZB4
C
                  YYX(IKL,11)=YXB5
                  YYY(IKL,11)=YYB5
                  YYZ(IKL,11)=YZB5
C
                  YYX(IKL,12)=YXB6
                  YYY(IKL,12)=YYB6
                  YYZ(IKL,12)=YZB6
C
C
CCC           WRITE(6,*) ' BEFORE 500, IKL = ',IKL
  500         CONTINUE
CCC           WRITE(6,*) ' END OF 500 LOOP'
C
            KN=-IANG
            KM=-ISIZ
C
C:::::::::::::::::::::::::::
C:::LOOP OVER KNO AND LNO:::
C:::::::::::::::::::::::::::
            DO 7000 KNO=1,KQN
CCC         WRITE(6,*) ' DO 7000,KNO,KQN',KNO,KQN
C
              KN=KN + IANG
              KM=KM + ISIZ
C
              DUMK=DBLE(KNO-1)
              DIDK=DUMK*DUMI
              A2DK=AA2*DUMK
              B2DK=BB2*DUMK
              D2DK=DD2*DUMK
              DUMKM1=DBLE((KNO-1)*(KNO-2))
              DUMK2=DBLE(2*KNO -1)
              C2DK=CC2*DUMK2
              C12DK=3.0D0*C4*DBLE(KNO)
              C6DK=3.0D0*CC2*DUMK*DUMK
              DJDK=DUMJ*DUMK
              DO 6000 LNO=1,LQN
CCC       WRITE(6,*) ' IROOT,INO,JNO,7000,KNO,6000,LNO'
CCC       WRITE(6,*)   IROOT,INO,JNO,KNO,LNO
C
                LN=LNO + KN
                LM=LNO + KM
C
                DUML=DBLE(LNO-1)
                DUMLM1=DBLE((LNO-1)*(LNO-2))
                DUML2=DBLE(2*LNO -1)
                D2DL=DD2*DUML2
                D12DL=3.0D0*D4*DBLE(LNO)
                D6DL=3.0D0*DD2*DUML*DUML
                C2DL=CC2*DUML
                A2DL=AA2*DUML
                B2DL=BB2*DUML
                DIDL=DUMI*DUML
                DJDL=DUMJ*DUML
                DKDL=DUMK*DUML
                ITT=KNO + LNO -1
                ITTM1=ITT-1
                ITTM2=ITT-2
                ITTM3=ITT-3
                ITTFIR=ITT + 1
                ITTSEC=ITT + 2
                ITTTHR=ITT + 3
                ITTMAX=ITTTHR
C
CCC   WRITE(6,*) ' IPLACE'
CCC   WRITE(6,*)   IPLACE
CCC   WRITE(6,*) ' ISAME'
CCC   WRITE(6,*)   ISAME
                KPL=IPLACE(LM)
                KTWO=2
                IF(ISAME(LM) .EQ. 1) KTWO=1
C
C
                  LP1P0=LM + ISIZ
                  KP1P0=IPLACE(LP1P0)
                  K2P1P0=2
                  IF(ISAME(LP1P0) .EQ. 1) K2P1P0=1
                  LP2P0=LM + ISIZ2
                  KP2P0=IPLACE(LP2P0)
                  K2P2P0=2
                  IF(ISAME(LP2P0) .EQ. 1) K2P2P0=1
                  LP3P0=LM + ISIZ3
                  KP3P0=IPLACE(LP3P0)
                  K2P3P0=2
                  IF(ISAME(LP3P0) .EQ. 1) K2P3P0=1
                  IF(KNO .GT. 1) THEN
                    LM1M0=LM - ISIZ
                    KM1M0=IPLACE(LM1M0)
                    K2M1M0=2
                    IF(ISAME(LM1M0) .EQ. 1) K2M1M0=1
                    IF(KNO .GT. 2) THEN
                      LM2M0=LM - ISIZ2
                      KM2M0=IPLACE(LM2M0)
                      K2M2M0=2
                      IF(ISAME(LM2M0) .EQ. 1) K2M2M0=1
                    END IF
                  END IF
C
C
                XXX1=0.0D0
                XYY1=0.0D0
                XZZ1=0.0D0
                XXX2=0.0D0
                XYY2=0.0D0
                XZZ2=0.0D0
                XXX3=0.0D0
                XYY3=0.0D0
                XZZ3=0.0D0
                XXX9=0.0D0
                XYY9=0.0D0
                XZZ9=0.0D0
                XXX4=0.0D0
                XYY4=0.0D0
                XZZ4=0.0D0
                XXX5=0.0D0
                XYY5=0.0D0
                XZZ5=0.0D0
                XXX10=0.0D0
                XYY10=0.0D0
                XZZ10=0.0D0
                XXC1=0.0D0
                XYC1=0.0D0
                XZC1=0.0D0
                XXC2=0.0D0
                XYC2=0.0D0
                XZC2=0.0D0
                XX2C1=0.0D0
                XY2C1=0.0D0
                XZ2C1=0.0D0
                XX2C2=0.0D0
                XY2C2=0.0D0
                XZ2C2=0.0D0
                XX3C1=0.0D0
                XY3C1=0.0D0
                XZ3C1=0.0D0
                XXSF1=0.0D0
                XYSF1=0.0D0
                XZSF1=0.0D0
                XXSF2=0.0D0
                XYSF2=0.0D0
                XZSF2=0.0D0
                XXSF3=0.0D0
                XYSF3=0.0D0
                XZSF3=0.0D0
                XXSF4=0.0D0
                XYSF4=0.0D0
                XZSF4=0.0D0
                XXSF5=0.0D0
                XYSF5=0.0D0
                XZSF5=0.0D0
                XXSF6=0.0D0
                XYSF6=0.0D0
                XZSF6=0.0D0
                XXFS1=0.0D0
                XYFS1=0.0D0
                XZFS1=0.0D0
                XXFS2=0.0D0
                XYFS2=0.0D0
                XZFS2=0.0D0
                XXFS3=0.0D0
                XYFS3=0.0D0
                XZFS3=0.0D0
                XXFS4=0.0D0
                XYFS4=0.0D0
                XZFS4=0.0D0
                XXFS5=0.0D0
                XYFS5=0.0D0
                XZFS5=0.0D0
                XXFS6=0.0D0
                XYFS6=0.0D0
                XZFS6=0.0D0
                XXX6=0.0D0
                XYY6=0.0D0
                XZZ6=0.0D0
                XXX11=0.0D0
                XYY11=0.0D0
                XZZ11=0.0D0
                XXX12=0.0D0
                XYY12=0.0D0
                XZZ12=0.0D0
                XXAC1=0.0D0
                XXAC2=0.0D0
                XXAC3=0.0D0
                XXAC4=0.0D0
                XYAC1=0.0D0
                XYAC2=0.0D0
                XYAC3=0.0D0
                XYAC4=0.0D0
                XZAC1=0.0D0
                XZAC2=0.0D0
                XZAC3=0.0D0
                XZAC4=0.0D0
                XXBC1=0.0D0
                XXBC2=0.0D0
                XXBC3=0.0D0
                XXBC4=0.0D0
                XYBC1=0.0D0
                XYBC2=0.0D0
                XYBC3=0.0D0
                XYBC4=0.0D0
                XZBC1=0.0D0
                XZBC2=0.0D0
                XZBC3=0.0D0
                XZBC4=0.0D0
                XXSF11=0.0D0
                XYSF11=0.0D0
                XZSF11=0.0D0
                XXSF21=0.0D0
                XYSF21=0.0D0
                XZSF21=0.0D0
                XXSF31=0.0D0
                XYSF31=0.0D0
                XZSF31=0.0D0
                XXSF41=0.0D0
                XYSF41=0.0D0
                XZSF41=0.0D0
                XXSF51=0.0D0
                XYSF51=0.0D0
                XZSF51=0.0D0
                XXSF61=0.0D0
                XYSF61=0.0D0
                XZSF61=0.0D0
                XXFS11=0.0D0
                XYFS11=0.0D0
                XZFS11=0.0D0
                XXFS21=0.0D0
                XYFS21=0.0D0
                XZFS21=0.0D0
                XXFS31=0.0D0
                XYFS31=0.0D0
                XZFS31=0.0D0
                XXFS41=0.0D0
                XYFS41=0.0D0
                XZFS41=0.0D0
                XXFS51=0.0D0
                XYFS51=0.0D0
                XZFS51=0.0D0
                XXFS61=0.0D0
                XYFS61=0.0D0
                XZFS61=0.0D0
                XXABC1=0.0D0
                XYABC1=0.0D0
                XZABC1=0.0D0
                XXABC2=0.0D0
                XYABC2=0.0D0
                XZABC2=0.0D0
C
                CONST=-1.0D0
CCC             WRITE(6,*) ' ITTMAX,ITT,KPL,KTWO'
CCC             WRITE(6,*)   ITTMAX,ITT,KPL,KTWO
CCC             WRITE(6,*) ' ITTFIR,ITTM1,ITTSEC,ITTM2'
CCC             WRITE(6,*)   ITTFIR,ITTM1,ITTSEC,ITTM2
C
                DO 600 KL=1,ITTMAX
CCC             WRITE(6,*) ' DO 600 , KL = ',KL
                  KLM1=KL - 1
                  CONST=-CONST
C
                  IF(KL .LE. ITT) THEN
C
C   ZEROTH ORDER SECTION
C
CCC             WRITE(6,*) ' ZEROTH ORDER SECTION'
                    KSPOT=KPL + KLM1*KTWO
                    EXCNST=EX(IESZ+KSPOT)*CONST
                    EYCNST=EY(IESZ+KSPOT)*CONST
                    EZCNST=EZ(IESZ+KSPOT)*CONST
C
                    XXX1=XXX1 + YX(KL,1)*EXCNST
                    XYY1=XYY1 + YY(KL,1)*EYCNST
                    XZZ1=XZZ1 + YZ(KL,1)*EZCNST
C
C   CENTER 1 FIRST, SECOND AND THIRD DERIVATIVES
C
CCC             WRITE(6,*) ' CENT 1 FIRST SECTION'
                      XXX2=XXX2 + YX(KL,2)*EXCNST
                      XYY2=XYY2 + YY(KL,2)*EYCNST
                      XZZ2=XZZ2 + YZ(KL,2)*EZCNST
C
                      XXX3=XXX3 + YX(KL,3)*EXCNST
                      XYY3=XYY3 + YY(KL,3)*EYCNST
                      XZZ3=XZZ3 + YZ(KL,3)*EZCNST
C
                      XXX9=XXX9 + YX(KL,9)*EXCNST
                      XYY9=XYY9 + YY(KL,9)*EYCNST
                      XZZ9=XZZ9 + YZ(KL,9)*EZCNST
C
C   CENTER 2 FIRST, SECOND, AND THIRD DERIVATIVES
C
CCC             WRITE(6,*) ' CENT 2 FIRST SECTION'
                      XXX4=XXX4 + YX(KL,4)*EXCNST
                      XYY4=XYY4 + YY(KL,4)*EYCNST
                      XZZ4=XZZ4 + YZ(KL,4)*EZCNST
C
                      XXX5=XXX5 + YX(KL,5)*EXCNST
                      XYY5=XYY5 + YY(KL,5)*EYCNST
                      XZZ5=XZZ5 + YZ(KL,5)*EZCNST
C
                      XXX10=XXX10 + YX(KL,10)*EXCNST
                      XYY10=XYY10 + YY(KL,10)*EYCNST
                      XZZ10=XZZ10 + YZ(KL,10)*EZCNST
C
C   CENTERS 1 AND 2 MIXED DERIVATIVES
C
CCC             WRITE(6,*) ' CENTERS 1 AND 2 FIRST SECTION'
                      XXX6=XXX6 + YX(KL,6)*EXCNST
                      XYY6=XYY6 + YY(KL,6)*EYCNST
                      XZZ6=XZZ6 + YZ(KL,6)*EZCNST
C
                      XXX11=XXX11 + YX(KL,11)*EXCNST
                      XYY11=XYY11 + YY(KL,11)*EYCNST
                      XZZ11=XZZ11 + YZ(KL,11)*EZCNST
C
                      XXX12=XXX12 + YX(KL,12)*EXCNST
                      XYY12=XYY12 + YY(KL,12)*EYCNST
                      XZZ12=XZZ12 + YZ(KL,12)*EZCNST
C
                  END IF
C
C   CENTER 3 FIRST, SECOND, AND THIRD DERIVATIVES
C
CCC             WRITE(6,*) ' CENTER 3 FIRST  SECTION'
                    IF(KL .GT. ITTFIR) GO TO 510
                    KSPOT=KP1P0 + KLM1*K2P1P0
                    XXC1=XXC1 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                    XYC1=XYC1 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                    XZC1=XZC1 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
C
                    IF(KNO .GT. 1) THEN
                      IF(KL .LE. ITTM1) THEN
                        KSPOT=KM1M0 + KLM1*K2M1M0
                        XXC2=XXC2 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                        XYC2=XYC2 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                        XZC2=XZC2 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
                      END IF
                    END IF
  510               CONTINUE
C
                    IF(KL .GT. ITTSEC) GO TO 520
                    KSPOT=KP2P0 + KLM1*K2P2P0
                    XX2C1=XX2C1 + YX(KL,8)*EX(IESZ+KSPOT)*CONST
                    XY2C1=XY2C1 + YY(KL,8)*EY(IESZ+KSPOT)*CONST
                    XZ2C1=XZ2C1 + YZ(KL,8)*EZ(IESZ+KSPOT)*CONST
C
                    IF(KNO .GT. 2) THEN
                      IF(KL .LE. ITTM2) THEN
                        KSPOT=KM2M0 + KLM1*K2M2M0
                        XX2C2=XX2C2 + YX(KL,8)*EX(IESZ+KSPOT)*CONST
                        XY2C2=XY2C2 + YY(KL,8)*EY(IESZ+KSPOT)*CONST
                        XZ2C2=XZ2C2 + YZ(KL,8)*EZ(IESZ+KSPOT)*CONST
                      END IF
                    END IF
  520               CONTINUE
C
                  KSPOT=KP3P0 + KLM1*K2P3P0
                  XX3C1=XX3C1 + YX(KL,13)*EX(IESZ+KSPOT)*CONST
                  XY3C1=XY3C1 + YY(KL,13)*EY(IESZ+KSPOT)*CONST
                  XZ3C1=XZ3C1 + YZ(KL,13)*EZ(IESZ+KSPOT)*CONST
                  IF(KL .GT. ITTSEC) GO TO 600
C
C
C   CENTERS 1 AND 3 MIXED DERIVATIVES
C
CCC             WRITE(6,*) ' CENTERS 1 AND  3 MIXED  SECTION'
                    IF(KL .LE. ITTFIR) THEN
                      KSPOT=KP1P0 + KLM1*K2P1P0
                      EXCNST=EX(IESZ+KSPOT)*CONST
                      EYCNST=EY(IESZ+KSPOT)*CONST
                      EZCNST=EZ(IESZ+KSPOT)*CONST
C
                      XXAC1=XXAC1 + YYX(KL,1)*EXCNST
                      XYAC1=XYAC1 + YYY(KL,1)*EYCNST
                      XZAC1=XZAC1 + YYZ(KL,1)*EZCNST
C
                      XXAC4=XXAC4 + YYX(KL,2)*EXCNST
                      XYAC4=XYAC4 + YYY(KL,2)*EYCNST
                      XZAC4=XZAC4 + YYZ(KL,2)*EZCNST
C
                      XXSF1=XXSF1 + YYX(KL,9)*EXCNST
                      XYSF1=XYSF1 + YYY(KL,9)*EYCNST
                      XZSF1=XZSF1 + YYZ(KL,9)*EZCNST
C
                      XXSF2=XXSF2 + YYX(KL,10)*EXCNST
                      XYSF2=XYSF2 + YYY(KL,10)*EYCNST
                      XZSF2=XZSF2 + YYZ(KL,10)*EZCNST
C
                      XXSF3=XXSF3 + YX(KL,7)*EXCNST
                      XYSF3=XYSF3 + YY(KL,7)*EYCNST
                      XZSF3=XZSF3 + YZ(KL,7)*EZCNST
C
                    END IF
                    IF(KNO .GT. 1) THEN
                      IF(KL .LE. ITTM1) THEN
                        KSPOT=KM1M0 + KLM1*K2M1M0
                        EXCNST=EX(IESZ+KSPOT)*CONST
                        EYCNST=EY(IESZ+KSPOT)*CONST
                        EZCNST=EZ(IESZ+KSPOT)*CONST
C
                        XXAC2=XXAC2 + YYX(KL,1)*EXCNST
                        XYAC2=XYAC2 + YYY(KL,1)*EYCNST
                        XZAC2=XZAC2 + YYZ(KL,1)*EZCNST
C
                        XXAC3=XXAC3 + YYX(KL,2)*EXCNST
                        XYAC3=XYAC3 + YYY(KL,2)*EYCNST
                        XZAC3=XZAC3 + YYZ(KL,2)*EZCNST
C
                        XXSF4=XXSF4 + YYX(KL,9)*EXCNST
                        XYSF4=XYSF4 + YYY(KL,9)*EYCNST
                        XZSF4=XZSF4 + YYZ(KL,9)*EZCNST
C
                        XXSF5=XXSF5 + YYX(KL,10)*EXCNST
                        XYSF5=XYSF5 + YYY(KL,10)*EYCNST
                        XZSF5=XZSF5 + YYZ(KL,10)*EZCNST
C
                        XXSF6=XXSF6 + YX(KL,7)*EXCNST
                        XYSF6=XYSF6 + YY(KL,7)*EYCNST
                        XZSF6=XZSF6 + YZ(KL,7)*EZCNST
                      END IF
                    END IF
C
                    KSPOT=KP2P0 + KLM1*K2P2P0
                    EXCNST=EX(IESZ+KSPOT)*CONST
                    EYCNST=EY(IESZ+KSPOT)*CONST
                    EZCNST=EZ(IESZ+KSPOT)*CONST
C
                    XXFS1=XXFS1 + YYX(KL,5)*EXCNST
                    XYFS1=XYFS1 + YYY(KL,5)*EYCNST
                    XZFS1=XZFS1 + YYZ(KL,5)*EZCNST
C
                    XXFS2=XXFS2 + YYX(KL,6)*EXCNST
                    XYFS2=XYFS2 + YYY(KL,6)*EYCNST
                    XZFS2=XZFS2 + YYZ(KL,6)*EZCNST
C
                    IF(KL .LE. ITT) THEN
                      KSPOT=KPL + KTWO*KLM1
                      EXCNST=EX(IESZ+KSPOT)*CONST
                      EYCNST=EY(IESZ+KSPOT)*CONST
                      EZCNST=EZ(IESZ+KSPOT)*CONST
C
                      XXFS3=XXFS3 + YYX(KL,17)*EXCNST
                      XYFS3=XYFS3 + YYY(KL,17)*EYCNST
                      XZFS3=XZFS3 + YYZ(KL,17)*EZCNST
C
                      XXFS4=XXFS4 + YYX(KL,18)*EXCNST
                      XYFS4=XYFS4 + YYY(KL,18)*EYCNST
                      XZFS4=XZFS4 + YYZ(KL,18)*EZCNST
                    END IF
C
                    IF(KNO .GT. 2) THEN
                      IF(KL .LE. ITTM2) THEN
                        KSPOT=KM2M0 + KLM1*K2M2M0
                        EXCNST=EX(IESZ+KSPOT)*CONST
                        EYCNST=EY(IESZ+KSPOT)*CONST
                        EZCNST=EZ(IESZ+KSPOT)*CONST
C
                        XXFS5=XXFS5 + YYX(KL,5)*EXCNST
                        XYFS5=XYFS5 + YYY(KL,5)*EYCNST
                        XZFS5=XZFS5 + YYZ(KL,5)*EZCNST
C
                        XXFS6=XXFS6 + YYX(KL,6)*EXCNST
                        XYFS6=XYFS6 + YYY(KL,6)*EYCNST
                        XZFS6=XZFS6 + YYZ(KL,6)*EZCNST
                      END IF
                    END IF
C
C
C   CENTERS 2 AND 3 MIXED DERIVATIVES
C
CCC             WRITE(6,*) ' CENTERS 2 AND  3 MIXED  SECTION'
                    IF(KL .LE. ITTFIR) THEN
                      KSPOT=KP1P0 + KLM1*K2P1P0
                      EXCNST=EX(IESZ+KSPOT)*CONST
                      EYCNST=EY(IESZ+KSPOT)*CONST
                      EZCNST=EZ(IESZ+KSPOT)*CONST
C
                      XXBC1=XXBC1 + YYX(KL,3)*EXCNST
                      XYBC1=XYBC1 + YYY(KL,3)*EYCNST
                      XZBC1=XZBC1 + YYZ(KL,3)*EZCNST
C
                      XXBC4=XXBC4 + YYX(KL,4)*EXCNST
                      XYBC4=XYBC4 + YYY(KL,4)*EYCNST
                      XZBC4=XZBC4 + YYZ(KL,4)*EZCNST
C
                      XXSF11=XXSF11 + YYX(KL,11)*EXCNST
                      XYSF11=XYSF11 + YYY(KL,11)*EYCNST
                      XZSF11=XZSF11 + YYZ(KL,11)*EZCNST
C
                      XXSF21=XXSF21 + YYX(KL,12)*EXCNST
                      XYSF21=XYSF21 + YYY(KL,12)*EYCNST
                      XZSF21=XZSF21 + YYZ(KL,12)*EZCNST
C
                      XXSF31=XXSF31 + YX(KL,7)*EXCNST
                      XYSF31=XYSF31 + YY(KL,7)*EYCNST
                      XZSF31=XZSF31 + YZ(KL,7)*EZCNST
C
                    END IF
                    IF(KNO .GT. 1) THEN
                      IF(KL .LE. ITTM1) THEN
                        KSPOT=KM1M0 + KLM1*K2M1M0
                        EXCNST=EX(IESZ+KSPOT)*CONST
                        EYCNST=EY(IESZ+KSPOT)*CONST
                        EZCNST=EZ(IESZ+KSPOT)*CONST
C
                        XXBC2=XXBC2 + YYX(KL,3)*EXCNST
                        XYBC2=XYBC2 + YYY(KL,3)*EYCNST
                        XZBC2=XZBC2 + YYZ(KL,3)*EZCNST
C
                        XXBC3=XXBC3 + YYX(KL,4)*EXCNST
                        XYBC3=XYBC3 + YYY(KL,4)*EYCNST
                        XZBC3=XZBC3 + YYZ(KL,4)*EZCNST
C
                        XXSF41=XXSF41 + YYX(KL,11)*EXCNST
                        XYSF41=XYSF41 + YYY(KL,11)*EYCNST
                        XZSF41=XZSF41 + YYZ(KL,11)*EZCNST
C
                        XXSF51=XXSF51 + YYX(KL,12)*EXCNST
                        XYSF51=XYSF51 + YYY(KL,12)*EYCNST
                        XZSF51=XZSF51 + YYZ(KL,12)*EZCNST
C
                        XXSF61=XXSF61 + YX(KL,7)*EXCNST
                        XYSF61=XYSF61 + YY(KL,7)*EYCNST
                        XZSF61=XZSF61 + YZ(KL,7)*EZCNST
                      END IF
                    END IF
C
                    KSPOT=KP2P0 + KLM1*K2P2P0
                    EXCNST=EX(IESZ+KSPOT)*CONST
                    EYCNST=EY(IESZ+KSPOT)*CONST
                    EZCNST=EZ(IESZ+KSPOT)*CONST
C
                    XXFS11=XXFS11 + YYX(KL,7)*EXCNST
                    XYFS11=XYFS11 + YYY(KL,7)*EYCNST
                    XZFS11=XZFS11 + YYZ(KL,7)*EZCNST
C
                    XXFS21=XXFS21 + YYX(KL,8)*EXCNST
                    XYFS21=XYFS21 + YYY(KL,8)*EYCNST
                    XZFS21=XZFS21 + YYZ(KL,8)*EZCNST
C
                    IF(KL .LE. ITT) THEN
                      KSPOT=KPL + KTWO*KLM1
                      EXCNST=EX(IESZ+KSPOT)*CONST
                      EYCNST=EY(IESZ+KSPOT)*CONST
                      EZCNST=EZ(IESZ+KSPOT)*CONST
C
                      XXFS31=XXFS31 + YYX(KL,15)*EXCNST
                      XYFS31=XYFS31 + YYY(KL,15)*EYCNST
                      XZFS31=XZFS31 + YYZ(KL,15)*EZCNST
C
                      XXFS41=XXFS41 + YYX(KL,16)*EXCNST
                      XYFS41=XYFS41 + YYY(KL,16)*EYCNST
                      XZFS41=XZFS41 + YYZ(KL,16)*EZCNST
                    END IF
C
                    IF(KNO .GT. 2) THEN
                      IF(KL .LE. ITTM2) THEN
                        KSPOT=KM2M0 + KLM1*K2M2M0
                        EXCNST=EX(IESZ+KSPOT)*CONST
                        EYCNST=EY(IESZ+KSPOT)*CONST
                        EZCNST=EZ(IESZ+KSPOT)*CONST
C
                        XXFS51=XXFS51 + YYX(KL,7)*EXCNST
                        XYFS51=XYFS51 + YYY(KL,7)*EYCNST
                        XZFS51=XZFS51 + YYZ(KL,7)*EZCNST
C
                        XXFS61=XXFS61 + YYX(KL,8)*EXCNST
                        XYFS61=XYFS61 + YYY(KL,8)*EYCNST
                        XZFS61=XZFS61 + YYZ(KL,8)*EZCNST
                      END IF
                    END IF
C
C
                    IF(KL .LE. ITTFIR) THEN
                      KSPOT=KP1P0 + KLM1*K2P1P0
                      XXABC1=XXABC1 + YX(KL,14)*EX(IESZ+KSPOT)*CONST
                      XYABC1=XYABC1 + YY(KL,14)*EY(IESZ+KSPOT)*CONST
                      XZABC1=XZABC1 + YZ(KL,14)*EZ(IESZ+KSPOT)*CONST
                      IF(KNO .GT. 1) THEN
                        IF(KL .LE. ITTM1) THEN
                          KSPOT=KM1M0 + KLM1*K2M1M0
                          XXABC2=XXABC2 + YX(KL,14)*EX(IESZ+KSPOT)*CONST
                          XYABC2=XYABC2 + YY(KL,14)*EY(IESZ+KSPOT)*CONST
                          XZABC2=XZABC2 + YZ(KL,14)*EZ(IESZ+KSPOT)*CONST
                        END IF
                      END IF
                    END IF
C
CCC             WRITE(6,*) ' END OF 600 LOOP'
  600           CONTINUE
C
                XX0(JN,LN)=XXX1
                XY0(JN,LN)=XYY1
                XZ0(JN,LN)=XZZ1
C
                INT=0
                  INT=INT+1
                  XXFIR(JN,LN,INT)=XXX2
                  XYFIR(JN,LN,INT)=XYY2
                  XZFIR(JN,LN,INT)=XZZ2
C
                  XXSEC(JN,LN,INT)=XXX3
                  XYSEC(JN,LN,INT)=XYY3
                  XZSEC(JN,LN,INT)=XZZ3
C
                  XXTHR(JN,LN,INT)=XXX9
                  XYTHR(JN,LN,INT)=XYY9
                  XZTHR(JN,LN,INT)=XZZ9
C
                  INT=INT+1
                  XXFIR(JN,LN,INT)=XXX4
                  XYFIR(JN,LN,INT)=XYY4
                  XZFIR(JN,LN,INT)=XZZ4
C
                  XXSEC(JN,LN,INT)=XXX5
                  XYSEC(JN,LN,INT)=XYY5
                  XZSEC(JN,LN,INT)=XZZ5
C
                  XXTHR(JN,LN,INT)=XXX10
                  XYTHR(JN,LN,INT)=XYY10
                  XZTHR(JN,LN,INT)=XZZ10
C
                  INT=INT+1
                  XXFIR(JN,LN,INT)=XXC1*CC2 - DUMK*XXC2
                  XYFIR(JN,LN,INT)=XYC1*CC2 - DUMK*XYC2
                  XZFIR(JN,LN,INT)=XZC1*CC2 - DUMK*XZC2
C
                  XXSEC(JN,LN,INT)=C4*XX2C1 - C2DK*XXX1 + DUMKM1*XX2C2
                  XYSEC(JN,LN,INT)=C4*XY2C1 - C2DK*XYY1 + DUMKM1*XY2C2
                  XZSEC(JN,LN,INT)=C4*XZ2C1 - C2DK*XZZ1 + DUMKM1*XZ2C2
C
                  XXTHR(JN,LN,INT)=C8*XX3C1 - C12DK*XXC1 + C6DK*XXC2
                  XYTHR(JN,LN,INT)=C8*XY3C1 - C12DK*XYC1 + C6DK*XYC2
                  XZTHR(JN,LN,INT)=C8*XZ3C1 - C12DK*XZC1 + C6DK*XZC2
C
                IMX=0
                IFS=0
                  IMX=IMX + 1
                  XXMXFF(JN,LN,IMX)=XXX6
                  XYMXFF(JN,LN,IMX)=XYY6
                  XZMXFF(JN,LN,IMX)=XZZ6
                  IFS=IFS + 1
                  XXFSMX(JN,LN,IFS)=XXX11
                  XYFSMX(JN,LN,IFS)=XYY11
                  XZFSMX(JN,LN,IFS)=XZZ11
                  IFS=IFS + 1
                  XXFSMX(JN,LN,IFS)=XXX12
                  XYFSMX(JN,LN,IFS)=XYY12
                  XZFSMX(JN,LN,IFS)=XZZ12
C
C
                  IMX=IMX+1
                  XXMXFF(JN,LN,IMX)=AC4*XXAC1 - A2DK*XXAC2 + DIDK*XXAC3
     *            - C2DI*XXAC4
                  XYMXFF(JN,LN,IMX)=AC4*XYAC1 - A2DK*XYAC2 + DIDK*XYAC3
     *            - C2DI*XYAC4
                  XZMXFF(JN,LN,IMX)=AC4*XZAC1 - A2DK*XZAC2 + DIDK*XZAC3
     *            - C2DI*XZAC4
                  IFS=IFS+1
                  XXFSMX(JN,LN,IFS)= AAC8*XXSF1 - AC4*DUMI2*XXSF3
     *                             + CC2*DUMIM1*XXSF2 - A4*DUMK*XXSF4
     *                      + AA2*DUMK*DUMI2*XXSF6 - DUMIM1*DUMK*XXSF5
                  XYFSMX(JN,LN,IFS)= AAC8*XYSF1 - AC4*DUMI2*XYSF3
     *                             + CC2*DUMIM1*XYSF2 - A4*DUMK*XYSF4
     *                      + AA2*DUMK*DUMI2*XYSF6 - DUMIM1*DUMK*XYSF5
                  XZFSMX(JN,LN,IFS)= AAC8*XZSF1 - AC4*DUMI2*XZSF3
     *                             + CC2*DUMIM1*XZSF2 - A4*DUMK*XZSF4
     *                      + AA2*DUMK*DUMI2*XZSF6 - DUMIM1*DUMK*XZSF5
                  IFS=IFS+1
                  XXFSMX(JN,LN,IFS)= CCA8*XXFS1 - AC4*DUMK2*XXFS3
     *                             + AA2*DUMKM1*XXFS5 - C4*DUMI*XXFS2
     *                      + CC2*DUMI*DUMK2*XXFS4 - DUMKM1*DUMI*XXFS6
                  XYFSMX(JN,LN,IFS)= CCA8*XYFS1 - AC4*DUMK2*XYFS3
     *                             + AA2*DUMKM1*XYFS5 - C4*DUMI*XYFS2
     *                      + CC2*DUMI*DUMK2*XYFS4 - DUMKM1*DUMI*XYFS6
                  XZFSMX(JN,LN,IFS)= CCA8*XZFS1 - AC4*DUMK2*XZFS3
     *                             + AA2*DUMKM1*XZFS5 - C4*DUMI*XZFS2
     *                      + CC2*DUMI*DUMK2*XZFS4 - DUMKM1*DUMI*XZFS6
                  IMX=IMX+1
                  XXMXFF(JN,LN,IMX)=BC4*XXBC1 - B2DK*XXBC2 + DJDK*XXBC3
     *            - C2DJ*XXBC4
                  XYMXFF(JN,LN,IMX)=BC4*XYBC1 - B2DK*XYBC2 + DJDK*XYBC3
     *            - C2DJ*XYBC4
                  XZMXFF(JN,LN,IMX)=BC4*XZBC1 - B2DK*XZBC2 + DJDK*XZBC3
     *            - C2DJ*XZBC4
                  IFS=IFS+1
                  XXFSMX(JN,LN,IFS)= BBC8*XXSF11 - BC4*DUMJ2*XXSF31
     *                     + CC2*DUMJM1*XXSF21 - B4*DUMK*XXSF41
     *                 + BB2*DUMK*DUMJ2*XXSF61 - DUMJM1*DUMK*XXSF51
                  XYFSMX(JN,LN,IFS)= BBC8*XYSF11 - BC4*DUMJ2*XYSF31
     *                     + CC2*DUMJM1*XYSF21 - B4*DUMK*XYSF41
     *                 + BB2*DUMK*DUMJ2*XYSF61 - DUMJM1*DUMK*XYSF51
                  XZFSMX(JN,LN,IFS)= BBC8*XZSF11 - BC4*DUMJ2*XZSF31
     *                 + CC2*DUMJM1*XZSF21 - B4*DUMK*XZSF41
     *                 + BB2*DUMK*DUMJ2*XZSF61 - DUMJM1*DUMK*XZSF51
                  IFS=IFS+1
                  XXFSMX(JN,LN,IFS)= CCB8*XXFS11 - BC4*DUMK2*XXFS31
     *                 + BB2*DUMKM1*XXFS51 - C4*DUMJ*XXFS21
     *                 + CC2*DUMJ*DUMK2*XXFS41 - DUMKM1*DUMJ*XXFS61
                  XYFSMX(JN,LN,IFS)= CCB8*XYFS11 - BC4*DUMK2*XYFS31
     *                 + BB2*DUMKM1*XYFS51 - C4*DUMJ*XYFS21
     *                 + CC2*DUMJ*DUMK2*XYFS41 - DUMKM1*DUMJ*XYFS61
                  XZFSMX(JN,LN,IFS)= CCB8*XZFS11 - BC4*DUMK2*XZFS31
     *                 + BB2*DUMKM1*XZFS51 - C4*DUMJ*XZFS21
     *                 + CC2*DUMJ*DUMK2*XZFS41 - DUMKM1*DUMJ*XZFS61
C
                  XXFFF(JN,LN)=CC2*XXABC1 - DUMK*XXABC2
                  XYFFF(JN,LN)=CC2*XYABC1 - DUMK*XYABC2
                  XZFFF(JN,LN)=CC2*XZABC1 - DUMK*XZABC2
C
 6000         CONTINUE
 7000       CONTINUE
C::::::::::::::::::::::::
C:::END OF KNO AND LNO:::
C::::::::::::::::::::::::
C
 8000     CONTINUE
 9000   CONTINUE
C::::::::::::::::::::::::
C:::END OF INO AND JNO:::
C::::::::::::::::::::::::
C
C   ACTUALLY FORM THE INTEGRALS
C
        ICNT=0
        IJCNT=0
        IORBMX=IORB1 -1 + NUMI
        JORBMX=JORB1 -1 + NUMJ
C
C:::::::::::::::::::::::::::::
C:::LOOP OVER IORB AND JORB:::
C:::::::::::::::::::::::::::::
        DO 5000 IORB=IORB1,IORBMX
          IF(BOTH1) JORBMX=IORB
          DO 4000 JORB=JORB1,JORBMX
            IJORB=IOFF(MAX0(IORB,JORB)) + MIN0(IORB,JORB)
            IJCNT=IJCNT + 1
            JNX=IJX(IJCNT)
            JNY=IJY(IJCNT)
            JNZ=IJZ(IJCNT)
            KLCNT=0
            KORBMX=KORB1 -1 + NUMK
            LORBMX=LORB1 -1 + NUML
            IF(ISHELL .EQ. KSHELL) KORBMX=IORB
C:::::::::::::::::::::::::::::
C:::LOOP OVER KORB AND LORB:::
C:::::::::::::::::::::::::::::
            DO 3000 KORB=KORB1,KORBMX
              IF(BOTH2) LORBMX=KORB
              IF(ISHELL.EQ.KSHELL) THEN
C               IF(JSHELL .EQ. LSHELL) LORBMX=JORB
              END IF
              DO 2000 LORB=LORB1,LORBMX
                KLORB=IOFF(MAX0(KORB,LORB)) + MIN0(KORB,LORB)
                IJKL=IOFF(MAX0(IJORB,KLORB)) + MIN0(IJORB,KLORB)
C               KLCNT=KLCNT + 1
C               LNX=KLX(KLCNT)
C               LNY=KLY(KLCNT)
C               LNZ=KLZ(KLCNT)
                IF(KLORB .GT. IJORB) GO TO 3000
C
C   CALCULATE THE TYPE OF INTEGRAL WE ARE DEALING WITH
C
C               ITYPE=0
C               CALL INTYPE(IORB,JORB,KORB,LORB,ITYPE)
C
CCC             WRITE(6,*) ' 5000,4000,3000,2000,IORB,JORB,KORB,LORB'
CCC             WRITE(6,*)   IORB,JORB,KORB,LORB
C
                ICNT=ICNT + 1
                IF(ICNT .GT. IMEM4) WRITE(IOUT,*) ' ICNT = ',ICNT
                KLCNT=KLCNT + 1
                LNX=KLX(KLCNT)
                LNY=KLY(KLCNT)
                LNZ=KLZ(KLCNT)
C               G(ICNT)=G(ICNT) + XX0(JNX,LNX)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
C
C   CENTER 1 DERIVATIVES
C
                INT=0
                  INT=INT+1
C
C   FIRST DERIVATIVES
C
                  GMXFIR(ICNT,1,INT)= GMXFIR(ICNT,1,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,2,INT)= GMXFIR(ICNT,2,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,3,INT)= GMXFIR(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
C
C   SECOND DERIVATIVES
C
                  GMXSEC(ICNT,1,INT)= GMXSEC(ICNT,1,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,2,INT)= GMXSEC(ICNT,2,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,3,INT)= GMXSEC(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,4,INT)= GMXSEC(ICNT,4,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,5,INT)= GMXSEC(ICNT,5,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,6,INT)= GMXSEC(ICNT,6,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
C
C   THIRD DERIVATIVES
C
                  GMXTHR(ICNT,1,INT)=GMXTHR(ICNT,1,INT) +
     *            XXTHR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,2,INT)=GMXTHR(ICNT,2,INT) +
     *            XXSEC(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,3,INT)=GMXTHR(ICNT,3,INT) +
     *            XXFIR(JNX,LNX,INT)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,4,INT)=GMXTHR(ICNT,4,INT) +
     *            XX0(JNX,LNX)*XYTHR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,5,INT)=GMXTHR(ICNT,5,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,6,INT)=GMXTHR(ICNT,6,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,
     *            INT)
                  GMXTHR(ICNT,7,INT)=GMXTHR(ICNT,7,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,8,INT)=GMXTHR(ICNT,8,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,9,INT)=GMXTHR(ICNT,9,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,10,INT)=GMXTHR(ICNT,10,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZTHR(JNZ,LNZ,INT)
C
C   CENTER 2 DERIVATIVES
C
                  INT=INT+1
C
C   FIRST DERIVATIVES
C
                  GMXFIR(ICNT,1,INT)= GMXFIR(ICNT,1,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,2,INT)= GMXFIR(ICNT,2,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,3,INT)= GMXFIR(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
C
C   SECOND DERIVATIVES
C
                  GMXSEC(ICNT,1,INT)= GMXSEC(ICNT,1,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,2,INT)= GMXSEC(ICNT,2,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,3,INT)= GMXSEC(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,4,INT)= GMXSEC(ICNT,4,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,5,INT)= GMXSEC(ICNT,5,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,6,INT)= GMXSEC(ICNT,6,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
C
C   THIRD DERIVATIVES
C
                  GMXTHR(ICNT,1,INT)=GMXTHR(ICNT,1,INT) +
     *            XXTHR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,2,INT)=GMXTHR(ICNT,2,INT) +
     *            XXSEC(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,3,INT)=GMXTHR(ICNT,3,INT) +
     *            XXFIR(JNX,LNX,INT)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,4,INT)=GMXTHR(ICNT,4,INT) +
     *            XX0(JNX,LNX)*XYTHR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,5,INT)=GMXTHR(ICNT,5,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,6,INT)=GMXTHR(ICNT,6,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,
     *            INT)
                  GMXTHR(ICNT,7,INT)=GMXTHR(ICNT,7,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,8,INT)=GMXTHR(ICNT,8,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,9,INT)=GMXTHR(ICNT,9,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,10,INT)=GMXTHR(ICNT,10,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZTHR(JNZ,LNZ,INT)
C
C   CENTER 3 DERIVATIVES
C
                  INT=INT+1
C
C   FIRST DERIVATIVES
C
                  GMXFIR(ICNT,1,INT)= GMXFIR(ICNT,1,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,2,INT)= GMXFIR(ICNT,2,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,3,INT)= GMXFIR(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
C
C   SECOND DERIVATIVES
C
                  GMXSEC(ICNT,1,INT)= GMXSEC(ICNT,1,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,2,INT)= GMXSEC(ICNT,2,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,3,INT)= GMXSEC(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,4,INT)= GMXSEC(ICNT,4,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,5,INT)= GMXSEC(ICNT,5,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,6,INT)= GMXSEC(ICNT,6,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
C
C   THIRD DERIVATIVES
C
                  GMXTHR(ICNT,1,INT)=GMXTHR(ICNT,1,INT) +
     *            XXTHR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,2,INT)=GMXTHR(ICNT,2,INT) +
     *            XXSEC(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,3,INT)=GMXTHR(ICNT,3,INT) +
     *            XXFIR(JNX,LNX,INT)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,4,INT)=GMXTHR(ICNT,4,INT) +
     *            XX0(JNX,LNX)*XYTHR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,5,INT)=GMXTHR(ICNT,5,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,6,INT)=GMXTHR(ICNT,6,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,
     *            INT)
                  GMXTHR(ICNT,7,INT)=GMXTHR(ICNT,7,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,8,INT)=GMXTHR(ICNT,8,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,9,INT)=GMXTHR(ICNT,9,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,10,INT)=GMXTHR(ICNT,10,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZTHR(JNZ,LNZ,INT)
                IMX=0
                IFS=0
C
C   CENTER 1 AND CENTER 2 MIXED DERIVATIVES
C
C
C   SECOND DERIVATIVES
C
                  IMX=IMX + 1
                  GMXFF(ICNT,1,IMX)= GMXFF(ICNT,1,IMX) +
     *            XXMXFF(JNX,LNX,IMX)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,2,IMX)= GMXFF(ICNT,2,IMX) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,3,IMX)= GMXFF(ICNT,3,IMX) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFF(ICNT,4,IMX)= GMXFF(ICNT,4,IMX) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,5,IMX)= GMXFF(ICNT,5,IMX) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,IMX)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,6,IMX)= GMXFF(ICNT,6,IMX) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFF(ICNT,7,IMX)= GMXFF(ICNT,7,IMX) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFF(ICNT,8,IMX)= GMXFF(ICNT,8,IMX) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFF(ICNT,9,IMX)= GMXFF(ICNT,9,IMX) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,IMX)
C
C   THIRD DERIVATIVES
C
                  IFS=IFS+1
                  GMXFS(ICNT,1,IFS)= GMXFS(ICNT,1,IFS) +
     *            XXFSMX(JNX,LNX,1)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,2,IFS)= GMXFS(ICNT,2,IFS) +
     *            XXSEC(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,3,IFS)= GMXFS(ICNT,3,IFS) +
     *            XXSEC(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,4,IFS)= GMXFS(ICNT,4,IFS) +
     *            XXMXFF(JNX,LNX,1)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,5,IFS)= GMXFS(ICNT,5,IFS) +
     *            XXFIR(JNX,LNX,1)*XYMXFF(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,6,IFS)= GMXFS(ICNT,6,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,7,IFS)= GMXFS(ICNT,7,IFS) +
     *            XXMXFF(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,8,IFS)= GMXFS(ICNT,8,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,9,IFS)= GMXFS(ICNT,9,IFS) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,10,IFS)= GMXFS(ICNT,10,IFS) +
     *            XXFIR(JNX,LNX,2)*XYSEC(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,11,IFS)= GMXFS(ICNT,11,IFS) +
     *            XX0(JNX,LNX)*XYFSMX(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,12,IFS)= GMXFS(ICNT,12,IFS) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,13,IFS)= GMXFS(ICNT,13,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,14,IFS)= GMXFS(ICNT,14,IFS) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,1)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,15,IFS)= GMXFS(ICNT,15,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,16,IFS)= GMXFS(ICNT,16,IFS) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,1)
                  GMXFS(ICNT,17,IFS)= GMXFS(ICNT,17,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZSEC(JNZ,LNZ,1)
                  GMXFS(ICNT,18,IFS)= GMXFS(ICNT,18,IFS) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFSMX(JNZ,LNZ,1)
C
                  IFS=IFS+1
                  GMXFS(ICNT,1,IFS)= GMXFS(ICNT,1,IFS) +
     *            XXFSMX(JNX,LNX,2)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,2,IFS)= GMXFS(ICNT,2,IFS) +
     *            XXSEC(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,3,IFS)= GMXFS(ICNT,3,IFS) +
     *            XXSEC(JNX,LNX,2)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,4,IFS)= GMXFS(ICNT,4,IFS) +
     *            XXMXFF(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,5,IFS)= GMXFS(ICNT,5,IFS) +
     *            XXFIR(JNX,LNX,2)*XYMXFF(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,6,IFS)= GMXFS(ICNT,6,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,7,IFS)= GMXFS(ICNT,7,IFS) +
     *            XXMXFF(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,8,IFS)= GMXFS(ICNT,8,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,9,IFS)= GMXFS(ICNT,9,IFS) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,10,IFS)= GMXFS(ICNT,10,IFS) +
     *            XXFIR(JNX,LNX,1)*XYSEC(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,11,IFS)= GMXFS(ICNT,11,IFS) +
     *            XX0(JNX,LNX)*XYFSMX(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,12,IFS)= GMXFS(ICNT,12,IFS) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,13,IFS)= GMXFS(ICNT,13,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,14,IFS)= GMXFS(ICNT,14,IFS) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,15,IFS)= GMXFS(ICNT,15,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,16,IFS)= GMXFS(ICNT,16,IFS) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,2)
                  GMXFS(ICNT,17,IFS)= GMXFS(ICNT,17,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZSEC(JNZ,LNZ,2)
                  GMXFS(ICNT,18,IFS)= GMXFS(ICNT,18,IFS) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFSMX(JNZ,LNZ,2)
C
C   CENTER 1 AND CENTER 3 MIXED DERIVATIVES
C
C
C   SECOND DERIVATIVES
C
                  IMX=IMX + 1
                  KKPOS=2
                  KKPOS=3
                  GMXFF(ICNT,1,IMX)= GMXFF(ICNT,1,IMX) +
     *            XXMXFF(JNX,LNX,IMX)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,2,IMX)= GMXFF(ICNT,2,IMX) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,KKPOS)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,3,IMX)= GMXFF(ICNT,3,IMX) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,KKPOS)
                  GMXFF(ICNT,4,IMX)= GMXFF(ICNT,4,IMX) +
     *            XXFIR(JNX,LNX,KKPOS)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,5,IMX)= GMXFF(ICNT,5,IMX) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,IMX)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,6,IMX)= GMXFF(ICNT,6,IMX) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,KKPOS)
                  GMXFF(ICNT,7,IMX)= GMXFF(ICNT,7,IMX) +
     *            XXFIR(JNX,LNX,KKPOS)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFF(ICNT,8,IMX)= GMXFF(ICNT,8,IMX) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,KKPOS)*XZFIR(JNZ,LNZ,1)
                  GMXFF(ICNT,9,IMX)= GMXFF(ICNT,9,IMX) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,IMX)
C
C   THIRD DERIVATIVES
C
                  IFS=IFS+1
                  GMXFS(ICNT,1,IFS)= GMXFS(ICNT,1,IFS) +
     *            XXFSMX(JNX,LNX,IFS)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,2,IFS)= GMXFS(ICNT,2,IFS) +
     *            XXSEC(JNX,LNX,1)*XYFIR(JNY,LNY,KKPOS)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,3,IFS)= GMXFS(ICNT,3,IFS) +
     *            XXSEC(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,KKPOS)
                  GMXFS(ICNT,4,IFS)= GMXFS(ICNT,4,IFS) +
     *            XXMXFF(JNX,LNX,IMX)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,5,IFS)= GMXFS(ICNT,5,IFS) +
     *            XXFIR(JNX,LNX,1)*XYMXFF(JNY,LNY,IMX)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,6,IFS)= GMXFS(ICNT,6,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,KKPOS)
                  GMXFS(ICNT,7,IFS)= GMXFS(ICNT,7,IFS) +
     *            XXMXFF(JNX,LNX,IMX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,8,IFS)= GMXFS(ICNT,8,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,KKPOS)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,9,IFS)= GMXFS(ICNT,9,IFS) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,IMX)
                  GMXFS(ICNT,10,IFS)= GMXFS(ICNT,10,IFS) +
     *            XXFIR(JNX,LNX,KKPOS)*XYSEC(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,11,IFS)= GMXFS(ICNT,11,IFS) +
     *            XX0(JNX,LNX)*XYFSMX(JNY,LNY,IFS)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,12,IFS)= GMXFS(ICNT,12,IFS) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,1)*XZFIR(JNZ,LNZ,KKPOS)
                  GMXFS(ICNT,13,IFS)= GMXFS(ICNT,13,IFS) +
     *            XXFIR(JNX,LNX,KKPOS)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,14,IFS)= GMXFS(ICNT,14,IFS) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,IMX)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,15,IFS)= GMXFS(ICNT,15,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZMXFF(JNZ,LNZ,IMX)
                  GMXFS(ICNT,16,IFS)= GMXFS(ICNT,16,IFS) +
     *            XXFIR(JNX,LNX,KKPOS)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,1)
                  GMXFS(ICNT,17,IFS)= GMXFS(ICNT,17,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,KKPOS)*XZSEC(JNZ,LNZ,1)
                  GMXFS(ICNT,18,IFS)= GMXFS(ICNT,18,IFS) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFSMX(JNZ,LNZ,IFS)
C
                  IFS=IFS+1
                  GMXFS(ICNT,1,IFS)= GMXFS(ICNT,1,IFS) +
     *            XXFSMX(JNX,LNX,IFS)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,2,IFS)= GMXFS(ICNT,2,IFS) +
     *            XXSEC(JNX,LNX,KKPOS)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,3,IFS)= GMXFS(ICNT,3,IFS) +
     *            XXSEC(JNX,LNX,KKPOS)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,4,IFS)= GMXFS(ICNT,4,IFS) +
     *            XXMXFF(JNX,LNX,IMX)*XYFIR(JNY,LNY,KKPOS)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,5,IFS)= GMXFS(ICNT,5,IFS) +
     *            XXFIR(JNX,LNX,KKPOS)*XYMXFF(JNY,LNY,IMX)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,6,IFS)= GMXFS(ICNT,6,IFS) +
     *            XXFIR(JNX,LNX,KKPOS)*XYFIR(JNY,LNY,KKPOS)*XZFIR(JNZ,
     *            LNZ,1)
                  GMXFS(ICNT,7,IFS)= GMXFS(ICNT,7,IFS) +
     *            XXMXFF(JNX,LNX,IMX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,KKPOS)
                  GMXFS(ICNT,8,IFS)= GMXFS(ICNT,8,IFS) +
     *            XXFIR(JNX,LNX,KKPOS)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,
     *            KKPOS)
                  GMXFS(ICNT,9,IFS)= GMXFS(ICNT,9,IFS) +
     *            XXFIR(JNX,LNX,KKPOS)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,IMX)
                  GMXFS(ICNT,10,IFS)= GMXFS(ICNT,10,IFS) +
     *            XXFIR(JNX,LNX,1)*XYSEC(JNY,LNY,KKPOS)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,11,IFS)= GMXFS(ICNT,11,IFS) +
     *            XX0(JNX,LNX)*XYFSMX(JNY,LNY,IFS)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,12,IFS)= GMXFS(ICNT,12,IFS) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,KKPOS)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,13,IFS)= GMXFS(ICNT,13,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,KKPOS)*XZFIR(JNZ,LNZ,
     *            KKPOS)
                  GMXFS(ICNT,14,IFS)= GMXFS(ICNT,14,IFS) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,IMX)*XZFIR(JNZ,LNZ,KKPOS)
                  GMXFS(ICNT,15,IFS)= GMXFS(ICNT,15,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,KKPOS)*XZMXFF(JNZ,LNZ,IMX)
                  GMXFS(ICNT,16,IFS)= GMXFS(ICNT,16,IFS) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,KKPOS)
                  GMXFS(ICNT,17,IFS)= GMXFS(ICNT,17,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZSEC(JNZ,LNZ,KKPOS)
                  GMXFS(ICNT,18,IFS)= GMXFS(ICNT,18,IFS) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFSMX(JNZ,LNZ,IFS)
C
C   CENTER 2 AND CENTER 3 MIXED DERIVATIVES
C
C
C   SECOND DERIVATIVES
C
                  IMX=IMX + 1
                  GMXFF(ICNT,1,IMX)= GMXFF(ICNT,1,IMX) +
     *            XXMXFF(JNX,LNX,IMX)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,2,IMX)= GMXFF(ICNT,2,IMX) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,3)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,3,IMX)= GMXFF(ICNT,3,IMX) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,3)
                  GMXFF(ICNT,4,IMX)= GMXFF(ICNT,4,IMX) +
     *            XXFIR(JNX,LNX,3)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,5,IMX)= GMXFF(ICNT,5,IMX) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,IMX)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,6,IMX)= GMXFF(ICNT,6,IMX) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,3)
                  GMXFF(ICNT,7,IMX)= GMXFF(ICNT,7,IMX) +
     *            XXFIR(JNX,LNX,3)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFF(ICNT,8,IMX)= GMXFF(ICNT,8,IMX) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,3)*XZFIR(JNZ,LNZ,2)
                  GMXFF(ICNT,9,IMX)= GMXFF(ICNT,9,IMX) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,IMX)
C
C   THIRD DERIVATIVES
C
                  IFS=IFS+1
                  GMXFS(ICNT,1,IFS)= GMXFS(ICNT,1,IFS) +
     *            XXFSMX(JNX,LNX,IFS)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,2,IFS)= GMXFS(ICNT,2,IFS) +
     *            XXSEC(JNX,LNX,2)*XYFIR(JNY,LNY,3)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,3,IFS)= GMXFS(ICNT,3,IFS) +
     *            XXSEC(JNX,LNX,2)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,3)
                  GMXFS(ICNT,4,IFS)= GMXFS(ICNT,4,IFS) +
     *            XXMXFF(JNX,LNX,IMX)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,5,IFS)= GMXFS(ICNT,5,IFS) +
     *            XXFIR(JNX,LNX,2)*XYMXFF(JNY,LNY,3)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,6,IFS)= GMXFS(ICNT,6,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,3)
                  GMXFS(ICNT,7,IFS)= GMXFS(ICNT,7,IFS) +
     *            XXMXFF(JNX,LNX,IMX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,8,IFS)= GMXFS(ICNT,8,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,3)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,9,IFS)= GMXFS(ICNT,9,IFS) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,IMX)
                  GMXFS(ICNT,10,IFS)= GMXFS(ICNT,10,IFS) +
     *            XXFIR(JNX,LNX,3)*XYSEC(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,11,IFS)= GMXFS(ICNT,11,IFS) +
     *            XX0(JNX,LNX)*XYFSMX(JNY,LNY,IFS)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,12,IFS)= GMXFS(ICNT,12,IFS) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,2)*XZFIR(JNZ,LNZ,3)
                  GMXFS(ICNT,13,IFS)= GMXFS(ICNT,13,IFS) +
     *            XXFIR(JNX,LNX,3)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,14,IFS)= GMXFS(ICNT,14,IFS) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,IMX)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,15,IFS)= GMXFS(ICNT,15,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZMXFF(JNZ,LNZ,IMX)
                  GMXFS(ICNT,16,IFS)= GMXFS(ICNT,16,IFS) +
     *            XXFIR(JNX,LNX,3)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,2)
                  GMXFS(ICNT,17,IFS)= GMXFS(ICNT,17,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,3)*XZSEC(JNZ,LNZ,2)
                  GMXFS(ICNT,18,IFS)= GMXFS(ICNT,18,IFS) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFSMX(JNZ,LNZ,IFS)
C
                  IFS=IFS+1
                  GMXFS(ICNT,1,IFS)= GMXFS(ICNT,1,IFS) +
     *            XXFSMX(JNX,LNX,IFS)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,2,IFS)= GMXFS(ICNT,2,IFS) +
     *            XXSEC(JNX,LNX,3)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,3,IFS)= GMXFS(ICNT,3,IFS) +
     *            XXSEC(JNX,LNX,3)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,4,IFS)= GMXFS(ICNT,4,IFS) +
     *            XXMXFF(JNX,LNX,IMX)*XYFIR(JNY,LNY,3)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,5,IFS)= GMXFS(ICNT,5,IFS) +
     *            XXFIR(JNX,LNX,3)*XYMXFF(JNY,LNY,IMX)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,6,IFS)= GMXFS(ICNT,6,IFS) +
     *            XXFIR(JNX,LNX,3)*XYFIR(JNY,LNY,3)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,7,IFS)= GMXFS(ICNT,7,IFS) +
     *            XXMXFF(JNX,LNX,IMX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,3)
                  GMXFS(ICNT,8,IFS)= GMXFS(ICNT,8,IFS) +
     *            XXFIR(JNX,LNX,3)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,3)
                  GMXFS(ICNT,9,IFS)= GMXFS(ICNT,9,IFS) +
     *            XXFIR(JNX,LNX,3)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,IMX)
                  GMXFS(ICNT,10,IFS)= GMXFS(ICNT,10,IFS) +
     *            XXFIR(JNX,LNX,2)*XYSEC(JNY,LNY,3)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,11,IFS)= GMXFS(ICNT,11,IFS) +
     *            XX0(JNX,LNX)*XYFSMX(JNY,LNY,IFS)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,12,IFS)= GMXFS(ICNT,12,IFS) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,3)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,13,IFS)= GMXFS(ICNT,13,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,3)*XZFIR(JNZ,LNZ,3)
                  GMXFS(ICNT,14,IFS)= GMXFS(ICNT,14,IFS) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,IMX)*XZFIR(JNZ,LNZ,3)
                  GMXFS(ICNT,15,IFS)= GMXFS(ICNT,15,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,3)*XZMXFF(JNZ,LNZ,IMX)
                  GMXFS(ICNT,16,IFS)= GMXFS(ICNT,16,IFS) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,3)
                  GMXFS(ICNT,17,IFS)= GMXFS(ICNT,17,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZSEC(JNZ,LNZ,3)
                  GMXFS(ICNT,18,IFS)= GMXFS(ICNT,18,IFS) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFSMX(JNZ,LNZ,IFS)
C
C
C   THIRD DERIVATIVES
C
                  GMXFFF(ICNT,1)= GMXFFF(ICNT,1) +
     *            XXFFF(JNX,LNX)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFFF(ICNT,2)= GMXFFF(ICNT,2) +
     *            XXMXFF(JNX,LNX,1)*XYFIR(JNY,LNY,3)*XZ0(JNZ,LNZ)
                  GMXFFF(ICNT,3)= GMXFFF(ICNT,3) +
     *            XXMXFF(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,3)
                  GMXFFF(ICNT,4)= GMXFFF(ICNT,4) +
     *            XXMXFF(JNX,LNX,2)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFFF(ICNT,5)= GMXFFF(ICNT,5) +
     *            XXFIR(JNX,LNX,1)*XYMXFF(JNY,LNY,3)*XZ0(JNZ,LNZ)
                  GMXFFF(ICNT,6)= GMXFFF(ICNT,6) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,3)
                  GMXFFF(ICNT,7)= GMXFFF(ICNT,7) +
     *            XXMXFF(JNX,LNX,2)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFFF(ICNT,8)= GMXFFF(ICNT,8) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,3)*XZFIR(JNZ,LNZ,2)
                  GMXFFF(ICNT,9)= GMXFFF(ICNT,9) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,3)
                  GMXFFF(ICNT,10)= GMXFFF(ICNT,10) +
     *            XXMXFF(JNX,LNX,3)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFFF(ICNT,11)= GMXFFF(ICNT,11) +
     *            XXFIR(JNX,LNX,2)*XYMXFF(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFFF(ICNT,12)= GMXFFF(ICNT,12) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,3)
                  GMXFFF(ICNT,13)= GMXFFF(ICNT,13) +
     *            XXFIR(JNX,LNX,3)*XYMXFF(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFFF(ICNT,14)= GMXFFF(ICNT,14) +
     *            XX0(JNX,LNX)*XYFFF(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFFF(ICNT,15)= GMXFFF(ICNT,15) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,1)*XZFIR(JNZ,LNZ,3)
                  GMXFFF(ICNT,16)= GMXFFF(ICNT,16) +
     *            XXFIR(JNX,LNX,3)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFFF(ICNT,17)= GMXFFF(ICNT,17) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,2)*XZFIR(JNZ,LNZ,2)
                  GMXFFF(ICNT,18)= GMXFFF(ICNT,18) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZMXFF(JNZ,LNZ,3)
                  GMXFFF(ICNT,19)= GMXFFF(ICNT,19) +
     *            XXMXFF(JNX,LNX,3)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFFF(ICNT,20)= GMXFFF(ICNT,20) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,3)*XZFIR(JNZ,LNZ,1)
                  GMXFFF(ICNT,21)= GMXFFF(ICNT,21) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,2)
                  GMXFFF(ICNT,22)= GMXFFF(ICNT,22) +
     *            XXFIR(JNX,LNX,3)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFFF(ICNT,23)= GMXFFF(ICNT,23) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,3)*XZFIR(JNZ,LNZ,1)
                  GMXFFF(ICNT,24)= GMXFFF(ICNT,24) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZMXFF(JNZ,LNZ,2)
                  GMXFFF(ICNT,25)= GMXFFF(ICNT,25) +
     *            XXFIR(JNX,LNX,3)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,1)
                  GMXFFF(ICNT,26)= GMXFFF(ICNT,26) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,3)*XZMXFF(JNZ,LNZ,1)
                  GMXFFF(ICNT,27)= GMXFFF(ICNT,27) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFFF(JNZ,LNZ)
 2000         CONTINUE
 3000       CONTINUE
C::::::::::::::::::::::::::
C:::END OF KORB AND LORB:::
C::::::::::::::::::::::::::
 4000     CONTINUE
 5000   CONTINUE
C::::::::::::::::::::::::::
C:::END OF IORB AND JORB:::
C::::::::::::::::::::::::::
C
10000 CONTINUE
C
      IGCNT=ICNT
CCC   WRITE(6,*) ' NOW YOU ARE END OF DER123, IGCNT = ',IGCNT
C
      RETURN
      END
C**********************************************************************
C   THIRD DERIVATIVE PROGRAM PART 4 : "CENT3A"                        *
C**********************************************************************
C
C**********************************************************************
C*   NOTICE OF PROGRAM MODIFICATION                                   *
C**********************************************************************
C*  BY:  RICHARD REMINGTON                         search:  c7-14-88  *
C*  DATE:  July  14,   1988                                           *
C*  REASON: Migration to run in 7Mb on 9370                           *
C**********************************************************************
C                                                                     *
C   LAST UPDATED ON NOVEMBER 26, 1985 BY YUKIO YAMAGUCHI              *
C                                                                     *
C######################################################################
C                                                                     *
C   CENTER 1 AND 2  DERIVATIVES ARE CALCULATED                        *
C                                                                     *
C######################################################################
      SUBROUTINE CENT12(GT,GU,GV,XX0,XY0,XZ0,XXFIR,XYFIR,XZFIR
     *,                 XXSEC,XYSEC,XZSEC,XXMXFF,XYMXFF,XZMXFF,GMXFIR
     *,                 GMXSEC,GMXFF,LO,XXTHR,XYTHR,XZTHR
     *,                 XXFFF,XYFFF,XZFFF,XXFSMX,XYFSMX,XZFSMX,GMXTHR
     *,                 GMXFFF,GMXFS)
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER GSPOT
      LOGICAL BOTH1,BOTH2,DO1,DO2,DO6
      LOGICAL EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      DIMENSION YX(8,14),YY(8,14),YZ(8,14)
      DIMENSION GT(I4LARL,I2LARL),GU(I4LARL,I2LARL)
      DIMENSION GV(I4LARL,I2LARL)
      DIMENSION ITEST(10)
      DIMENSION YYX(8,18),YYY(8,18),YYZ(8,18)
      DIMENSION XX0(IANGSQ,IANGSQ),XY0(IANGSQ,IANGSQ),XZ0(IANGSQ,IANGSQ)
      DIMENSION XXFIR(IANGSQ,IANGSQ,3),XYFIR(IANGSQ,IANGSQ,3)
      DIMENSION XZFIR(IANGSQ,IANGSQ,3),XXSEC(IANGSQ,IANGSQ,3)
      DIMENSION XYSEC(IANGSQ,IANGSQ,3),XZSEC(IANGSQ,IANGSQ,3)
      DIMENSION XXMXFF(IANGSQ,IANGSQ,3),XYMXFF(IANGSQ,IANGSQ,3)
      DIMENSION XZMXFF(IANGSQ,IANGSQ,3),GMXFIR(IMEM4,3,3)
      DIMENSION GMXSEC(IMEM4,6,3),GMXFF(IMEM4,9,3)
      DIMENSION LO(IMEM4*5)
      DIMENSION XXTHR(IANGSQ,IANGSQ,3),XYTHR(IANGSQ,IANGSQ,3)
     *,         XZTHR(IANGSQ,IANGSQ,3),XXFFF(IANGSQ,IANGSQ)
     *,         XYFFF(IANGSQ,IANGSQ),XZFFF(IANGSQ,IANGSQ)
      DIMENSION XXFSMX(IANGSQ,IANGSQ,6),XYFSMX(IANGSQ,IANGSQ,6)
     *,         XZFSMX(IANGSQ,IANGSQ,6)
      DIMENSION GMXTHR(IMEM4,10,3),GMXFFF(IMEM4,27),GMXFS(IMEM4,18,6)
      COMMON/CALQN/ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET
      COMMON/EINFO/IPLACE(49),ISAME(49)
      COMMON/EXYZS/EX(686),EY(686),EZ(686)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/IPAR5/IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL
      COMMON/LOGIC/EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      COMMON/ORBIN/IORB1,JORB1,KORB1,LORB1,NUMI,NUMJ,NUMK,NUML
      COMMON/PASS /II,JJ,KK,LL
      COMMON/POSNS/IJX(50),IJY(50),IJZ(50),KLX(50),KLY(50),KLZ(50)
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/TWINF/ISHELL,JSHELL,KSHELL,LSHELL
C
      ISIZ=   7
      ISIZ2= 14
      ISIZ3= 21
      IESZ=343
C
      RETURN
C
      ENTRY DER12(BOTH1,BOTH2,IQN,JQN,KQN,LQN,IGCNT,NROOT0,AA,BB,CC,DD,
     *ITEST)
C
      AA2=AA + AA
      BB2=BB + BB
      A4=AA2 * AA2
      B4=BB2 * BB2
      A8=A4 * AA2
      B8=B4 * BB2
      AB4=AA2*BB2
      AAB8=AB4 * AA2
      BBA8=AB4 * BB2
C
      DO1=ITEST(1).EQ.1
      DO2=ITEST(2).EQ.1
      DO6=ITEST(6).EQ.1
C
      NROOT=NROOT0 + NDERIV
      KLQN=KQN+LQN -1
      MAX=KLQN + IQN + JQN -1
C
      DO 10000 IROOT=1,NROOT
C
        IN=-IANG
        IM=-ISIZ
C
        DO 9000 INO=1,IQN
C
          IN=IN + IANG
          IM=IM + ISIZ
C
          DUMI=DBLE(INO-1)
          DUMIM1=DBLE((INO-1)*(INO-2))
          DUMI2=DBLE(2*INO -1)
          A2DI=AA2*DUMI2
          A12DI=3.0D0*A4*DBLE(INO)
          A6DI=3.0D0*AA2*DUMI*DUMI
C
          DO 8000 JNO=1,JQN
C
            JN=JNO + IN
            JM=JNO + IM
C
            DUMJ=DBLE(JNO-1)
            DUMJM1=DBLE((JNO-1)*(JNO-2))
            DUMJ2=DBLE(2*JNO -1)
            B2DJ=BB2*DUMJ2
            B2DI=BB2*DUMI
            A2DJ=AA2*DUMJ
            B12DJ=3.0D0*B4*DBLE(JNO)
            B6DJ=3.0D0*BB2*DUMJ*DUMJ
            DIDJ=DUMI*DUMJ
C
            IPL=IPLACE(JM)
            ITWO=2
            IF(ISAME(JM) .EQ. 1) ITWO=1
C
            IF(DO2) THEN
              JP0P1=JM + 1
              IP0P1=IPLACE(JP0P1)
              I2P0P1=2
              IF(ISAME(JP0P1) .EQ. 1) I2P0P1=1
              JP0P2=JM + 2
              IP0P2=IPLACE(JP0P2)
              I2P0P2=2
              IF(ISAME(JP0P2) .EQ. 1) I2P0P2=1
              JP0P3=JM + 3
              IP0P3=IPLACE(JP0P3)
              I2P0P3=2
              IF(ISAME(JP0P3) .EQ. 1) I2P0P3=1
              IF(JNO .GT. 1) THEN
                JM0M1=JM-1
                IM0M1=IPLACE(JM0M1)
                I2M0M1=2
                IF(ISAME(JM0M1) .EQ. 1) I2M0M1=1
                IF(JNO .GT. 2) THEN
                  JM0M2=JM - 2
                  IM0M2=IPLACE(JM0M2)
                  I2M0M2=2
                  IF(ISAME(JM0M2) .EQ. 1) I2M0M2=1
                END IF
              END IF
            END IF
C
            IF(DO1) THEN
              JP1P0=JM + ISIZ
              IP1P0=IPLACE(JP1P0)
              I2P1P0=2
              IF(ISAME(JP1P0) .EQ. 1) I2P1P0=1
              JP2P0=JM + ISIZ2
              IP2P0=IPLACE(JP2P0)
              I2P2P0=2
              IF(ISAME(JP2P0) .EQ. 1) I2P2P0=1
              JP3P0=JM + ISIZ3
              IP3P0=IPLACE(JP3P0)
              I2P3P0=2
              IF(ISAME(JP3P0) .EQ. 1) I2P3P0=1
              IF(INO .GT. 1) THEN
                JM1M0=JM - ISIZ
                IM1M0=IPLACE(JM1M0)
                I2M1M0=2
                IF(ISAME(JM1M0) .EQ. 1) I2M1M0=1
                IF(INO .GT. 2) THEN
                  JM2M0=JM -ISIZ2
                  IM2M0=IPLACE(JM2M0)
                  I2M2M0=2
                  IF(ISAME(JM2M0) .EQ. 1) I2M2M0=1
                END IF
              END IF
            END IF
C
            IF(DO6) THEN
              JP1P1=JM + ISIZ + 1
              IP1P1=IPLACE(JP1P1)
              I2P1P1=2
              IF(ISAME(JP1P1) .EQ. 1) I2P1P1=1
              JP2P1=JM + ISIZ2 + 1
              IP2P1=IPLACE(JP2P1)
              I2P2P1=2
              IF(ISAME(JP2P1) .EQ. 1) I2P2P1=1
              JP1P2=JM + ISIZ + 2
              IP1P2=IPLACE(JP1P2)
              I2P1P2=2
              IF(ISAME(JP1P2) .EQ. 1) I2P1P2=1
              IF(INO .GT. 1) THEN
                JM1P1=JM - ISIZ + 1
                IM1P1=IPLACE(JM1P1)
                I2M1P1=2
                IF(ISAME(JM1P1) .EQ. 1) I2M1P1=1
                JM1P2=JM - ISIZ + 2
                IM1P2=IPLACE(JM1P2)
                I2M1P2=2
                IF(ISAME(JM1P2) .EQ. 1) I2M1P2=1
                IF(JNO .GT. 1) THEN
                  JM1M1=JM - ISIZ - 1
                  IM1M1=IPLACE(JM1M1)
                  I2M1M1=2
                  IF(ISAME(JM1M1) .EQ. 1) I2M1M1=1
                  IF(JNO .GT. 2) THEN
                    JM1M2=JM - ISIZ - 2
                    IM1M2=IPLACE(JM1M2)
                    I2M1M2=2
                    IF(ISAME(JM1M2) .EQ. 1) I2M1M2=1
                  END IF
                END IF
                IF(INO .GT. 2) THEN
                  JM2P1=JM - ISIZ2 + 1
                  IM2P1=IPLACE(JM2P1)
                  I2M2P1=2
                  IF(ISAME(JM2P1) .EQ. 1) I2M2P1=1
                END IF
              END IF
              IF(JNO .GT. 1) THEN
                JP1M1=JM + ISIZ - 1
                IP1M1=IPLACE(JP1M1)
                I2P1M1=2
                IF(ISAME(JP1M1) .EQ. 1) I2P1M1=1
                JP2M1=JM + ISIZ2 - 1
                IP2M1=IPLACE(JP2M1)
                I2P2M1=2
                IF(ISAME(JP2M1) .EQ. 1) I2P2M1=1
                IF(INO .GT. 2) THEN
                  JM2M1=JM - ISIZ2 - 1
                  IM2M1=IPLACE(JM2M1)
                  I2M2M1=2
                  IF(ISAME(JM2M1) .EQ. 1) I2M2M1=1
                END IF
                IF(JNO .GT. 2) THEN
                  JP1M2=JM + ISIZ - 2
                  IP1M2=IPLACE(JP1M2)
                  I2P1M2=2
                  IF(ISAME(JP1M2) .EQ. 1) I2P1M2=1
                END IF
              END IF
            END IF
C
            IT=INO + JNO - 1
            ITM1=IT-1
            ITM2=IT-2
            ITM3=IT-3
            ITFIR=IT + 1
            ITSEC=IT + 2
            ITTHR=IT + 3
C
C   ZEROTH ORDER SECTION
C
            DO 150 IKL=1,KLQN
              YX0=0.0D0
              YY0=0.0D0
              YZ0=0.0D0
              DO 100 IJ=1,IT
                IJM1=IJ-1
                ISPOT=IPL + IJM1*ITWO
                GSPOT=IKL + IJ -1
                YX0=YX0 + EX(ISPOT)*GT(GSPOT,IROOT)
                YY0=YY0 + EY(ISPOT)*GU(GSPOT,IROOT)
                YZ0=YZ0 + EZ(ISPOT)*GV(GSPOT,IROOT)
  100         CONTINUE
C
              YX(IKL,1)=YX0
              YY(IKL,1)=YY0
              YZ(IKL,1)=YZ0
C
  150       CONTINUE
C
            DO 300 IKL=1,KLQN
              YX0=YX(IKL,1)
              YY0=YY(IKL,1)
              YZ0=YZ(IKL,1)
              IF(DO1) THEN
                YXA1=0.0D0
                YYA1=0.0D0
                YZA1=0.0D0
                YXA2=0.0D0
                YYA2=0.0D0
                YZA2=0.0D0
                YX2A1=0.0D0
                YY2A1=0.0D0
                YZ2A1=0.0D0
                YX2A2=0.0D0
                YY2A2=0.0D0
                YZ2A2=0.0D0
                YX3A1=0.0D0
                YY3A1=0.0D0
                YZ3A1=0.0D0
              END IF
              IF(DO2) THEN
                YXB1=0.0D0
                YYB1=0.0D0
                YZB1=0.0D0
                YXB2=0.0D0
                YYB2=0.0D0
                YZB2=0.0D0
                YX2B1=0.0D0
                YY2B1=0.0D0
                YZ2B1=0.0D0
                YX2B2=0.0D0
                YY2B2=0.0D0
                YZ2B2=0.0D0
                YX3B1=0.0D0
                YY3B1=0.0D0
                YZ3B1=0.0D0
              END IF
              IF(DO6) THEN
                YXAB1=0.0D0
                YXAB2=0.0D0
                YXAB3=0.0D0
                YXAB4=0.0D0
                YYAB1=0.0D0
                YYAB2=0.0D0
                YYAB3=0.0D0
                YYAB4=0.0D0
                YZAB1=0.0D0
                YZAB2=0.0D0
                YZAB3=0.0D0
                YZAB4=0.0D0
                YXSF1=0.0D0
                YYSF1=0.0D0
                YZSF1=0.0D0
                YXSF2=0.0D0
                YYSF2=0.0D0
                YZSF2=0.0D0
                YXSF3=0.0D0
                YYSF3=0.0D0
                YZSF3=0.0D0
                YXSF4=0.0D0
                YYSF4=0.0D0
                YZSF4=0.0D0
                YXFS1=0.0D0
                YYFS1=0.0D0
                YZFS1=0.0D0
                YXFS2=0.0D0
                YYFS2=0.0D0
                YZFS2=0.0D0
                YXFS3=0.0D0
                YYFS3=0.0D0
                YZFS3=0.0D0
                YXFS4=0.0D0
                YYFS4=0.0D0
                YZFS4=0.0D0
              END IF
              DO 200 IJ=1,ITTHR
                IJM1=IJ-1
                GSPOT=IKL + IJM1
C
C   FIRST DERIVATIVE SECTION
C
                IF(IJ .GT. ITFIR) GO TO 160
                IF(DO2) THEN
                  ISPOT=IP0P1 +  IJM1*I2P0P1
                  YXB1=YXB1 + EX(ISPOT)*GT(GSPOT,IROOT)
                  YYB1=YYB1 + EY(ISPOT)*GU(GSPOT,IROOT)
                  YZB1=YZB1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                  IF(JNO .GT. 1) THEN
                    IF(IJ .LE. ITM1) THEN
                      ISPOT=IM0M1 + IJM1*I2M0M1
                      YXB2=YXB2 + EX(ISPOT)*GT(GSPOT,IROOT)
                      YYB2=YYB2 + EY(ISPOT)*GU(GSPOT,IROOT)
                      YZB2=YZB2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                    END IF
                  END IF
                END IF
C
                IF(DO1) THEN
                  ISPOT=IP1P0 + IJM1*I2P1P0
                  YXA1=YXA1 + EX(ISPOT)*GT(GSPOT,IROOT)
                  YYA1=YYA1 + EY(ISPOT)*GU(GSPOT,IROOT)
                  YZA1=YZA1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                  IF(INO .GT. 1) THEN
                    IF(IJ .LE. ITM1) THEN
                      ISPOT=IM1M0 + IJM1*I2M1M0
                      YXA2=YXA2 + EX(ISPOT)*GT(GSPOT,IROOT)
                      YYA2=YYA2 + EY(ISPOT)*GU(GSPOT,IROOT)
                      YZA2=YZA2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                    END IF
                  END IF
                END IF
  160           CONTINUE
C
C   SECOND DERIVATIVE SECTION
C
                IF(IJ .GT. ITSEC) GO TO 170
                IF(DO1) THEN
                  ISPOT=IP2P0 + IJM1*I2P2P0
                  YX2A1=YX2A1 + EX(ISPOT)*GT(GSPOT,IROOT)
                  YY2A1=YY2A1 + EY(ISPOT)*GU(GSPOT,IROOT)
                  YZ2A1=YZ2A1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                  IF(INO .GT. 2) THEN
                    IF(IJ .LE. ITM2) THEN
                      ISPOT=IM2M0 + IJM1*I2M2M0
                      YX2A2=YX2A2 + EX(ISPOT)*GT(GSPOT,IROOT)
                      YY2A2=YY2A2 + EY(ISPOT)*GU(GSPOT,IROOT)
                      YZ2A2=YZ2A2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                    END IF
                  END IF
C
                END IF
C
                IF(DO2) THEN
                  ISPOT=IP0P2 + IJM1*I2P0P2
                  YX2B1=YX2B1 + EX(ISPOT)*GT(GSPOT,IROOT)
                  YY2B1=YY2B1 + EY(ISPOT)*GU(GSPOT,IROOT)
                  YZ2B1=YZ2B1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                  IF(JNO .GT. 2) THEN
                    IF(IJ .LE. ITM2) THEN
                      ISPOT=IM0M2 + IJM1*I2M0M2
                      YX2B2=YX2B2 + EX(ISPOT)*GT(GSPOT,IROOT)
                      YY2B2=YY2B2 + EY(ISPOT)*GU(GSPOT,IROOT)
                      YZ2B2=YZ2B2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                    END IF
                  END IF
C
                END IF
C
C   CENTER 1 AND CENTER 2 MIXED DERIVATIVES
C
                IF(DO6) THEN
                  ISPOT=IP1P1 + IJM1*I2P1P1
                  YXAB1=YXAB1 + EX(ISPOT)*GT(GSPOT,IROOT)
                  YYAB1=YYAB1 + EY(ISPOT)*GU(GSPOT,IROOT)
                  YZAB1=YZAB1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                  IF(INO .GT. 1) THEN
                    IF(IJ .LE. IT) THEN
                      ISPOT=IM1P1 + IJM1*I2M1P1
                      YXAB2=YXAB2 + EX(ISPOT)*GT(GSPOT,IROOT)
                      YYAB2=YYAB2 + EY(ISPOT)*GU(GSPOT,IROOT)
                      YZAB2=YZAB2 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                      IF(JNO .GT. 1) THEN
                        IF(IJ .LE. ITM2) THEN
                          ISPOT=IM1M1 + IJM1*I2M1M1
                          YXAB3=YXAB3 + EX(ISPOT)*GT(GSPOT,
     *                    IROOT)
                          YYAB3=YYAB3 + EY(ISPOT)*GU(GSPOT,
     *                    IROOT)
                          YZAB3=YZAB3 + EZ(ISPOT)*GV(GSPOT,
     *                    IROOT)
                        END IF
                      END IF
                    END IF
                  END IF
C
                  IF(JNO .GT. 1) THEN
                    IF(IJ .LE. IT) THEN
                      ISPOT=IP1M1 + IJM1*I2P1M1
                      YXAB4=YXAB4 + EX(ISPOT)*GT(GSPOT,IROOT)
                      YYAB4=YYAB4 + EY(ISPOT)*GU(GSPOT,IROOT)
                      YZAB4=YZAB4 + EZ(ISPOT)*GV(GSPOT,IROOT)
                    END IF
                  END IF
C
                END IF
  170           CONTINUE
C
C   THIRD DERIVATIVES
C
                IF(DO1) THEN
                  ISPOT=IP3P0 + IJM1*I2P3P0
                  YX3A1=YX3A1 + EX(ISPOT)*GT(GSPOT,IROOT)
                  YY3A1=YY3A1 + EY(ISPOT)*GU(GSPOT,IROOT)
                  YZ3A1=YZ3A1 + EZ(ISPOT)*GV(GSPOT,IROOT)
                END IF
C
                IF(DO2) THEN
                  ISPOT=IP0P3 + IJM1*I2P0P3
                  YX3B1=YX3B1 + EX(ISPOT)*GT(GSPOT,IROOT)
                  YY3B1=YY3B1 + EY(ISPOT)*GU(GSPOT,IROOT)
                  YZ3B1=YZ3B1 + EZ(ISPOT)*GV(GSPOT,IROOT)
                END IF
C
                IF(DO6) THEN
                  ISPOT=IP2P1 + IJM1*I2P2P1
                  YXSF1=YXSF1 + EX(ISPOT)*GT(GSPOT,IROOT)
                  YYSF1=YYSF1 + EY(ISPOT)*GU(GSPOT,IROOT)
                  YZSF1=YZSF1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                  ISPOT=IP1P2 + IJM1*I2P1P2
                  YXFS1=YXFS1 + EX(ISPOT)*GT(GSPOT,IROOT)
                  YYFS1=YYFS1 + EY(ISPOT)*GU(GSPOT,IROOT)
                  YZFS1=YZFS1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                  IF(INO .GT. 2) THEN
                    IF(IJ .LE. ITM1) THEN
                      ISPOT=IM2P1 + IJM1*I2M2P1
                      YXSF2=YXSF2 + EX(ISPOT)*GT(GSPOT,IROOT)
                      YYSF2=YYSF2 + EY(ISPOT)*GU(GSPOT,IROOT)
                      YZSF2=YZSF2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                    END IF
                    IF(JNO .GT. 1) THEN
                      IF(IJ .LE. ITM3) THEN
                        ISPOT=IM2M1 + IJM1*I2M2M1
                        YXSF3=YXSF3 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YYSF3=YYSF3 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZSF3=YZSF3 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                    END IF
                  END IF
C
                  IF(JNO .GT. 1) THEN
                    IF(IJ .LE. ITFIR) THEN
                      ISPOT=IP2M1 + IJM1*I2P2M1
                      YXSF4=YXSF4 + EX(ISPOT)*GT(GSPOT,IROOT)
                      YYSF4=YYSF4 + EY(ISPOT)*GU(GSPOT,IROOT)
                      YZSF4=YZSF4 + EZ(ISPOT)*GV(GSPOT,IROOT)
                    END IF
                  END IF
C
                  IF(JNO .GT. 2) THEN
                    IF(IJ .LE. ITM1) THEN
                      ISPOT=IP1M2 + IJM1*I2P1M2
                      YXFS2=YXFS2 + EX(ISPOT)*GT(GSPOT,IROOT)
                      YYFS2=YYFS2 + EY(ISPOT)*GU(GSPOT,IROOT)
                      YZFS2=YZFS2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                    END IF
                    IF(INO .GT. 1) THEN
                      IF(IJ .LE. ITM3) THEN
                        ISPOT=IM1M2 + IJM1*I2M1M2
                        YXFS3=YXFS3 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YYFS3=YYFS3 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZFS3=YZFS3 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                    END IF
                  END IF
C
                  IF(INO .GT. 1) THEN
                    IF(IJ .LE. ITFIR) THEN
                      ISPOT=IM1P2 + IJM1*I2M1P2
                      YXFS4=YXFS4 + EX(ISPOT)*GT(GSPOT,IROOT)
                      YYFS4=YYFS4 + EY(ISPOT)*GU(GSPOT,IROOT)
                      YZFS4=YZFS4 + EZ(ISPOT)*GV(GSPOT,IROOT)
                     END IF
                   END IF
                END IF
C
  200         CONTINUE
C
              IF(DO1) THEN
                YX(IKL,2)=YXA1*AA2 - DUMI*YXA2
                YY(IKL,2)=YYA1*AA2 - DUMI*YYA2
                YZ(IKL,2)=YZA1*AA2 - DUMI*YZA2
C
                YX(IKL,3)=YX2A1*A4 - A2DI*YX0 + DUMIM1*YX2A2
                YY(IKL,3)=YY2A1*A4 - A2DI*YY0 + DUMIM1*YY2A2
                YZ(IKL,3)=YZ2A1*A4 - A2DI*YZ0 + DUMIM1*YZ2A2
C
                YX(IKL,9)=YX3A1*A8 - A12DI*YXA1 + YXA2*A6DI
                YY(IKL,9)=YY3A1*A8 - A12DI*YYA1 + YYA2*A6DI
                YZ(IKL,9)=YZ3A1*A8 - A12DI*YZA1 + YZA2*A6DI
              END IF
C
              IF(DO2) THEN
                YX(IKL,4)=YXB1*BB2 - DUMJ*YXB2
                YY(IKL,4)=YYB1*BB2 - DUMJ*YYB2
                YZ(IKL,4)=YZB1*BB2 - DUMJ*YZB2
C
                YX(IKL,5)=YX2B1*B4 - B2DJ*YX0 + DUMJM1*YX2B2
                YY(IKL,5)=YY2B1*B4 - B2DJ*YY0 + DUMJM1*YY2B2
                YZ(IKL,5)=YZ2B1*B4 - B2DJ*YZ0 + DUMJM1*YZ2B2
C
                YX(IKL,10)=YX3B1*B8 - B12DJ*YXB1 + YXB2*B6DJ
                YY(IKL,10)=YY3B1*B8 - B12DJ*YYB1 + YYB2*B6DJ
                YZ(IKL,10)=YZ3B1*B8 - B12DJ*YZB1 + YZB2*B6DJ
C
              END IF
C
              IF(DO6) THEN
                YX(IKL,6)=AB4*YXAB1 - B2DI*YXAB2 + DIDJ*YXAB3 - A2DJ*
     *          YXAB4
                YY(IKL,6)=AB4*YYAB1 - B2DI*YYAB2 + DIDJ*YYAB3 - A2DJ*
     *          YYAB4
                YZ(IKL,6)=AB4*YZAB1 - B2DI*YZAB2 + DIDJ*YZAB3 - A2DJ*
     *          YZAB4
C
                YX(IKL,11)=AAB8*YXSF1 - AB4*DUMI2*YXB1 + BB2*DUMIM1*
     *                   YXSF2 - A4*DUMJ*YXSF4 + AA2*DUMJ*DUMI2*YXB2
     *                 - DUMIM1*DUMJ*YXSF3
                YY(IKL,11)=AAB8*YYSF1 - AB4*DUMI2*YYB1 + BB2*DUMIM1*
     *                   YYSF2 - A4*DUMJ*YYSF4 + AA2*DUMJ*DUMI2*YYB2
     *                 - DUMIM1*DUMJ*YYSF3
                YZ(IKL,11)=AAB8*YZSF1 - AB4*DUMI2*YZB1 + BB2*DUMIM1*
     *                   YZSF2 - A4*DUMJ*YZSF4 + AA2*DUMJ*DUMI2*YZB2
     *                 - DUMIM1*DUMJ*YZSF3
C
                YX(IKL,12)=BBA8*YXFS1 - AB4*DUMJ2*YXA1 + AA2*DUMJM1*
     *                   YXFS2 - B4*DUMI*YXFS4 + BB2*DUMI*DUMJ2*YXA2
     *                 - DUMJM1*DUMI*YXFS3
                YY(IKL,12)=BBA8*YYFS1 - AB4*DUMJ2*YYA1 + AA2*DUMJM1*
     *                   YYFS2 - B4*DUMI*YYFS4 + BB2*DUMI*DUMJ2*YYA2
     *                 - DUMJM1*DUMI*YYFS3
                YZ(IKL,12)=BBA8*YZFS1 - AB4*DUMJ2*YZA1 + AA2*DUMJM1*
     *                   YZFS2 - B4*DUMI*YZFS4 + BB2*DUMI*DUMJ2*YZA2
     *                 - DUMJM1*DUMI*YZFS3
              END IF
  300       CONTINUE
C
C
            KN=-IANG
            KM=-ISIZ
C
            DO 7000 KNO=1,KQN
C
              KN=KN + IANG
              KM=KM + ISIZ
C
              DO 6000 LNO=1,LQN
C
                LN=LNO + KN
                LM=LNO + KM
C
                ITT=KNO + LNO -1
C
                KPL=IPLACE(LM)
                KTWO=2
                IF(ISAME(LM) .EQ. 1) KTWO=1
C
C
                XXX1=0.0D0
                XYY1=0.0D0
                XZZ1=0.0D0
                IF(DO1) THEN
                  XXX2=0.0D0
                  XYY2=0.0D0
                  XZZ2=0.0D0
                  XXX3=0.0D0
                  XYY3=0.0D0
                  XZZ3=0.0D0
                  XXX9=0.0D0
                  XYY9=0.0D0
                  XZZ9=0.0D0
                END IF
                IF(DO2) THEN
                  XXX4=0.0D0
                  XYY4=0.0D0
                  XZZ4=0.0D0
                  XXX5=0.0D0
                  XYY5=0.0D0
                  XZZ5=0.0D0
                  XXX10=0.0D0
                  XYY10=0.0D0
                  XZZ10=0.0D0
                END IF
                IF(DO6) THEN
                  XXX6=0.0D0
                  XYY6=0.0D0
                  XZZ6=0.0D0
                  XXX11=0.0D0
                  XYY11=0.0D0
                  XZZ11=0.0D0
                  XXX12=0.0D0
                  XYY12=0.0D0
                  XZZ12=0.0D0
                END IF
C
                CONST=-1.0D0
                DO 600 KL=1,ITT
                  KLM1=KL - 1
                  CONST=-CONST
C
C
C   ZEROTH ORDER SECTION
C
                    KSPOT=KPL + KLM1*KTWO
                    EXCNST=EX(IESZ+KSPOT)*CONST
                    EYCNST=EY(IESZ+KSPOT)*CONST
                    EZCNST=EZ(IESZ+KSPOT)*CONST
C
                    XXX1=XXX1 + YX(KL,1)*EXCNST
                    XYY1=XYY1 + YY(KL,1)*EYCNST
                    XZZ1=XZZ1 + YZ(KL,1)*EZCNST
C
C   CENTER 1 FIRST, SECOND AND THIRD DERIVATIVES
C
                    IF(DO1) THEN
                      XXX2=XXX2 + YX(KL,2)*EXCNST
                      XYY2=XYY2 + YY(KL,2)*EYCNST
                      XZZ2=XZZ2 + YZ(KL,2)*EZCNST
C
                      XXX3=XXX3 + YX(KL,3)*EXCNST
                      XYY3=XYY3 + YY(KL,3)*EYCNST
                      XZZ3=XZZ3 + YZ(KL,3)*EZCNST
C
                      XXX9=XXX9 + YX(KL,9)*EXCNST
                      XYY9=XYY9 + YY(KL,9)*EYCNST
                      XZZ9=XZZ9 + YZ(KL,9)*EZCNST
                    END IF
C
C   CENTER 2 FIRST, SECOND, AND THIRD DERIVATIVES
C
                    IF(DO2) THEN
                      XXX4=XXX4 + YX(KL,4)*EXCNST
                      XYY4=XYY4 + YY(KL,4)*EYCNST
                      XZZ4=XZZ4 + YZ(KL,4)*EZCNST
C
                      XXX5=XXX5 + YX(KL,5)*EXCNST
                      XYY5=XYY5 + YY(KL,5)*EYCNST
                      XZZ5=XZZ5 + YZ(KL,5)*EZCNST
C
                      XXX10=XXX10 + YX(KL,10)*EXCNST
                      XYY10=XYY10 + YY(KL,10)*EYCNST
                      XZZ10=XZZ10 + YZ(KL,10)*EZCNST
                    END IF
C
C   CENTERS 1 AND 2 MIXED DERIVATIVES
C
                    IF(DO6) THEN
                      XXX6=XXX6 + YX(KL,6)*EXCNST
                      XYY6=XYY6 + YY(KL,6)*EYCNST
                      XZZ6=XZZ6 + YZ(KL,6)*EZCNST
C
                      XXX11=XXX11 + YX(KL,11)*EXCNST
                      XYY11=XYY11 + YY(KL,11)*EYCNST
                      XZZ11=XZZ11 + YZ(KL,11)*EZCNST
C
                      XXX12=XXX12 + YX(KL,12)*EXCNST
                      XYY12=XYY12 + YY(KL,12)*EYCNST
                      XZZ12=XZZ12 + YZ(KL,12)*EZCNST
                    END IF
C
  600           CONTINUE
                IF(JN .GT. 9) WRITE(IOUT,*) 'JN TOO BIG  JN=',JN
                IF(LN .GT. 9) WRITE(IOUT,*) 'LN TOO BIG  LN=',LN
C
                XX0(JN,LN)=XXX1
                XY0(JN,LN)=XYY1
                XZ0(JN,LN)=XZZ1
C
                INT=0
                IF(DO1) THEN
                  INT=INT+1
                  XXFIR(JN,LN,INT)=XXX2
                  XYFIR(JN,LN,INT)=XYY2
                  XZFIR(JN,LN,INT)=XZZ2
C
                  XXSEC(JN,LN,INT)=XXX3
                  XYSEC(JN,LN,INT)=XYY3
                  XZSEC(JN,LN,INT)=XZZ3
C
                  XXTHR(JN,LN,INT)=XXX9
                  XYTHR(JN,LN,INT)=XYY9
                  XZTHR(JN,LN,INT)=XZZ9
                END IF
C
                IF(DO2) THEN
                  INT=INT+1
                  XXFIR(JN,LN,INT)=XXX4
                  XYFIR(JN,LN,INT)=XYY4
                  XZFIR(JN,LN,INT)=XZZ4
C
                  XXSEC(JN,LN,INT)=XXX5
                  XYSEC(JN,LN,INT)=XYY5
                  XZSEC(JN,LN,INT)=XZZ5
C
                  XXTHR(JN,LN,INT)=XXX10
                  XYTHR(JN,LN,INT)=XYY10
                  XZTHR(JN,LN,INT)=XZZ10
                END IF
C
                IMX=0
                IFS=0
C
                IF(DO6) THEN
                  IMX=IMX + 1
                  XXMXFF(JN,LN,IMX)=XXX6
                  XYMXFF(JN,LN,IMX)=XYY6
                  XZMXFF(JN,LN,IMX)=XZZ6
                  IFS=IFS + 1
                  XXFSMX(JN,LN,IFS)=XXX11
                  XYFSMX(JN,LN,IFS)=XYY11
                  XZFSMX(JN,LN,IFS)=XZZ11
                  IFS=IFS + 1
                  XXFSMX(JN,LN,IFS)=XXX12
                  XYFSMX(JN,LN,IFS)=XYY12
                  XZFSMX(JN,LN,IFS)=XZZ12
                END IF
C
C
 6000         CONTINUE
 7000       CONTINUE
C
 8000     CONTINUE
 9000   CONTINUE
C
C
C   ACTUALLY FORM THE INTEGRALS
C
        ICNT=0
        IJCNT=0
        IORBMX=IORB1 -1 + NUMI
        JORBMX=JORB1 -1 + NUMJ
        DO 5000 IORB=IORB1,IORBMX
          IF(BOTH1) JORBMX=IORB
          DO 4000 JORB=JORB1,JORBMX
            IJORB=IOFF(MAX0(IORB,JORB)) + MIN0(IORB,JORB)
            IJCNT=IJCNT + 1
            JNX=IJX(IJCNT)
            JNY=IJY(IJCNT)
            JNZ=IJZ(IJCNT)
            KLCNT=0
            KORBMX=KORB1 -1 + NUMK
            LORBMX=LORB1 -1 + NUML
            IF(ISHELL .EQ. KSHELL) KORBMX=IORB
            DO 3000 KORB=KORB1,KORBMX
              IF(BOTH2) LORBMX=KORB
              DO 2000 LORB=LORB1,LORBMX
                KLORB=IOFF(MAX0(KORB,LORB)) + MIN0(KORB,LORB)
                IJKL=IOFF(MAX0(IJORB,KLORB)) + MIN0(IJORB,KLORB)
                IF(KLORB .GT. IJORB) GO TO 3000
C
                ICNT=ICNT + 1
                IF(ICNT .GT. IMEM4) WRITE(IOUT,*) ' ICNT = ',ICNT
                KLCNT=KLCNT + 1
                LNX=KLX(KLCNT)
                LNY=KLY(KLCNT)
                LNZ=KLZ(KLCNT)
C
C   CENTER 1 DERIVATIVES
C
                INT=0
                IF(DO1) THEN
                  INT=INT+1
C
C   FIRST DERIVATIVES
C
                  GMXFIR(ICNT,1,INT)= GMXFIR(ICNT,1,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,2,INT)= GMXFIR(ICNT,2,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,3,INT)= GMXFIR(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
C
C   SECOND DERIVATIVES
C
                  GMXSEC(ICNT,1,INT)= GMXSEC(ICNT,1,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,2,INT)= GMXSEC(ICNT,2,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,3,INT)= GMXSEC(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,4,INT)= GMXSEC(ICNT,4,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,5,INT)= GMXSEC(ICNT,5,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,6,INT)= GMXSEC(ICNT,6,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
C
C   THIRD DERIVATIVES
C
                  GMXTHR(ICNT,1,INT)=GMXTHR(ICNT,1,INT) +
     *            XXTHR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,2,INT)=GMXTHR(ICNT,2,INT) +
     *            XXSEC(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,3,INT)=GMXTHR(ICNT,3,INT) +
     *            XXFIR(JNX,LNX,INT)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,4,INT)=GMXTHR(ICNT,4,INT) +
     *            XX0(JNX,LNX)*XYTHR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,5,INT)=GMXTHR(ICNT,5,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,6,INT)=GMXTHR(ICNT,6,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,
     *            INT)
                  GMXTHR(ICNT,7,INT)=GMXTHR(ICNT,7,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,8,INT)=GMXTHR(ICNT,8,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,9,INT)=GMXTHR(ICNT,9,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,10,INT)=GMXTHR(ICNT,10,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZTHR(JNZ,LNZ,INT)
                END IF
C
C   CENTER 2 DERIVATIVES
C
                IF(DO2) THEN
                  INT=INT+1
C
C   FIRST DERIVATIVES
C
                  GMXFIR(ICNT,1,INT)= GMXFIR(ICNT,1,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,2,INT)= GMXFIR(ICNT,2,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,3,INT)= GMXFIR(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
C
C   SECOND DERIVATIVES
C
                  GMXSEC(ICNT,1,INT)= GMXSEC(ICNT,1,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,2,INT)= GMXSEC(ICNT,2,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,3,INT)= GMXSEC(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,4,INT)= GMXSEC(ICNT,4,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,5,INT)= GMXSEC(ICNT,5,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,6,INT)= GMXSEC(ICNT,6,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
C
C   THIRD DERIVATIVES
C
                  GMXTHR(ICNT,1,INT)=GMXTHR(ICNT,1,INT) +
     *            XXTHR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,2,INT)=GMXTHR(ICNT,2,INT) +
     *            XXSEC(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,3,INT)=GMXTHR(ICNT,3,INT) +
     *            XXFIR(JNX,LNX,INT)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,4,INT)=GMXTHR(ICNT,4,INT) +
     *            XX0(JNX,LNX)*XYTHR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,5,INT)=GMXTHR(ICNT,5,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,6,INT)=GMXTHR(ICNT,6,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,
     *            INT)
                  GMXTHR(ICNT,7,INT)=GMXTHR(ICNT,7,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,8,INT)=GMXTHR(ICNT,8,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,9,INT)=GMXTHR(ICNT,9,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,10,INT)=GMXTHR(ICNT,10,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZTHR(JNZ,LNZ,INT)
                END IF
C
C   CENTER 1 AND CENTER 2 MIXED DERIVATIVES
C
                IMX=0
                IFS=0
                IF(DO6) THEN
C
C   SECOND DERIVATIVES
C
                  IMX=IMX + 1
                  GMXFF(ICNT,1,IMX)= GMXFF(ICNT,1,IMX) +
     *            XXMXFF(JNX,LNX,IMX)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,2,IMX)= GMXFF(ICNT,2,IMX) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,3,IMX)= GMXFF(ICNT,3,IMX) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFF(ICNT,4,IMX)= GMXFF(ICNT,4,IMX) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,5,IMX)= GMXFF(ICNT,5,IMX) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,IMX)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,6,IMX)= GMXFF(ICNT,6,IMX) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFF(ICNT,7,IMX)= GMXFF(ICNT,7,IMX) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFF(ICNT,8,IMX)= GMXFF(ICNT,8,IMX) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFF(ICNT,9,IMX)= GMXFF(ICNT,9,IMX) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,IMX)
C
C   THIRD DERIVATIVES
C
                  IFS=IFS+1
                  GMXFS(ICNT,1,IFS)= GMXFS(ICNT,1,IFS) +
     *            XXFSMX(JNX,LNX,1)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,2,IFS)= GMXFS(ICNT,2,IFS) +
     *            XXSEC(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,3,IFS)= GMXFS(ICNT,3,IFS) +
     *            XXSEC(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,4,IFS)= GMXFS(ICNT,4,IFS) +
     *            XXMXFF(JNX,LNX,1)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,5,IFS)= GMXFS(ICNT,5,IFS) +
     *            XXFIR(JNX,LNX,1)*XYMXFF(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,6,IFS)= GMXFS(ICNT,6,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,7,IFS)= GMXFS(ICNT,7,IFS) +
     *            XXMXFF(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,8,IFS)= GMXFS(ICNT,8,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,9,IFS)= GMXFS(ICNT,9,IFS) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,10,IFS)= GMXFS(ICNT,10,IFS) +
     *            XXFIR(JNX,LNX,2)*XYSEC(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,11,IFS)= GMXFS(ICNT,11,IFS) +
     *            XX0(JNX,LNX)*XYFSMX(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,12,IFS)= GMXFS(ICNT,12,IFS) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,13,IFS)= GMXFS(ICNT,13,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,14,IFS)= GMXFS(ICNT,14,IFS) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,1)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,15,IFS)= GMXFS(ICNT,15,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,16,IFS)= GMXFS(ICNT,16,IFS) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,1)
                  GMXFS(ICNT,17,IFS)= GMXFS(ICNT,17,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZSEC(JNZ,LNZ,1)
                  GMXFS(ICNT,18,IFS)= GMXFS(ICNT,18,IFS) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFSMX(JNZ,LNZ,1)
C
                  IFS=IFS+1
                  GMXFS(ICNT,1,IFS)= GMXFS(ICNT,1,IFS) +
     *            XXFSMX(JNX,LNX,2)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,2,IFS)= GMXFS(ICNT,2,IFS) +
     *            XXSEC(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,3,IFS)= GMXFS(ICNT,3,IFS) +
     *            XXSEC(JNX,LNX,2)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,4,IFS)= GMXFS(ICNT,4,IFS) +
     *            XXMXFF(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,5,IFS)= GMXFS(ICNT,5,IFS) +
     *            XXFIR(JNX,LNX,2)*XYMXFF(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,6,IFS)= GMXFS(ICNT,6,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,7,IFS)= GMXFS(ICNT,7,IFS) +
     *            XXMXFF(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,8,IFS)= GMXFS(ICNT,8,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,9,IFS)= GMXFS(ICNT,9,IFS) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,10,IFS)= GMXFS(ICNT,10,IFS) +
     *            XXFIR(JNX,LNX,1)*XYSEC(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,11,IFS)= GMXFS(ICNT,11,IFS) +
     *            XX0(JNX,LNX)*XYFSMX(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,12,IFS)= GMXFS(ICNT,12,IFS) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,13,IFS)= GMXFS(ICNT,13,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,14,IFS)= GMXFS(ICNT,14,IFS) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,15,IFS)= GMXFS(ICNT,15,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,16,IFS)= GMXFS(ICNT,16,IFS) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,2)
                  GMXFS(ICNT,17,IFS)= GMXFS(ICNT,17,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZSEC(JNZ,LNZ,2)
                  GMXFS(ICNT,18,IFS)= GMXFS(ICNT,18,IFS) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFSMX(JNZ,LNZ,2)
                END IF
 2000         CONTINUE
 3000       CONTINUE
 4000     CONTINUE
 5000   CONTINUE
C
10000 CONTINUE
C
      IGCNT=ICNT
C
      RETURN
      END
C***********************************************************************
C
C   CENTER 1 AND 3  DERIVATIVES ARE CALCULATED
C
C***********************************************************************
      SUBROUTINE CENT13(GT,GU,GV,XX0,XY0,XZ0,XXFIR,XYFIR,XZFIR
     *,                 XXSEC,XYSEC,XZSEC,XXMXFF,XYMXFF,XZMXFF,GMXFIR
     *,                 GMXSEC,GMXFF,LO,XXTHR,XYTHR,XZTHR
     *,                 XXFFF,XYFFF,XZFFF,XXFSMX,XYFSMX,XZFSMX,GMXTHR
     *,                 GMXFFF,GMXFS)
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER GSPOT
      LOGICAL BOTH1,BOTH2
      LOGICAL EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      DIMENSION YX(8,14),YY(8,14),YZ(8,14)
      DIMENSION GT(I4LARL,I2LARL),GU(I4LARL,I2LARL)
      DIMENSION GV(I4LARL,I2LARL)
      DIMENSION ITEST(10)
      DIMENSION YYX(8,18),YYY(8,18),YYZ(8,18)
      DIMENSION XX0(IANGSQ,IANGSQ),XY0(IANGSQ,IANGSQ),XZ0(IANGSQ,IANGSQ)
      DIMENSION XXFIR(IANGSQ,IANGSQ,3),XYFIR(IANGSQ,IANGSQ,3)
      DIMENSION XZFIR(IANGSQ,IANGSQ,3),XXSEC(IANGSQ,IANGSQ,3)
      DIMENSION XYSEC(IANGSQ,IANGSQ,3),XZSEC(IANGSQ,IANGSQ,3)
      DIMENSION XXMXFF(IANGSQ,IANGSQ,3),XYMXFF(IANGSQ,IANGSQ,3)
      DIMENSION XZMXFF(IANGSQ,IANGSQ,3),GMXFIR(IMEM4,3,3)
      DIMENSION GMXSEC(IMEM4,6,3),GMXFF(IMEM4,9,3)
      DIMENSION LO(IMEM4*5)
      DIMENSION XXTHR(IANGSQ,IANGSQ,3),XYTHR(IANGSQ,IANGSQ,3)
     *,         XZTHR(IANGSQ,IANGSQ,3),XXFFF(IANGSQ,IANGSQ)
     *,         XYFFF(IANGSQ,IANGSQ),XZFFF(IANGSQ,IANGSQ)
      DIMENSION XXFSMX(IANGSQ,IANGSQ,6),XYFSMX(IANGSQ,IANGSQ,6)
     *,         XZFSMX(IANGSQ,IANGSQ,6)
      DIMENSION GMXTHR(IMEM4,10,3),GMXFFF(IMEM4,27),GMXFS(IMEM4,18,6)
      COMMON/CALQN/ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET
      COMMON/EINFO/IPLACE(49),ISAME(49)
      COMMON/EXYZS/EX(686),EY(686),EZ(686)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/IPAR5/IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL
      COMMON/LOGIC/EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      COMMON/ORBIN/IORB1,JORB1,KORB1,LORB1,NUMI,NUMJ,NUMK,NUML
      COMMON/PASS /II,JJ,KK,LL
      COMMON/POSNS/IJX(50),IJY(50),IJZ(50),KLX(50),KLY(50),KLZ(50)
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/TWINF/ISHELL,JSHELL,KSHELL,LSHELL
C
      ISIZ=   7
      ISIZ2= 14
      ISIZ3= 21
      IESZ=343
C
      RETURN
C
      ENTRY DER13(BOTH1,BOTH2,IQN,JQN,KQN,LQN,IGCNT,NROOT0,AA,BB,CC,DD,
     *ITEST)
C
      AA2=AA + AA
      CC2=CC + CC
      A4=AA2 * AA2
      C4=CC2 * CC2
      A8=A4 * AA2
      C8=C4 * CC2
      AC4=AA2*CC2
      AAC8=AC4 * AA2
      CCA8=AC4 * CC2
C
      NROOT=NROOT0 + NDERIV
      KLQN=KQN+LQN -1
      KLQNP1=KLQN + 1
      KLQNP2=KLQN + 2
      KLQNP3=KLQN + 3
      MAX=KLQN + IQN + JQN -1
C
      DO 10000 IROOT=1,NROOT
C
        IN=-IANG
        IM=-ISIZ
C
        DO 9000 INO=1,IQN
C
          IN=IN + IANG
          IM=IM + ISIZ
C
          DUMI=DBLE(INO-1)
          DUMIM1=DBLE((INO-1)*(INO-2))
          DUMI2=DBLE(2*INO -1)
          A2DI=AA2*DUMI2
          C2DI=CC2*DUMI
          A12DI=3.0D0*A4*DBLE(INO)
          A6DI=3.0D0*AA2*DUMI*DUMI
C
          DO 8000 JNO=1,JQN
C
            JN=JNO + IN
            JM=JNO + IM
C
C
            IPL=IPLACE(JM)
            ITWO=2
            IF(ISAME(JM) .EQ. 1) ITWO=1
C
C
            JP1P0=JM + ISIZ
            IP1P0=IPLACE(JP1P0)
            I2P1P0=2
            IF(ISAME(JP1P0) .EQ. 1) I2P1P0=1
            JP2P0=JM + ISIZ2
            IP2P0=IPLACE(JP2P0)
            I2P2P0=2
            IF(ISAME(JP2P0) .EQ. 1) I2P2P0=1
            JP3P0=JM + ISIZ3
            IP3P0=IPLACE(JP3P0)
            I2P3P0=2
            IF(ISAME(JP3P0) .EQ. 1) I2P3P0=1
            IF(INO .GT. 1) THEN
              JM1M0=JM - ISIZ
              IM1M0=IPLACE(JM1M0)
              I2M1M0=2
              IF(ISAME(JM1M0) .EQ. 1) I2M1M0=1
              IF(INO .GT. 2) THEN
                JM2M0=JM -ISIZ2
                IM2M0=IPLACE(JM2M0)
                I2M2M0=2
                IF(ISAME(JM2M0) .EQ. 1) I2M2M0=1
              END IF
            END IF
C
C
            IT=INO + JNO - 1
            ITM1=IT-1
            ITM2=IT-2
            ITM3=IT-3
            ITFIR=IT + 1
            ITSEC=IT + 2
            ITTHR=IT + 3
C
C   ZEROTH ORDER SECTION
C
            DO 150 IKL=1,KLQN
              YX0=0.0D0
              YY0=0.0D0
              YZ0=0.0D0
              DO 100 IJ=1,IT
                IJM1=IJ-1
                ISPOT=IPL + IJM1*ITWO
                GSPOT=IKL + IJM1
                YX0=YX0 + EX(ISPOT)*GT(GSPOT,IROOT)
                YY0=YY0 + EY(ISPOT)*GU(GSPOT,IROOT)
                YZ0=YZ0 + EZ(ISPOT)*GV(GSPOT,IROOT)
  100         CONTINUE
C
              YX(IKL,1)=YX0
              YY(IKL,1)=YY0
              YZ(IKL,1)=YZ0
C
  150       CONTINUE
C
            DO 300 IKL=1,KLQN
              YX0=YX(IKL,1)
              YY0=YY(IKL,1)
              YZ0=YZ(IKL,1)
              YXA1=0.0D0
              YYA1=0.0D0
              YZA1=0.0D0
              YXA2=0.0D0
              YYA2=0.0D0
              YZA2=0.0D0
              YX2A1=0.0D0
              YY2A1=0.0D0
              YZ2A1=0.0D0
              YX2A2=0.0D0
              YY2A2=0.0D0
              YZ2A2=0.0D0
              YX3A1=0.0D0
              YY3A1=0.0D0
              YZ3A1=0.0D0
              DO 200 IJ=1,ITTHR
                IJM1=IJ-1
                GSPOT=IKL + IJM1
C
C   FIRST DERIVATIVE SECTION
C
                IF(IJ .GT. ITFIR) GO TO 160
C
                ISPOT=IP1P0 + IJM1*I2P1P0
                YXA1=YXA1 + EX(ISPOT)*GT(GSPOT,IROOT)
                YYA1=YYA1 + EY(ISPOT)*GU(GSPOT,IROOT)
                YZA1=YZA1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                IF(INO .GT. 1) THEN
                  IF(IJ .LE. ITM1) THEN
                    ISPOT=IM1M0 + IJM1*I2M1M0
                    YXA2=YXA2 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YYA2=YYA2 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZA2=YZA2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                  END IF
                END IF
  160           CONTINUE
C
C   SECOND DERIVATIVE SECTION
C
                IF(IJ .GT. ITSEC) GO TO 170
                ISPOT=IP2P0 + IJM1*I2P2P0
                YX2A1=YX2A1 + EX(ISPOT)*GT(GSPOT,IROOT)
                YY2A1=YY2A1 + EY(ISPOT)*GU(GSPOT,IROOT)
                YZ2A1=YZ2A1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                IF(INO .GT. 2) THEN
                  IF(IJ .LE. ITM2) THEN
                    ISPOT=IM2M0 + IJM1*I2M2M0
                    YX2A2=YX2A2 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YY2A2=YY2A2 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZ2A2=YZ2A2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                  END IF
                END IF
C
C
  170           CONTINUE
C
C   THIRD DERIVATIVES
C
                ISPOT=IP3P0 + IJM1*I2P3P0
                YX3A1=YX3A1 + EX(ISPOT)*GT(GSPOT,IROOT)
                YY3A1=YY3A1 + EY(ISPOT)*GU(GSPOT,IROOT)
                YZ3A1=YZ3A1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
C
  200         CONTINUE
C
              YX(IKL,2)=YXA1*AA2 - DUMI*YXA2
              YY(IKL,2)=YYA1*AA2 - DUMI*YYA2
              YZ(IKL,2)=YZA1*AA2 - DUMI*YZA2
C
              YX(IKL,3)=YX2A1*A4 - A2DI*YX0 + DUMIM1*YX2A2
              YY(IKL,3)=YY2A1*A4 - A2DI*YY0 + DUMIM1*YY2A2
              YZ(IKL,3)=YZ2A1*A4 - A2DI*YZ0 + DUMIM1*YZ2A2
C
              YX(IKL,9)=YX3A1*A8 - A12DI*YXA1 + YXA2*A6DI
              YY(IKL,9)=YY3A1*A8 - A12DI*YYA1 + YYA2*A6DI
              YZ(IKL,9)=YZ3A1*A8 - A12DI*YZA1 + YZA2*A6DI
C
              YYX(IKL,17)=YXA1
              YYY(IKL,17)=YYA1
              YYZ(IKL,17)=YZA1
C
              YYX(IKL,18)=YXA2
              YYY(IKL,18)=YYA2
              YYZ(IKL,18)=YZA2
C
  300       CONTINUE
C
            DO 375 IKL=1,KLQNP3
              YX3=0.0D0
              YY3=0.0D0
              YZ3=0.0D0
              DO 350 IJ=1,IT
                IJM1=IJ-1
                ISPOT=IPL + IJM1*ITWO
                GSPOT=IKL + IJM1
                YX3=YX3 + EX(ISPOT)*GT(GSPOT,IROOT)
                YY3=YY3 + EY(ISPOT)*GU(GSPOT,IROOT)
                YZ3=YZ3 + EZ(ISPOT)*GV(GSPOT,IROOT)
  350         CONTINUE
              IF(IKL .LE. KLQNP1) THEN
                YX(IKL,7)=YX3
                YY(IKL,7)=YY3
                YZ(IKL,7)=YZ3
              END IF
              IF(IKL .LE. KLQNP2) THEN
                YX(IKL,8)=YX3
                YY(IKL,8)=YY3
                YZ(IKL,8)=YZ3
              END IF
              YX(IKL,13)=YX3
              YY(IKL,13)=YY3
              YZ(IKL,13)=YZ3
  375       CONTINUE
C
C
C   MIXED CENTER DERIVATIVES
C
            DO 500 IKL=1,KLQNP2
              YXA1=0.0D0
              YYA1=0.0D0
              YZA1=0.0D0
              YXA2=0.0D0
              YYA2=0.0D0
              YZA2=0.0D0
              YXA3=0.0D0
              YYA3=0.0D0
              YZA3=0.0D0
              YXA4=0.0D0
              YYA4=0.0D0
              YZA4=0.0D0
              YXA5=0.0D0
              YYA5=0.0D0
              YZA5=0.0D0
              YXA6=0.0D0
              YYA6=0.0D0
              YZA6=0.0D0
              DO 450 IJ=1,ITSEC
                IJM1=IJ - 1
                GSPOT=IJM1 + IKL
C
                IF(IJ .GT. ITFIR) GO TO 410
                ISPOT=IP1P0 + IJM1*I2P1P0
                EXCNST=EX(ISPOT)*GT(GSPOT,IROOT)
                EYCNST=EY(ISPOT)*GU(GSPOT,IROOT)
                EZCNST=EZ(ISPOT)*GV(GSPOT,IROOT)
                IF(IKL .LE. KLQNP1) THEN
                  YXA1=YXA1 + EXCNST
                  YYA1=YYA1 + EYCNST
                  YZA1=YZA1 + EZCNST
                END IF
                YXA3=YXA3 + EXCNST
                YYA3=YYA3 + EYCNST
                YZA3=YZA3 + EZCNST
C
                IF(INO .GT. 1) THEN
                  IF(IJ .LE. ITM1) THEN
                    ISPOT=IM1M0 + IJM1*I2M1M0
                    EXCNST=EX(ISPOT)*GT(GSPOT,IROOT)
                    EYCNST=EY(ISPOT)*GU(GSPOT,IROOT)
                    EZCNST=EZ(ISPOT)*GV(GSPOT,IROOT)
                    IF(IKL .LE. KLQNP1) THEN
                      YXA2=YXA2 + EXCNST
                      YYA2=YYA2 + EYCNST
                      YZA2=YZA2 + EZCNST
                    END IF
                    YXA4=YXA4 + EXCNST
                    YYA4=YYA4 + EYCNST
                    YZA4=YZA4 + EZCNST
                  END IF
                END IF
C
  410           CONTINUE
                IF(IKL .GT. KLQNP1) GO TO 420
                ISPOT=IP2P0 + IJM1*I2P2P0
                YXA5=YXA5 + EX(ISPOT)*GT(GSPOT,IROOT)
                YYA5=YYA5 + EY(ISPOT)*GU(GSPOT,IROOT)
                YZA5=YZA5 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                IF(INO .GT. 2) THEN
                  IF(IJ .LE. ITM2) THEN
                    ISPOT=IM2M0 + IJM1*I2M2M0
                    YXA6=YXA6 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YYA6=YYA6 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZA6=YZA6 + EZ(ISPOT)*GV(GSPOT,IROOT)
                  END IF
                END IF
C
  420           CONTINUE
C
C
  450         CONTINUE
C
              YYX(IKL,1)=YXA1
              YYY(IKL,1)=YYA1
              YYZ(IKL,1)=YZA1
C
              YYX(IKL,2)=YXA2
              YYY(IKL,2)=YYA2
              YYZ(IKL,2)=YZA2
C
              YYX(IKL,5)=YXA3
              YYY(IKL,5)=YYA3
              YYZ(IKL,5)=YZA3
C
              YYX(IKL,6)=YXA4
              YYY(IKL,6)=YYA4
              YYZ(IKL,6)=YZA4
C
              YYX(IKL,9)=YXA5
              YYY(IKL,9)=YYA5
              YYZ(IKL,9)=YZA5
C
              YYX(IKL,10)=YXA6
              YYY(IKL,10)=YYA6
              YYZ(IKL,10)=YZA6
C
  500       CONTINUE
C
            KN=-IANG
            KM=-ISIZ
C
            DO 7000 KNO=1,KQN
C
              KN=KN + IANG
              KM=KM + ISIZ
C
              DUMK=DBLE(KNO-1)
              DIDK=DUMK*DUMI
              A2DK=AA2*DUMK
              DUMKM1=DBLE((KNO-1)*(KNO-2))
              DUMK2=DBLE(2*KNO -1)
              C2DK=CC2*DUMK2
              C12DK=3.0D0*C4*DBLE(KNO)
              C6DK=3.0D0*CC2*DUMK*DUMK
C
              DO 6000 LNO=1,LQN
C
                LN=LNO + KN
                LM=LNO + KM
C
                ITT=KNO + LNO -1
                ITTM1=ITT-1
                ITTM2=ITT-2
                ITTM3=ITT-3
                ITTFIR=ITT + 1
                ITTSEC=ITT + 2
                ITTTHR=ITT + 3
C
                KPL=IPLACE(LM)
                KTWO=2
                IF(ISAME(LM) .EQ. 1) KTWO=1
C
                LP1P0=LM + ISIZ
                KP1P0=IPLACE(LP1P0)
                K2P1P0=2
                IF(ISAME(LP1P0) .EQ. 1) K2P1P0=1
                LP2P0=LM + ISIZ2
                KP2P0=IPLACE(LP2P0)
                K2P2P0=2
                IF(ISAME(LP2P0) .EQ. 1) K2P2P0=1
                LP3P0=LM + ISIZ3
                KP3P0=IPLACE(LP3P0)
                K2P3P0=2
                IF(ISAME(LP3P0) .EQ. 1) K2P3P0=1
                IF(KNO .GT. 1) THEN
                  LM1M0=LM - ISIZ
                  KM1M0=IPLACE(LM1M0)
                  K2M1M0=2
                  IF(ISAME(LM1M0) .EQ. 1) K2M1M0=1
                  IF(KNO .GT. 2) THEN
                    LM2M0=LM - ISIZ2
                    KM2M0=IPLACE(LM2M0)
                    K2M2M0=2
                    IF(ISAME(LM2M0) .EQ. 1) K2M2M0=1
                  END IF
                END IF
C
C
                XXX1=0.0D0
                XYY1=0.0D0
                XZZ1=0.0D0
                XXX2=0.0D0
                XYY2=0.0D0
                XZZ2=0.0D0
                XXX3=0.0D0
                XYY3=0.0D0
                XZZ3=0.0D0
                XXX9=0.0D0
                XYY9=0.0D0
                XZZ9=0.0D0
                XXC1=0.0D0
                XYC1=0.0D0
                XZC1=0.0D0
                XXC2=0.0D0
                XYC2=0.0D0
                XZC2=0.0D0
                XX2C1=0.0D0
                XY2C1=0.0D0
                XZ2C1=0.0D0
                XX2C2=0.0D0
                XY2C2=0.0D0
                XZ2C2=0.0D0
                XX3C1=0.0D0
                XY3C1=0.0D0
                XZ3C1=0.0D0
                XXSF1=0.0D0
                XYSF1=0.0D0
                XZSF1=0.0D0
                XXSF2=0.0D0
                XYSF2=0.0D0
                XZSF2=0.0D0
                XXSF3=0.0D0
                XYSF3=0.0D0
                XZSF3=0.0D0
                XXSF4=0.0D0
                XYSF4=0.0D0
                XZSF4=0.0D0
                XXSF5=0.0D0
                XYSF5=0.0D0
                XZSF5=0.0D0
                XXSF6=0.0D0
                XYSF6=0.0D0
                XZSF6=0.0D0
                XXFS1=0.0D0
                XYFS1=0.0D0
                XZFS1=0.0D0
                XXFS2=0.0D0
                XYFS2=0.0D0
                XZFS2=0.0D0
                XXFS3=0.0D0
                XYFS3=0.0D0
                XZFS3=0.0D0
                XXFS4=0.0D0
                XYFS4=0.0D0
                XZFS4=0.0D0
                XXFS5=0.0D0
                XYFS5=0.0D0
                XZFS5=0.0D0
                XXFS6=0.0D0
                XYFS6=0.0D0
                XZFS6=0.0D0
                XXAC1=0.0D0
                XYAC1=0.0D0
                XZAC1=0.0D0
                XXAC2=0.0D0
                XYAC2=0.0D0
                XZAC2=0.0D0
                XXAC3=0.0D0
                XYAC3=0.0D0
                XZAC3=0.0D0
                XXAC4=0.0D0
                XYAC4=0.0D0
                XZAC4=0.0D0
C
                CONST=-1.0D0
                DO 600 KL=1,ITTTHR
                  KLM1=KL - 1
                  CONST=-CONST
C
                  IF(KL .LE. ITT) THEN
C
C   ZEROTH ORDER SECTION
C
                    KSPOT=KPL + KLM1*KTWO
                    EXCNST=EX(IESZ+KSPOT)*CONST
                    EYCNST=EY(IESZ+KSPOT)*CONST
                    EZCNST=EZ(IESZ+KSPOT)*CONST
C
C   ZEROTH ORDER INTEGRALS
C
                    XXX1=XXX1 + YX(KL,1)*EXCNST
                    XYY1=XYY1 + YY(KL,1)*EYCNST
                    XZZ1=XZZ1 + YZ(KL,1)*EZCNST
C
C   CENTER 1 FIRST, SECOND AND THIRD DERIVATIVES
C
                    XXX2=XXX2 + YX(KL,2)*EXCNST
                    XYY2=XYY2 + YY(KL,2)*EYCNST
                    XZZ2=XZZ2 + YZ(KL,2)*EZCNST
C
                    XXX3=XXX3 + YX(KL,3)*EXCNST
                    XYY3=XYY3 + YY(KL,3)*EYCNST
                    XZZ3=XZZ3 + YZ(KL,3)*EZCNST
C
                    XXX9=XXX9 + YX(KL,9)*EXCNST
                    XYY9=XYY9 + YY(KL,9)*EYCNST
                    XZZ9=XZZ9 + YZ(KL,9)*EZCNST
                  END IF
C
C   CENTER 3 FIRST, SECOND, AND THIRD DERIVATIVES
C
                  IF(KL .GT. ITTFIR) GO TO 505
                  KSPOT=KP1P0 + KLM1*K2P1P0
                  XXC1=XXC1 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                  XYC1=XYC1 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                  XZC1=XZC1 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
C
                  IF(KNO .GT. 1) THEN
                    IF(KL .LE. ITTM1) THEN
                      KSPOT=KM1M0 + KLM1*K2M1M0
                      XXC2=XXC2 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                      XYC2=XYC2 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                      XZC2=XZC2 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
                    END IF
                  END IF
  505             CONTINUE
C
                  IF(KL .GT. ITTSEC) GO TO 510
                  KSPOT=KP2P0 + KLM1*K2P2P0
                  XX2C1=XX2C1 + YX(KL,8)*EX(IESZ+KSPOT)*CONST
                  XY2C1=XY2C1 + YY(KL,8)*EY(IESZ+KSPOT)*CONST
                  XZ2C1=XZ2C1 + YZ(KL,8)*EZ(IESZ+KSPOT)*CONST
C
                  IF(KNO .GT. 2) THEN
                    IF(KL .LE. ITTM2) THEN
                      KSPOT=KM2M0 + KLM1*K2M2M0
                      XX2C2=XX2C2 + YX(KL,8)*EX(IESZ+KSPOT)*CONST
                      XY2C2=XY2C2 + YY(KL,8)*EY(IESZ+KSPOT)*CONST
                      XZ2C2=XZ2C2 + YZ(KL,8)*EZ(IESZ+KSPOT)*CONST
                    END IF
                  END IF
  510             CONTINUE
C
                  KSPOT=KP3P0 + KLM1*K2P3P0
                  XX3C1=XX3C1 + YX(KL,13)*EX(IESZ+KSPOT)*CONST
                  XY3C1=XY3C1 + YY(KL,13)*EY(IESZ+KSPOT)*CONST
                  XZ3C1=XZ3C1 + YZ(KL,13)*EZ(IESZ+KSPOT)*CONST
C
C   CENTERS 1 AND 3 MIXED DERIVATIVES
C
                  IF(KL .GT. ITTSEC) GO TO 600
C
                  IF(KL .LE. ITTFIR) THEN
                    KSPOT=KP1P0 + KLM1*K2P1P0
                    EXCNST=EX(IESZ+KSPOT)*CONST
                    EYCNST=EY(IESZ+KSPOT)*CONST
                    EZCNST=EZ(IESZ+KSPOT)*CONST
C
                    XXAC1=XXAC1 + YYX(KL,1)*EXCNST
                    XYAC1=XYAC1 + YYY(KL,1)*EYCNST
                    XZAC1=XZAC1 + YYZ(KL,1)*EZCNST
C
                    XXAC4=XXAC4 + YYX(KL,2)*EXCNST
                    XYAC4=XYAC4 + YYY(KL,2)*EYCNST
                    XZAC4=XZAC4 + YYZ(KL,2)*EZCNST
C
                    XXSF1=XXSF1 + YYX(KL,9)*EXCNST
                    XYSF1=XYSF1 + YYY(KL,9)*EYCNST
                    XZSF1=XZSF1 + YYZ(KL,9)*EZCNST
C
                    XXSF2=XXSF2 + YYX(KL,10)*EXCNST
                    XYSF2=XYSF2 + YYY(KL,10)*EYCNST
                    XZSF2=XZSF2 + YYZ(KL,10)*EZCNST
C
                    XXSF3=XXSF3 + YX(KL,7)*EXCNST
                    XYSF3=XYSF3 + YY(KL,7)*EYCNST
                    XZSF3=XZSF3 + YZ(KL,7)*EZCNST
C
                  END IF
                  IF(KNO .GT. 1) THEN
                    IF(KL .LE. ITTM1) THEN
                      KSPOT=KM1M0 + KLM1*K2M1M0
                      EXCNST=EX(IESZ+KSPOT)*CONST
                      EYCNST=EY(IESZ+KSPOT)*CONST
                      EZCNST=EZ(IESZ+KSPOT)*CONST
C
                      XXAC2=XXAC2 + YYX(KL,1)*EXCNST
                      XYAC2=XYAC2 + YYY(KL,1)*EYCNST
                      XZAC2=XZAC2 + YYZ(KL,1)*EZCNST
C
                      XXAC3=XXAC3 + YYX(KL,2)*EXCNST
                      XYAC3=XYAC3 + YYY(KL,2)*EYCNST
                      XZAC3=XZAC3 + YYZ(KL,2)*EZCNST
C
                      XXSF4=XXSF4 + YYX(KL,9)*EXCNST
                      XYSF4=XYSF4 + YYY(KL,9)*EYCNST
                      XZSF4=XZSF4 + YYZ(KL,9)*EZCNST
C
                      XXSF5=XXSF5 + YYX(KL,10)*EXCNST
                      XYSF5=XYSF5 + YYY(KL,10)*EYCNST
                      XZSF5=XZSF5 + YYZ(KL,10)*EZCNST
C
                      XXSF6=XXSF6 + YX(KL,7)*EXCNST
                      XYSF6=XYSF6 + YY(KL,7)*EYCNST
                      XZSF6=XZSF6 + YZ(KL,7)*EZCNST
                    END IF
                  END IF
C
                  KSPOT=KP2P0 + KLM1*K2P2P0
                  EXCNST=EX(IESZ+KSPOT)*CONST
                  EYCNST=EY(IESZ+KSPOT)*CONST
                  EZCNST=EZ(IESZ+KSPOT)*CONST
C
                  XXFS1=XXFS1 + YYX(KL,5)*EXCNST
                  XYFS1=XYFS1 + YYY(KL,5)*EYCNST
                  XZFS1=XZFS1 + YYZ(KL,5)*EZCNST
C
                  XXFS2=XXFS2 + YYX(KL,6)*EXCNST
                  XYFS2=XYFS2 + YYY(KL,6)*EYCNST
                  XZFS2=XZFS2 + YYZ(KL,6)*EZCNST
C
                  IF(KL .LE. ITT) THEN
                    KSPOT=KPL + KTWO*KLM1
                    EXCNST=EX(IESZ+KSPOT)*CONST
                    EYCNST=EY(IESZ+KSPOT)*CONST
                    EZCNST=EZ(IESZ+KSPOT)*CONST
C
                    XXFS3=XXFS3 + YYX(KL,17)*EXCNST
                    XYFS3=XYFS3 + YYY(KL,17)*EYCNST
                    XZFS3=XZFS3 + YYZ(KL,17)*EZCNST
C
                    XXFS4=XXFS4 + YYX(KL,18)*EXCNST
                    XYFS4=XYFS4 + YYY(KL,18)*EYCNST
                    XZFS4=XZFS4 + YYZ(KL,18)*EZCNST
                  END IF
C
                  IF(KNO .GT. 2) THEN
                    IF(KL .LE. ITTM2) THEN
                      KSPOT=KM2M0 + KLM1*K2M2M0
                      EXCNST=EX(IESZ+KSPOT)*CONST
                      EYCNST=EY(IESZ+KSPOT)*CONST
                      EZCNST=EZ(IESZ+KSPOT)*CONST
C
                      XXFS5=XXFS5 + YYX(KL,5)*EXCNST
                      XYFS5=XYFS5 + YYY(KL,5)*EYCNST
                      XZFS5=XZFS5 + YYZ(KL,5)*EZCNST
C
                      XXFS6=XXFS6 + YYX(KL,6)*EXCNST
                      XYFS6=XYFS6 + YYY(KL,6)*EYCNST
                      XZFS6=XZFS6 + YYZ(KL,6)*EZCNST
                    END IF
                  END IF
  600           CONTINUE
C
                XX0(JN,LN)=XXX1
                XY0(JN,LN)=XYY1
                XZ0(JN,LN)=XZZ1
C
                XXFIR(JN,LN,1)=XXX2
                XYFIR(JN,LN,1)=XYY2
                XZFIR(JN,LN,1)=XZZ2
C
                XXSEC(JN,LN,1)=XXX3
                XYSEC(JN,LN,1)=XYY3
                XZSEC(JN,LN,1)=XZZ3
C
                XXTHR(JN,LN,1)=XXX9
                XYTHR(JN,LN,1)=XYY9
                XZTHR(JN,LN,1)=XZZ9
C
                XXFIR(JN,LN,2)=XXC1*CC2 - DUMK*XXC2
                XYFIR(JN,LN,2)=XYC1*CC2 - DUMK*XYC2
                XZFIR(JN,LN,2)=XZC1*CC2 - DUMK*XZC2
C
                XXSEC(JN,LN,2)=C4*XX2C1 - C2DK*XXX1 + DUMKM1*XX2C2
                XYSEC(JN,LN,2)=C4*XY2C1 - C2DK*XYY1 + DUMKM1*XY2C2
                XZSEC(JN,LN,2)=C4*XZ2C1 - C2DK*XZZ1 + DUMKM1*XZ2C2
C
                XXTHR(JN,LN,2)=C8*XX3C1 - C12DK*XXC1 + C6DK*XXC2
                XYTHR(JN,LN,2)=C8*XY3C1 - C12DK*XYC1 + C6DK*XYC2
                XZTHR(JN,LN,2)=C8*XZ3C1 - C12DK*XZC1 + C6DK*XZC2
C
                IMX=0
                IFS=0
C
                IMX=IMX+1
                XXMXFF(JN,LN,IMX)=AC4*XXAC1 - A2DK*XXAC2 + DIDK*XXAC3
     *            - C2DI*XXAC4
                XYMXFF(JN,LN,IMX)=AC4*XYAC1 - A2DK*XYAC2 + DIDK*XYAC3
     *            - C2DI*XYAC4
                XZMXFF(JN,LN,IMX)=AC4*XZAC1 - A2DK*XZAC2 + DIDK*XZAC3
     *            - C2DI*XZAC4
                IFS=IFS+1
                XXFSMX(JN,LN,IFS)= AAC8*XXSF1 - AC4*DUMI2*XXSF3
     *                             + CC2*DUMIM1*XXSF2 - A4*DUMK*XXSF4
     *                      + AA2*DUMK*DUMI2*XXSF6 - DUMIM1*DUMK*XXSF5
                XYFSMX(JN,LN,IFS)= AAC8*XYSF1 - AC4*DUMI2*XYSF3
     *                             + CC2*DUMIM1*XYSF2 - A4*DUMK*XYSF4
     *                      + AA2*DUMK*DUMI2*XYSF6 - DUMIM1*DUMK*XYSF5
                XZFSMX(JN,LN,IFS)= AAC8*XZSF1 - AC4*DUMI2*XZSF3
     *                             + CC2*DUMIM1*XZSF2 - A4*DUMK*XZSF4
     *                      + AA2*DUMK*DUMI2*XZSF6 - DUMIM1*DUMK*XZSF5
                IFS=IFS+1
                XXFSMX(JN,LN,IFS)= CCA8*XXFS1 - AC4*DUMK2*XXFS3
     *                             + AA2*DUMKM1*XXFS5 - C4*DUMI*XXFS2
     *                      + CC2*DUMI*DUMK2*XXFS4 - DUMKM1*DUMI*XXFS6
                XYFSMX(JN,LN,IFS)= CCA8*XYFS1 - AC4*DUMK2*XYFS3
     *                             + AA2*DUMKM1*XYFS5 - C4*DUMI*XYFS2
     *                      + CC2*DUMI*DUMK2*XYFS4 - DUMKM1*DUMI*XYFS6
                XZFSMX(JN,LN,IFS)= CCA8*XZFS1 - AC4*DUMK2*XZFS3
     *                             + AA2*DUMKM1*XZFS5 - C4*DUMI*XZFS2
     *                      + CC2*DUMI*DUMK2*XZFS4 - DUMKM1*DUMI*XZFS6
 6000         CONTINUE
 7000       CONTINUE
C
 8000     CONTINUE
 9000   CONTINUE
C
C
C   ACTUALLY FORM THE INTEGRALS
C
        ICNT=0
        IJCNT=0
        IORBMX=IORB1 -1 + NUMI
        JORBMX=JORB1 -1 + NUMJ
        DO 5000 IORB=IORB1,IORBMX
          IF(BOTH1) JORBMX=IORB
          DO 4000 JORB=JORB1,JORBMX
            IJORB=IOFF(MAX0(IORB,JORB)) + MIN0(IORB,JORB)
            IJCNT=IJCNT + 1
            JNX=IJX(IJCNT)
            JNY=IJY(IJCNT)
            JNZ=IJZ(IJCNT)
            KLCNT=0
            KORBMX=KORB1 -1 + NUMK
            LORBMX=LORB1 -1 + NUML
            IF(ISHELL .EQ. KSHELL) KORBMX=IORB
            DO 3000 KORB=KORB1,KORBMX
              IF(BOTH2) LORBMX=KORB
              DO 2000 LORB=LORB1,LORBMX
                KLORB=IOFF(MAX0(KORB,LORB)) + MIN0(KORB,LORB)
                IJKL=IOFF(MAX0(IJORB,KLORB)) + MIN0(IJORB,KLORB)
                IF(KLORB .GT. IJORB) GO TO 3000
                ICNT=ICNT + 1
                IF(ICNT .GT. IMEM4) WRITE(IOUT,*) ' ICNT = ',ICNT
                KLCNT=KLCNT + 1
                LNX=KLX(KLCNT)
                LNY=KLY(KLCNT)
                LNZ=KLZ(KLCNT)
C               G(ICNT)=G(ICNT) + XX0(JNX,LNX)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
C
C   CENTER 1 DERIVATIVES
C
C
C   FIRST DERIVATIVES
C
                  GMXFIR(ICNT,1,1)= GMXFIR(ICNT,1,1) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,2,1)= GMXFIR(ICNT,2,1) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,3,1)= GMXFIR(ICNT,3,1) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
C
C   SECOND DERIVATIVES
C
                  GMXSEC(ICNT,1,1)= GMXSEC(ICNT,1,1) +
     *            XXSEC(JNX,LNX,1)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,2,1)= GMXSEC(ICNT,2,1) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,3,1)= GMXSEC(ICNT,3,1) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,4,1)= GMXSEC(ICNT,4,1) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXSEC(ICNT,5,1)= GMXSEC(ICNT,5,1) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,1)
                  GMXSEC(ICNT,6,1)= GMXSEC(ICNT,6,1) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,1)
C
C   THIRD DERIVATIVES
C
                  GMXTHR(ICNT,1,1)=GMXTHR(ICNT,1,1) +
     *            XXTHR(JNX,LNX,1)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,2,1)=GMXTHR(ICNT,2,1) +
     *            XXSEC(JNX,LNX,1)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,3,1)=GMXTHR(ICNT,3,1) +
     *            XXFIR(JNX,LNX,1)*XYSEC(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,4,1)=GMXTHR(ICNT,4,1) +
     *            XX0(JNX,LNX)*XYTHR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,5,1)=GMXTHR(ICNT,5,1) +
     *            XXSEC(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXTHR(ICNT,6,1)=GMXTHR(ICNT,6,1) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,
     *            1)
                  GMXTHR(ICNT,7,1)=GMXTHR(ICNT,7,1) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,1)*XZFIR(JNZ,LNZ,1)
                  GMXTHR(ICNT,8,1)=GMXTHR(ICNT,8,1) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,1)
                  GMXTHR(ICNT,9,1)=GMXTHR(ICNT,9,1) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZSEC(JNZ,LNZ,1)
                  GMXTHR(ICNT,10,1)=GMXTHR(ICNT,10,1) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZTHR(JNZ,LNZ,1)
C
C   CENTER 3 DERIVATIVES
C
C
C   FIRST DERIVATIVES
C
                  GMXFIR(ICNT,1,2)= GMXFIR(ICNT,1,2) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,2,2)= GMXFIR(ICNT,2,2) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,3,2)= GMXFIR(ICNT,3,2) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
C
C   SECOND DERIVATIVES
C
                  GMXSEC(ICNT,1,2)= GMXSEC(ICNT,1,2) +
     *            XXSEC(JNX,LNX,2)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,2,2)= GMXSEC(ICNT,2,2) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,3,2)= GMXSEC(ICNT,3,2) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,4,2)= GMXSEC(ICNT,4,2) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXSEC(ICNT,5,2)= GMXSEC(ICNT,5,2) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,2)
                  GMXSEC(ICNT,6,2)= GMXSEC(ICNT,6,2) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,2)
C
C   THIRD DERIVATIVES
C
                  GMXTHR(ICNT,1,2)=GMXTHR(ICNT,1,2) +
     *            XXTHR(JNX,LNX,2)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,2,2)=GMXTHR(ICNT,2,2) +
     *            XXSEC(JNX,LNX,2)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,3,2)=GMXTHR(ICNT,3,2) +
     *            XXFIR(JNX,LNX,2)*XYSEC(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,4,2)=GMXTHR(ICNT,4,2) +
     *            XX0(JNX,LNX)*XYTHR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,5,2)=GMXTHR(ICNT,5,2) +
     *            XXSEC(JNX,LNX,2)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXTHR(ICNT,6,2)=GMXTHR(ICNT,6,2) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,
     *            2)
                  GMXTHR(ICNT,7,2)=GMXTHR(ICNT,7,2) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,2)*XZFIR(JNZ,LNZ,2)
                  GMXTHR(ICNT,8,2)=GMXTHR(ICNT,8,2) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,2)
                  GMXTHR(ICNT,9,2)=GMXTHR(ICNT,9,2) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZSEC(JNZ,LNZ,2)
                  GMXTHR(ICNT,10,2)=GMXTHR(ICNT,10,2) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZTHR(JNZ,LNZ,2)
C
C   CENTER 1 AND 3 MIXED DERIVATIVES
C
                 IMX=0
                 IFS=0
 
C
C   SECOND DERIVATIVES
C
                  IMX=IMX + 1
                  KKPOS=2
                  GMXFF(ICNT,1,IMX)= GMXFF(ICNT,1,IMX) +
     *            XXMXFF(JNX,LNX,IMX)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,2,IMX)= GMXFF(ICNT,2,IMX) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,KKPOS)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,3,IMX)= GMXFF(ICNT,3,IMX) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,KKPOS)
                  GMXFF(ICNT,4,IMX)= GMXFF(ICNT,4,IMX) +
     *            XXFIR(JNX,LNX,KKPOS)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,5,IMX)= GMXFF(ICNT,5,IMX) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,IMX)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,6,IMX)= GMXFF(ICNT,6,IMX) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,KKPOS)
                  GMXFF(ICNT,7,IMX)= GMXFF(ICNT,7,IMX) +
     *            XXFIR(JNX,LNX,KKPOS)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFF(ICNT,8,IMX)= GMXFF(ICNT,8,IMX) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,KKPOS)*XZFIR(JNZ,LNZ,1)
                  GMXFF(ICNT,9,IMX)= GMXFF(ICNT,9,IMX) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,IMX)
C
C   THIRD DERIVATIVES
C
                  IFS=IFS+1
                  GMXFS(ICNT,1,IFS)= GMXFS(ICNT,1,IFS) +
     *            XXFSMX(JNX,LNX,IFS)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,2,IFS)= GMXFS(ICNT,2,IFS) +
     *            XXSEC(JNX,LNX,1)*XYFIR(JNY,LNY,KKPOS)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,3,IFS)= GMXFS(ICNT,3,IFS) +
     *            XXSEC(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,KKPOS)
                  GMXFS(ICNT,4,IFS)= GMXFS(ICNT,4,IFS) +
     *            XXMXFF(JNX,LNX,IMX)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,5,IFS)= GMXFS(ICNT,5,IFS) +
     *            XXFIR(JNX,LNX,1)*XYMXFF(JNY,LNY,IMX)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,6,IFS)= GMXFS(ICNT,6,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,KKPOS)
                  GMXFS(ICNT,7,IFS)= GMXFS(ICNT,7,IFS) +
     *            XXMXFF(JNX,LNX,IMX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,8,IFS)= GMXFS(ICNT,8,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,KKPOS)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,9,IFS)= GMXFS(ICNT,9,IFS) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,IMX)
                  GMXFS(ICNT,10,IFS)= GMXFS(ICNT,10,IFS) +
     *            XXFIR(JNX,LNX,KKPOS)*XYSEC(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,11,IFS)= GMXFS(ICNT,11,IFS) +
     *            XX0(JNX,LNX)*XYFSMX(JNY,LNY,IFS)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,12,IFS)= GMXFS(ICNT,12,IFS) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,1)*XZFIR(JNZ,LNZ,KKPOS)
                  GMXFS(ICNT,13,IFS)= GMXFS(ICNT,13,IFS) +
     *            XXFIR(JNX,LNX,KKPOS)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,14,IFS)= GMXFS(ICNT,14,IFS) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,IMX)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,15,IFS)= GMXFS(ICNT,15,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZMXFF(JNZ,LNZ,IMX)
                  GMXFS(ICNT,16,IFS)= GMXFS(ICNT,16,IFS) +
     *            XXFIR(JNX,LNX,KKPOS)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,1)
                  GMXFS(ICNT,17,IFS)= GMXFS(ICNT,17,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,KKPOS)*XZSEC(JNZ,LNZ,1)
                  GMXFS(ICNT,18,IFS)= GMXFS(ICNT,18,IFS) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFSMX(JNZ,LNZ,IFS)
C
                  IFS=IFS+1
                  GMXFS(ICNT,1,IFS)= GMXFS(ICNT,1,IFS) +
     *            XXFSMX(JNX,LNX,IFS)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,2,IFS)= GMXFS(ICNT,2,IFS) +
     *            XXSEC(JNX,LNX,KKPOS)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,3,IFS)= GMXFS(ICNT,3,IFS) +
     *            XXSEC(JNX,LNX,KKPOS)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,4,IFS)= GMXFS(ICNT,4,IFS) +
     *            XXMXFF(JNX,LNX,IMX)*XYFIR(JNY,LNY,KKPOS)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,5,IFS)= GMXFS(ICNT,5,IFS) +
     *            XXFIR(JNX,LNX,KKPOS)*XYMXFF(JNY,LNY,IMX)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,6,IFS)= GMXFS(ICNT,6,IFS) +
     *            XXFIR(JNX,LNX,KKPOS)*XYFIR(JNY,LNY,KKPOS)*XZFIR(JNZ,
     *            LNZ,1)
                  GMXFS(ICNT,7,IFS)= GMXFS(ICNT,7,IFS) +
     *            XXMXFF(JNX,LNX,IMX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,KKPOS)
                  GMXFS(ICNT,8,IFS)= GMXFS(ICNT,8,IFS) +
     *            XXFIR(JNX,LNX,KKPOS)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,
     *            KKPOS)
                  GMXFS(ICNT,9,IFS)= GMXFS(ICNT,9,IFS) +
     *            XXFIR(JNX,LNX,KKPOS)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,IMX)
                  GMXFS(ICNT,10,IFS)= GMXFS(ICNT,10,IFS) +
     *            XXFIR(JNX,LNX,1)*XYSEC(JNY,LNY,KKPOS)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,11,IFS)= GMXFS(ICNT,11,IFS) +
     *            XX0(JNX,LNX)*XYFSMX(JNY,LNY,IFS)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,12,IFS)= GMXFS(ICNT,12,IFS) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,KKPOS)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,13,IFS)= GMXFS(ICNT,13,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,KKPOS)*XZFIR(JNZ,LNZ,
     *            KKPOS)
                  GMXFS(ICNT,14,IFS)= GMXFS(ICNT,14,IFS) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,IMX)*XZFIR(JNZ,LNZ,KKPOS)
                  GMXFS(ICNT,15,IFS)= GMXFS(ICNT,15,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,KKPOS)*XZMXFF(JNZ,LNZ,IMX)
                  GMXFS(ICNT,16,IFS)= GMXFS(ICNT,16,IFS) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,KKPOS)
                  GMXFS(ICNT,17,IFS)= GMXFS(ICNT,17,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZSEC(JNZ,LNZ,KKPOS)
                  GMXFS(ICNT,18,IFS)= GMXFS(ICNT,18,IFS) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFSMX(JNZ,LNZ,IFS)
 2000         CONTINUE
 3000       CONTINUE
 4000     CONTINUE
 5000   CONTINUE
C
10000 CONTINUE
C
      IGCNT=ICNT
C
      RETURN
      END
C***********************************************************************
C
C   CENTER 1 AND 4  DERIVATIVES ARE CALCULATED
C
C***********************************************************************
      SUBROUTINE CENT14(GT,GU,GV,XX0,XY0,XZ0,XXFIR,XYFIR,XZFIR
     *,                 XXSEC,XYSEC,XZSEC,XXMXFF,XYMXFF,XZMXFF,GMXFIR
     *,                 GMXSEC,GMXFF,LO,XXTHR,XYTHR,XZTHR
     *,                 XXFFF,XYFFF,XZFFF,XXFSMX,XYFSMX,XZFSMX,GMXTHR
     *,                 GMXFFF,GMXFS)
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER GSPOT
      LOGICAL BOTH1,BOTH2
      LOGICAL EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      DIMENSION YX(8,14),YY(8,14),YZ(8,14)
      DIMENSION GT(I4LARL,I2LARL),GU(I4LARL,I2LARL)
      DIMENSION GV(I4LARL,I2LARL)
      DIMENSION ITEST(10)
      DIMENSION YYX(8,18),YYY(8,18),YYZ(8,18)
      DIMENSION XX0(IANGSQ,IANGSQ),XY0(IANGSQ,IANGSQ),XZ0(IANGSQ,IANGSQ)
      DIMENSION XXFIR(IANGSQ,IANGSQ,3),XYFIR(IANGSQ,IANGSQ,3)
      DIMENSION XZFIR(IANGSQ,IANGSQ,3),XXSEC(IANGSQ,IANGSQ,3)
      DIMENSION XYSEC(IANGSQ,IANGSQ,3),XZSEC(IANGSQ,IANGSQ,3)
      DIMENSION XXMXFF(IANGSQ,IANGSQ,3),XYMXFF(IANGSQ,IANGSQ,3)
      DIMENSION XZMXFF(IANGSQ,IANGSQ,3),GMXFIR(IMEM4,3,3)
      DIMENSION GMXSEC(IMEM4,6,3),GMXFF(IMEM4,9,3)
      DIMENSION LO(IMEM4*5)
      DIMENSION XXTHR(IANGSQ,IANGSQ,3),XYTHR(IANGSQ,IANGSQ,3)
     *,         XZTHR(IANGSQ,IANGSQ,3),XXFFF(IANGSQ,IANGSQ)
     *,         XYFFF(IANGSQ,IANGSQ),XZFFF(IANGSQ,IANGSQ)
      DIMENSION XXFSMX(IANGSQ,IANGSQ,6),XYFSMX(IANGSQ,IANGSQ,6)
     *,         XZFSMX(IANGSQ,IANGSQ,6)
      DIMENSION GMXTHR(IMEM4,10,3),GMXFFF(IMEM4,27),GMXFS(IMEM4,18,6)
      COMMON/CALQN/ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET
      COMMON/EINFO/IPLACE(49),ISAME(49)
      COMMON/EXYZS/EX(686),EY(686),EZ(686)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/IPAR5/IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL
      COMMON/LOGIC/EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      COMMON/ORBIN/IORB1,JORB1,KORB1,LORB1,NUMI,NUMJ,NUMK,NUML
      COMMON/PASS /II,JJ,KK,LL
      COMMON/POSNS/IJX(50),IJY(50),IJZ(50),KLX(50),KLY(50),KLZ(50)
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/TWINF/ISHELL,JSHELL,KSHELL,LSHELL
C
      ISIZ=   7
      ISIZ2= 14
      ISIZ3= 21
      IESZ=343
C
      RETURN
C
      ENTRY DER14(BOTH1,BOTH2,IQN,JQN,KQN,LQN,IGCNT,NROOT0,AA,BB,CC,DD,
     *ITEST)
C
      AA2=AA + AA
      DD2=DD + DD
      A4=AA2 * AA2
      D4=DD2 * DD2
      A8=A4 * AA2
      D8=D4 * DD2
      AD4=AA2*DD2
      AAD8=AD4 * AA2
      DDA8=AD4 * DD2
C
      NROOT=NROOT0 + NDERIV
      KLQN=KQN+LQN -1
      KLQNP1=KLQN + 1
      KLQNP2=KLQN + 2
      KLQNP3=KLQN + 3
      MAX=KLQN + IQN + JQN -1
C
      DO 10000 IROOT=1,NROOT
C
        IN=-IANG
        IM=-ISIZ
C
        DO 9000 INO=1,IQN
C
          IN=IN + IANG
          IM=IM + ISIZ
C
          DUMI=DBLE(INO-1)
          DUMIM1=DBLE((INO-1)*(INO-2))
          DUMI2=DBLE(2*INO -1)
          A2DI=AA2*DUMI2
          D2DI=DD2*DUMI
          A12DI=3.0D0*A4*DBLE(INO)
          A6DI=3.0D0*AA2*DUMI*DUMI
C
          DO 8000 JNO=1,JQN
C
            JN=JNO + IN
            JM=JNO + IM
C
C
            IPL=IPLACE(JM)
            ITWO=2
            IF(ISAME(JM) .EQ. 1) ITWO=1
C
C
            JP1P0=JM + ISIZ
            IP1P0=IPLACE(JP1P0)
            I2P1P0=2
            IF(ISAME(JP1P0) .EQ. 1) I2P1P0=1
            JP2P0=JM + ISIZ2
            IP2P0=IPLACE(JP2P0)
            I2P2P0=2
            IF(ISAME(JP2P0) .EQ. 1) I2P2P0=1
            JP3P0=JM + ISIZ3
            IP3P0=IPLACE(JP3P0)
            I2P3P0=2
            IF(ISAME(JP3P0) .EQ. 1) I2P3P0=1
            IF(INO .GT. 1) THEN
              JM1M0=JM - ISIZ
              IM1M0=IPLACE(JM1M0)
              I2M1M0=2
              IF(ISAME(JM1M0) .EQ. 1) I2M1M0=1
              IF(INO .GT. 2) THEN
                JM2M0=JM -ISIZ2
                IM2M0=IPLACE(JM2M0)
                I2M2M0=2
                IF(ISAME(JM2M0) .EQ. 1) I2M2M0=1
              END IF
            END IF
C
C
            IT=INO + JNO - 1
            ITM1=IT-1
            ITM2=IT-2
            ITM3=IT-3
            ITZERO=IT
            ITFIR=IT + 1
            ITSEC=IT + 2
            ITTHR=IT + 3
C
C   ZEROTH ORDER SECTION
C
            DO 150 IKL=1,KLQN
              YX0=0.0D0
              YY0=0.0D0
              YZ0=0.0D0
              DO 100 IJ=1,IT
                IJM1=IJ-1
                ISPOT=IPL + IJM1*ITWO
                GSPOT=IKL + IJM1
                YX0=YX0 + EX(ISPOT)*GT(GSPOT,IROOT)
                YY0=YY0 + EY(ISPOT)*GU(GSPOT,IROOT)
                YZ0=YZ0 + EZ(ISPOT)*GV(GSPOT,IROOT)
  100         CONTINUE
C
              YX(IKL,1)=YX0
              YY(IKL,1)=YY0
              YZ(IKL,1)=YZ0
C
  150       CONTINUE
C
              DO 300 IKL=1,KLQN
                YX0=YX(IKL,1)
                YY0=YY(IKL,1)
                YZ0=YZ(IKL,1)
                YXA1=0.0D0
                YYA1=0.0D0
                YZA1=0.0D0
                YXA2=0.0D0
                YYA2=0.0D0
                YZA2=0.0D0
                YX2A1=0.0D0
                YY2A1=0.0D0
                YZ2A1=0.0D0
                YX2A2=0.0D0
                YY2A2=0.0D0
                YZ2A2=0.0D0
                YX3A1=0.0D0
                YY3A1=0.0D0
                YZ3A1=0.0D0
                DO 200 IJ=1,ITTHR
                  IJM1=IJ-1
                  GSPOT=IKL + IJM1
C
C   FIRST DERIVATIVE SECTION
C
                  IF(IJ .GT. ITFIR) GO TO 160
C
                    ISPOT=IP1P0 + IJM1*I2P1P0
                    YXA1=YXA1 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YYA1=YYA1 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZA1=YZA1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                    IF(INO .GT. 1) THEN
                      IF(IJ .LE. ITM1) THEN
                        ISPOT=IM1M0 + IJM1*I2M1M0
                        YXA2=YXA2 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YYA2=YYA2 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZA2=YZA2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                    END IF
  160              CONTINUE
C
C   SECOND DERIVATIVE SECTION
C
                  IF(IJ .GT. ITSEC) GO TO 170
                    ISPOT=IP2P0 + IJM1*I2P2P0
                    YX2A1=YX2A1 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YY2A1=YY2A1 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZ2A1=YZ2A1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                    IF(INO .GT. 2) THEN
                      IF(IJ .LE. ITM2) THEN
                        ISPOT=IM2M0 + IJM1*I2M2M0
                        YX2A2=YX2A2 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YY2A2=YY2A2 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZ2A2=YZ2A2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                    END IF
C
C
  170             CONTINUE
C
C   THIRD DERIVATIVES
C
                  ISPOT=IP3P0 + IJM1*I2P3P0
                  YX3A1=YX3A1 + EX(ISPOT)*GT(GSPOT,IROOT)
                  YY3A1=YY3A1 + EY(ISPOT)*GU(GSPOT,IROOT)
                  YZ3A1=YZ3A1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
C
  200           CONTINUE
C
              YX(IKL,2)=YXA1*AA2 - DUMI*YXA2
              YY(IKL,2)=YYA1*AA2 - DUMI*YYA2
              YZ(IKL,2)=YZA1*AA2 - DUMI*YZA2
C
              YX(IKL,3)=YX2A1*A4 - A2DI*YX0 + DUMIM1*YX2A2
              YY(IKL,3)=YY2A1*A4 - A2DI*YY0 + DUMIM1*YY2A2
              YZ(IKL,3)=YZ2A1*A4 - A2DI*YZ0 + DUMIM1*YZ2A2
C
              YX(IKL,9)=YX3A1*A8 - A12DI*YXA1 + YXA2*A6DI
              YY(IKL,9)=YY3A1*A8 - A12DI*YYA1 + YYA2*A6DI
              YZ(IKL,9)=YZ3A1*A8 - A12DI*YZA1 + YZA2*A6DI
C
              YYX(IKL,17)=YXA1
              YYY(IKL,17)=YYA1
              YYZ(IKL,17)=YZA1
C
              YYX(IKL,18)=YXA2
              YYY(IKL,18)=YYA2
              YYZ(IKL,18)=YZA2
C
  300       CONTINUE
C
            DO 375 IKL=1,KLQNP3
              YX3=0.0D0
              YY3=0.0D0
              YZ3=0.0D0
              DO 350 IJ=1,IT
                IJM1=IJ-1
                ISPOT=IPL + IJM1*ITWO
                GSPOT=IKL + IJM1
                YX3=YX3 + EX(ISPOT)*GT(GSPOT,IROOT)
                YY3=YY3 + EY(ISPOT)*GU(GSPOT,IROOT)
                YZ3=YZ3 + EZ(ISPOT)*GV(GSPOT,IROOT)
  350         CONTINUE
              IF(IKL .LE. KLQNP1) THEN
                YX(IKL,7)=YX3
                YY(IKL,7)=YY3
                YZ(IKL,7)=YZ3
              END IF
              IF(IKL .LE. KLQNP2) THEN
                YX(IKL,8)=YX3
                YY(IKL,8)=YY3
                YZ(IKL,8)=YZ3
              END IF
              YX(IKL,13)=YX3
              YY(IKL,13)=YY3
              YZ(IKL,13)=YZ3
  375       CONTINUE
C
C   MIXED CENTER DERIVATIVES
C
              DO 500 IKL=1,KLQNP2
                  YXA1=0.0D0
                  YYA1=0.0D0
                  YZA1=0.0D0
                  YXA2=0.0D0
                  YYA2=0.0D0
                  YZA2=0.0D0
                  YXA3=0.0D0
                  YYA3=0.0D0
                  YZA3=0.0D0
                  YXA4=0.0D0
                  YYA4=0.0D0
                  YZA4=0.0D0
                  YXA5=0.0D0
                  YYA5=0.0D0
                  YZA5=0.0D0
                  YXA6=0.0D0
                  YYA6=0.0D0
                  YZA6=0.0D0
                DO 450 IJ=1,ITSEC
                  IJM1=IJ - 1
                  GSPOT=IJM1 + IKL
C
                    IF(IJ .GT. ITFIR) GO TO 410
                    ISPOT=IP1P0 + IJM1*I2P1P0
                    EXCNST=EX(ISPOT)*GT(GSPOT,IROOT)
                    EYCNST=EY(ISPOT)*GU(GSPOT,IROOT)
                    EZCNST=EZ(ISPOT)*GV(GSPOT,IROOT)
                    IF(IKL .LE. KLQNP1) THEN
                      YXA1=YXA1 + EXCNST
                      YYA1=YYA1 + EYCNST
                      YZA1=YZA1 + EZCNST
                    END IF
                    YXA3=YXA3 + EXCNST
                    YYA3=YYA3 + EYCNST
                    YZA3=YZA3 + EZCNST
C
                    IF(INO .GT. 1) THEN
                      IF(IJ .LE. ITM1) THEN
                        ISPOT=IM1M0 + IJM1*I2M1M0
                        EXCNST=EX(ISPOT)*GT(GSPOT,IROOT)
                        EYCNST=EY(ISPOT)*GU(GSPOT,IROOT)
                        EZCNST=EZ(ISPOT)*GV(GSPOT,IROOT)
                        IF(IKL .LE. KLQNP1) THEN
                          YXA2=YXA2 + EXCNST
                          YYA2=YYA2 + EYCNST
                          YZA2=YZA2 + EZCNST
                        END IF
                        YXA4=YXA4 + EXCNST
                        YYA4=YYA4 + EYCNST
                        YZA4=YZA4 + EZCNST
                      END IF
                    END IF
C
  410               CONTINUE
                    IF(IKL .GT. KLQNP1) GO TO 420
                    ISPOT=IP2P0 + IJM1*I2P2P0
                    YXA5=YXA5 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YYA5=YYA5 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZA5=YZA5 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                    IF(INO .GT. 2) THEN
                      IF(IJ .LE. ITM2) THEN
                        ISPOT=IM2M0 + IJM1*I2M2M0
                        YXA6=YXA6 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YYA6=YYA6 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZA6=YZA6 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                    END IF
C
  420               CONTINUE
C
C
  450           CONTINUE
C
                  YYX(IKL,1)=YXA1
                  YYY(IKL,1)=YYA1
                  YYZ(IKL,1)=YZA1
C
                  YYX(IKL,2)=YXA2
                  YYY(IKL,2)=YYA2
                  YYZ(IKL,2)=YZA2
C
                  YYX(IKL,5)=YXA3
                  YYY(IKL,5)=YYA3
                  YYZ(IKL,5)=YZA3
C
                  YYX(IKL,6)=YXA4
                  YYY(IKL,6)=YYA4
                  YYZ(IKL,6)=YZA4
C
                  YYX(IKL,9)=YXA5
                  YYY(IKL,9)=YYA5
                  YYZ(IKL,9)=YZA5
C
                  YYX(IKL,10)=YXA6
                  YYY(IKL,10)=YYA6
                  YYZ(IKL,10)=YZA6
C
  500         CONTINUE
C
            KN=-IANG
            KM=-ISIZ
C
            DO 7000 KNO=1,KQN
C
              KN=KN + IANG
              KM=KM + ISIZ
C
              DO 6000 LNO=1,LQN
C
                LN=LNO + KN
                LM=LNO + KM
C
                DUML=DBLE(LNO-1)
                DUMLM1=DBLE((LNO-1)*(LNO-2))
                DUML2=DBLE(2*LNO -1)
                D2DL=DD2*DUML2
                D12DL=3.0D0*D4*DBLE(LNO)
                D6DL=3.0D0*DD2*DUML*DUML
                A2DL=AA2*DUML
                DIDL=DUMI*DUML
C
                ITT=KNO + LNO -1
                ITTM1=ITT-1
                ITTM2=ITT-2
                ITTM3=ITT-3
                ITTFIR=ITT + 1
                ITTSEC=ITT + 2
                ITTTHR=ITT + 3
C
                KPL=IPLACE(LM)
                KTWO=2
                IF(ISAME(LM) .EQ. 1) KTWO=1
C
                  LP0P1=LM + 1
                  KP0P1=IPLACE(LP0P1)
                  K2P0P1=2
                  IF(ISAME(LP0P1) .EQ. 1) K2P0P1=1
                  LP0P2=LM + 2
                  KP0P2=IPLACE(LP0P2)
                  K2P0P2=2
                  IF(ISAME(LP0P2) .EQ. 1) K2P0P2=1
                  LP0P3=LM + 3
                  KP0P3=IPLACE(LP0P3)
                  K2P0P3=2
                  IF(ISAME(LP0P3) .EQ. 1) K2P0P3=1
                  IF(LNO .GT. 1) THEN
                    LM0M1=LM - 1
                    KM0M1=IPLACE(LM0M1)
                    K2M0M1=2
                    IF(ISAME(LM0M1) .EQ. 1) K2M0M1=1
                    IF(LNO .GT. 2) THEN
                      LM0M2=LM - 2
                      KM0M2=IPLACE(LM0M2)
                      K2M0M2=2
                      IF(ISAME(LM0M2) .EQ. 1) K2M0M2=1
                    END IF
                  END IF
C
C
                XXX1=0.0D0
                XYY1=0.0D0
                XZZ1=0.0D0
                  XXX2=0.0D0
                  XYY2=0.0D0
                  XZZ2=0.0D0
                  XXX3=0.0D0
                  XYY3=0.0D0
                  XZZ3=0.0D0
                  XXX9=0.0D0
                  XYY9=0.0D0
                  XZZ9=0.0D0
                  XXD1=0.0D0
                  XYD1=0.0D0
                  XZD1=0.0D0
                  XXD2=0.0D0
                  XYD2=0.0D0
                  XZD2=0.0D0
                  XX2D1=0.0D0
                  XY2D1=0.0D0
                  XZ2D1=0.0D0
                  XX2D2=0.0D0
                  XY2D2=0.0D0
                  XZ2D2=0.0D0
                  XX3D1=0.0D0
                  XY3D1=0.0D0
                  XZ3D1=0.0D0
                  XXSF1=0.0D0
                  XYSF1=0.0D0
                  XZSF1=0.0D0
                  XXSF2=0.0D0
                  XYSF2=0.0D0
                  XZSF2=0.0D0
                  XXSF3=0.0D0
                  XYSF3=0.0D0
                  XZSF3=0.0D0
                  XXSF4=0.0D0
                  XYSF4=0.0D0
                  XZSF4=0.0D0
                  XXSF5=0.0D0
                  XYSF5=0.0D0
                  XZSF5=0.0D0
                  XXSF6=0.0D0
                  XYSF6=0.0D0
                  XZSF6=0.0D0
                  XXFS1=0.0D0
                  XYFS1=0.0D0
                  XZFS1=0.0D0
                  XXFS2=0.0D0
                  XYFS2=0.0D0
                  XZFS2=0.0D0
                  XXFS3=0.0D0
                  XYFS3=0.0D0
                  XZFS3=0.0D0
                  XXFS4=0.0D0
                  XYFS4=0.0D0
                  XZFS4=0.0D0
                  XXFS5=0.0D0
                  XYFS5=0.0D0
                  XZFS5=0.0D0
                  XXFS6=0.0D0
                  XYFS6=0.0D0
                  XZFS6=0.0D0
                  XXAD1=0.0D0
                  XXAD2=0.0D0
                  XXAD3=0.0D0
                  XXAD4=0.0D0
                  XYAD1=0.0D0
                  XYAD2=0.0D0
                  XYAD3=0.0D0
                  XYAD4=0.0D0
                  XZAD1=0.0D0
                  XZAD2=0.0D0
                  XZAD3=0.0D0
                  XZAD4=0.0D0
C
                CONST=-1.0D0
                DO 600 KL=1,ITTTHR
                  KLM1=KL - 1
                  CONST=-CONST
C
                  IF(KL .LE. ITT) THEN
C
C   ZEROTH ORDER SECTION
C
                    KSPOT=KPL + KLM1*KTWO
                    EXCNST=EX(IESZ+KSPOT)*CONST
                    EYCNST=EY(IESZ+KSPOT)*CONST
                    EZCNST=EZ(IESZ+KSPOT)*CONST
C
                    XXX1=XXX1 + YX(KL,1)*EXCNST
                    XYY1=XYY1 + YY(KL,1)*EYCNST
                    XZZ1=XZZ1 + YZ(KL,1)*EZCNST
C
C   CENTER 1 FIRST, SECOND AND THIRD DERIVATIVES
C
                      XXX2=XXX2 + YX(KL,2)*EXCNST
                      XYY2=XYY2 + YY(KL,2)*EYCNST
                      XZZ2=XZZ2 + YZ(KL,2)*EZCNST
C
                      XXX3=XXX3 + YX(KL,3)*EXCNST
                      XYY3=XYY3 + YY(KL,3)*EYCNST
                      XZZ3=XZZ3 + YZ(KL,3)*EZCNST
C
                      XXX9=XXX9 + YX(KL,9)*EXCNST
                      XYY9=XYY9 + YY(KL,9)*EYCNST
                      XZZ9=XZZ9 + YZ(KL,9)*EZCNST
                  END IF
C
C   CENTER 4 FIRST, SECOND, AND THIRD DERIVATIVES
C
                    IF(KL .GT. ITTFIR) GO TO 505
                    KSPOT=KP0P1 + KLM1*K2P0P1
                    XXD1=XXD1 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                    XYD1=XYD1 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                    XZD1=XZD1 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
C
                    IF(LNO .GT. 1) THEN
                      IF(KL .LE. ITTM1) THEN
                        KSPOT=KM0M1 + KLM1*K2M0M1
                        XXD2=XXD2 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                        XYD2=XYD2 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                        XZD2=XZD2 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
                      END IF
                    END IF
  505               CONTINUE
C
                    IF(KL .GT. ITTSEC) GO TO 510
                    KSPOT=KP0P2 + KLM1*K2P0P2
                    XX2D1=XX2D1 + YX(KL,8)*EX(IESZ+KSPOT)*CONST
                    XY2D1=XY2D1 + YY(KL,8)*EY(IESZ+KSPOT)*CONST
                    XZ2D1=XZ2D1 + YZ(KL,8)*EZ(IESZ+KSPOT)*CONST
C
                    IF(LNO .GT. 2) THEN
                      IF(KL .LE. ITTM2) THEN
                        KSPOT=KM0M2 + KLM1*K2M0M2
                        XX2D2=XX2D2 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                        XY2D2=XY2D2 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                        XZ2D2=XZ2D2 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
                      END IF
                    END IF
  510               CONTINUE
C
                  KSPOT=KP0P3 + KLM1*K2P0P3
                  XX3D1=XX3D1 + YX(KL,13)*EX(IESZ+KSPOT)*CONST
                  XY3D1=XY3D1 + YY(KL,13)*EY(IESZ+KSPOT)*CONST
                  XZ3D1=XZ3D1 + YZ(KL,13)*EZ(IESZ+KSPOT)*CONST
C
C   CENTERS 1 AND 4 MIXED DERIVATIVES
C
                  IF(KL .GT. ITTSEC) GO TO 600
C
                    IF(KL .LE. ITTFIR) THEN
                      KSPOT=KP0P1 + KLM1*K2P0P1
                      EXCNST=EX(IESZ+KSPOT)*CONST
                      EYCNST=EY(IESZ+KSPOT)*CONST
                      EZCNST=EZ(IESZ+KSPOT)*CONST
C
                      XXAD1=XXAD1 + YYX(KL,1)*EXCNST
                      XYAD1=XYAD1 + YYY(KL,1)*EYCNST
                      XZAD1=XZAD1 + YYZ(KL,1)*EZCNST
C
                      XXAD4=XXAD4 + YYX(KL,2)*EXCNST
                      XYAD4=XYAD4 + YYY(KL,2)*EYCNST
                      XZAD4=XZAD4 + YYZ(KL,2)*EZCNST
C
                      XXSF1=XXSF1 + YYX(KL,9)*EXCNST
                      XYSF1=XYSF1 + YYY(KL,9)*EYCNST
                      XZSF1=XZSF1 + YYZ(KL,9)*EZCNST
C
                      XXSF2=XXSF2 + YYX(KL,10)*EXCNST
                      XYSF2=XYSF2 + YYY(KL,10)*EYCNST
                      XZSF2=XZSF2 + YYZ(KL,10)*EZCNST
C
                      XXSF3=XXSF3 + YX(KL,7)*EXCNST
                      XYSF3=XYSF3 + YY(KL,7)*EYCNST
                      XZSF3=XZSF3 + YZ(KL,7)*EZCNST
C
                    END IF
                    IF(LNO .GT. 1) THEN
                      IF(KL .LE. ITTM1) THEN
                        KSPOT=KM0M1 + KLM1*K2M0M1
                        EXCNST=EX(IESZ+KSPOT)*CONST
                        EYCNST=EY(IESZ+KSPOT)*CONST
                        EZCNST=EZ(IESZ+KSPOT)*CONST
C
                        XXAD2=XXAD2 + YYX(KL,1)*EXCNST
                        XYAD2=XYAD2 + YYY(KL,1)*EYCNST
                        XZAD2=XZAD2 + YYZ(KL,1)*EZCNST
C
                        XXAD3=XXAD3 + YYX(KL,2)*EXCNST
                        XYAD3=XYAD3 + YYY(KL,2)*EYCNST
                        XZAD3=XZAD3 + YYZ(KL,2)*EZCNST
C
                        XXSF4=XXSF4 + YYX(KL,9)*EXCNST
                        XYSF4=XYSF4 + YYY(KL,9)*EYCNST
                        XZSF4=XZSF4 + YYZ(KL,9)*EZCNST
C
                        XXSF5=XXSF5 + YYX(KL,10)*EXCNST
                        XYSF5=XYSF5 + YYY(KL,10)*EYCNST
                        XZSF5=XZSF5 + YYZ(KL,10)*EZCNST
C
                        XXSF6=XXSF6 + YX(KL,7)*EXCNST
                        XYSF6=XYSF6 + YY(KL,7)*EYCNST
                        XZSF6=XZSF6 + YZ(KL,7)*EZCNST
                      END IF
                    END IF
C
                    KSPOT=KP0P2 + KLM1*K2P0P2
                    EXCNST=EX(IESZ+KSPOT)*CONST
                    EYCNST=EY(IESZ+KSPOT)*CONST
                    EZCNST=EZ(IESZ+KSPOT)*CONST
C
                    XXFS1=XXFS1 + YYX(KL,5)*EXCNST
                    XYFS1=XYFS1 + YYY(KL,5)*EYCNST
                    XZFS1=XZFS1 + YYZ(KL,5)*EZCNST
C
                    XXFS2=XXFS2 + YYX(KL,6)*EXCNST
                    XYFS2=XYFS2 + YYY(KL,6)*EYCNST
                    XZFS2=XZFS2 + YYZ(KL,6)*EZCNST
C
                    IF(KL .LE. ITT) THEN
                      KSPOT=KPL + KTWO*KLM1
                      EXCNST=EX(IESZ+KSPOT)*CONST
                      EYCNST=EY(IESZ+KSPOT)*CONST
                      EZCNST=EZ(IESZ+KSPOT)*CONST
C
                      XXFS3=XXFS3 + YYX(KL,17)*EXCNST
                      XYFS3=XYFS3 + YYY(KL,17)*EYCNST
                      XZFS3=XZFS3 + YYZ(KL,17)*EZCNST
C
                      XXFS4=XXFS4 + YYX(KL,18)*EXCNST
                      XYFS4=XYFS4 + YYY(KL,18)*EYCNST
                      XZFS4=XZFS4 + YYZ(KL,18)*EZCNST
                    END IF
C
                    IF(LNO .GT. 2) THEN
                      IF(KL .LE. ITTM2) THEN
                        KSPOT=KM0M2 + KLM1*K2M0M2
                        EXCNST=EX(IESZ+KSPOT)*CONST
                        EYCNST=EY(IESZ+KSPOT)*CONST
                        EZCNST=EZ(IESZ+KSPOT)*CONST
C
                        XXFS5=XXFS5 + YYX(KL,5)*EXCNST
                        XYFS5=XYFS5 + YYY(KL,5)*EYCNST
                        XZFS5=XZFS5 + YYZ(KL,5)*EZCNST
C
                        XXFS6=XXFS6 + YYX(KL,6)*EXCNST
                        XYFS6=XYFS6 + YYY(KL,6)*EYCNST
                        XZFS6=XZFS6 + YYZ(KL,6)*EZCNST
                      END IF
                    END IF
C
  600           CONTINUE
                IF(JN .GT. 9) WRITE(IOUT,*) 'JN TOO BIG  JN=',JN
                IF(LN .GT. 9) WRITE(IOUT,*) 'LN TOO BIG  LN=',LN
C
                XX0(JN,LN)=XXX1
                XY0(JN,LN)=XYY1
                XZ0(JN,LN)=XZZ1
C
                INT=0
                  INT=INT+1
                  XXFIR(JN,LN,INT)=XXX2
                  XYFIR(JN,LN,INT)=XYY2
                  XZFIR(JN,LN,INT)=XZZ2
C
                  XXSEC(JN,LN,INT)=XXX3
                  XYSEC(JN,LN,INT)=XYY3
                  XZSEC(JN,LN,INT)=XZZ3
C
                  XXTHR(JN,LN,INT)=XXX9
                  XYTHR(JN,LN,INT)=XYY9
                  XZTHR(JN,LN,INT)=XZZ9
C
                  INT=INT+1
                  XXFIR(JN,LN,INT)=XXD1*DD2 - DUML*XXD2
                  XYFIR(JN,LN,INT)=XYD1*DD2 - DUML*XYD2
                  XZFIR(JN,LN,INT)=XZD1*DD2 - DUML*XZD2
C
                  XXSEC(JN,LN,INT)=D4*XX2D1 - D2DL*XXX1 + DUMLM1*XX2D2
                  XYSEC(JN,LN,INT)=D4*XY2D1 - D2DL*XYY1 + DUMLM1*XY2D2
                  XZSEC(JN,LN,INT)=D4*XZ2D1 - D2DL*XZZ1 + DUMLM1*XZ2D2
C
                  XXTHR(JN,LN,INT)=D8*XX3D1 - D12DL*XXD1 + D6DL*XXD2
                  XYTHR(JN,LN,INT)=D8*XY3D1 - D12DL*XYD1 + D6DL*XYD2
                  XZTHR(JN,LN,INT)=D8*XZ3D1 - D12DL*XZD1 + D6DL*XZD2
C
               IMX=0
               IFS=0
                  IMX=IMX+1
                  XXMXFF(JN,LN,IMX)=AD4*XXAD1 - A2DL*XXAD2 + DIDL*XXAD3
     *            - D2DI*XXAD4
                  XYMXFF(JN,LN,IMX)=AD4*XYAD1 - A2DL*XYAD2 + DIDL*XYAD3
     *            - D2DI*XYAD4
                  XZMXFF(JN,LN,IMX)=AD4*XZAD1 - A2DL*XZAD2 + DIDL*XZAD3
     *            - D2DI*XZAD4
C
                  IFS=IFS+1
                  XXFSMX(JN,LN,IFS)= AAD8*XXSF1 - AD4*DUMI2*XXSF3
     *                             + DD2*DUMIM1*XXSF2 - A4*DUML*XXSF4
     *                      + AA2*DUML*DUMI2*XXSF6 - DUMIM1*DUML*XXSF5
                  XYFSMX(JN,LN,IFS)= AAD8*XYSF1 - AD4*DUMI2*XYSF3
     *                             + DD2*DUMIM1*XYSF2 - A4*DUML*XYSF4
     *                      + AA2*DUML*DUMI2*XYSF6 - DUMIM1*DUML*XYSF5
                  XZFSMX(JN,LN,IFS)= AAD8*XZSF1 - AD4*DUMI2*XZSF3
     *                             + DD2*DUMIM1*XZSF2 - A4*DUML*XZSF4
     *                      + AA2*DUML*DUMI2*XZSF6 - DUMIM1*DUML*XZSF5
                  IFS=IFS+1
                  XXFSMX(JN,LN,IFS)= DDA8*XXFS1 - AD4*DUML2*XXFS3
     *                             + AA2*DUMLM1*XXFS5 - D4*DUMI*XXFS2
     *                      + DD2*DUMI*DUML2*XXFS4 - DUMLM1*DUMI*XXFS6
                  XYFSMX(JN,LN,IFS)= DDA8*XYFS1 - AD4*DUML2*XYFS3
     *                             + AA2*DUMLM1*XYFS5 - D4*DUMI*XYFS2
     *                      + DD2*DUMI*DUML2*XYFS4 - DUMLM1*DUMI*XYFS6
                  XZFSMX(JN,LN,IFS)= DDA8*XZFS1 - AD4*DUML2*XZFS3
     *                             + AA2*DUMLM1*XZFS5 - D4*DUMI*XZFS2
     *                      + DD2*DUMI*DUML2*XZFS4 - DUMLM1*DUMI*XZFS6
C
 6000         CONTINUE
 7000       CONTINUE
C
 8000     CONTINUE
 9000   CONTINUE
C
C
C   ACTUALLY FORM THE INTEGRALS
C
        ICNT=0
        IJCNT=0
        IORBMX=IORB1 -1 + NUMI
        JORBMX=JORB1 -1 + NUMJ
        DO 5000 IORB=IORB1,IORBMX
          IF(BOTH1) JORBMX=IORB
          DO 4000 JORB=JORB1,JORBMX
            IJORB=IOFF(MAX0(IORB,JORB)) + MIN0(IORB,JORB)
            IJCNT=IJCNT + 1
            JNX=IJX(IJCNT)
            JNY=IJY(IJCNT)
            JNZ=IJZ(IJCNT)
            KLCNT=0
            KORBMX=KORB1 -1 + NUMK
            LORBMX=LORB1 -1 + NUML
            IF(ISHELL .EQ. KSHELL) KORBMX=IORB
            DO 3000 KORB=KORB1,KORBMX
              IF(BOTH2) LORBMX=KORB
              DO 2000 LORB=LORB1,LORBMX
                KLORB=IOFF(MAX0(KORB,LORB)) + MIN0(KORB,LORB)
                IJKL=IOFF(MAX0(IJORB,KLORB)) + MIN0(IJORB,KLORB)
                IF(KLORB .GT. IJORB) GO TO 3000
C
                ICNT=ICNT + 1
                IF(ICNT .GT. IMEM4) WRITE(IOUT,*) ' ICNT = ',ICNT
                KLCNT=KLCNT + 1
                LNX=KLX(KLCNT)
                LNY=KLY(KLCNT)
                LNZ=KLZ(KLCNT)
                INT=0
C
C   CENTER 1 DERIVATIVES
C
                  INT=INT+1
C
C   FIRST DERIVATIVES
C
                  GMXFIR(ICNT,1,INT)= GMXFIR(ICNT,1,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,2,INT)= GMXFIR(ICNT,2,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,3,INT)= GMXFIR(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
C
C   SECOND DERIVATIVES
C
                  GMXSEC(ICNT,1,INT)= GMXSEC(ICNT,1,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,2,INT)= GMXSEC(ICNT,2,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,3,INT)= GMXSEC(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,4,INT)= GMXSEC(ICNT,4,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,5,INT)= GMXSEC(ICNT,5,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,6,INT)= GMXSEC(ICNT,6,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
C
C   THIRD DERIVATIVES
C
                  GMXTHR(ICNT,1,INT)=GMXTHR(ICNT,1,INT) +
     *            XXTHR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,2,INT)=GMXTHR(ICNT,2,INT) +
     *            XXSEC(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,3,INT)=GMXTHR(ICNT,3,INT) +
     *            XXFIR(JNX,LNX,INT)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,4,INT)=GMXTHR(ICNT,4,INT) +
     *            XX0(JNX,LNX)*XYTHR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,5,INT)=GMXTHR(ICNT,5,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,6,INT)=GMXTHR(ICNT,6,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,
     *            INT)
                  GMXTHR(ICNT,7,INT)=GMXTHR(ICNT,7,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,8,INT)=GMXTHR(ICNT,8,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,9,INT)=GMXTHR(ICNT,9,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,10,INT)=GMXTHR(ICNT,10,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZTHR(JNZ,LNZ,INT)
C
C   CENTER 4 DERIVATIVES
C
                  INT=INT+1
C
C   FIRST DERIVATIVES
C
                  GMXFIR(ICNT,1,INT)= GMXFIR(ICNT,1,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,2,INT)= GMXFIR(ICNT,2,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,3,INT)= GMXFIR(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
C
C   SECOND DERIVATIVES
C
                  GMXSEC(ICNT,1,INT)= GMXSEC(ICNT,1,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,2,INT)= GMXSEC(ICNT,2,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,3,INT)= GMXSEC(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,4,INT)= GMXSEC(ICNT,4,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,5,INT)= GMXSEC(ICNT,5,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,6,INT)= GMXSEC(ICNT,6,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
C
C   THIRD DERIVATIVES
C
                  GMXTHR(ICNT,1,INT)=GMXTHR(ICNT,1,INT) +
     *            XXTHR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,2,INT)=GMXTHR(ICNT,2,INT) +
     *            XXSEC(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,3,INT)=GMXTHR(ICNT,3,INT) +
     *            XXFIR(JNX,LNX,INT)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,4,INT)=GMXTHR(ICNT,4,INT) +
     *            XX0(JNX,LNX)*XYTHR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,5,INT)=GMXTHR(ICNT,5,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,6,INT)=GMXTHR(ICNT,6,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,
     *            INT)
                  GMXTHR(ICNT,7,INT)=GMXTHR(ICNT,7,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,8,INT)=GMXTHR(ICNT,8,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,9,INT)=GMXTHR(ICNT,9,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,10,INT)=GMXTHR(ICNT,10,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZTHR(JNZ,LNZ,INT)
C
C   CENTER 1 AND CENTER 4 MIXED DERIVATIVES
C
C
C   SECOND DERIVATIVES
C
                  IMX=0
                  IFS=0
                  IMX=IMX + 1
                  GMXFF(ICNT,1,IMX)= GMXFF(ICNT,1,IMX) +
     *            XXMXFF(JNX,LNX,IMX)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,2,IMX)= GMXFF(ICNT,2,IMX) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,3,IMX)= GMXFF(ICNT,3,IMX) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFF(ICNT,4,IMX)= GMXFF(ICNT,4,IMX) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,5,IMX)= GMXFF(ICNT,5,IMX) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,IMX)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,6,IMX)= GMXFF(ICNT,6,IMX) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFF(ICNT,7,IMX)= GMXFF(ICNT,7,IMX) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFF(ICNT,8,IMX)= GMXFF(ICNT,8,IMX) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFF(ICNT,9,IMX)= GMXFF(ICNT,9,IMX) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,IMX)
C
C   THIRD DERIVATIVES
C
                  IFS=IFS+1
                  GMXFS(ICNT,1,IFS)= GMXFS(ICNT,1,IFS) +
     *            XXFSMX(JNX,LNX,1)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,2,IFS)= GMXFS(ICNT,2,IFS) +
     *            XXSEC(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,3,IFS)= GMXFS(ICNT,3,IFS) +
     *            XXSEC(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,4,IFS)= GMXFS(ICNT,4,IFS) +
     *            XXMXFF(JNX,LNX,1)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,5,IFS)= GMXFS(ICNT,5,IFS) +
     *            XXFIR(JNX,LNX,1)*XYMXFF(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,6,IFS)= GMXFS(ICNT,6,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,7,IFS)= GMXFS(ICNT,7,IFS) +
     *            XXMXFF(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,8,IFS)= GMXFS(ICNT,8,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,9,IFS)= GMXFS(ICNT,9,IFS) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,10,IFS)= GMXFS(ICNT,10,IFS) +
     *            XXFIR(JNX,LNX,2)*XYSEC(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,11,IFS)= GMXFS(ICNT,11,IFS) +
     *            XX0(JNX,LNX)*XYFSMX(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,12,IFS)= GMXFS(ICNT,12,IFS) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,13,IFS)= GMXFS(ICNT,13,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,14,IFS)= GMXFS(ICNT,14,IFS) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,1)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,15,IFS)= GMXFS(ICNT,15,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,16,IFS)= GMXFS(ICNT,16,IFS) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,1)
                  GMXFS(ICNT,17,IFS)= GMXFS(ICNT,17,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZSEC(JNZ,LNZ,1)
                  GMXFS(ICNT,18,IFS)= GMXFS(ICNT,18,IFS) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFSMX(JNZ,LNZ,1)
C
                  IFS=IFS+1
                  GMXFS(ICNT,1,IFS)= GMXFS(ICNT,1,IFS) +
     *            XXFSMX(JNX,LNX,2)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,2,IFS)= GMXFS(ICNT,2,IFS) +
     *            XXSEC(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,3,IFS)= GMXFS(ICNT,3,IFS) +
     *            XXSEC(JNX,LNX,2)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,4,IFS)= GMXFS(ICNT,4,IFS) +
     *            XXMXFF(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,5,IFS)= GMXFS(ICNT,5,IFS) +
     *            XXFIR(JNX,LNX,2)*XYMXFF(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,6,IFS)= GMXFS(ICNT,6,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,7,IFS)= GMXFS(ICNT,7,IFS) +
     *            XXMXFF(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,8,IFS)= GMXFS(ICNT,8,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,9,IFS)= GMXFS(ICNT,9,IFS) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,10,IFS)= GMXFS(ICNT,10,IFS) +
     *            XXFIR(JNX,LNX,1)*XYSEC(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,11,IFS)= GMXFS(ICNT,11,IFS) +
     *            XX0(JNX,LNX)*XYFSMX(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,12,IFS)= GMXFS(ICNT,12,IFS) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,13,IFS)= GMXFS(ICNT,13,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,14,IFS)= GMXFS(ICNT,14,IFS) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,15,IFS)= GMXFS(ICNT,15,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,16,IFS)= GMXFS(ICNT,16,IFS) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,2)
                  GMXFS(ICNT,17,IFS)= GMXFS(ICNT,17,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZSEC(JNZ,LNZ,2)
                  GMXFS(ICNT,18,IFS)= GMXFS(ICNT,18,IFS) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFSMX(JNZ,LNZ,2)
 2000         CONTINUE
 3000       CONTINUE
 4000     CONTINUE
 5000   CONTINUE
C
10000 CONTINUE
C
      IGCNT=ICNT
C
      RETURN
      END
C**********************************************************************
C   THIRD DERIVATIVE PROGRAM PART 5 : "CENT3B"
C**********************************************************************
C
C**********************************************************************
C*   NOTICE OF PROGRAM MODIFICATION                                   *
C**********************************************************************
C*  BY:  RICHARD REMINGTON                         search:  c7-14-88  *
C*  DATE:  July  14,   1988                                           *
C*  REASON: Migration to run in 7Mb on 9370                           *
C**********************************************************************
C                                                                     *
C   LAST UPDATED ON NOVEMBER 26, 1985 BY YUKIO YAMAGUCHI              *
C                                                                     *
C**********************************************************************
C                                                                     *
C   CENTER 2 AND 4  DERIVATIVES ARE CALCULATED                        *
C                                                                     *
C######################################################################
      SUBROUTINE CENT24(GT,GU,GV,XX0,XY0,XZ0,XXFIR,XYFIR,XZFIR
     *,                 XXSEC,XYSEC,XZSEC,XXMXFF,XYMXFF,XZMXFF,GMXFIR
     *,                 GMXSEC,GMXFF,LO,XXTHR,XYTHR,XZTHR
     *,                 XXFFF,XYFFF,XZFFF,XXFSMX,XYFSMX,XZFSMX,GMXTHR
     *,                 GMXFFF,GMXFS)
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER GSPOT
      LOGICAL BOTH1,BOTH2
      LOGICAL EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      DIMENSION YX(8,14),YY(8,14),YZ(8,14)
      DIMENSION GT(I4LARL,I2LARL),GU(I4LARL,I2LARL)
      DIMENSION GV(I4LARL,I2LARL)
      DIMENSION ITEST(10)
      DIMENSION YYX(8,18),YYY(8,18),YYZ(8,18)
      DIMENSION XX0(IANGSQ,IANGSQ),XY0(IANGSQ,IANGSQ),XZ0(IANGSQ,IANGSQ)
      DIMENSION XXFIR(IANGSQ,IANGSQ,3),XYFIR(IANGSQ,IANGSQ,3)
      DIMENSION XZFIR(IANGSQ,IANGSQ,3),XXSEC(IANGSQ,IANGSQ,3)
      DIMENSION XYSEC(IANGSQ,IANGSQ,3),XZSEC(IANGSQ,IANGSQ,3)
      DIMENSION XXMXFF(IANGSQ,IANGSQ,3),XYMXFF(IANGSQ,IANGSQ,3)
      DIMENSION XZMXFF(IANGSQ,IANGSQ,3),GMXFIR(IMEM4,3,3)
      DIMENSION GMXSEC(IMEM4,6,3),GMXFF(IMEM4,9,3)
      DIMENSION LO(IMEM4*5)
      DIMENSION XXTHR(IANGSQ,IANGSQ,3),XYTHR(IANGSQ,IANGSQ,3)
     *,         XZTHR(IANGSQ,IANGSQ,3),XXFFF(IANGSQ,IANGSQ)
     *,         XYFFF(IANGSQ,IANGSQ),XZFFF(IANGSQ,IANGSQ)
      DIMENSION XXFSMX(IANGSQ,IANGSQ,6),XYFSMX(IANGSQ,IANGSQ,6)
     *,         XZFSMX(IANGSQ,IANGSQ,6)
      DIMENSION GMXTHR(IMEM4,10,3),GMXFFF(IMEM4,27),GMXFS(IMEM4,18,6)
      COMMON/CALQN/ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET
      COMMON/EINFO/IPLACE(49),ISAME(49)
      COMMON/EXYZS/EX(686),EY(686),EZ(686)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/IPAR5/IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL
      COMMON/LOGIC/EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      COMMON/ORBIN/IORB1,JORB1,KORB1,LORB1,NUMI,NUMJ,NUMK,NUML
      COMMON/PASS /II,JJ,KK,LL
      COMMON/POSNS/IJX(50),IJY(50),IJZ(50),KLX(50),KLY(50),KLZ(50)
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/TWINF/ISHELL,JSHELL,KSHELL,LSHELL
C
      ISIZ=   7
      ISIZ2= 14
      ISIZ3= 21
      IESZ=343
C
      RETURN
C
      ENTRY DER24(BOTH1,BOTH2,IQN,JQN,KQN,LQN,IGCNT,NROOT0,AA,BB,CC,DD,
     *ITEST)
C
      BB2=BB + BB
      DD2=DD + DD
      B4=BB2 * BB2
      D4=DD2 * DD2
      B8=B4 * BB2
      D8=D4 * DD2
      BD4=BB2*DD2
      BBD8=BD4 * BB2
      DDB8=BD4 * DD2
C
      NROOT=NROOT0 + NDERIV
      KLQN=KQN+LQN -1
      KLQNP1=KLQN + 1
      KLQNP2=KLQN + 2
      KLQNP3=KLQN + 3
      MAX=KLQN + IQN + JQN -1
C
      DO 10000 IROOT=1,NROOT
C
        IN=-IANG
        IM=-ISIZ
C
        DO 9000 INO=1,IQN
C
          IN=IN + IANG
          IM=IM + ISIZ
C
          DO 8000 JNO=1,JQN
C
            JN=JNO + IN
            JM=JNO + IM
C
            DUMJ=DBLE(JNO-1)
            DUMJM1=DBLE((JNO-1)*(JNO-2))
            DUMJ2=DBLE(2*JNO -1)
            B2DJ=BB2*DUMJ2
            D2DJ=DD2*DUMJ
            B12DJ=3.0D0*B4*DBLE(JNO)
            B6DJ=3.0D0*BB2*DUMJ*DUMJ
C
            IPL=IPLACE(JM)
            ITWO=2
            IF(ISAME(JM) .EQ. 1) ITWO=1
C
              JP0P1=JM + 1
              IP0P1=IPLACE(JP0P1)
              I2P0P1=2
              IF(ISAME(JP0P1) .EQ. 1) I2P0P1=1
              JP0P2=JM + 2
              IP0P2=IPLACE(JP0P2)
              I2P0P2=2
              IF(ISAME(JP0P2) .EQ. 1) I2P0P2=1
              JP0P3=JM + 3
              IP0P3=IPLACE(JP0P3)
              I2P0P3=2
              IF(ISAME(JP0P3) .EQ. 1) I2P0P3=1
              IF(JNO .GT. 1) THEN
                JM0M1=JM-1
                IM0M1=IPLACE(JM0M1)
                I2M0M1=2
                IF(ISAME(JM0M1) .EQ. 1) I2M0M1=1
                IF(JNO .GT. 2) THEN
                  JM0M2=JM - 2
                  IM0M2=IPLACE(JM0M2)
                  I2M0M2=2
                  IF(ISAME(JM0M2) .EQ. 1) I2M0M2=1
                END IF
              END IF
C
            IT=INO + JNO - 1
            ITM1=IT-1
            ITM2=IT-2
            ITM3=IT-3
            ITZERO=IT
            ITFIR=IT + 1
            ITSEC=IT + 2
            ITTHR=IT + 3
C
C   ZEROTH ORDER SECTION
C
            DO 150 IKL=1,KLQN
              YX0=0.0D0
              YY0=0.0D0
              YZ0=0.0D0
              DO 100 IJ=1,IT
                IJM1=IJ-1
                ISPOT=IPL + IJM1*ITWO
                GSPOT=IKL + IJM1
                YX0=YX0 + EX(ISPOT)*GT(GSPOT,IROOT)
                YY0=YY0 + EY(ISPOT)*GU(GSPOT,IROOT)
                YZ0=YZ0 + EZ(ISPOT)*GV(GSPOT,IROOT)
  100         CONTINUE
C
              YX(IKL,1)=YX0
              YY(IKL,1)=YY0
              YZ(IKL,1)=YZ0
C
  150       CONTINUE
C
              DO 300 IKL=1,KLQN
                YX0=YX(IKL,1)
                YY0=YY(IKL,1)
                YZ0=YZ(IKL,1)
                  YXB1=0.0D0
                  YYB1=0.0D0
                  YZB1=0.0D0
                  YXB2=0.0D0
                  YYB2=0.0D0
                  YZB2=0.0D0
                  YX2B1=0.0D0
                  YY2B1=0.0D0
                  YZ2B1=0.0D0
                  YX2B2=0.0D0
                  YY2B2=0.0D0
                  YZ2B2=0.0D0
                  YX3B1=0.0D0
                  YY3B1=0.0D0
                  YZ3B1=0.0D0
                DO 200 IJ=1,ITTHR
                  IJM1=IJ-1
                  GSPOT=IKL + IJM1
C
C   FIRST DERIVATIVE SECTION
C
                  IF(IJ .GT. ITFIR) GO TO 160
                    ISPOT=IP0P1 +  IJM1*I2P0P1
                    YXB1=YXB1 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YYB1=YYB1 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZB1=YZB1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                    IF(JNO .GT. 1) THEN
                      IF(IJ .LE. ITM1) THEN
                        ISPOT=IM0M1 + IJM1*I2M0M1
                        YXB2=YXB2 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YYB2=YYB2 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZB2=YZB2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                    END IF
C
  160             CONTINUE
C
C   SECOND DERIVATIVE SECTION
C
                  IF(IJ .GT. ITSEC) GO TO 170
C
                    ISPOT=IP0P2 + IJM1*I2P0P2
                    YX2B1=YX2B1 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YY2B1=YY2B1 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZ2B1=YZ2B1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                    IF(JNO .GT. 2) THEN
                      IF(IJ .LE. ITM2) THEN
                        ISPOT=IM0M2 + IJM1*I2M0M2
                        YX2B2=YX2B2 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YY2B2=YY2B2 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZ2B2=YZ2B2 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                    END IF
C
  170             CONTINUE
C
C   THIRD DERIVATIVES
C
C
                    ISPOT=IP0P3 + IJM1*I2P0P3
                    YX3B1=YX3B1 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YY3B1=YY3B1 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZ3B1=YZ3B1 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
C
  200           CONTINUE
C
                  YX(IKL,4)=YXB1*BB2 - DUMJ*YXB2
                  YY(IKL,4)=YYB1*BB2 - DUMJ*YYB2
                  YZ(IKL,4)=YZB1*BB2 - DUMJ*YZB2
C
                  YX(IKL,5)=YX2B1*B4 - B2DJ*YX0 + DUMJM1*YX2B2
                  YY(IKL,5)=YY2B1*B4 - B2DJ*YY0 + DUMJM1*YY2B2
                  YZ(IKL,5)=YZ2B1*B4 - B2DJ*YZ0 + DUMJM1*YZ2B2
C
                  YX(IKL,10)=YX3B1*B8 - B12DJ*YXB1 + YXB2*B6DJ
                  YY(IKL,10)=YY3B1*B8 - B12DJ*YYB1 + YYB2*B6DJ
                  YZ(IKL,10)=YZ3B1*B8 - B12DJ*YZB1 + YZB2*B6DJ
C
                    YYX(IKL,15)=YXB1
                    YYY(IKL,15)=YYB1
                    YYZ(IKL,15)=YZB1
C
                    YYX(IKL,16)=YXB2
                    YYY(IKL,16)=YYB2
                    YYZ(IKL,16)=YZB2
C
  300         CONTINUE
C
            DO 375 IKL=1,KLQNP3
              YX3=0.0D0
              YY3=0.0D0
              YZ3=0.0D0
              DO 350 IJ=1,IT
                IJM1=IJ-1
                ISPOT=IPL + IJM1*ITWO
                GSPOT=IKL + IJ -1
                YX3=YX3 + EX(ISPOT)*GT(GSPOT,IROOT)
                YY3=YY3 + EY(ISPOT)*GU(GSPOT,IROOT)
                YZ3=YZ3 + EZ(ISPOT)*GV(GSPOT,IROOT)
  350         CONTINUE
              IF(IKL .LE. KLQNP1) THEN
                YX(IKL,7)=YX3
                YY(IKL,7)=YY3
                YZ(IKL,7)=YZ3
              END IF
              IF(IKL .LE. KLQNP2) THEN
                YX(IKL,8)=YX3
                YY(IKL,8)=YY3
                YZ(IKL,8)=YZ3
              END IF
              YX(IKL,13)=YX3
              YY(IKL,13)=YY3
              YZ(IKL,13)=YZ3
  375       CONTINUE
C
C   MIXED CENTER DERIVATIVES
C
              DO 500 IKL=1,KLQNP2
                  YXB1=0.0D0
                  YYB1=0.0D0
                  YZB1=0.0D0
                  YXB2=0.0D0
                  YYB2=0.0D0
                  YZB2=0.0D0
                  YXB3=0.0D0
                  YYB3=0.0D0
                  YZB3=0.0D0
                  YXB4=0.0D0
                  YYB4=0.0D0
                  YZB4=0.0D0
                  YXB5=0.0D0
                  YYB5=0.0D0
                  YZB5=0.0D0
                  YXB6=0.0D0
                  YYB6=0.0D0
                  YZB6=0.0D0
                DO 450 IJ=1,ITSEC
                  IJM1=IJ - 1
                  GSPOT=IJM1 + IKL
C
C
                    IF(IJ .GT. ITFIR) GO TO 410
                    ISPOT=IP0P1 + IJM1*I2P0P1
                    EXCNST=EX(ISPOT)*GT(GSPOT,IROOT)
                    EYCNST=EY(ISPOT)*GU(GSPOT,IROOT)
                    EZCNST=EZ(ISPOT)*GV(GSPOT,IROOT)
                    IF(IKL .LE. KLQNP1) THEN
                      YXB1=YXB1 + EXCNST
                      YYB1=YYB1 + EYCNST
                      YZB1=YZB1 + EZCNST
                    END IF
                    YXB3=YXB3 + EXCNST
                    YYB3=YYB3 + EYCNST
                    YZB3=YZB3 + EZCNST
C
                    IF(JNO .GT. 1) THEN
                      IF(IJ .LE. ITM1) THEN
                        ISPOT=IM0M1 + IJM1*I2M0M1
                        EXCNST=EX(ISPOT)*GT(GSPOT,IROOT)
                        EYCNST=EY(ISPOT)*GU(GSPOT,IROOT)
                        EZCNST=EZ(ISPOT)*GV(GSPOT,IROOT)
                        IF(IKL .LE. KLQNP1) THEN
                          YXB2=YXB2 + EXCNST
                          YYB2=YYB2 + EYCNST
                          YZB2=YZB2 + EZCNST
                        END IF
                        YXB4=YXB4 + EXCNST
                        YYB4=YYB4 + EYCNST
                        YZB4=YZB4 + EZCNST
                      END IF
                    END IF
C
  410               CONTINUE
                    IF(IKL .GT. KLQNP1) GO TO 420
                    ISPOT=IP0P2 + IJM1*I2P0P2
                    YXB5=YXB5 + EX(ISPOT)*GT(GSPOT,IROOT)
                    YYB5=YYB5 + EY(ISPOT)*GU(GSPOT,IROOT)
                    YZB5=YZB5 + EZ(ISPOT)*GV(GSPOT,IROOT)
C
                    IF(JNO .GT. 2) THEN
                      IF(IJ .LE. ITM2) THEN
                        ISPOT=IM0M2 + IJM1*I2M0M2
                        YXB6=YXB6 + EX(ISPOT)*GT(GSPOT,IROOT)
                        YYB6=YYB6 + EY(ISPOT)*GU(GSPOT,IROOT)
                        YZB6=YZB6 + EZ(ISPOT)*GV(GSPOT,IROOT)
                      END IF
                    END IF
  420               CONTINUE
  450           CONTINUE
C
                  YYX(IKL,3)=YXB1
                  YYY(IKL,3)=YYB1
                  YYZ(IKL,3)=YZB1
C
                  YYX(IKL,4)=YXB2
                  YYY(IKL,4)=YYB2
                  YYZ(IKL,4)=YZB2
C
                  YYX(IKL,7)=YXB3
                  YYY(IKL,7)=YYB3
                  YYZ(IKL,7)=YZB3
C
                  YYX(IKL,8)=YXB4
                  YYY(IKL,8)=YYB4
                  YYZ(IKL,8)=YZB4
C
                  YYX(IKL,11)=YXB5
                  YYY(IKL,11)=YYB5
                  YYZ(IKL,11)=YZB5
C
                  YYX(IKL,12)=YXB6
                  YYY(IKL,12)=YYB6
                  YYZ(IKL,12)=YZB6
C
C
  500         CONTINUE
C
            KN=-IANG
            KM=-ISIZ
C
            DO 7000 KNO=1,KQN
C
              KN=KN + IANG
              KM=KM + ISIZ
C
              DO 6000 LNO=1,LQN
C
                LN=LNO + KN
                LM=LNO + KM
C
                DUML=DBLE(LNO-1)
                DUMLM1=DBLE((LNO-1)*(LNO-2))
                DUML2=DBLE(2*LNO -1)
                D2DL=DD2*DUML2
                D12DL=3.0D0*D4*DBLE(LNO)
                D6DL=3.0D0*DD2*DUML*DUML
                B2DL=BB2*DUML
                DJDL=DUMJ*DUML
C
                ITT=KNO + LNO -1
                ITTM1=ITT-1
                ITTM2=ITT-2
                ITTM3=ITT-3
                ITTFIR=ITT + 1
                ITTSEC=ITT + 2
                ITTTHR=ITT + 3
C
                KPL=IPLACE(LM)
                KTWO=2
                IF(ISAME(LM) .EQ. 1) KTWO=1
C
                  LP0P1=LM + 1
                  KP0P1=IPLACE(LP0P1)
                  K2P0P1=2
                  IF(ISAME(LP0P1) .EQ. 1) K2P0P1=1
                  LP0P2=LM + 2
                  KP0P2=IPLACE(LP0P2)
                  K2P0P2=2
                  IF(ISAME(LP0P2) .EQ. 1) K2P0P2=1
                  LP0P3=LM + 3
                  KP0P3=IPLACE(LP0P3)
                  K2P0P3=2
                  IF(ISAME(LP0P3) .EQ. 1) K2P0P3=1
                  IF(LNO .GT. 1) THEN
                    LM0M1=LM - 1
                    KM0M1=IPLACE(LM0M1)
                    K2M0M1=2
                    IF(ISAME(LM0M1) .EQ. 1) K2M0M1=1
                    IF(LNO .GT. 2) THEN
                      LM0M2=LM - 2
                      KM0M2=IPLACE(LM0M2)
                      K2M0M2=2
                      IF(ISAME(LM0M2) .EQ. 1) K2M0M2=1
                    END IF
                  END IF
C
                XXX1=0.0D0
                XYY1=0.0D0
                XZZ1=0.0D0
                  XXX4=0.0D0
                  XYY4=0.0D0
                  XZZ4=0.0D0
                  XXX5=0.0D0
                  XYY5=0.0D0
                  XZZ5=0.0D0
                  XXX10=0.0D0
                  XYY10=0.0D0
                  XZZ10=0.0D0
                  XXD1=0.0D0
                  XYD1=0.0D0
                  XZD1=0.0D0
                  XXD2=0.0D0
                  XYD2=0.0D0
                  XZD2=0.0D0
                  XX2D1=0.0D0
                  XY2D1=0.0D0
                  XZ2D1=0.0D0
                  XX2D2=0.0D0
                  XY2D2=0.0D0
                  XZ2D2=0.0D0
                  XX3D1=0.0D0
                  XY3D1=0.0D0
                  XZ3D1=0.0D0
                  XXSF1=0.0D0
                  XYSF1=0.0D0
                  XZSF1=0.0D0
                  XXSF2=0.0D0
                  XYSF2=0.0D0
                  XZSF2=0.0D0
                  XXSF3=0.0D0
                  XYSF3=0.0D0
                  XZSF3=0.0D0
                  XXSF4=0.0D0
                  XYSF4=0.0D0
                  XZSF4=0.0D0
                  XXSF5=0.0D0
                  XYSF5=0.0D0
                  XZSF5=0.0D0
                  XXSF6=0.0D0
                  XYSF6=0.0D0
                  XZSF6=0.0D0
                  XXFS1=0.0D0
                  XYFS1=0.0D0
                  XZFS1=0.0D0
                  XXFS2=0.0D0
                  XYFS2=0.0D0
                  XZFS2=0.0D0
                  XXFS3=0.0D0
                  XYFS3=0.0D0
                  XZFS3=0.0D0
                  XXFS4=0.0D0
                  XYFS4=0.0D0
                  XZFS4=0.0D0
                  XXFS5=0.0D0
                  XYFS5=0.0D0
                  XZFS5=0.0D0
                  XXFS6=0.0D0
                  XYFS6=0.0D0
                  XZFS6=0.0D0
                  XXBD1=0.0D0
                  XXBD2=0.0D0
                  XXBD3=0.0D0
                  XXBD4=0.0D0
                  XYBD1=0.0D0
                  XYBD2=0.0D0
                  XYBD3=0.0D0
                  XYBD4=0.0D0
                  XZBD1=0.0D0
                  XZBD2=0.0D0
                  XZBD3=0.0D0
                  XZBD4=0.0D0
C
                CONST=-1.0D0
                DO 600 KL=1,ITTTHR
                  KLM1=KL - 1
                  CONST=-CONST
C
                  IF(KL .LE. ITT) THEN
C
C   ZEROTH ORDER SECTION
C
                    KSPOT=KPL + KLM1*KTWO
                    EXCNST=EX(IESZ+KSPOT)*CONST
                    EYCNST=EY(IESZ+KSPOT)*CONST
                    EZCNST=EZ(IESZ+KSPOT)*CONST
C
                    XXX1=XXX1 + YX(KL,1)*EXCNST
                    XYY1=XYY1 + YY(KL,1)*EYCNST
                    XZZ1=XZZ1 + YZ(KL,1)*EZCNST
C
C   CENTER 2 FIRST, SECOND, AND THIRD DERIVATIVES
C
                      XXX4=XXX4 + YX(KL,4)*EXCNST
                      XYY4=XYY4 + YY(KL,4)*EYCNST
                      XZZ4=XZZ4 + YZ(KL,4)*EZCNST
C
                      XXX5=XXX5 + YX(KL,5)*EXCNST
                      XYY5=XYY5 + YY(KL,5)*EYCNST
                      XZZ5=XZZ5 + YZ(KL,5)*EZCNST
C
                      XXX10=XXX10 + YX(KL,10)*EXCNST
                      XYY10=XYY10 + YY(KL,10)*EYCNST
                      XZZ10=XZZ10 + YZ(KL,10)*EZCNST
                    END IF
C
C   CENTER 4 FIRST, SECOND, AND THIRD DERIVATIVES
C
                    IF(KL .GT. ITTFIR) GO TO 505
                    KSPOT=KP0P1 + KLM1*K2P0P1
                    XXD1=XXD1 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                    XYD1=XYD1 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                    XZD1=XZD1 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
C
                    IF(LNO .GT. 1) THEN
                      IF(KL .LE. ITTM1) THEN
                        KSPOT=KM0M1 + KLM1*K2M0M1
                        XXD2=XXD2 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                        XYD2=XYD2 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                        XZD2=XZD2 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
                      END IF
                    END IF
  505               CONTINUE
C
                    IF(KL .GT. ITTSEC) GO TO 510
                    KSPOT=KP0P2 + KLM1*K2P0P2
                    XX2D1=XX2D1 + YX(KL,8)*EX(IESZ+KSPOT)*CONST
                    XY2D1=XY2D1 + YY(KL,8)*EY(IESZ+KSPOT)*CONST
                    XZ2D1=XZ2D1 + YZ(KL,8)*EZ(IESZ+KSPOT)*CONST
C
                    IF(LNO .GT. 2) THEN
                      IF(KL .LE. ITTM2) THEN
                        KSPOT=KM0M2 + KLM1*K2M0M2
                        XX2D2=XX2D2 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                        XY2D2=XY2D2 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                        XZ2D2=XZ2D2 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
                      END IF
                    END IF
  510               CONTINUE
C
                  KSPOT=KP0P3 + KLM1*K2P0P3
                  XX3D1=XX3D1 + YX(KL,13)*EX(IESZ+KSPOT)*CONST
                  XY3D1=XY3D1 + YY(KL,13)*EY(IESZ+KSPOT)*CONST
                  XZ3D1=XZ3D1 + YZ(KL,13)*EZ(IESZ+KSPOT)*CONST
C
C   CENTERS 2 AND 4 MIXED DERIVATIVES
C
                    IF(KL .GT. ITTSEC) GO TO 600
C
                    IF(KL .LE. ITTFIR) THEN
                      KSPOT=KP0P1 + KLM1*K2P0P1
                      EXCNST=EX(IESZ+KSPOT)*CONST
                      EYCNST=EY(IESZ+KSPOT)*CONST
                      EZCNST=EZ(IESZ+KSPOT)*CONST
C
                      XXBD1=XXBD1 + YYX(KL,3)*EXCNST
                      XYBD1=XYBD1 + YYY(KL,3)*EYCNST
                      XZBD1=XZBD1 + YYZ(KL,3)*EZCNST
C
                      XXBD4=XXBD4 + YYX(KL,4)*EXCNST
                      XYBD4=XYBD4 + YYY(KL,4)*EYCNST
                      XZBD4=XZBD4 + YYZ(KL,4)*EZCNST
C
                      XXSF1=XXSF1 + YYX(KL,11)*EXCNST
                      XYSF1=XYSF1 + YYY(KL,11)*EYCNST
                      XZSF1=XZSF1 + YYZ(KL,11)*EZCNST
C
                      XXSF2=XXSF2 + YYX(KL,12)*EXCNST
                      XYSF2=XYSF2 + YYY(KL,12)*EYCNST
                      XZSF2=XZSF2 + YYZ(KL,12)*EZCNST
C
                      XXSF3=XXSF3 + YX(KL,7)*EXCNST
                      XYSF3=XYSF3 + YY(KL,7)*EYCNST
                      XZSF3=XZSF3 + YZ(KL,7)*EZCNST
C
                    END IF
                    IF(LNO .GT. 1) THEN
                      IF(KL .LE. ITTM1) THEN
                        KSPOT=KM0M1 + KLM1*K2M0M1
                        EXCNST=EX(IESZ+KSPOT)*CONST
                        EYCNST=EY(IESZ+KSPOT)*CONST
                        EZCNST=EZ(IESZ+KSPOT)*CONST
C
                        XXBD2=XXBD2 + YYX(KL,3)*EXCNST
                        XYBD2=XYBD2 + YYY(KL,3)*EYCNST
                        XZBD2=XZBD2 + YYZ(KL,3)*EZCNST
C
                        XXBD3=XXBD3 + YYX(KL,4)*EXCNST
                        XYBD3=XYBD3 + YYY(KL,4)*EYCNST
                        XZBD3=XZBD3 + YYZ(KL,4)*EZCNST
C
                        XXSF4=XXSF4 + YYX(KL,11)*EXCNST
                        XYSF4=XYSF4 + YYY(KL,11)*EYCNST
                        XZSF4=XZSF4 + YYZ(KL,11)*EZCNST
C
                        XXSF5=XXSF5 + YYX(KL,12)*EXCNST
                        XYSF5=XYSF5 + YYY(KL,12)*EYCNST
                        XZSF5=XZSF5 + YYZ(KL,12)*EZCNST
C
                        XXSF6=XXSF6 + YX(KL,7)*EXCNST
                        XYSF6=XYSF6 + YY(KL,7)*EYCNST
                        XZSF6=XZSF6 + YZ(KL,7)*EZCNST
                      END IF
                    END IF
C
                    KSPOT=KP0P2 + KLM1*K2P0P2
                    EXCNST=EX(IESZ+KSPOT)*CONST
                    EYCNST=EY(IESZ+KSPOT)*CONST
                    EZCNST=EZ(IESZ+KSPOT)*CONST
C
                    XXFS1=XXFS1 + YYX(KL,7)*EXCNST
                    XYFS1=XYFS1 + YYY(KL,7)*EYCNST
                    XZFS1=XZFS1 + YYZ(KL,7)*EZCNST
C
                    XXFS2=XXFS2 + YYX(KL,8)*EXCNST
                    XYFS2=XYFS2 + YYY(KL,8)*EYCNST
                    XZFS2=XZFS2 + YYZ(KL,8)*EZCNST
C
                    IF(KL .LE. ITT) THEN
                      KSPOT=KPL + KTWO*KLM1
                      EXCNST=EX(IESZ+KSPOT)*CONST
                      EYCNST=EY(IESZ+KSPOT)*CONST
                      EZCNST=EZ(IESZ+KSPOT)*CONST
C
                      XXFS3=XXFS3 + YYX(KL,15)*EXCNST
                      XYFS3=XYFS3 + YYY(KL,15)*EYCNST
                      XZFS3=XZFS3 + YYZ(KL,15)*EZCNST
C
                      XXFS4=XXFS4 + YYX(KL,16)*EXCNST
                      XYFS4=XYFS4 + YYY(KL,16)*EYCNST
                      XZFS4=XZFS4 + YYZ(KL,16)*EZCNST
                    END IF
C
                    IF(LNO .GT. 2) THEN
                      IF(KL .LE. ITTM2) THEN
                        KSPOT=KM0M2 + KLM1*K2M0M2
                        EXCNST=EX(IESZ+KSPOT)*CONST
                        EYCNST=EY(IESZ+KSPOT)*CONST
                        EZCNST=EZ(IESZ+KSPOT)*CONST
C
                        XXFS5=XXFS5 + YYX(KL,7)*EXCNST
                        XYFS5=XYFS5 + YYY(KL,7)*EYCNST
                        XZFS5=XZFS5 + YYZ(KL,7)*EZCNST
C
                        XXFS6=XXFS6 + YYX(KL,8)*EXCNST
                        XYFS6=XYFS6 + YYY(KL,8)*EYCNST
                        XZFS6=XZFS6 + YYZ(KL,8)*EZCNST
                      END IF
                    END IF
C
  600           CONTINUE
                IF(JN .GT. 9) WRITE(IOUT,*) 'JN TOO BIG  JN=',JN
                IF(LN .GT. 9) WRITE(IOUT,*) 'LN TOO BIG  LN=',LN
C
                XX0(JN,LN)=XXX1
                XY0(JN,LN)=XYY1
                XZ0(JN,LN)=XZZ1
C
                INT=0
                  INT=INT+1
                  XXFIR(JN,LN,INT)=XXX4
                  XYFIR(JN,LN,INT)=XYY4
                  XZFIR(JN,LN,INT)=XZZ4
C
                  XXSEC(JN,LN,INT)=XXX5
                  XYSEC(JN,LN,INT)=XYY5
                  XZSEC(JN,LN,INT)=XZZ5
C
                  XXTHR(JN,LN,INT)=XXX10
                  XYTHR(JN,LN,INT)=XYY10
                  XZTHR(JN,LN,INT)=XZZ10
C
                  INT=INT+1
                  XXFIR(JN,LN,INT)=XXD1*DD2 - DUML*XXD2
                  XYFIR(JN,LN,INT)=XYD1*DD2 - DUML*XYD2
                  XZFIR(JN,LN,INT)=XZD1*DD2 - DUML*XZD2
C
                  XXSEC(JN,LN,INT)=D4*XX2D1 - D2DL*XXX1 + DUMLM1*XX2D2
                  XYSEC(JN,LN,INT)=D4*XY2D1 - D2DL*XYY1 + DUMLM1*XY2D2
                  XZSEC(JN,LN,INT)=D4*XZ2D1 - D2DL*XZZ1 + DUMLM1*XZ2D2
C
                  XXTHR(JN,LN,INT)=D8*XX3D1 - D12DL*XXD1 + D6DL*XXD2
                  XYTHR(JN,LN,INT)=D8*XY3D1 - D12DL*XYD1 + D6DL*XYD2
                  XZTHR(JN,LN,INT)=D8*XZ3D1 - D12DL*XZD1 + D6DL*XZD2
C
                IMX=0
                IFS=0
C
                  IMX=IMX+1
                  XXMXFF(JN,LN,IMX)=BD4*XXBD1 - B2DL*XXBD2 + DJDL*XXBD3
     *            - D2DJ*XXBD4
                  XYMXFF(JN,LN,IMX)=BD4*XYBD1 - B2DL*XYBD2 + DJDL*XYBD3
     *            - D2DJ*XYBD4
                  XZMXFF(JN,LN,IMX)=BD4*XZBD1 - B2DL*XZBD2 + DJDL*XZBD3
     *            - D2DJ*XZBD4
                  IFS=IFS+1
                  XXFSMX(JN,LN,IFS)= BBD8*XXSF1 - BD4*DUMJ2*XXSF3
     *                             + DD2*DUMJM1*XXSF2 - B4*DUML*XXSF4
     *                      + BB2*DUML*DUMJ2*XXSF6 - DUMJM1*DUML*XXSF5
                  XYFSMX(JN,LN,IFS)= BBD8*XYSF1 - BD4*DUMJ2*XYSF3
     *                             + DD2*DUMJM1*XYSF2 - B4*DUML*XYSF4
     *                      + BB2*DUML*DUMJ2*XYSF6 - DUMJM1*DUML*XYSF5
                  XZFSMX(JN,LN,IFS)= BBD8*XZSF1 - BD4*DUMJ2*XZSF3
     *                             + DD2*DUMJM1*XZSF2 - B4*DUML*XZSF4
     *                      + BB2*DUML*DUMJ2*XZSF6 - DUMJM1*DUML*XZSF5
                  IFS=IFS+1
                  XXFSMX(JN,LN,IFS)= DDB8*XXFS1 - BD4*DUML2*XXFS3
     *                             + BB2*DUMLM1*XXFS5 - D4*DUMJ*XXFS2
     *                      + DD2*DUMJ*DUML2*XXFS4 - DUMLM1*DUMJ*XXFS6
                  XYFSMX(JN,LN,IFS)= DDB8*XYFS1 - BD4*DUML2*XYFS3
     *                             + BB2*DUMLM1*XYFS5 - D4*DUMJ*XYFS2
     *                      + DD2*DUMJ*DUML2*XYFS4 - DUMLM1*DUMJ*XYFS6
                  XZFSMX(JN,LN,IFS)= DDB8*XZFS1 - BD4*DUML2*XZFS3
     *                             + BB2*DUMLM1*XZFS5 - D4*DUMJ*XZFS2
     *                      + DD2*DUMJ*DUML2*XZFS4 - DUMLM1*DUMJ*XZFS6
C
C
 6000         CONTINUE
 7000       CONTINUE
C
 8000     CONTINUE
 9000   CONTINUE
C
C
C   ACTUALLY FORM THE INTEGRALS
C
        ICNT=0
        IJCNT=0
        IORBMX=IORB1 -1 + NUMI
        JORBMX=JORB1 -1 + NUMJ
        DO 5000 IORB=IORB1,IORBMX
          IF(BOTH1) JORBMX=IORB
          DO 4000 JORB=JORB1,JORBMX
            IJORB=IOFF(MAX0(IORB,JORB)) + MIN0(IORB,JORB)
            IJCNT=IJCNT + 1
            JNX=IJX(IJCNT)
            JNY=IJY(IJCNT)
            JNZ=IJZ(IJCNT)
            KLCNT=0
            KORBMX=KORB1 -1 + NUMK
            LORBMX=LORB1 -1 + NUML
            IF(ISHELL .EQ. KSHELL) KORBMX=IORB
            DO 3000 KORB=KORB1,KORBMX
              IF(BOTH2) LORBMX=KORB
              DO 2000 LORB=LORB1,LORBMX
                KLORB=IOFF(MAX0(KORB,LORB)) + MIN0(KORB,LORB)
                IJKL=IOFF(MAX0(IJORB,KLORB)) + MIN0(IJORB,KLORB)
                IF(KLORB .GT. IJORB) GO TO 3000
C
                ICNT=ICNT + 1
                IF(ICNT .GT. IMEM4) WRITE(IOUT,*) ' ICNT = ',ICNT
                KLCNT=KLCNT + 1
                LNX=KLX(KLCNT)
                LNY=KLY(KLCNT)
                LNZ=KLZ(KLCNT)
                INT=0
C
C   CENTER 2 DERIVATIVES
C
                  INT=INT+1
C
C   FIRST DERIVATIVES
C
                  GMXFIR(ICNT,1,INT)= GMXFIR(ICNT,1,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,2,INT)= GMXFIR(ICNT,2,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,3,INT)= GMXFIR(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
C
C   SECOND DERIVATIVES
C
                  GMXSEC(ICNT,1,INT)= GMXSEC(ICNT,1,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,2,INT)= GMXSEC(ICNT,2,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,3,INT)= GMXSEC(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,4,INT)= GMXSEC(ICNT,4,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,5,INT)= GMXSEC(ICNT,5,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,6,INT)= GMXSEC(ICNT,6,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
C
C   THIRD DERIVATIVES
C
                  GMXTHR(ICNT,1,INT)=GMXTHR(ICNT,1,INT) +
     *            XXTHR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,2,INT)=GMXTHR(ICNT,2,INT) +
     *            XXSEC(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,3,INT)=GMXTHR(ICNT,3,INT) +
     *            XXFIR(JNX,LNX,INT)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,4,INT)=GMXTHR(ICNT,4,INT) +
     *            XX0(JNX,LNX)*XYTHR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,5,INT)=GMXTHR(ICNT,5,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,6,INT)=GMXTHR(ICNT,6,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,
     *            INT)
                  GMXTHR(ICNT,7,INT)=GMXTHR(ICNT,7,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,8,INT)=GMXTHR(ICNT,8,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,9,INT)=GMXTHR(ICNT,9,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,10,INT)=GMXTHR(ICNT,10,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZTHR(JNZ,LNZ,INT)
C
C   CENTER 4 DERIVATIVES
C
                  INT=INT+1
C
C   FIRST DERIVATIVES
C
                  GMXFIR(ICNT,1,INT)= GMXFIR(ICNT,1,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,2,INT)= GMXFIR(ICNT,2,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,3,INT)= GMXFIR(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
C
C   SECOND DERIVATIVES
C
                  GMXSEC(ICNT,1,INT)= GMXSEC(ICNT,1,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,2,INT)= GMXSEC(ICNT,2,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,3,INT)= GMXSEC(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,4,INT)= GMXSEC(ICNT,4,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,5,INT)= GMXSEC(ICNT,5,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,6,INT)= GMXSEC(ICNT,6,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
C
C   THIRD DERIVATIVES
C
                  GMXTHR(ICNT,1,INT)=GMXTHR(ICNT,1,INT) +
     *            XXTHR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,2,INT)=GMXTHR(ICNT,2,INT) +
     *            XXSEC(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,3,INT)=GMXTHR(ICNT,3,INT) +
     *            XXFIR(JNX,LNX,INT)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,4,INT)=GMXTHR(ICNT,4,INT) +
     *            XX0(JNX,LNX)*XYTHR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,5,INT)=GMXTHR(ICNT,5,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,6,INT)=GMXTHR(ICNT,6,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,
     *            INT)
                  GMXTHR(ICNT,7,INT)=GMXTHR(ICNT,7,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,8,INT)=GMXTHR(ICNT,8,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,9,INT)=GMXTHR(ICNT,9,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,10,INT)=GMXTHR(ICNT,10,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZTHR(JNZ,LNZ,INT)
C
C   MIXED DERIVATIVE ON CENTERS 2 AND 4
C
                  IMX=0
                  IFS=0
 
C
C   SECOND DERIVATIVES
C
                  IMX=IMX + 1
                  GMXFF(ICNT,1,IMX)= GMXFF(ICNT,1,IMX) +
     *            XXMXFF(JNX,LNX,IMX)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,2,IMX)= GMXFF(ICNT,2,IMX) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,3,IMX)= GMXFF(ICNT,3,IMX) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFF(ICNT,4,IMX)= GMXFF(ICNT,4,IMX) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,5,IMX)= GMXFF(ICNT,5,IMX) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,IMX)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,6,IMX)= GMXFF(ICNT,6,IMX) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFF(ICNT,7,IMX)= GMXFF(ICNT,7,IMX) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFF(ICNT,8,IMX)= GMXFF(ICNT,8,IMX) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFF(ICNT,9,IMX)= GMXFF(ICNT,9,IMX) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,IMX)
C
C   THIRD DERIVATIVES
C
                  IFS=IFS+1
                  GMXFS(ICNT,1,IFS)= GMXFS(ICNT,1,IFS) +
     *            XXFSMX(JNX,LNX,1)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,2,IFS)= GMXFS(ICNT,2,IFS) +
     *            XXSEC(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,3,IFS)= GMXFS(ICNT,3,IFS) +
     *            XXSEC(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,4,IFS)= GMXFS(ICNT,4,IFS) +
     *            XXMXFF(JNX,LNX,1)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,5,IFS)= GMXFS(ICNT,5,IFS) +
     *            XXFIR(JNX,LNX,1)*XYMXFF(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,6,IFS)= GMXFS(ICNT,6,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,7,IFS)= GMXFS(ICNT,7,IFS) +
     *            XXMXFF(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,8,IFS)= GMXFS(ICNT,8,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,9,IFS)= GMXFS(ICNT,9,IFS) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,10,IFS)= GMXFS(ICNT,10,IFS) +
     *            XXFIR(JNX,LNX,2)*XYSEC(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,11,IFS)= GMXFS(ICNT,11,IFS) +
     *            XX0(JNX,LNX)*XYFSMX(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,12,IFS)= GMXFS(ICNT,12,IFS) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,13,IFS)= GMXFS(ICNT,13,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,14,IFS)= GMXFS(ICNT,14,IFS) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,1)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,15,IFS)= GMXFS(ICNT,15,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,16,IFS)= GMXFS(ICNT,16,IFS) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,1)
                  GMXFS(ICNT,17,IFS)= GMXFS(ICNT,17,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZSEC(JNZ,LNZ,1)
                  GMXFS(ICNT,18,IFS)= GMXFS(ICNT,18,IFS) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFSMX(JNZ,LNZ,1)
C
                  IFS=IFS+1
                  GMXFS(ICNT,1,IFS)= GMXFS(ICNT,1,IFS) +
     *            XXFSMX(JNX,LNX,2)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,2,IFS)= GMXFS(ICNT,2,IFS) +
     *            XXSEC(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,3,IFS)= GMXFS(ICNT,3,IFS) +
     *            XXSEC(JNX,LNX,2)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,4,IFS)= GMXFS(ICNT,4,IFS) +
     *            XXMXFF(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,5,IFS)= GMXFS(ICNT,5,IFS) +
     *            XXFIR(JNX,LNX,2)*XYMXFF(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,6,IFS)= GMXFS(ICNT,6,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,7,IFS)= GMXFS(ICNT,7,IFS) +
     *            XXMXFF(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,8,IFS)= GMXFS(ICNT,8,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,9,IFS)= GMXFS(ICNT,9,IFS) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,10,IFS)= GMXFS(ICNT,10,IFS) +
     *            XXFIR(JNX,LNX,1)*XYSEC(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,11,IFS)= GMXFS(ICNT,11,IFS) +
     *            XX0(JNX,LNX)*XYFSMX(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,12,IFS)= GMXFS(ICNT,12,IFS) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,13,IFS)= GMXFS(ICNT,13,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,14,IFS)= GMXFS(ICNT,14,IFS) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,15,IFS)= GMXFS(ICNT,15,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,16,IFS)= GMXFS(ICNT,16,IFS) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,2)
                  GMXFS(ICNT,17,IFS)= GMXFS(ICNT,17,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZSEC(JNZ,LNZ,2)
                  GMXFS(ICNT,18,IFS)= GMXFS(ICNT,18,IFS) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFSMX(JNZ,LNZ,2)
 2000         CONTINUE
 3000       CONTINUE
 4000     CONTINUE
 5000   CONTINUE
C
10000 CONTINUE
C
      IGCNT=ICNT
C
      RETURN
      END
C***********************************************************************
C
C   CENTER 3 AND 4  DERIVATIVES ARE CALCULATED
C
C***********************************************************************
      SUBROUTINE CENT34(GT,GU,GV,XX0,XY0,XZ0,XXFIR,XYFIR,XZFIR
     *,                 XXSEC,XYSEC,XZSEC,XXMXFF,XYMXFF,XZMXFF,GMXFIR
     *,                 GMXSEC,GMXFF,LO,XXTHR,XYTHR,XZTHR
     *,                 XXFFF,XYFFF,XZFFF,XXFSMX,XYFSMX,XZFSMX,GMXTHR
     *,                 GMXFFF,GMXFS)
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER GSPOT
      LOGICAL BOTH1,BOTH2,DO3,DO5
      LOGICAL EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      DIMENSION YX(8,14),YY(8,14),YZ(8,14)
      DIMENSION GT(I4LARL,I2LARL),GU(I4LARL,I2LARL)
      DIMENSION GV(I4LARL,I2LARL)
      DIMENSION ITEST(10)
      DIMENSION YYX(8,18),YYY(8,18),YYZ(8,18)
      DIMENSION XX0(IANGSQ,IANGSQ),XY0(IANGSQ,IANGSQ),XZ0(IANGSQ,IANGSQ)
      DIMENSION XXFIR(IANGSQ,IANGSQ,3),XYFIR(IANGSQ,IANGSQ,3)
      DIMENSION XZFIR(IANGSQ,IANGSQ,3),XXSEC(IANGSQ,IANGSQ,3)
      DIMENSION XYSEC(IANGSQ,IANGSQ,3),XZSEC(IANGSQ,IANGSQ,3)
      DIMENSION XXMXFF(IANGSQ,IANGSQ,3),XYMXFF(IANGSQ,IANGSQ,3)
      DIMENSION XZMXFF(IANGSQ,IANGSQ,3),GMXFIR(IMEM4,3,3)
      DIMENSION GMXSEC(IMEM4,6,3),GMXFF(IMEM4,9,3)
      DIMENSION LO(IMEM4*5)
      DIMENSION XXTHR(IANGSQ,IANGSQ,3),XYTHR(IANGSQ,IANGSQ,3)
     *,         XZTHR(IANGSQ,IANGSQ,3),XXFFF(IANGSQ,IANGSQ)
     *,         XYFFF(IANGSQ,IANGSQ),XZFFF(IANGSQ,IANGSQ)
      DIMENSION XXFSMX(IANGSQ,IANGSQ,6),XYFSMX(IANGSQ,IANGSQ,6)
     *,         XZFSMX(IANGSQ,IANGSQ,6)
      DIMENSION GMXTHR(IMEM4,10,3),GMXFFF(IMEM4,27),GMXFS(IMEM4,18,6)
      COMMON/CALQN/ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET
      COMMON/EINFO/IPLACE(49),ISAME(49)
      COMMON/EXYZS/EX(686),EY(686),EZ(686)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/IPAR5/IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL
      COMMON/LOGIC/EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      COMMON/ORBIN/IORB1,JORB1,KORB1,LORB1,NUMI,NUMJ,NUMK,NUML
      COMMON/PASS /II,JJ,KK,LL
      COMMON/POSNS/IJX(50),IJY(50),IJZ(50),KLX(50),KLY(50),KLZ(50)
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/TWINF/ISHELL,JSHELL,KSHELL,LSHELL
C
      ISIZ=   7
      ISIZ2= 14
      ISIZ3= 21
      IESZ=343
C
      RETURN
C
      ENTRY DER34(BOTH1,BOTH2,IQN,JQN,KQN,LQN,IGCNT,NROOT0,AA,BB,CC,DD,
     *ITEST)
C
      CC2=CC + CC
      DD2=DD + DD
      C4=CC2 * CC2
      D4=DD2 * DD2
      C8=C4 * CC2
      D8=D4 * DD2
      CD4=CC2*DD2
      CCD8=CD4 * CC2
      DDC8=CD4 * DD2
C
      NROOT=NROOT0 + NDERIV
C
      DO3=ITEST(3).EQ.1
      DO5=ITEST(5).EQ.1
C
      KLQN=KQN+LQN -1
      KLQNP1=KLQN + 1
      KLQNP2=KLQN + 2
      KLQNP3=KLQN + 3
      MAX=KLQN + IQN + JQN -1
C
      DO 10000 IROOT=1,NROOT
C
        IN=-IANG
        IM=-ISIZ
C
        DO 9000 INO=1,IQN
C
          IN=IN + IANG
          IM=IM + ISIZ
C
          DO 8000 JNO=1,JQN
C
            JN=JNO + IN
            JM=JNO + IM
C
C
            IPL=IPLACE(JM)
            ITWO=2
            IF(ISAME(JM) .EQ. 1) ITWO=1
C
C
            IT=INO + JNO - 1
C
C   ZEROTH ORDER SECTION
C
            DO 150 IKL=1,KLQN
              YX0=0.0D0
              YY0=0.0D0
              YZ0=0.0D0
              DO 100 IJ=1,IT
                IJM1=IJ-1
                ISPOT=IPL + IJM1*ITWO
                GSPOT=IKL + IJM1
                YX0=YX0 + EX(ISPOT)*GT(GSPOT,IROOT)
                YY0=YY0 + EY(ISPOT)*GU(GSPOT,IROOT)
                YZ0=YZ0 + EZ(ISPOT)*GV(GSPOT,IROOT)
  100         CONTINUE
C
              YX(IKL,1)=YX0
              YY(IKL,1)=YY0
              YZ(IKL,1)=YZ0
C
  150       CONTINUE
C
            DO 250 IKL=1,KLQNP3
              YX3=0.0D0
              YY3=0.0D0
              YZ3=0.0D0
              DO 200 IJ=1,IT
                IJM1=IJ-1
                ISPOT=IPL + IJM1*ITWO
                GSPOT=IKL + IJM1
                YX3=YX3 + EX(ISPOT)*GT(GSPOT,IROOT)
                YY3=YY3 + EY(ISPOT)*GU(GSPOT,IROOT)
                YZ3=YZ3 + EZ(ISPOT)*GV(GSPOT,IROOT)
  200         CONTINUE
              IF(IKL .LE. KLQNP1) THEN
                YX(IKL,7)=YX3
                YY(IKL,7)=YY3
                YZ(IKL,7)=YZ3
              END IF
              IF(IKL .LE. KLQNP2) THEN
                YX(IKL,8)=YX3
                YY(IKL,8)=YY3
                YZ(IKL,8)=YZ3
              END IF
              YX(IKL,13)=YX3
              YY(IKL,13)=YY3
              YZ(IKL,13)=YZ3
  250       CONTINUE
C
            KN=-IANG
            KM=-ISIZ
C
            DO 7000 KNO=1,KQN
C
              KN=KN + IANG
              KM=KM + ISIZ
C
              DUMK=DBLE(KNO-1)
              D2DK=DD2*DUMK
              DUMKM1=DBLE((KNO-1)*(KNO-2))
              DUMK2=DBLE(2*KNO -1)
              C2DK=CC2*DUMK2
              C12DK=3.0D0*C4*DBLE(KNO)
              C6DK=3.0D0*CC2*DUMK*DUMK
C
              DO 6000 LNO=1,LQN
C
                LN=LNO + KN
                LM=LNO + KM
C
                DUML=DBLE(LNO-1)
                DUMLM1=DBLE((LNO-1)*(LNO-2))
                DUML2=DBLE(2*LNO -1)
                D2DL=DD2*DUML2
                D12DL=3.0D0*D4*DBLE(LNO)
                D6DL=3.0D0*DD2*DUML*DUML
                C2DL=CC2*DUML
                DKDL=DUMK*DUML
C
                ITT=KNO + LNO -1
                ITTM1=ITT-1
                ITTM2=ITT-2
                ITTM3=ITT-3
                ITTFIR=ITT + 1
                ITTSEC=ITT + 2
                ITTTHR=ITT + 3
C
                KPL=IPLACE(LM)
                KTWO=2
                IF(ISAME(LM) .EQ. 1) KTWO=1
C
                LP0P1=LM + 1
                KP0P1=IPLACE(LP0P1)
                K2P0P1=2
                IF(ISAME(LP0P1) .EQ. 1) K2P0P1=1
                LP0P2=LM + 2
                KP0P2=IPLACE(LP0P2)
                K2P0P2=2
                IF(ISAME(LP0P2) .EQ. 1) K2P0P2=1
                LP0P3=LM + 3
                KP0P3=IPLACE(LP0P3)
                K2P0P3=2
                IF(ISAME(LP0P3) .EQ. 1) K2P0P3=1
                IF(LNO .GT. 1) THEN
                  LM0M1=LM - 1
                  KM0M1=IPLACE(LM0M1)
                  K2M0M1=2
                  IF(ISAME(LM0M1) .EQ. 1) K2M0M1=1
                  IF(LNO .GT. 2) THEN
                    LM0M2=LM - 2
                    KM0M2=IPLACE(LM0M2)
                    K2M0M2=2
                    IF(ISAME(LM0M2) .EQ. 1) K2M0M2=1
                  END IF
                END IF
C
                IF(DO3) THEN
                  LP1P0=LM + ISIZ
                  KP1P0=IPLACE(LP1P0)
                  K2P1P0=2
                  IF(ISAME(LP1P0) .EQ. 1) K2P1P0=1
                  LP2P0=LM + ISIZ2
                  KP2P0=IPLACE(LP2P0)
                  K2P2P0=2
                  IF(ISAME(LP2P0) .EQ. 1) K2P2P0=1
                  LP3P0=LM + ISIZ3
                  KP3P0=IPLACE(LP3P0)
                  K2P3P0=2
                  IF(ISAME(LP3P0) .EQ. 1) K2P3P0=1
                  IF(KNO .GT. 1) THEN
                    LM1M0=LM - ISIZ
                    KM1M0=IPLACE(LM1M0)
                    K2M1M0=2
                    IF(ISAME(LM1M0) .EQ. 1) K2M1M0=1
                    IF(KNO .GT. 2) THEN
                      LM2M0=LM - ISIZ2
                      KM2M0=IPLACE(LM2M0)
                      K2M2M0=2
                      IF(ISAME(LM2M0) .EQ. 1) K2M2M0=1
                    END IF
                  END IF
                END IF
C
                IF(DO5) THEN
                  LP1P1=LM + ISIZ + 1
                  KP1P1=IPLACE(LP1P1)
                  K2P1P1=2
                  IF(ISAME(LP1P1) .EQ. 1) K2P1P1=1
                  LP2P1=LM + ISIZ2 + 1
                  KP2P1=IPLACE(LP2P1)
                  K2P2P1=2
                  IF(ISAME(LP2P1) .EQ. 1) K2P2P1=1
                  LP1P2=LM + ISIZ + 2
                  KP1P2=IPLACE(LP1P2)
                  K2P1P2=2
                  IF(ISAME(LP1P2) .EQ. 1) K2P1P2=1
                  IF(KNO .GT. 1) THEN
                    LM1P1=LM - ISIZ + 1
                    KM1P1=IPLACE(LM1P1)
                    K2M1P1=2
                    IF(ISAME(LM1P1) .EQ. 1) K2M1P1=1
                    LM1P2=LM - ISIZ + 2
                    KM1P2=IPLACE(LM1P2)
                    K2M1P2=2
                    IF(ISAME(LM1P2) .EQ. 1) K2M1P2=1
                    IF(LNO .GT. 1) THEN
                      LM1M1=LM - ISIZ - 1
                      KM1M1=IPLACE(LM1M1)
                      K2M1M1=2
                      IF(ISAME(LM1M1) .EQ. 1) K2M1M1=1
                      IF(LNO .GT. 2) THEN
                        LM1M2=LM - ISIZ - 2
                        KM1M2=IPLACE(LM1M2)
                        K2M1M2=2
                        IF(ISAME(LM1M2) .EQ. 1) K2M1M2=1
                      END IF
                    END IF
                    IF(KNO .GT. 2) THEN
                      LM2P1=LM - ISIZ2 + 1
                      KM2P1=IPLACE(LM2P1)
                      K2M2P1=2
                      IF(ISAME(LM2P1) .EQ. 1) K2M2P1=1
                    END IF
                  END IF
                  IF(LNO .GT. 1) THEN
                    LP1M1=LM + ISIZ - 1
                    KP1M1=IPLACE(LP1M1)
                    K2P1M1=2
                    IF(ISAME(LP1M1) .EQ. 1) K2P1M1=1
                    LP2M1=LM + ISIZ2 - 1
                    KP2M1=IPLACE(LP2M1)
                    K2P2M1=2
                    IF(ISAME(LP2M1) .EQ. 1) K2P2M1=1
                    IF(KNO .GT. 2) THEN
                      LM2M1=LM - ISIZ2 - 1
                      KM2M1=IPLACE(LM2M1)
                      K2M2M1=2
                      IF(ISAME(LM2M1) .EQ. 1) K2M2M1=1
                    END IF
                    IF(LNO .GT. 2) THEN
                      LP1M2=LM + ISIZ - 2
                      KP1M2=IPLACE(LP1M2)
                      K2P1M2=2
                      IF(ISAME(LP1M2) .EQ. 1) K2P1M2=1
                    END IF
                  END IF
                END IF
C
                XXX1=0.0D0
                XYY1=0.0D0
                XZZ1=0.0D0
                IF(DO3) THEN
                  XXC1=0.0D0
                  XYC1=0.0D0
                  XZC1=0.0D0
                  XXC2=0.0D0
                  XYC2=0.0D0
                  XZC2=0.0D0
                  XX2C1=0.0D0
                  XY2C1=0.0D0
                  XZ2C1=0.0D0
                  XX2C2=0.0D0
                  XY2C2=0.0D0
                  XZ2C2=0.0D0
                  XX3C1=0.0D0
                  XY3C1=0.0D0
                  XZ3C1=0.0D0
                END IF
                XXD1=0.0D0
                XYD1=0.0D0
                XZD1=0.0D0
                XXD2=0.0D0
                XYD2=0.0D0
                XZD2=0.0D0
                XX2D1=0.0D0
                XY2D1=0.0D0
                XZ2D1=0.0D0
                XX2D2=0.0D0
                XY2D2=0.0D0
                XZ2D2=0.0D0
                XX3D1=0.0D0
                XY3D1=0.0D0
                XZ3D1=0.0D0
                IF(DO5) THEN
                  XXCD1=0.0D0
                  XXCD2=0.0D0
                  XXCD3=0.0D0
                  XXCD4=0.0D0
                  XYCD1=0.0D0
                  XYCD2=0.0D0
                  XYCD3=0.0D0
                  XYCD4=0.0D0
                  XZCD1=0.0D0
                  XZCD2=0.0D0
                  XZCD3=0.0D0
                  XZCD4=0.0D0
                  XXSF1=0.0D0
                  XYSF1=0.0D0
                  XZSF1=0.0D0
                  XXSF2=0.0D0
                  XYSF2=0.0D0
                  XZSF2=0.0D0
                  XXSF3=0.0D0
                  XYSF3=0.0D0
                  XZSF3=0.0D0
                  XXSF4=0.0D0
                  XYSF4=0.0D0
                  XZSF4=0.0D0
                  XXSF5=0.0D0
                  XYSF5=0.0D0
                  XZSF5=0.0D0
                  XXSF6=0.0D0
                  XYSF6=0.0D0
                  XZSF6=0.0D0
                  XXFS1=0.0D0
                  XYFS1=0.0D0
                  XZFS1=0.0D0
                  XXFS2=0.0D0
                  XYFS2=0.0D0
                  XZFS2=0.0D0
                  XXFS3=0.0D0
                  XYFS3=0.0D0
                  XZFS3=0.0D0
                  XXFS4=0.0D0
                  XYFS4=0.0D0
                  XZFS4=0.0D0
                  XXFS5=0.0D0
                  XYFS5=0.0D0
                  XZFS5=0.0D0
                  XXFS6=0.0D0
                  XYFS6=0.0D0
                  XZFS6=0.0D0
                END IF
C
                CONST=-1.0D0
                DO 600 KL=1,ITTTHR
                  KLM1=KL - 1
                  CONST=-CONST
C
                  IF(KL .LE. ITT) THEN
C
C   ZEROTH ORDER SECTION
C
                    KSPOT=KPL + KLM1*KTWO
                    EXCNST=EX(IESZ+KSPOT)*CONST
                    EYCNST=EY(IESZ+KSPOT)*CONST
                    EZCNST=EZ(IESZ+KSPOT)*CONST
C
                    XXX1=XXX1 + YX(KL,1)*EXCNST
                    XYY1=XYY1 + YY(KL,1)*EYCNST
                    XZZ1=XZZ1 + YZ(KL,1)*EZCNST
                  END IF
C
C   CENTER 4 FIRST, SECOND, AND THIRD DERIVATIVES
C
                  IF(KL .GT. ITTFIR) GO TO 505
                  KSPOT=KP0P1 + KLM1*K2P0P1
                  XXD1=XXD1 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                  XYD1=XYD1 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                  XZD1=XZD1 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
C
                  IF(LNO .GT. 1) THEN
                    IF(KL .LE. ITTM1) THEN
                      KSPOT=KM0M1 + KLM1*K2M0M1
                      XXD2=XXD2 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                      XYD2=XYD2 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                      XZD2=XZD2 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
                    END IF
                  END IF
  505             CONTINUE
C
                  IF(KL .GT. ITTSEC) GO TO 510
                  KSPOT=KP0P2 + KLM1*K2P0P2
                  XX2D1=XX2D1 + YX(KL,8)*EX(IESZ+KSPOT)*CONST
                  XY2D1=XY2D1 + YY(KL,8)*EY(IESZ+KSPOT)*CONST
                  XZ2D1=XZ2D1 + YZ(KL,8)*EZ(IESZ+KSPOT)*CONST
C
                  IF(LNO .GT. 2) THEN
                    IF(KL .LE. ITTM2) THEN
                      KSPOT=KM0M2 + KLM1*K2M0M2
                      XX2D2=XX2D2 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                      XY2D2=XY2D2 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                      XZ2D2=XZ2D2 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
                    END IF
                  END IF
  510             CONTINUE
C
                  KSPOT=KP0P3 + KLM1*K2P0P3
                  XX3D1=XX3D1 + YX(KL,13)*EX(IESZ+KSPOT)*CONST
                  XY3D1=XY3D1 + YY(KL,13)*EY(IESZ+KSPOT)*CONST
                  XZ3D1=XZ3D1 + YZ(KL,13)*EZ(IESZ+KSPOT)*CONST
C
C   CENTER 3 FIRST, SECOND, AND THIRD DERIVATIVES
C
                  IF(DO3) THEN
                    IF(KL .GT. ITTFIR) GO TO 520
                    KSPOT=KP1P0 + KLM1*K2P1P0
                    XXC1=XXC1 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                    XYC1=XYC1 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                    XZC1=XZC1 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
C
                    IF(KNO .GT. 1) THEN
                      IF(KL .LE. ITTM1) THEN
                        KSPOT=KM1M0 + KLM1*K2M1M0
                        XXC2=XXC2 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                        XYC2=XYC2 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                        XZC2=XZC2 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
                      END IF
                    END IF
  520               CONTINUE
C
                    IF(KL .GT. ITTSEC) GO TO 530
                    KSPOT=KP2P0 + KLM1*K2P2P0
                    XX2C1=XX2C1 + YX(KL,8)*EX(IESZ+KSPOT)*CONST
                    XY2C1=XY2C1 + YY(KL,8)*EY(IESZ+KSPOT)*CONST
                    XZ2C1=XZ2C1 + YZ(KL,8)*EZ(IESZ+KSPOT)*CONST
C
                    IF(KNO .GT. 2) THEN
                      IF(KL .LE. ITTM2) THEN
                        KSPOT=KM2M0 + KLM1*K2M2M0
                        XX2C2=XX2C2 + YX(KL,8)*EX(IESZ+KSPOT)*CONST
                        XY2C2=XY2C2 + YY(KL,8)*EY(IESZ+KSPOT)*CONST
                        XZ2C2=XZ2C2 + YZ(KL,8)*EZ(IESZ+KSPOT)*CONST
                      END IF
                    END IF
  530               CONTINUE
C
                  KSPOT=KP3P0 + KLM1*K2P3P0
                  XX3C1=XX3C1 + YX(KL,13)*EX(IESZ+KSPOT)*CONST
                  XY3C1=XY3C1 + YY(KL,13)*EY(IESZ+KSPOT)*CONST
                  XZ3C1=XZ3C1 + YZ(KL,13)*EZ(IESZ+KSPOT)*CONST
                  END IF
C
C   CENTERS 3 AND 4 MIXED DERIVATIVES
C
                  IF(DO5) THEN
                    IF(KL .GT. ITTSEC) GO TO 540
                    KSPOT=KP1P1 + KLM1*K2P1P1
                    XXCD1=XXCD1 + YX(KL,8)*EX(IESZ+KSPOT)*CONST
                    XYCD1=XYCD1 + YY(KL,8)*EY(IESZ+KSPOT)*CONST
                    XZCD1=XZCD1 + YZ(KL,8)*EZ(IESZ+KSPOT)*CONST
C
                    IF(KNO .GT. 1) THEN
                      IF(KL .LE. ITT) THEN
                        KSPOT=KM1P1 + KLM1*K2M1P1
                        XXCD2=XXCD2 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                        XYCD2=XYCD2 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                        XZCD2=XZCD2 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
                      END IF
                      IF(LNO .GT. 1) THEN
                        IF(KL .LE. ITTM2) THEN
                          KSPOT=KM1M1 + KLM1*K2M1M1
                          XXCD3=XXCD3 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                          XYCD3=XYCD3 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                          XZCD3=XZCD3 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
                        END IF
                      END IF
                    END IF
                    IF(LNO .GT. 1) THEN
                      IF(KL .LE. ITT) THEN
                        KSPOT=KP1M1 + KLM1*K2P1M1
                        XXCD4=XXCD4 + YX(KL,7)*EX(IESZ+KSPOT)*CONST
                        XYCD4=XYCD4 + YY(KL,7)*EY(IESZ+KSPOT)*CONST
                        XZCD4=XZCD4 + YZ(KL,7)*EZ(IESZ+KSPOT)*CONST
                      END IF
                    END IF
  540               CONTINUE
C
                    KSPOT=KP2P1 + KLM1*K2P2P1
                    XXSF1=XXSF1 + YX(KL,13)*EX(IESZ+KSPOT)*CONST
                    XYSF1=XYSF1 + YY(KL,13)*EY(IESZ+KSPOT)*CONST
                    XZSF1=XZSF1 + YZ(KL,13)*EZ(IESZ+KSPOT)*CONST
C
                    KSPOT=KP1P2 + KLM1*K2P1P2
                    XXFS1=XXFS1 + YX(KL,13)*EX(IESZ+KSPOT)*CONST
                    XYFS1=XYFS1 + YY(KL,13)*EY(IESZ+KSPOT)*CONST
                    XZFS1=XZFS1 + YZ(KL,13)*EZ(IESZ+KSPOT)*CONST
C
                    IF(KNO .GT. 2) THEN
                      IF(KL .LE. ITTM1) THEN
                        KSPOT=KM2P1 + KLM1*K2M2P1
                        XXSF2=XXSF2 + YX(KL,13)*EX(IESZ+KSPOT)*CONST
                        XYSF2=XYSF2 + YY(KL,13)*EY(IESZ+KSPOT)*CONST
                        XZSF2=XZSF2 + YZ(KL,13)*EZ(IESZ+KSPOT)*CONST
                      END IF
                      IF(LNO .GT. 1) THEN
                        IF(KL .LE. ITTM3) THEN
                          KSPOT=KM2M1 + KLM1*K2M2M1
                          XXSF3=XXSF3 + YX(KL,13)*EX(IESZ+KSPOT)*CONST
                          XYSF3=XYSF3 + YY(KL,13)*EY(IESZ+KSPOT)*CONST
                          XZSF3=XZSF3 + YZ(KL,13)*EZ(IESZ+KSPOT)*CONST
                        END IF
                      END IF
                    END IF
C
                    IF(LNO .GT. 1) THEN
                      IF(KL .LE. ITTFIR) THEN
                        KSPOT=KP2M1 + KLM1*K2P2M1
                        XXSF4=XXSF4 + YX(KL,13)*EX(IESZ+KSPOT)*CONST
                        XYSF4=XYSF4 + YY(KL,13)*EY(IESZ+KSPOT)*CONST
                        XZSF4=XZSF4 + YZ(KL,13)*EZ(IESZ+KSPOT)*CONST
                       END IF
                     END IF
C
                    IF(LNO .GT. 2) THEN
                      IF(KL .LE. ITTM1) THEN
                        KSPOT=KP1M2 + KLM1*K2P1M2
                        XXFS2=XXFS2 + YX(KL,13)*EX(IESZ+KSPOT)*CONST
                        XYFS2=XYFS2 + YY(KL,13)*EY(IESZ+KSPOT)*CONST
                        XZFS2=XZFS2 + YZ(KL,13)*EZ(IESZ+KSPOT)*CONST
                      END IF
                      IF(KNO .GT. 1) THEN
                        IF(KL .LE. ITTM3) THEN
                          KSPOT=KM1M2 + KLM1*K2M1M2
                          XXFS3=XXFS3 + YX(KL,13)*EX(IESZ+KSPOT)*CONST
                          XYFS3=XYFS3 + YY(KL,13)*EY(IESZ+KSPOT)*CONST
                          XZFS3=XZFS3 + YZ(KL,13)*EZ(IESZ+KSPOT)*CONST
                        END IF
                      END IF
                    END IF
C
                    IF(KNO .GT. 1) THEN
                      IF(KL .LE. ITTFIR) THEN
                        KSPOT=KM1P2 + KLM1*K2M1P2
                        XXFS4=XXFS4 + YX(KL,13)*EX(IESZ+KSPOT)*CONST
                        XYFS4=XYFS4 + YY(KL,13)*EY(IESZ+KSPOT)*CONST
                        XZFS4=XZFS4 + YZ(KL,13)*EZ(IESZ+KSPOT)*CONST
                       END IF
                     END IF
                  END IF
  600           CONTINUE
C
                XX0(JN,LN)=XXX1
                XY0(JN,LN)=XYY1
                XZ0(JN,LN)=XZZ1
C
                INT=0
C
                IF(DO3) THEN
                  INT=INT+1
                  XXFIR(JN,LN,INT)=XXC1*CC2 - DUMK*XXC2
                  XYFIR(JN,LN,INT)=XYC1*CC2 - DUMK*XYC2
                  XZFIR(JN,LN,INT)=XZC1*CC2 - DUMK*XZC2
C
                  XXSEC(JN,LN,INT)=C4*XX2C1 - C2DK*XXX1 + DUMKM1*XX2C2
                  XYSEC(JN,LN,INT)=C4*XY2C1 - C2DK*XYY1 + DUMKM1*XY2C2
                  XZSEC(JN,LN,INT)=C4*XZ2C1 - C2DK*XZZ1 + DUMKM1*XZ2C2
C
                  XXTHR(JN,LN,INT)=C8*XX3C1 - C12DK*XXC1 + C6DK*XXC2
                  XYTHR(JN,LN,INT)=C8*XY3C1 - C12DK*XYC1 + C6DK*XYC2
                  XZTHR(JN,LN,INT)=C8*XZ3C1 - C12DK*XZC1 + C6DK*XZC2
                END IF
C
                INT=INT+1
                XXFIR(JN,LN,INT)=XXD1*DD2 - DUML*XXD2
                XYFIR(JN,LN,INT)=XYD1*DD2 - DUML*XYD2
                XZFIR(JN,LN,INT)=XZD1*DD2 - DUML*XZD2
C
                XXSEC(JN,LN,INT)=D4*XX2D1 - D2DL*XXX1 + DUMLM1*XX2D2
                XYSEC(JN,LN,INT)=D4*XY2D1 - D2DL*XYY1 + DUMLM1*XY2D2
                XZSEC(JN,LN,INT)=D4*XZ2D1 - D2DL*XZZ1 + DUMLM1*XZ2D2
C
                XXTHR(JN,LN,INT)=D8*XX3D1 - D12DL*XXD1 + D6DL*XXD2
                XYTHR(JN,LN,INT)=D8*XY3D1 - D12DL*XYD1 + D6DL*XYD2
                XZTHR(JN,LN,INT)=D8*XZ3D1 - D12DL*XZD1 + D6DL*XZD2
C
                IMX=0
                IFS=0
                IF(DO5) THEN
                  IMX=IMX+1
                  XXMXFF(JN,LN,IMX)=CD4*XXCD1 - D2DK*XXCD2 + DKDL*XXCD3
     *            - C2DL*XXCD4
                  XYMXFF(JN,LN,IMX)=CD4*XYCD1 - D2DK*XYCD2 + DKDL*XYCD3
     *            - C2DL*XYCD4
                  XZMXFF(JN,LN,IMX)=CD4*XZCD1 - D2DK*XZCD2 + DKDL*XZCD3
     *            - C2DL*XZCD4
C
                  IFS=IFS+1
                  XXFSMX(JN,LN,IFS)= CCD8*XXSF1 - CD4*DUMK2*XXD1
     *                             + DD2*DUMKM1*XXSF2 - C4*DUML*XXSF4
     *                         + CC2*DUML*DUMK2*XXD2 - DUMKM1*DUML*XXSF3
                  XYFSMX(JN,LN,IFS)= CCD8*XYSF1 - CD4*DUMK2*XYD1
     *                             + DD2*DUMKM1*XYSF2 - C4*DUML*XYSF4
     *                         + CC2*DUML*DUMK2*XYD2 - DUMKM1*DUML*XYSF3
                  XZFSMX(JN,LN,IFS)= CCD8*XZSF1 - CD4*DUMK2*XZD1
     *                             + DD2*DUMKM1*XZSF2 - C4*DUML*XZSF4
     *                         + CC2*DUML*DUMK2*XZD2 - DUMKM1*DUML*XZSF3
                  IFS=IFS+1
                  XXFSMX(JN,LN,IFS)= DDC8*XXFS1 - CD4*DUML2*XXC1
     *                             + CC2*DUMLM1*XXFS2 - D4*DUMK*XXFS4
     *                         + DD2*DUMK*DUML2*XXC2 - DUMLM1*DUMK*XXFS3
                  XYFSMX(JN,LN,IFS)= DDC8*XYFS1 - CD4*DUML2*XYC1
     *                             + CC2*DUMLM1*XYFS2 - D4*DUMK*XYFS4
     *                         + DD2*DUMK*DUML2*XYC2 - DUMLM1*DUMK*XYFS3
                  XZFSMX(JN,LN,IFS)= DDC8*XZFS1 - CD4*DUML2*XZC1
     *                             + CC2*DUMLM1*XZFS2 - D4*DUMK*XZFS4
     *                         + DD2*DUMK*DUML2*XZC2 - DUMLM1*DUMK*XZFS3
                END IF
C
C
 6000         CONTINUE
 7000       CONTINUE
C
 8000     CONTINUE
 9000   CONTINUE
C
C
C   ACTUALLY FORM THE INTEGRALS
C
        ICNT=0
        IJCNT=0
        IORBMX=IORB1 -1 + NUMI
        JORBMX=JORB1 -1 + NUMJ
        DO 5000 IORB=IORB1,IORBMX
          IF(BOTH1) JORBMX=IORB
          DO 4000 JORB=JORB1,JORBMX
            IJORB=IOFF(MAX0(IORB,JORB)) + MIN0(IORB,JORB)
            IJCNT=IJCNT + 1
            JNX=IJX(IJCNT)
            JNY=IJY(IJCNT)
            JNZ=IJZ(IJCNT)
            KLCNT=0
            KORBMX=KORB1 -1 + NUMK
            LORBMX=LORB1 -1 + NUML
            IF(ISHELL .EQ. KSHELL) KORBMX=IORB
            DO 3000 KORB=KORB1,KORBMX
              IF(BOTH2) LORBMX=KORB
              DO 2000 LORB=LORB1,LORBMX
                KLORB=IOFF(MAX0(KORB,LORB)) + MIN0(KORB,LORB)
                IJKL=IOFF(MAX0(IJORB,KLORB)) + MIN0(IJORB,KLORB)
                IF(KLORB .GT. IJORB) GO TO 3000
C
                ICNT=ICNT + 1
                IF(ICNT .GT. IMEM4) WRITE(IOUT,*) ' ICNT = ',ICNT
                KLCNT=KLCNT + 1
                LNX=KLX(KLCNT)
                LNY=KLY(KLCNT)
                LNZ=KLZ(KLCNT)
                INT=0
C
C   CENTER 3 DERIVATIVES
C
                IF(DO3) THEN
                  INT=INT+1
C
C   FIRST DERIVATIVES
C
                  GMXFIR(ICNT,1,INT)= GMXFIR(ICNT,1,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,2,INT)= GMXFIR(ICNT,2,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXFIR(ICNT,3,INT)= GMXFIR(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
C
C   SECOND DERIVATIVES
C
                  GMXSEC(ICNT,1,INT)= GMXSEC(ICNT,1,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,2,INT)= GMXSEC(ICNT,2,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,3,INT)= GMXSEC(ICNT,3,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXSEC(ICNT,4,INT)= GMXSEC(ICNT,4,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,5,INT)= GMXSEC(ICNT,5,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXSEC(ICNT,6,INT)= GMXSEC(ICNT,6,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
C
C   THIRD DERIVATIVES
C
                  GMXTHR(ICNT,1,INT)=GMXTHR(ICNT,1,INT) +
     *            XXTHR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,2,INT)=GMXTHR(ICNT,2,INT) +
     *            XXSEC(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,3,INT)=GMXTHR(ICNT,3,INT) +
     *            XXFIR(JNX,LNX,INT)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,4,INT)=GMXTHR(ICNT,4,INT) +
     *            XX0(JNX,LNX)*XYTHR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                  GMXTHR(ICNT,5,INT)=GMXTHR(ICNT,5,INT) +
     *            XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,6,INT)=GMXTHR(ICNT,6,INT) +
     *            XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,
     *            INT)
                  GMXTHR(ICNT,7,INT)=GMXTHR(ICNT,7,INT) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                  GMXTHR(ICNT,8,INT)=GMXTHR(ICNT,8,INT) +
     *            XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,9,INT)=GMXTHR(ICNT,9,INT) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZSEC(JNZ,LNZ,INT)
                  GMXTHR(ICNT,10,INT)=GMXTHR(ICNT,10,INT) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZTHR(JNZ,LNZ,INT)
                END IF
C
C   CENTER 4 DERIVATIVES
C
                INT=INT+1
C
C   FIRST DERIVATIVES
C
                GMXFIR(ICNT,1,INT)= GMXFIR(ICNT,1,INT) +
     *          XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                GMXFIR(ICNT,2,INT)= GMXFIR(ICNT,2,INT) +
     *          XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                GMXFIR(ICNT,3,INT)= GMXFIR(ICNT,3,INT) +
     *          XX0(JNX,LNX)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
C
C   SECOND DERIVATIVES
C
                GMXSEC(ICNT,1,INT)= GMXSEC(ICNT,1,INT) +
     *          XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                GMXSEC(ICNT,2,INT)= GMXSEC(ICNT,2,INT) +
     *          XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                GMXSEC(ICNT,3,INT)= GMXSEC(ICNT,3,INT) +
     *          XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                GMXSEC(ICNT,4,INT)= GMXSEC(ICNT,4,INT) +
     *          XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                GMXSEC(ICNT,5,INT)= GMXSEC(ICNT,5,INT) +
     *          XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                GMXSEC(ICNT,6,INT)= GMXSEC(ICNT,6,INT) +
     *          XX0(JNX,LNX)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
C
C   THIRD DERIVATIVES
C
                GMXTHR(ICNT,1,INT)=GMXTHR(ICNT,1,INT) +
     *          XXTHR(JNX,LNX,INT)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                GMXTHR(ICNT,2,INT)=GMXTHR(ICNT,2,INT) +
     *          XXSEC(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                GMXTHR(ICNT,3,INT)=GMXTHR(ICNT,3,INT) +
     *          XXFIR(JNX,LNX,INT)*XYSEC(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                GMXTHR(ICNT,4,INT)=GMXTHR(ICNT,4,INT) +
     *          XX0(JNX,LNX)*XYTHR(JNY,LNY,INT)*XZ0(JNZ,LNZ)
                GMXTHR(ICNT,5,INT)=GMXTHR(ICNT,5,INT) +
     *          XXSEC(JNX,LNX,INT)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,INT)
                GMXTHR(ICNT,6,INT)=GMXTHR(ICNT,6,INT) +
     *          XXFIR(JNX,LNX,INT)*XYFIR(JNY,LNY,INT)*XZFIR(JNZ,LNZ,
     *          INT)
                GMXTHR(ICNT,7,INT)=GMXTHR(ICNT,7,INT) +
     *          XX0(JNX,LNX)*XYSEC(JNY,LNY,INT)*XZFIR(JNZ,LNZ,INT)
                GMXTHR(ICNT,8,INT)=GMXTHR(ICNT,8,INT) +
     *          XXFIR(JNX,LNX,INT)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,INT)
                GMXTHR(ICNT,9,INT)=GMXTHR(ICNT,9,INT) +
     *          XX0(JNX,LNX)*XYFIR(JNY,LNY,INT)*XZSEC(JNZ,LNZ,INT)
                GMXTHR(ICNT,10,INT)=GMXTHR(ICNT,10,INT) +
     *          XX0(JNX,LNX)*XY0(JNY,LNY)*XZTHR(JNZ,LNZ,INT)
C
C   CENTER 3 AND CENTER 4 MIXED DERIVATIVES
C
                IMX=0
                IFS=0
                IF(DO5) THEN
C
C   SECOND DERIVATIVES
C
                  IMX=IMX + 1
                  GMXFF(ICNT,1,IMX)= GMXFF(ICNT,1,IMX) +
     *            XXMXFF(JNX,LNX,IMX)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,2,IMX)= GMXFF(ICNT,2,IMX) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,3,IMX)= GMXFF(ICNT,3,IMX) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFF(ICNT,4,IMX)= GMXFF(ICNT,4,IMX) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,5,IMX)= GMXFF(ICNT,5,IMX) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,IMX)*XZ0(JNZ,LNZ)
                  GMXFF(ICNT,6,IMX)= GMXFF(ICNT,6,IMX) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFF(ICNT,7,IMX)= GMXFF(ICNT,7,IMX) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFF(ICNT,8,IMX)= GMXFF(ICNT,8,IMX) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFF(ICNT,9,IMX)= GMXFF(ICNT,9,IMX) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,IMX)
C
C   THIRD DERIVATIVES
C
                  IFS=IFS+1
                  GMXFS(ICNT,1,IFS)= GMXFS(ICNT,1,IFS) +
     *            XXFSMX(JNX,LNX,1)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,2,IFS)= GMXFS(ICNT,2,IFS) +
     *            XXSEC(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,3,IFS)= GMXFS(ICNT,3,IFS) +
     *            XXSEC(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,4,IFS)= GMXFS(ICNT,4,IFS) +
     *            XXMXFF(JNX,LNX,1)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,5,IFS)= GMXFS(ICNT,5,IFS) +
     *            XXFIR(JNX,LNX,1)*XYMXFF(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,6,IFS)= GMXFS(ICNT,6,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,7,IFS)= GMXFS(ICNT,7,IFS) +
     *            XXMXFF(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,8,IFS)= GMXFS(ICNT,8,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,9,IFS)= GMXFS(ICNT,9,IFS) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,10,IFS)= GMXFS(ICNT,10,IFS) +
     *            XXFIR(JNX,LNX,2)*XYSEC(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,11,IFS)= GMXFS(ICNT,11,IFS) +
     *            XX0(JNX,LNX)*XYFSMX(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,12,IFS)= GMXFS(ICNT,12,IFS) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,13,IFS)= GMXFS(ICNT,13,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,14,IFS)= GMXFS(ICNT,14,IFS) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,1)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,15,IFS)= GMXFS(ICNT,15,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,16,IFS)= GMXFS(ICNT,16,IFS) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,1)
                  GMXFS(ICNT,17,IFS)= GMXFS(ICNT,17,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZSEC(JNZ,LNZ,1)
                  GMXFS(ICNT,18,IFS)= GMXFS(ICNT,18,IFS) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFSMX(JNZ,LNZ,1)
C
                  IFS=IFS+1
                  GMXFS(ICNT,1,IFS)= GMXFS(ICNT,1,IFS) +
     *            XXFSMX(JNX,LNX,2)*XY0(JNY,LNY)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,2,IFS)= GMXFS(ICNT,2,IFS) +
     *            XXSEC(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,3,IFS)= GMXFS(ICNT,3,IFS) +
     *            XXSEC(JNX,LNX,2)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,4,IFS)= GMXFS(ICNT,4,IFS) +
     *            XXMXFF(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,5,IFS)= GMXFS(ICNT,5,IFS) +
     *            XXFIR(JNX,LNX,2)*XYMXFF(JNY,LNY,1)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,6,IFS)= GMXFS(ICNT,6,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,7,IFS)= GMXFS(ICNT,7,IFS) +
     *            XXMXFF(JNX,LNX,1)*XY0(JNY,LNY)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,8,IFS)= GMXFS(ICNT,8,IFS) +
     *            XXFIR(JNX,LNX,2)*XYFIR(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,9,IFS)= GMXFS(ICNT,9,IFS) +
     *            XXFIR(JNX,LNX,2)*XY0(JNY,LNY)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,10,IFS)= GMXFS(ICNT,10,IFS) +
     *            XXFIR(JNX,LNX,1)*XYSEC(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,11,IFS)= GMXFS(ICNT,11,IFS) +
     *            XX0(JNX,LNX)*XYFSMX(JNY,LNY,2)*XZ0(JNZ,LNZ)
                  GMXFS(ICNT,12,IFS)= GMXFS(ICNT,12,IFS) +
     *            XX0(JNX,LNX)*XYSEC(JNY,LNY,2)*XZFIR(JNZ,LNZ,1)
                  GMXFS(ICNT,13,IFS)= GMXFS(ICNT,13,IFS) +
     *            XXFIR(JNX,LNX,1)*XYFIR(JNY,LNY,2)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,14,IFS)= GMXFS(ICNT,14,IFS) +
     *            XX0(JNX,LNX)*XYMXFF(JNY,LNY,1)*XZFIR(JNZ,LNZ,2)
                  GMXFS(ICNT,15,IFS)= GMXFS(ICNT,15,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,2)*XZMXFF(JNZ,LNZ,1)
                  GMXFS(ICNT,16,IFS)= GMXFS(ICNT,16,IFS) +
     *            XXFIR(JNX,LNX,1)*XY0(JNY,LNY)*XZSEC(JNZ,LNZ,2)
                  GMXFS(ICNT,17,IFS)= GMXFS(ICNT,17,IFS) +
     *            XX0(JNX,LNX)*XYFIR(JNY,LNY,1)*XZSEC(JNZ,LNZ,2)
                  GMXFS(ICNT,18,IFS)= GMXFS(ICNT,18,IFS) +
     *            XX0(JNX,LNX)*XY0(JNY,LNY)*XZFSMX(JNZ,LNZ,2)
                END IF
 2000         CONTINUE
 3000       CONTINUE
 4000     CONTINUE
 5000   CONTINUE
C
10000 CONTINUE
C
      IGCNT=ICNT
C
      RETURN
      END
      SUBROUTINE DENSET(DM123,D,DA,DB,DC,ITOTDG)
      IMPLICIT REAL*8 (A-H,O-Z)
      DIMENSION DA(NUMIJ,NTYPES),DB(NUMIJ,NTYPES),DC(NUMIJ*NTYPES)
      DIMENSION DM123(NUMIJ,ITOTDG*NTYPES),D(NTYPES,NUMIJ,ITOTDG)
      COMMON/CALQN/ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/SIGNS/IOFF(256),IPRNT
C
C   D     : OPEN SHELL HALF TRANSFORMED DERIVATIVE FOCK MATRICES
C   DM123 : CLOSED SHELL HALF TRANSFORMED DERIVATIVE FOCK MATRICES
C
C   D AND DM123 BEGIN AT THE SAME PLACE, BUT THEIR SIZES ARE DIFFERENT
C
      RETURN
C
      ENTRY DAMULT(VALU,IOR,JOR,KOR,LOR,ITYPE,IPLACE,IORDER)
C
C   FORM THE FOCK TYPE MATRIX HALF TRANSFORMED TO THE MO BASIS
C
      ISKIP=IPLACE
      IF(IORDER .EQ. 2) ISKIP=IPLACE + N3N
      IF(IORDER .EQ. 3) ISKIP=IPLACE + N3N + I2N3N
C
      GO TO (50,70,80,90),ISTYPE
C
C::::::::::::::::::
C:::CLOSED-SHELL:::
C::::::::::::::::::
C
   50 CONTINUE
C
      GO TO (301,302,303,304,305,306,307,308,309,310,311,312,312,312),IT
     *YPE
C
C (II/II)   1=(11/11)
C
  301 IIII=IOFF(IOR+1)
      DM123(IIII,ISKIP)=DM123(IIII,ISKIP)+DC(IIII)*VALU
      GO TO 400
C
C  (II/KK)  2=(22/11)
C
  302 IIII=IOFF(IOR+1)
      KKKK=IOFF(KOR+1)
      IIKK=IOFF(IOR)+KOR
      VAL2=VALU+VALU
      DM123(IIII,ISKIP)=DM123(IIII,ISKIP)+DC(KKKK)*VAL2
      DM123(KKKK,ISKIP)=DM123(KKKK,ISKIP)+DC(IIII)*VAL2
      DM123(IIKK,ISKIP)=DM123(IIKK,ISKIP)-DC(IIKK)*VALU
      GO TO 400
C
C  (II/IL)  3=(22/21)
C
  303 IIII=IOFF(IOR+1)
      IILL=IOFF(IOR)+LOR
      VAL2=VALU+VALU
      DM123(IIII,ISKIP)=DM123(IIII,ISKIP)+DC(IILL)*VAL2
      DM123(IILL,ISKIP)=DM123(IILL,ISKIP)+DC(IIII)*VALU
      GO TO 400
C
C  (IJ/JJ)  4=(21/11)
C
  304 IIJJ=IOFF(IOR)+JOR
      JJJJ=IOFF(JOR+1)
      VAL2=VALU+VALU
      DM123(IIJJ,ISKIP)=DM123(IIJJ,ISKIP)+DC(JJJJ)*VALU
      DM123(JJJJ,ISKIP)=DM123(JJJJ,ISKIP)+DC(IIJJ)*VAL2
      GO TO 400
C
C  (IJ/IJ)  5=(21/21)
C
  305 IIJJ=IOFF(IOR)+JOR
      IIII=IOFF(IOR+1)
      JJJJ=IOFF(JOR+1)
      VAL3=VALU+VALU+VALU
      DM123(IIJJ,ISKIP)=DM123(IIJJ,ISKIP)+DC(IIJJ)*VAL3
      DM123(IIII,ISKIP)=DM123(IIII,ISKIP)-DC(JJJJ)*VALU
      DM123(JJJJ,ISKIP)=DM123(JJJJ,ISKIP)-DC(IIII)*VALU
      GO TO 400
C
C  (II/KL)  6=(33/21)
C
  306 IIII=IOFF(IOR+1)
      KKLL=IOFF(KOR)+LOR
      IIKK=IOFF(IOR)+KOR
      IILL=IOFF(IOR)+LOR
      VAL2=VALU+VALU
      VAL4=VAL2+VAL2
      DM123(IIII,ISKIP)=DM123(IIII,ISKIP)+DC(KKLL)*VAL4
      DM123(KKLL,ISKIP)=DM123(KKLL,ISKIP)+DC(IIII)*VAL2
      DM123(IIKK,ISKIP)=DM123(IIKK,ISKIP)-DC(IILL)*VALU
      DM123(IILL,ISKIP)=DM123(IILL,ISKIP)-DC(IIKK)*VALU
      GO TO 400
C
C  (IJ/KK)  7=(32/11)
C
  307 IIJJ=IOFF(IOR)+JOR
      KKKK=IOFF(KOR+1)
      IIKK=IOFF(IOR)+KOR
      JJKK=IOFF(JOR)+KOR
      VAL2=VALU+VALU
      VAL4=VAL2+VAL2
      DM123(IIJJ,ISKIP)=DM123(IIJJ,ISKIP)+DC(KKKK)*VAL2
      DM123(KKKK,ISKIP)=DM123(KKKK,ISKIP)+DC(IIJJ)*VAL4
      DM123(IIKK,ISKIP)=DM123(IIKK,ISKIP)-DC(JJKK)*VALU
      DM123(JJKK,ISKIP)=DM123(JJKK,ISKIP)-DC(IIKK)*VALU
      GO TO 400
C
C  (IJ/KK)  8=(31/22)
C
  308 IIJJ=IOFF(IOR)+JOR
      KKKK=IOFF(KOR+1)
      IIKK=IOFF(IOR)+KOR
      JJKK=JOR+IOFF(KOR)
      VAL2=VALU+VALU
      VAL4=VAL2+VAL2
      DM123(IIJJ,ISKIP)=DM123(IIJJ,ISKIP)+DC(KKKK)*VAL2
      DM123(KKKK,ISKIP)=DM123(KKKK,ISKIP)+DC(IIJJ)*VAL4
      DM123(IIKK,ISKIP)=DM123(IIKK,ISKIP)-DC(JJKK)*VALU
      DM123(JJKK,ISKIP)=DM123(JJKK,ISKIP)-DC(IIKK)*VALU
      GO TO 400
C
C (IJ/IL)  9=(32/31)
C
  309 IIJJ=IOFF(IOR)+JOR
      IILL=IOFF(IOR)+LOR
      IIII=IOFF(IOR+1)
      JJLL=IOFF(JOR)+LOR
      VAL2=VALU+VALU
      VAL3=VALU+VAL2
      DM123(IIJJ,ISKIP)=DM123(IIJJ,ISKIP)+DC(IILL)*VAL3
      DM123(IILL,ISKIP)=DM123(IILL,ISKIP)+DC(IIJJ)*VAL3
      DM123(IIII,ISKIP)=DM123(IIII,ISKIP)-DC(JJLL)*VAL2
      DM123(JJLL,ISKIP)=DM123(JJLL,ISKIP)-DC(IIII)*VALU
      GO TO 400
C
C  (IJ/JL)  10=(32/21)
C
  310 IIJJ=IOFF(IOR)+JOR
      JJLL=IOFF(JOR)+LOR
      IILL=IOFF(IOR)+LOR
      JJJJ=IOFF(JOR+1)
      VAL2=VALU+VALU
      VAL3=VALU+VAL2
      DM123(IIJJ,ISKIP)=DM123(IIJJ,ISKIP)+DC(JJLL)*VAL3
      DM123(JJLL,ISKIP)=DM123(JJLL,ISKIP)+DC(IIJJ)*VAL3
      DM123(IILL,ISKIP)=DM123(IILL,ISKIP)-DC(JJJJ)*VALU
      DM123(JJJJ,ISKIP)=DM123(JJJJ,ISKIP)-DC(IILL)*VAL2
      GO TO 400
C
C  (IJ/KJ)  11=(31/21)
C
  311 IIJJ=IOFF(IOR)+JOR
      JJKK=JOR+IOFF(KOR)
      IIKK=IOFF(IOR)+KOR
      JJJJ=IOFF(JOR+1)
      VAL2=VALU+VALU
      VAL3=VALU+VAL2
      DM123(IIJJ,ISKIP)=DM123(IIJJ,ISKIP)+DC(JJKK)*VAL3
      DM123(JJKK,ISKIP)=DM123(JJKK,ISKIP)+DC(IIJJ)*VAL3
      DM123(IIKK,ISKIP)=DM123(IIKK,ISKIP)-DC(JJJJ)*VALU
      DM123(JJJJ,ISKIP)=DM123(JJJJ,ISKIP)-DC(IIKK)*VAL2
      GO TO 400
C
C  (IJ/KL)  12=(43/21)
C  (IJ/KL)  13=(42/31)
C  (IJ/KL)  14=(41/32)
C
  312 IIJJ=IOFF(IOR)+JOR
      KKLL=IOFF(KOR)+LOR
      IIKK=IOFF(IOR)+KOR
      IILL=IOFF(IOR)+LOR
      JJKK=IOFF(MAX0(JOR,KOR))+MIN0(JOR,KOR)
      JJLL=IOFF(MAX0(JOR,LOR))+MIN0(JOR,LOR)
      VAL2=VALU+VALU
      VAL4=VAL2+VAL2
      DM123(IIJJ,ISKIP)=DM123(IIJJ,ISKIP)+DC(KKLL)*VAL4
      DM123(KKLL,ISKIP)=DM123(KKLL,ISKIP)+DC(IIJJ)*VAL4
      DM123(IIKK,ISKIP)=DM123(IIKK,ISKIP)-DC(JJLL)*VALU
      DM123(JJLL,ISKIP)=DM123(JJLL,ISKIP)-DC(IIKK)*VALU
      DM123(IILL,ISKIP)=DM123(IILL,ISKIP)-DC(JJKK)*VALU
      DM123(JJKK,ISKIP)=DM123(JJKK,ISKIP)-DC(IILL)*VALU
C
  400 CONTINUE
      GOTO 1000
C
C::::::::::::::::::::::::
C:::GENERAL OPEN-SHELL:::
C::::::::::::::::::::::::
C
   70 CONTINUE
C
      GO TO (601,602,603,604,605,606,607,608,609,610,611,612,612,612),IT
     *YPE
C
C (II/II)   1=(11/11)
C
  601 IIII=IOFF(IOR+1)
      DO 501 ITYP=1,NTYPES
        D(ITYP,IIII,ISKIP)=D(ITYP,IIII,ISKIP)
     *                   +(DA(IIII,ITYP)+DB(IIII,ITYP))*VALU
  501 CONTINUE
      GO TO 700
C
C  (II/KK)  2=(22/11)
C
  602 IIII=IOFF(IOR+1)
      KKKK=IOFF(KOR+1)
      IIKK=IOFF(IOR)+KOR
      DO 502 ITYP=1,NTYPES
        D(ITYP,IIII,ISKIP)=D(ITYP,IIII,ISKIP)+DA(KKKK,ITYP)*VALU
        D(ITYP,KKKK,ISKIP)=D(ITYP,KKKK,ISKIP)+DA(IIII,ITYP)*VALU
        D(ITYP,IIKK,ISKIP)=D(ITYP,IIKK,ISKIP)+DB(IIKK,ITYP)*VALU
  502 CONTINUE
      GO TO 700
C
C  (II/IL)  3=(22/21)
C
  603 IIII=IOFF(IOR+1)
      IILL=IOFF(IOR)+LOR
      VAL2=VALU+VALU
      DO 503 ITYP=1,NTYPES
        D(ITYP,IIII,ISKIP)=D(ITYP,IIII,ISKIP)
     *                   +(DA(IILL,ITYP)+DB(IILL,ITYP))*VAL2
        D(ITYP,IILL,ISKIP)=D(ITYP,IILL,ISKIP)
     *                   +(DA(IIII,ITYP)+DB(IIII,ITYP))*VALU
  503 CONTINUE
      GO TO 700
C
C  (IJ/JJ)  4=(21/11)
C
  604 IIJJ=IOFF(IOR)+JOR
      JJJJ=IOFF(JOR+1)
      VAL2=VALU+VALU
      DO 504 ITYP=1,NTYPES
        D(ITYP,IIJJ,ISKIP)=D(ITYP,IIJJ,ISKIP)
     *                   +(DA(JJJJ,ITYP)+DB(JJJJ,ITYP))*VALU
        D(ITYP,JJJJ,ISKIP)=D(ITYP,JJJJ,ISKIP)
     *                   +(DA(IIJJ,ITYP)+DB(IIJJ,ITYP))*VAL2
  504 CONTINUE
      GO TO 700
C
C  (IJ/IJ)  5=(21/21)
C
  605 IIJJ=IOFF(IOR)+JOR
      IIII=IOFF(IOR+1)
      JJJJ=IOFF(JOR+1)
      DO 505 ITYP=1,NTYPES
        D(ITYP,IIJJ,ISKIP)=D(ITYP,IIJJ,ISKIP)
     *                   +(DA(IIJJ,ITYP)*2.0D0+DB(IIJJ,ITYP))*VALU
        D(ITYP,IIII,ISKIP)=D(ITYP,IIII,ISKIP)+DB(JJJJ,ITYP)*VALU
        D(ITYP,JJJJ,ISKIP)=D(ITYP,JJJJ,ISKIP)+DB(IIII,ITYP)*VALU
  505 CONTINUE
      GO TO 700
C
C  (II/KL)  6=(33/21)
C
  606 IIII=IOFF(IOR+1)
      KKLL=IOFF(KOR)+LOR
      IIKK=IOFF(IOR)+KOR
      IILL=IOFF(IOR)+LOR
      VAL2=VALU+VALU
      DO 506 ITYP=1,NTYPES
        D(ITYP,IIII,ISKIP)=D(ITYP,IIII,ISKIP)+DA(KKLL,ITYP)*VAL2
        D(ITYP,KKLL,ISKIP)=D(ITYP,KKLL,ISKIP)+DA(IIII,ITYP)*VALU
        D(ITYP,IIKK,ISKIP)=D(ITYP,IIKK,ISKIP)+DB(IILL,ITYP)*VALU
        D(ITYP,IILL,ISKIP)=D(ITYP,IILL,ISKIP)+DB(IIKK,ITYP)*VALU
  506 CONTINUE
      GO TO 700
C
C  (IJ/KK)  7=(32/11)
C
  607 IIJJ=IOFF(IOR)+JOR
      KKKK=IOFF(KOR+1)
      IIKK=IOFF(IOR)+KOR
      JJKK=IOFF(JOR)+KOR
      VAL2=VALU+VALU
      DO 507 ITYP=1,NTYPES
        D(ITYP,IIJJ,ISKIP)=D(ITYP,IIJJ,ISKIP)+DA(KKKK,ITYP)*VALU
        D(ITYP,KKKK,ISKIP)=D(ITYP,KKKK,ISKIP)+DA(IIJJ,ITYP)*VAL2
        D(ITYP,IIKK,ISKIP)=D(ITYP,IIKK,ISKIP)+DB(JJKK,ITYP)*VALU
        D(ITYP,JJKK,ISKIP)=D(ITYP,JJKK,ISKIP)+DB(IIKK,ITYP)*VALU
  507 CONTINUE
      GO TO 700
C
C  (IJ/KK)  8=(31/22)
C
  608 IIJJ=IOFF(IOR)+JOR
      KKKK=IOFF(KOR+1)
      IIKK=IOFF(IOR)+KOR
      JJKK=JOR+IOFF(KOR)
      VAL2=VALU+VALU
      DO 508 ITYP=1,NTYPES
        D(ITYP,IIJJ,ISKIP)=D(ITYP,IIJJ,ISKIP)+DA(KKKK,ITYP)*VALU
        D(ITYP,KKKK,ISKIP)=D(ITYP,KKKK,ISKIP)+DA(IIJJ,ITYP)*VAL2
        D(ITYP,IIKK,ISKIP)=D(ITYP,IIKK,ISKIP)+DB(JJKK,ITYP)*VALU
        D(ITYP,JJKK,ISKIP)=D(ITYP,JJKK,ISKIP)+DB(IIKK,ITYP)*VALU
  508 CONTINUE
      GO TO 700
C
C (IJ/IL)  9=(32/31)
C
  609 IIJJ=IOFF(IOR)+JOR
      IILL=IOFF(IOR)+LOR
      IIII=IOFF(IOR+1)
      JJLL=IOFF(JOR)+LOR
      VAL2=VALU+VALU
      DO 509 ITYP=1,NTYPES
        D(ITYP,IIJJ,ISKIP)=D(ITYP,IIJJ,ISKIP)
     *                  +(DA(IILL,ITYP)*2.0D0+DB(IILL,ITYP))*VALU
        D(ITYP,IILL,ISKIP)=D(ITYP,IILL,ISKIP)
     *                  +(DA(IIJJ,ITYP)*2.0D0+DB(IIJJ,ITYP))*VALU
        D(ITYP,IIII,ISKIP)=D(ITYP,IIII,ISKIP)+DB(JJLL,ITYP)*VAL2
        D(ITYP,JJLL,ISKIP)=D(ITYP,JJLL,ISKIP)+DB(IIII,ITYP)*VALU
  509 CONTINUE
      GO TO 700
C
C  (IJ/JL)  10=(32/21)
C
  610 IIJJ=IOFF(IOR)+JOR
      JJLL=IOFF(JOR)+LOR
      IILL=IOFF(IOR)+LOR
      JJJJ=IOFF(JOR+1)
      VAL2=VALU+VALU
      DO 510 ITYP=1,NTYPES
        D(ITYP,IIJJ,ISKIP)=D(ITYP,IIJJ,ISKIP)
     *                  +(DA(JJLL,ITYP)*2.0D0+DB(JJLL,ITYP))*VALU
        D(ITYP,JJLL,ISKIP)=D(ITYP,JJLL,ISKIP)
     *                  +(DA(IIJJ,ITYP)*2.0D0+DB(IIJJ,ITYP))*VALU
        D(ITYP,IILL,ISKIP)=D(ITYP,IILL,ISKIP)+DB(JJJJ,ITYP)*VALU
        D(ITYP,JJJJ,ISKIP)=D(ITYP,JJJJ,ISKIP)+DB(IILL,ITYP)*VAL2
  510 CONTINUE
      GO TO 700
C
C  (IJ/KJ)  11=(31/21)
C
  611 IIJJ=IOFF(IOR)+JOR
      JJKK=JOR+IOFF(KOR)
      IIKK=IOFF(IOR)+KOR
      JJJJ=IOFF(JOR+1)
      VAL2=VALU+VALU
      DO 511 ITYP=1,NTYPES
        D(ITYP,IIJJ,ISKIP)=D(ITYP,IIJJ,ISKIP)
     *                  +(DA(JJKK,ITYP)*2.0D0+DB(JJKK,ITYP))*VALU
        D(ITYP,JJKK,ISKIP)=D(ITYP,JJKK,ISKIP)
     *                  +(DA(IIJJ,ITYP)*2.0D0+DB(IIJJ,ITYP))*VALU
        D(ITYP,IIKK,ISKIP)=D(ITYP,IIKK,ISKIP)+DB(JJJJ,ITYP)*VALU
        D(ITYP,JJJJ,ISKIP)=D(ITYP,JJJJ,ISKIP)+DB(IIKK,ITYP)*VAL2
  511 CONTINUE
      GO TO 700
C
C  (IJ/KL)  12=(43/21)
C  (IJ/KL)  13=(42/31)
C  (IJ/KL)  14=(41/32)
C
  612 IIJJ=IOFF(IOR)+JOR
      KKLL=IOFF(KOR)+LOR
      IIKK=IOFF(IOR)+KOR
      IILL=IOFF(IOR)+LOR
      JJKK=IOFF(MAX0(JOR,KOR))+MIN0(JOR,KOR)
      JJLL=IOFF(MAX0(JOR,LOR))+MIN0(JOR,LOR)
      VAL2=VALU+VALU
      DO 520 ITYP=1,NTYPES
        D(ITYP,IIJJ,ISKIP)=D(ITYP,IIJJ,ISKIP)+DA(KKLL,ITYP)*VAL2
        D(ITYP,KKLL,ISKIP)=D(ITYP,KKLL,ISKIP)+DA(IIJJ,ITYP)*VAL2
        D(ITYP,IIKK,ISKIP)=D(ITYP,IIKK,ISKIP)+DB(JJLL,ITYP)*VALU
        D(ITYP,JJLL,ISKIP)=D(ITYP,JJLL,ISKIP)+DB(IIKK,ITYP)*VALU
        D(ITYP,IILL,ISKIP)=D(ITYP,IILL,ISKIP)+DB(JJKK,ITYP)*VALU
        D(ITYP,JJKK,ISKIP)=D(ITYP,JJKK,ISKIP)+DB(IILL,ITYP)*VALU
  520 CONTINUE
C
  700 CONTINUE
      GO TO 1000
C
C:::::::::::::::::::::::::::
C:::TWO-CONFIGURATION SCF:::
C:::::::::::::::::::::::::::
   80 CONTINUE
C:::::::::::::::::::::::::::::
C:::MULTI-CONFIGURATION SCF:::
C:::::::::::::::::::::::::::::
   90 CONTINUE
C
 1000 CONTINUE
C
      RETURN
      END
      PROGRAM DER3RD
C**********************************************************************
C   THIRD DERIVATIVE PROGRAM PART 1 : "DER3RD"                        *
C**********************************************************************
C                                                                     *
C   THIS IS THE DRIVER FOR A THRID DERIVATIVE INTEGRAL PROGRAM THAT   *
C   USES NO SYMMETRY                                                  *
C                                                                     *
C**********************************************************************
C
C**********************************************************************
C*   NOTICE OF PROGRAM MODIFICATION                                   *
C**********************************************************************
C*  BY:  RICHARD REMINGTON                         search:  c7-14-88  *
C*  DATE:  July  14,   1988                                           *
C*  REASON: Decrease Core to Run in 7Mb on 9370   and add 2 continues *
C*          at Subroutine Nucatt 305 and Subroutine Rcalcu 205 in     *
C*          order to maintain F77 standard code.                      *
C**********************************************************************
c*                                                                    *
c*  Modified to write out ITAP11 properly (BFY -  16 November 1987)   *
c*  Look for 'bfy' to find the changes.                               *
C*                                                                    *
C*  LAST UPDATED  ON :   JANUARY  23, 1987 BY YUKIO YAMAGUCHI         *
c*                                                                    *
C*  LAST UPDATED  ON :   DECEMBER 02, 1985 BY YUKIO YAMAGUCHI         *
C*                                                                    *
C*  LAST MODIFIED ON :   JANUARY  02, 1985 BY JFG                     *
C*                                                                    *
C**********************************************************************
      IMPLICIT INTEGER (B-Z)
      IMPLICIT REAL*8 (A)
c7-14-88  DIMENSION AI(1200000),IA(1),I30(200)
      DIMENSION AI(600000),IA(1),I30(200)
      REAL*8 X,Y,Z,CHG,EX,EY,EZ,BET,TOL
      CHARACTER*8 SCFTYP,CITYP,DERTYP
      COMMON/CALIF/LPARA(1024),APARA(1024)
      COMMON/CALQN/ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET
      COMMON/COORD/X(50),Y(50),Z(50),CHG(50)
      COMMON/EXYZS/EX(686),EY(686),EZ(686)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/IADRS/IPASS(35)
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR3/TSHELL,TPRIM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/IPAR5/IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL
      COMMON/IPAR6/IMTOT
      COMMON/KEEPS/IDRVT,IDRVF
      COMMON/MFSEC/MASTER,NSECT
      COMMON/MINFO/ALP(10,10),BET(10,10)
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/TAPES/ITAP30,ITAP38,ITAP42,ITAP45,ITAP46
      COMMON/TOLER/TOL(10)
      COMMON/WORKS/JTAPE1,JTAPE2
      EQUIVALENCE (AI,IA)
    1 FORMAT(/,2X,' HERMITE-GAUSSIAN TYPE ORBITAL INTEGRAL PROGRAM',/)
    2 FORMAT(3(A8,2X))
    3 FORMAT(/,3X,3(A8,2X)/)
    4 FORMAT(5I5)
  106 FORMAT(/,2X,' ONE ELECTRON SIZE =',I10)
  107 FORMAT(/,2X,' CALLING READIN')
  108 FORMAT(/,2X,' AMOUNT OF CORE NEEDS TO BE INCREASED TO AT LEAST '
     *        ,I10)
  110 FORMAT(/,2X,' WE HAVE TO PLAY AROUND WITH THE SIZES OF ARRAYS '/
     *,        2X,' RDENOM =',I10,' RDIV =',I10)
  111 FORMAT(/,2X,' TWO ELECTRON SIZE =',I10,5X,' IUNIT =',I10)
  112 FORMAT(/,2X,' AMOUNT OF CORE NEEDS TO BE INCREASED TO',I10,' STOP!
     1!!'/)
  115 FORMAT(/,2X,' CALLING RDVEC')
  116 FORMAT(/,2X,' CALLING INT1')
  117 FORMAT(/,2X,' CALLING INT2')
  120 FORMAT(/,2X,' CALLING NUCLEAR REPULSION DERIVATIVES')
  125 FORMAT(/,2X,' SPACE USED BEFORE STORING DERIVATIVES =',I10,/
     *,        2X,' SPACE LEFT =',I10)
  126 FORMAT(/,2X,' MISSING TYPE OF CALCULATION !'/)
  127 FORMAT(/,2X,' MISSING THE DER3RD STATEMENT !'/)
  128 FORMAT(/,3X,60('*')
     *,/,2X,' **THE 38 FILE NEEDS TO BE',I9,' RECORDS (1K BYTES EACH)**'
     *,/,3X,60('*')/)
  129 FORMAT(/,2X,' CALLING BRIDGE')
C
      call drum
      CALL TSTART(6)
      CALL INITMF(1)
C
C::::::::::::::::::::::::::::::::::
C:::DEFINE MAXCOR AND TOLERANCES:::
C::::::::::::::::::::::::::::::::::
C
C   MAXCOR : MAXIMUM CORE MEMORY ALLOWED
C   TOL(1) : BASIS SET CUTOFF
C   TOL(2) : KAB CUTOFF
C   TOL(3) : ONE ELECTRON CUTOFF
C   TOL(4) : TWO ELECTRON CUTOFF
c7-14-88  MAXCOR=1200000
      MAXCOR= 600000
      TOL(1)=1.0D-10
      TOL(2)=2.30258D+00*DBLE(20)
      TOL(3)=1.0D-10
      TOL(4)=1.0D-10
      TOL(5)=1.0D-10
      TOL(6)=1.0D-10
      TOL(7)=1.0D-10
      TOL(8)=1.0D-10
      TOL(9)=1.0D-10
      TOL(10)=1.0D-10
C
C   DEFINE TAPE NUMBERS
      INPUT=5
      IOUT=6
      IDBG=3
      ITERM=4
      ITAP11=11
      ITAP30=30
      ITAP38=38
      ITAP42=42
      ITAP45=45
      ITAP46=46
      JTAPE1=91
      JTAP99=99
C
C===============================
C===READ IN THE INPUT OPTIONS===
C===============================
C
      CALL LOCATE(INPUT,'# DER3RD #',IERR)
      IF(IERR .EQ. 1) THEN
        WRITE(IOUT,127)
        CALL mabort
      END IF
C
      WRITE(IOUT,1)
      READ(INPUT,2) SCFTYP,CITYP,DERTYP
      WRITE(IOUT,3) SCFTYP,CITYP,DERTYP
      WRITE(ITERM,3) SCFTYP,CITYP,DERTYP
C
      ISTYPE=0
      IF(SCFTYP.EQ.'CLSCF   ') ISTYPE=1
      IF(SCFTYP.EQ.'HSOP    ') ISTYPE=2
      IF(SCFTYP.EQ.'OPSNG   ') ISTYPE=2
      IF(SCFTYP.EQ.'GRSCF   ') ISTYPE=2
      IF(SCFTYP.EQ.'TCSCF   ') ISTYPE=3
      IF(SCFTYP.EQ.'MCSCF   ') ISTYPE=4
      ICTYPE=0
      IF(CITYP.EQ.'SCF      ') ICTYPE=1
      IF(CITYP.EQ.'CI       ') ICTYPE=2
      IF(CITYP.EQ.'MCSCF    ') ICTYPE=3
      NDERIV=0
      IF(DERTYP.EQ.'FIRST   ') NDERIV=1
      IF(DERTYP.EQ.'SECOND  ') NDERIV=2
      IF(DERTYP.EQ.'THIRD   ') NDERIV=3
      IF(DERTYP.EQ.'FOURTH  ') NDERIV=4
      IF(NDERIV .EQ. 0) THEN
        WRITE(IOUT,126)
        CALL mabort
      END IF
      IF(NDERIV .GE. 4) THEN
        WRITE(IOUT,126)
        CALL mabort
      END IF
C
C   IDRVT IS AN OPTION TO STORE DERIVATIVE TWO ELECTRON INTEGRALS
C            ON TAPE38
C   IDRVT = 1 : KEEP ONLY THE 2E- FIRST DERIVATIVES
C   IDRVT = 2 : KEEP THE 2E- FIRST AND SECOND DERIVATIVES
C   IDRVT = 3 : KEEP THE 2E- FIRST, SECOND, AND THIRD DERIVATIVES
C
C   IDRVF IS AN OPTION TO CALCULATE DERIVATIVE FOCK MATRICES
C   IDRVF = 1 : KEEP ONLY FIRST DERIVATIVE FOCK'S
C   IDRVF = 2 : KEEP FIRST AND SECOND DERIVATIVE FOCK'S
C   IDRVF = 3 : KEEP FIRST, SECOND, AND THIRD DERIVATIVE FOCK'S
      READ(INPUT,4) IPRNT,IDRVT,IDRVF
      IF(IDRVT.EQ.0) IDRVT=1
      IF(IDRVF.EQ.0) IDRVF=2
      IF(IDRVT.GE.4) THEN
        WRITE(IOUT,126)
        CALL mabort
      END IF
      IF(IDRVF.GE.4) THEN
        WRITE(IOUT,126)
        CALL mabort
      END IF
C
      ITWO=0
      ITHREE=0
      IF(IDRVT.EQ.2) ITWO=1
      IF(IDRVT.EQ.3) THEN
        ITWO=1
        ITHREE=1
      END IF
C
C   SET UP THE IOFF ARRARY
C
      IOFF(1)=0
      DO 100 I=1,255
        IOFF(I+1)=IOFF(I) + I
  100 CONTINUE
C
C   READ IN SOME INFORMATION FROM TAPE30
C
      CALL RFILE(ITAP30)
      CALL WREADW(ITAP30,I30,200,101,JUNK)
      IEND=I30(1)
      MPOINT=I30(2)
      MCONST=I30(3)
      MCALCS=I30(4)
      NCALCS=I30(5)
      NBFSO=I30(18)
      NS=I30(19)
      NBFAO=I30(22)
      TSHELL=I30(27)
      TPRIM=I30(32)
      NSYM=I30(41)
      IOPEN=I30(43)
      NBASIS=NBFSO
C
      NTYPES=LPARA(18)
C
C:::::::::::::::::::::::::::::::::::
C:::READ IN BASIS SET INFORMATION:::
C:::::::::::::::::::::::::::::::::::
C
      NMEM=1
      LMNP1=NMEM + TSHELL
      NCON=LMNP1 + TSHELL
      NF=NCON + TSHELL
      NSHELL=NF + NS
      NFIRST=NSHELL + NS*TSHELL
      KST=NFIRST + NS*TSHELL
      INTSV=KST + NS*NS*NS
      ISTOP=INTSV +500*4
C
      ZET=(ISTOP + 1)/2 + 1
      ETA=ZET + TSHELL*TPRIM
      RSTOP=ETA + TSHELL*TPRIM
C
      CALL IZERO(IA(1),ISTOP)
      CALL ZERO(AI(ZET),RSTOP-ZET)
      WRITE(IDBG,107)
      WRITE(ITERM,107)
      CALL RDBAS(IA(NMEM),IA(LMNP1),IA(NCON),IA(NF),IA(NSHELL)
     *,          IA(NFIRST),AI(ZET),AI(ETA)
     *,          MPOINT,MCONST,NCALCS)
      CALL RFILE(JTAP99)
      CALL RCLOSE(JTAP99,3)
C
C:::::::::::::::::::::::::::::::::::::::::::::::::
C:::CALCULATE THE NUCLEAR REPULSION DERIVATIVES:::
C:::::::::::::::::::::::::::::::::::::::::::::::::
C
      CALL RFILE(JTAPE1)
C
      REP1=ETA + TSHELL*TPRIM
      REP2=REP1 + N3N
      REP3=REP2 + I2N3N
      RSTOP=REP3 + I3N3N
      CALL ZERO(AI(REP1),RSTOP-REP1)
      WRITE(IDBG,120)
      WRITE(ITERM,120)
      CALL REPUL(IA(KST),AI(REP1),AI(REP2),AI(REP3))
      CALL RFILE(JTAP99)
      CALL RCLOSE(JTAP99,3)
C
C:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
C:::READS VECTOR FROM THE MASTER TAPE AND FORM DENSITY MATRICES:::
C:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
C
      DENA=ETA + TSHELL*TPRIM
      DENB=DENA + NUMIJ*NTYPES
      DENC=DENB + NUMIJ*NTYPES
      DEN1T=DENC + NUMIJ*NTYPES
      OCC=DEN1T + NUMIJ
      EIG=OCC + NBFSO
      ESO=EIG + NBFSO
      RSTOP=ESO + NBFSO*NBFSO
      CALL ZERO(AI(DENA),RSTOP-DENA)
      WRITE(IDBG,115)
      WRITE(ITERM,115)
      CALL RDVECS(AI(DENA),AI(DENB),AI(DENC),AI(DEN1T),AI(OCC),AI(EIG)
     *,           AI(ESO),NBFSO)
      CALL RFILE(JTAP99)
      CALL RCLOSE(JTAP99,3)
C
C   SIZES OF THE G ARRAYS   I2LAR (2 E-) AND LARGL (1E-)
C
      IANG=LARGL
      IANGSQ=IANG*IANG
      IANG4 =IANGSQ*IANGSQ
      I2LARL=(LARGL*4-4)/2 + 1  + NDERIV
      I4LARL=LARGL*4 - 3  + NDERIV
      LARGL2=LARGL*2-1 + NDERIV
      LARGL=(LARGL*2-2)/2+1 + NDERIV
C
C::::::::::::::::::::::::::::::::::::::::::::
C:::CALCULATE THE ONE ELECTRON DERIVATIVES:::
C::::::::::::::::::::::::::::::::::::::::::::
C
      IJORB=EIG + EIG +1
      ISTOP=IJORB + IMEM2
      RSTART=(ISTOP + 1)/2 + 1
      EONE1=RSTART
      EONE2=EONE1 + N3N
      EONE3=EONE2 + I2N3N
      GT=EONE3 + I3N3N
      GU=GT + LARGL*NS*LARGL2
      GV=GU + LARGL*NS*LARGL2
      SX=GV + LARGL*NS*LARGL2
      SY=SX + IANGSQ
      SZ=SY + IANGSQ
      TX=SZ + IANGSQ
      TY=TX + IANGSQ
      TZ=TY + IANGSQ
      VX=TZ + IANGSQ
      VY=VX + IANGSQ
      VZ=VY + IANGSQ
      LAG=VZ + IANGSQ
      SXD=LAG + NUMIJ
      SYD=SXD + IANGSQ
      SZD=SYD + IANGSQ
      S1DER=SZD + IANGSQ
      S1LAG=S1DER + NUMIJ*N3N
      TXD=S1LAG + N3N
      TYD=TXD + IANGSQ
      TZD=TYD + IANGSQ
      VXD=TZD + IANGSQ
      VYD=VXD + IANGSQ*2
      VZD=VYD + IANGSQ*2
      V1DER=VZD + IANGSQ*2
      T1DER=V1DER
      STWO=V1DER + N3N*NUMIJ
      S2DER=STWO + IANGSQ*3
      S2LAG=S2DER + NUMIJ*I2N3N
      TTWO=S2LAG + I2N3N
C
      VXTWO=TTWO + IANGSQ*3
      VYTWO=VXTWO + IANGSQ*2
      VZTWO=VYTWO + IANGSQ*2
      V2DER=VZTWO + IANGSQ*2
      T2DER=V2DER
      V1B1K=V2DER + NUMIJ*I2N3N
      FIRB=V1B1K + IANGSQ*3
      FIRK=FIRB + IMEM2*3
      SECMXB=FIRK + IMEM2*3
      SECMXK=SECMXB + IMEM2*6
      MX1B1K=SECMXK + IMEM2*6
      STHRE=MX1B1K + IMEM2*9
      S3LAG=STHRE + IANGSQ*3
      S3DER=S3LAG
      TTHRE=S3LAG + I3N3N
C
      IF(IDRVF.EQ.3) THEN
        S3DER=S3LAG + I3N3N
        TTHRE=S3DER + NUMIJ*I3N3N
      END IF
C
      VXTHRE=TTHRE + IANGSQ*3
      VYTHRE=VXTHRE + IANGSQ*2
      VZTHRE=VYTHRE + IANGSQ*2
      V2B1K=VZTHRE + IANGSQ*2
      V1B2K=V2B1K + IANGSQ*3
      V3DER=V1B2K + IANGSQ*3
      T3DER=V3DER
      THRMXB=V3DER +I3N3N
C
      IF(IDRVF.EQ.3) THEN
         THRMXB=V3DER + NUMIJ*I3N3N
      END IF
C
      THRMXK=THRMXB + IMEM2*10 +100
      MX2B1K=THRMXK + IMEM2*10 +100
      MX1B2K=MX2B1K + IMEM2*18 +100
      R1STOP=MX1B2K + IMEM2*18 +100
      WRITE(IOUT,106) R1STOP
      IF(R1STOP .GT. MAXCOR) THEN
        WRITE(IOUT,108) R1STOP
        STOP
      END IF
      CALL IZERO(IA(IJORB),IMEM2)
      CALL ZERO(AI(EONE1),R1STOP-EONE1)
C
      WRITE(IDBG,116)
      WRITE(ITERM,116)
      CALL INT1(IA(NMEM),IA(LMNP1),IA(NCON),IA(NF),IA(NSHELL)
     1,    IA(NFIRST),IA(KST),IA(IJORB)
     2,    AI(ZET),AI(ETA),AI(DEN1T),AI(EONE1),AI(EONE2),AI(EONE3)
     3,    AI(GT),AI(GU),AI(GV),AI(SX),AI(SY),AI(SZ)
     4,    AI(TX),AI(TY),AI(TZ),AI(VX),AI(VY),AI(VZ),AI(LAG)
     5,    AI(SXD),AI(SYD),AI(SZD),AI(S1DER),AI(S1LAG)
     6,    AI(TXD),AI(TYD),AI(TZD),AI(VXD),AI(VYD),AI(VZD)
     7,    AI(V1DER),AI(T1DER),AI(STWO),AI(S2DER),AI(S2LAG),AI(TTWO)
     8,    AI(VXTWO),AI(VYTWO),AI(VZTWO),AI(V2DER),AI(T2DER)
     9,    AI(V1B1K),AI(FIRB),AI(FIRK),AI(SECMXB),AI(SECMXK),AI(MX1B1K)
     X,    AI(STHRE),AI(S3LAG),AI(S3DER),AI(TTHRE)
     1,    AI(VXTHRE),AI(VYTHRE),AI(VZTHRE)
     2,    AI(V2B1K),AI(V1B2K),AI(V3DER),AI(T3DER)
     3,    AI(THRMXB),AI(THRMXK),AI(MX2B1K),AI(MX1B2K))
      CALL RFILE(JTAP99)
      CALL RCLOSE(JTAP99,3)
C
C::::::::::::::::::::::::::::::::::::::::::::
C:::CALCULATE THE TWO ELECTRON DERIVATIVES:::
C::::::::::::::::::::::::::::::::::::::::::::
C
      ITOTDG=N3N+I2N3N
      IF(IDRVF.EQ.3) THEN
        ITOTDG=N3N+I2N3N+I3N3N
      END IF
C
      ETWO1=RSTART
      ETWO2=ETWO1 + N3N
      ETWO3=ETWO2 + I2N3N
      DAO=ETWO3 + I3N3N
      GT2=DAO + IMEM4
      GU2=GT2 + I2LARL*I4LARL
      GV2=GU2 + I2LARL*I4LARL
      DENT=GV2 + I2LARL*I4LARL
      DNTYP=DENT
      XX0=DNTYP + NUMIJ*ITOTDG*NTYPES
      XY0=XX0 + IANG4
      XZ0=XY0 + IANG4
      XXFIR=XZ0 + IANG4
      XYFIR=XXFIR + IANG4*3
      XZFIR=XYFIR + IANG4*3
      XXSEC=XZFIR + IANG4*3
      XYSEC=XXSEC + IANG4*3
      XZSEC=XYSEC + IANG4*3
      XXMXFF=XZSEC + IANG4*3
      XYMXFF=XXMXFF + IANG4*3
      XZMXFF=XYMXFF + IANG4*3
      GMXFIR=XZMXFF + IANG4*3
      GMXSEC=GMXFIR + IMEM4*3*3
      GMXFF= GMXSEC + IMEM4*6*3
      XXTHR=GMXFF + IMEM4*9*3
      XYTHR=XXTHR + IANG4*3
      XZTHR=XYTHR + IANG4*3
      XXFFF=XZTHR + IANG4*3
      XYFFF=XXFFF + IANG4
      XZFFF=XYFFF + IANG4
      XXFSMX=XZFFF + IANG4
      XYFSMX=XXFSMX + IANG4*6
      XZFSMX=XYFSMX + IANG4*6
      GMXTHR=XZFSMX + IANG4*6
      GMXFFF=GMXTHR + IMEM4*10*3
      GMXFS=GMXFFF + IMEM4*27
      RSTOP=GMXFS + IMEM4*18*6
      LO=RSTOP + RSTOP + 1
      ITYPE=LO + IMEM4*5
      ISTOP=ITYPE + IMEM4
      RLST=(ISTOP+1)/2 +1
C
C
C   FIGURE OUT HOW MUCH OF THE 2 E- DERIVATIVES WE CAN HOLD
C
      RTEST=MAXCOR-RLST
      RDIV=NUMNUM
      WRITE(IOUT,125) RLST,RTEST
      IUNIT1=NUMNUM*N3N + ITWO*NUMNUM*I2N3N+ ITHREE*NUMNUM*I3N3N
      ILAB=(NUMNUM*4+1)/2
      NEED=IUNIT1 + ILAB
      IF(NEED .LE. RTEST) THEN
        IUNIT=NUMNUM
        IUNIT4=NUMNUM*4
      ELSE
        RDENOM=N3N + 2 + ITWO*I2N3N + ITHREE*I3N3N
        RDIV=RTEST/RDENOM
        WRITE(IOUT,110) RDENOM,RDIV
        IUNIT=RDIV
        IUNIT4=IUNIT*4
      END IF
      IF(IUNIT.GT.10000) THEN
        IUNIT=10000
        IUNIT4=IUNIT*4
      END IF
C
      LOUT=ISTOP
      ISTOP=LOUT + IUNIT4
      VALU1=(ISTOP+1)/2 + 1
      VALU2=VALU1 + IUNIT*N3N
      VALU3=VALU2
      R2STOP=VALU2
      IF(IDRVT.EQ.2) THEN
        VALU3=VALU2 + IUNIT*I2N3N
        R2STOP=VALU3
      END IF
      IF(IDRVT.EQ.3) THEN
        VALU3=VALU2 + IUNIT*I2N3N
        R2STOP=VALU3 + IUNIT*I3N3N
      END IF
      WRITE(IOUT,111) R2STOP,IUNIT
      IF(R2STOP .GT. MAXCOR) THEN
        WRITE(IOUT,112) R2STOP
        STOP
      END IF
C
C   FIGURE OUT HOW MUCH SPACE IS NEEDED ON THE TAPE38
C
      ITIME=NUMNUM/RDIV
      IF(ITIME*RDIV .NE. NUMNUM) ITIME=ITIME+1
      I38ADD=ITIME*IUNIT*N3N*2 + ITIME*IUNIT4 + ITIME*IUNIT*ITWO*2*I2N3N
     *      + ITIME*IUNIT*ITHREE*2*I3N3N
      NREC38=NREC(I38ADD)
      WRITE(IOUT,128) NREC38
C
      CALL RFILE(ITAP38)
      CALL ZFILE(ITAP38,NREC38)
      CALL IZERO(IA(LO),IMEM4*5)
      CALL IZERO(IA(ITYPE),IMEM4)
      CALL IZERO(IA(LOUT),IUNIT4)
      CALL ZERO(AI(ETWO1),RSTOP-ETWO1)
      CALL ZERO(AI(VALU1),R2STOP-VALU1)
C
      WRITE(IDBG,117)
      WRITE(ITERM,117)
C     WRITE(6,*) ' NMEM,LMNP1,NCON,NF,NSHELL'
C     WRITE(6,*)   NMEM,LMNP1,NCON,NF,NSHELL
C     WRITE(6,*) ' NFIRST,KST,INTSV,LO,ITYPE,LOUT'
C     WRITE(6,*)   NFIRST,KST,INTSV,LO,ITYPE,LOUT
C     WRITE(6,*) ' ZET,ETA,DENA,DENB,DENC'
C     WRITE(6,*)   ZET,ETA,DENA,DENB,DENC
C     WRITE(6,*) ' ETWO1,ETWO2,ETWO3,DAO,GT2,GU2,GV2'
C     WRITE(6,*)   ETWO1,ETWO2,ETWO3,DAO,GT2,GU2,GV2
C     WRITE(6,*) ' DENT,DNTYP,XX0,XY0,XZ0'
C     WRITE(6,*)   DENT,DNTYP,XX0,XY0,XZ0
C     WRITE(6,*) ' XXFIR,XYFIR,XZFIR,XXSEC,XYSEC,XZSEC'
C     WRITE(6,*)   XXFIR,XYFIR,XZFIR,XXSEC,XYSEC,XZSEC
C     WRITE(6,*) ' XXMXFF,XYMXFF,XZMXFF'
C     WRITE(6,*)   XXMXFF,XYMXFF,XZMXFF
C     WRITE(6,*) ' GMXFIR,GMXSEC,GMXFF'
C     WRITE(6,*)   GMXFIR,GMXSEC,GMXFF
C     WRITE(6,*) ' XXTHR,XYTHR,XZTHR,XXFFF,XYFFF,XZFFF'
C     WRITE(6,*)   XXTHR,XYTHR,XZTHR,XXFFF,XYFFF,XZFFF
C     WRITE(6,*) ' XXFSMX,XYFSMX,XZFSMX'
C     WRITE(6,*)   XXFSMX,XYFSMX,XZFSMX
C     WRITE(6,*) ' GMXTHR,GMXFFF,GMXFS,VALU1,VALU2,VALU3'
C     WRITE(6,*)   GMXTHR,GMXFFF,GMXFS,VALU1,VALU2,VALU3
C     WRITE(6,*) ' ITOTDG,IUNIT,IUNIT4'
C     WRITE(6,*)   ITOTDG,IUNIT,IUNIT4
      CALL INT2(IA(NMEM),IA(LMNP1),IA(NCON),IA(NF),IA(NSHELL)
     1,    IA(NFIRST),IA(KST),IA(INTSV),IA(LO),IA(ITYPE),IA(LOUT)
     2,    AI(ZET),AI(ETA),AI(DENA),AI(DENB),AI(DENC)
     3,    AI(ETWO1),AI(ETWO2),AI(ETWO3),AI(DAO),AI(GT2),AI(GU2),AI(GV2)
     4,    AI(DENT),AI(DNTYP),AI(XX0),AI(XY0),AI(XZ0)
     5,    AI(XXFIR),AI(XYFIR),AI(XZFIR),AI(XXSEC),AI(XYSEC),AI(XZSEC)
     6,    AI(XXMXFF),AI(XYMXFF),AI(XZMXFF)
     7,    AI(GMXFIR),AI(GMXSEC),AI(GMXFF)
     8,    AI(XXTHR),AI(XYTHR),AI(XZTHR),AI(XXFFF),AI(XYFFF),AI(XZFFF)
     9,    AI(XXFSMX),AI(XYFSMX),AI(XZFSMX)
     X,    AI(GMXTHR),AI(GMXFFF),AI(GMXFS),AI(VALU1),AI(VALU2),AI(VALU3)
     1,    ITOTDG,IUNIT,IUNIT4)
      CALL RFILE(JTAP99)
      CALL RCLOSE(JTAP99,3)
C
C:::::::::::::::::::::::::::
C:::MAKE DERIVATIVE FILES:::
C:::::::::::::::::::::::::::
C
 1234 CONTINUE
      WRITE(IDBG,129)
      WRITE(ITERM,129)
      CALL BRIDGE(AI,IA,MAXCOR)
C
      CALL RCLOSE(MASTER,3)
      CALL RCLOSE(ITAP30,3)
      CALL RCLOSE(ITAP38,3)
      CALL RCLOSE(ITAP42,3)
      CALL RCLOSE(ITAP45,3)
      CALL RCLOSE(ITAP46,3)
      CALL RCLOSE(JTAPE1,3)
      CALL TSTOP(6)
      STOP
      END
      SUBROUTINE ENEW
      IMPLICIT REAL*8 (A-H,O-Z)
      LOGICAL EQUAL,SAME
      INTEGER T,T1,TP1
      DIMENSION IJ(28)
      COMMON/EXYZS/EX(686),EY(686),EZ(686)
      COMMON/SIGNS/IOFF(256),IPRNT
      DATA IESZ / 343 /
      DATA IJ / 1,2,6,9,15,23,28,36,46,58,65,75,87,101,117,126,138,
     *152,168,186,206,217,231,247,265,285,307,331/
C
      RETURN
C
      ENTRY ECAL(PAX,PAY,PAZ,PBX,PBY,PBZ,P,DUMMY,IQNMX,IOPT)
C
C NOTE:  THE EX ARRAY HAS THE 6 DIFFERENT FACTORS
C               1) KAB    THE EXP(AVG GAUSSIAN)
C        2) AND 3) THE CONTRACTION COEFFS * NORMALIZATION CONSTANTS
C               4) FACTOR   FACTOR=1 IF SAME FUNCS ON SAME CENTER
C                                    AND SAME MEMBERS OF THE CONTRACTION
C                                    SET
C                           FACTOR=2 IF SAME FUNCS AND CENTERS WITH
C                                    DIFFERENT MEMBERS OF THE CONTR SET
C               5) DIVIDED BY THE AVERAGE EXPONENT
C   AND ONLY FOR THE TWO ELECTRON INTS   6) SQRT(2*(PI)**-.5)
C
C
C  IOPT= 0   .........  ONE ELECTRON E ARRAYS
C      = 1   .........  TWO ELECTRON E ARRAYS
C
      PFACT=1.0D0/(2.0D0*P)
      IADD=0
      IF(IOPT .EQ. 1) IADD=IESZ
C
      I1=IADD+1
      EX(I1)=DUMMY
      EY(I1)=1.0D0
      EZ(I1)=1.0D0
C
C   MAX ORBITAL IS ONE WITH PRINCIPLE QUANTUM NO. 5
C   ONLY CALCULATE E COEFF.S AS LARGE AS IQNMX
C
      DO 700 III=2,IQNMX
C
        INEW=III-1
        DO 600 JJJ=1,III
C
          IPOSN=IOFF(III) + JJJ
          IPOS1=IOFF(MAX0(INEW,JJJ)) + MIN0(INEW,JJJ)
          IPOS2=IJ(IPOS1)
          EQUAL=III.EQ.JJJ
          SAME=INEW.EQ.JJJ
          IJTOT=(III-2) + (JJJ-1)
          MAXT=III+JJJ-1
C
          DO 500 T=1,MAXT
C
            T1=T-1
            R1X1=0.0D0
            R1X2=0.0D0
            R1Y1=0.0D0
            R1Y2=0.0D0
            R1Z1=0.0D0
            R1Z2=0.0D0
            R2X1=0.0D0
            R2X2=0.0D0
            R2Y1=0.0D0
            R2Y2=0.0D0
            R2Z1=0.0D0
            R2Z2=0.0D0
            R3X1=0.0D0
            R3X2=0.0D0
            R3Y1=0.0D0
            R3Y2=0.0D0
            R3Z1=0.0D0
            R3Z2=0.0D0
            IF(T1 .GE. 1) THEN
              ISPOT=IPOS2 + (T1-1)*2
              ISPOT1=ISPOT + 1
              IF(SAME) THEN
                ISPOT=IPOS2 + (T1-1)
                ISPOT1=ISPOT
              END IF
              IF(EQUAL) THEN
                ISPOT1=IPOS2 + T1*2 -1
                GO TO 100
              END IF
              I1=IADD+ISPOT
              R1X1=EX(I1)*PFACT
              R1Y1=EY(I1)*PFACT
              R1Z1=EZ(I1)*PFACT
  100         CONTINUE
              I1=IADD+ISPOT1
              R1X2=EX(I1)*PFACT
              R1Y2=EY(I1)*PFACT
              R1Z2=EZ(I1)*PFACT
            END IF
            ITEST=T-1
            IF(ITEST .LE. IJTOT) THEN
              XDUM=PBX
              YDUM=PBY
              ZDUM=PBZ
              ISPOT=IPOS2 + (T-1)*2
              ISPOT1=ISPOT + 1
              IF(SAME) THEN
                ISPOT=IPOS2 + (T-1)
                ISPOT1=ISPOT
              END IF
              IF(EQUAL) THEN
                ISPOT1=IPOS2 + T*2 -1
                XDUM=PAX
                YDUM=PAY
                ZDUM=PAZ
                GO TO 200
              END IF
              I1=IADD+ISPOT
              R2X1=PAX*EX(I1)
              R2Y1=PAY*EY(I1)
              R2Z1=PAZ*EZ(I1)
  200         CONTINUE
              I1=IADD+ISPOT1
              R2X2=XDUM*EX(I1)
              R2Y2=YDUM*EY(I1)
              R2Z2=ZDUM*EZ(I1)
            END IF
            TP1=T + 1
            ITEST=TP1 - 1
            IF(ITEST .LE. IJTOT) THEN
              ISPOT=IPOS2 + (TP1-1)*2
              ISPOT1=ISPOT + 1
              IF(SAME) THEN
                ISPOT=IPOS2 + (TP1-1)
                ISPOT1=ISPOT
              END IF
              IF(EQUAL) THEN
                ISPOT1=IPOS2 + TP1*2 -1
                GO TO 300
              END IF
              I1=IADD+ISPOT
              R3X1=T*EX(I1)
              R3Y1=T*EY(I1)
              R3Z1=T*EZ(I1)
  300         CONTINUE
              I1=IADD+ISPOT1
              R3X2=T*EX(I1)
              R3Y2=T*EY(I1)
              R3Z2=T*EZ(I1)
            END IF
            ISPOT=IJ(IPOSN) + (T-1)*2
            ISPOT1=ISPOT + 1
            IF(EQUAL) THEN
              ISPOT1=IJ(IPOSN) + (T-1)
              GO TO 400
            END IF
            I1=IADD+ISPOT
            EX(I1)=R1X1 + R2X1 + R3X1
            EY(I1)=R1Y1 + R2Y1 + R3Y1
            EZ(I1)=R1Z1 + R2Z1 + R3Z1
  400       CONTINUE
            I1=IADD+ISPOT1
            EX(I1)=R1X2 + R2X2 + R3X2
            EY(I1)=R1Y2 + R2Y2 + R3Y2
            EZ(I1)=R1Z2 + R2Z2 + R3Z2
  500     CONTINUE
  600   CONTINUE
  700 CONTINUE
C
      RETURN
      END
      SUBROUTINE FIVE(SECDER,LABOUT,IUNIT,IUNIT4,INTSV,ETWO1,
     *ETWO2,FIRDER,GMXFIR,GMXSEC,GMXFF,LO,DAO,THRDER,GMXTHR,GMXFFF,
     *GMXFS,ETWO3)
      IMPLICIT REAL*8 (A-H,O-Z)
      LOGICAL EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      DIMENSION SECDER(I2N3N,IUNIT),LABOUT(IUNIT4)
      DIMENSION INTSV(500,4),ETWO1(N3N),ETWO2(I2N3N),FIRDER(N3N,IUNIT)
      DIMENSION GMXFIR(IMEM4,3,3),GMXSEC(IMEM4,6,3),GMXFF(IMEM4,9,3)
      DIMENSION LO(IMEM4*5),DAO(IMEM4)
      DIMENSION THRDER(I3N3N,IUNIT),GMXTHR(IMEM4,10,3),GMXFFF(IMEM4,27),
     *          GMXFS(IMEM4,18,6),ETWO3(I3N3N)
      COMMON/CENTS/IDER(3),JDER(3),KDER(3),LDER(3),IIDER(6)
     *,            JJDER(6),KKDER(6),LLDER(6),IJDER(9),IKDER(9)
     *,            ILDER(9),JKDER(9),JLDER(9),KLDER(9)
      COMMON/CENT3/IIIDER(10),JJJDER(10),KKKDER(10),LLLDER(10)
     *,            IIJDER(18),IJJDER(18),IIKDER(18),IKKDER(18)
     *,            IILDER(18),ILLDER(18),JJKDER(18),JKKDER(18)
     *,            JJLDER(18),JLLDER(18),KKLDER(18),KLLDER(18)
     *,            IJKDER(27),IJLDER(27),JKLDER(27),IKLDER(27)
      COMMON/KEEPS/IDRVT,IDRVF
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/LOGIC/EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      COMMON/NARRY/N2II(6,2),N2IK(9),N2KI(9),N2IK2(9,3),N3III(10,3)
      COMMON/NARR2/N3IIK(18,4),N3IKK(18,3),N3IJK(27,6),N3JKK(18,2)
      COMMON/NINFO/INTOT,ISPOT,IFSEC,ISSEC,ITSEC,ILSEC
      COMMON/PASS /II,JJ,KK,LL
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/TAPES/ITAP30,ITAP38,ITAP42,ITAP45,ITAP46
      COMMON/TOLER/TOL(10)
C
      CUTOFF=TOL(5)
C
      RETURN
C
      ENTRY FIVEQU(ISTOP)
C
      DO 1000 ICNT=1,ISTOP
C
        ISPOT=ISPOT + 1
        IF(ISPOT .GT. IUNIT) THEN
          INTOT=INTOT + 1
        IF(INTOT.GT.498) THEN
          WRITE(6,*) ' INTOT EXCEEDS 498 IN FIVE',INTOT
          WRITE(6,*) ' MAXIMUM INTOT = 498 + 2'
          STOP
        END IF
          IF(INTOT .GT. 2) THEN
            INTSV(INTOT,1)=INTSV(INTOT-1,4) + ILSEC
          ELSE
            INTSV(INTOT,1)=3
          END IF
          IF(IDRVT .EQ. 1) THEN
            INTSV(INTOT,4)=INTSV(INTOT,1) + IFSEC
          END IF
          IF(IDRVT .EQ. 2) THEN
            INTSV(INTOT,2)=INTSV(INTOT,1) + IFSEC
            INTSV(INTOT,4)=INTSV(INTOT,2) + ISSEC
          END IF
          IF(IDRVT .EQ. 3) THEN
            INTSV(INTOT,2)=INTSV(INTOT,1) + IFSEC
            INTSV(INTOT,3)=INTSV(INTOT,2) + ISSEC
            INTSV(INTOT,4)=INTSV(INTOT,3) + ITSEC
          END IF
C
          ISIZE1=INTOWP(IUNIT*N3N)
          ISIZE2=INTOWP(IUNIT*I2N3N)
          ISIZE3=INTOWP(IUNIT*I3N3N)
          ISIZEL=IUNIT*4
          ISEC1=INTSV(INTOT,1)
          ISEC2=INTSV(INTOT,2)
          ISEC3=INTSV(INTOT,3)
          ISECL=INTSV(INTOT,4)
          INTSV(499,1)=ISIZE1
          INTSV(499,2)=ISIZE2
          INTSV(499,3)=ISIZE3
          INTSV(499,4)=ISIZEL
C
C:::::::::::::::::
C:::FORM TAPE38:::
C:::::::::::::::::
C
          CALL SREW(ITAP38)
          IF(IDRVT .EQ. 1) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
          END IF
          IF(IDRVT .EQ. 2) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
            CALL RWRIT(ITAP38,SECDER,ISIZE2,ISEC2)
          END IF
          IF(IDRVT .EQ. 3) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
            CALL RWRIT(ITAP38,SECDER,ISIZE2,ISEC2)
            CALL RWRIT(ITAP38,THRDER,ISIZE3,ISEC3)
          END IF
C
          CALL RWRIT(ITAP38,LABOUT,ISIZEL,ISECL)
          ISZ=IUNIT*N3N
          CALL ZERO(FIRDER,ISZ)
          IF(IDRVT .EQ. 2) THEN
            ISZ=IUNIT*I2N3N
            CALL ZERO(SECDER,ISZ)
          END IF
          IF(IDRVT .EQ. 3) THEN
            ISZ=IUNIT*I3N3N
            CALL ZERO(THRDER,ISZ)
          END IF
          ISPOT=1
        END IF
C
        ICNT1=(ICNT-1)*5 + 1
        ITYPE=LO(ICNT1)
        I=LO(ICNT1+1)
        J=LO(ICNT1+2)
        K=LO(ICNT1+3)
        L=LO(ICNT1+4)
        IJKL=(ISPOT-1)*4 + 1
        LABOUT(IJKL)=I
        LABOUT(IJKL+1)=J
        LABOUT(IJKL+2)=K
        LABOUT(IJKL+3)=L
        DD=DAO(ICNT)
C
C   FIRST DERIVATIVE
C
C   II.EQ.KK .NE. JJ .NE. LL     3 CENTER INTEGRAL
C
        DO 100 ICRD=1,3
          FIR1=GMXFIR(ICNT,ICRD,1)
          FIR2=GMXFIR(ICNT,ICRD,2)
          FIR12= -FIR1 - FIR2
          FIRDER(JDER(ICRD),ISPOT)= FIR1
          FIRDER(LDER(ICRD),ISPOT)= FIR2
          FIRDER(IDER(ICRD),ISPOT)= FIR12
          GMXFIR(ICNT,ICRD,1)= 0.0D0
          GMXFIR(ICNT,ICRD,2)= 0.0D0
          IF(ABS(FIR1) .GT. CUTOFF) THEN
            CALL DAMULT(FIR1,I,J,K,L,ITYPE,JDER(ICRD),1)
            ETWO1(JDER(ICRD))=ETWO1(JDER(ICRD)) + FIR1*DD
          END IF
          IF(ABS(FIR2) .GT. CUTOFF) THEN
            CALL DAMULT(FIR2,I,J,K,L,ITYPE,LDER(ICRD),1)
            ETWO1(LDER(ICRD))=ETWO1(LDER(ICRD)) + FIR2*DD
          END IF
          IF(ABS(FIR12) .GT. CUTOFF) THEN
            CALL DAMULT(FIR12,I,J,K,L,ITYPE,IDER(ICRD),1)
            ETWO1(IDER(ICRD))=ETWO1(IDER(ICRD)) + FIR12*DD
          END IF
  100   CONTINUE
C
C   SECOND DERIVATIVES
C
C   II.EQ.KK .NE. JJ .NE. LL     3 CENTER INTEGRAL
C
        DO 200 ICRD=1,9
          IF(ICRD .LE. 6) THEN
            SEC1=GMXSEC(ICNT,ICRD,1)
            SEC2=GMXSEC(ICNT,ICRD,2)
            SEC3=GMXFF(ICNT,N2II(ICRD,1),1)
            SEC4=GMXFF(ICNT,N2II(ICRD,2),1)
C           SECDER(JJDER(ICRD),ISPOT)= SEC1
C           SECDER(LLDER(ICRD),ISPOT)= SEC2
            SECOND=SEC1 + SEC2 + SEC3 + SEC4
C           SECDER(IIDER(ICRD),ISPOT)= SECOND
            IF(ABS(SEC1) .GT. CUTOFF) THEN
              CALL DAMULT(SEC1,I,J,K,L,ITYPE,JJDER(ICRD),2)
              ETWO2(JJDER(ICRD))=ETWO2(JJDER(ICRD)) + SEC1*DD
            END IF
            IF(ABS(SEC2) .GT. CUTOFF) THEN
              CALL DAMULT(SEC2,I,J,K,L,ITYPE,LLDER(ICRD),2)
              ETWO2(LLDER(ICRD))=ETWO2(LLDER(ICRD)) + SEC2*DD
            END IF
            IF(ABS(SECOND) .GT. CUTOFF) THEN
              CALL DAMULT(SECOND,I,J,K,L,ITYPE,IIDER(ICRD),2)
              ETWO2(IIDER(ICRD))=ETWO2(IIDER(ICRD)) + SECOND*DD
            END IF
          END IF
          SEC1=GMXSEC(ICNT,N2IK(ICRD),1)
          SEC2=GMXSEC(ICNT,N2IK(ICRD),2)
          SEC3=GMXFF(ICNT,N2KI(ICRD),1)
          SEC4=GMXFF(ICNT,ICRD,1)
          SEC13= - SEC1 - SEC3
          SEC24= - SEC2 - SEC4
          IF(LL .GT. JJ) SEC4=GMXFF(ICNT,N2KI(ICRD),1)
C         SECDER(IJDER(ICRD),ISPOT)= SEC13
C         SECDER(ILDER(ICRD),ISPOT)= SEC24
C         SECDER(JLDER(ICRD),ISPOT)= SEC4
          IF(ABS(SEC13) .GT. CUTOFF) THEN
            CALL DAMULT(SEC13,I,J,K,L,ITYPE,IJDER(ICRD),2)
            ETWO2(IJDER(ICRD))=ETWO2(IJDER(ICRD)) + SEC13*DD
          END IF
          IF(ABS(SEC24) .GT. CUTOFF) THEN
            CALL DAMULT(SEC24,I,J,K,L,ITYPE,ILDER(ICRD),2)
            ETWO2(ILDER(ICRD))=ETWO2(ILDER(ICRD)) + SEC24*DD
          END IF
          IF(ABS(SEC4) .GT. CUTOFF) THEN
            CALL DAMULT(SEC4,I,J,K,L,ITYPE,JLDER(ICRD),2)
            ETWO2(JLDER(ICRD))=ETWO2(JLDER(ICRD)) + SEC4*DD
          END IF
  200   CONTINUE
        DO 210 ICRD=1,9
          GMXFF(ICNT,ICRD,1)= 0.0D0
          IF(ICRD .LE. 6) THEN
            GMXSEC(ICNT,ICRD,1)= 0.0D0
            GMXSEC(ICNT,ICRD,2)= 0.0D0
          END IF
  210   CONTINUE
C
C   THIRD DERIVATIVE
C
C   II.EQ.KK .NE. JJ .NE. LL     3 CENTER INTEGRAL
C
C
        DO 300 ICRD=1,27
          IF(ICRD .LE. 10) THEN
            THR1=GMXTHR(ICNT,ICRD,1)
            THR2=GMXTHR(ICNT,ICRD,2)
            N1POS=N3III(ICRD,1)
            N2POS=N3III(ICRD,2)
            N3POS=N3III(ICRD,3)
            THR3=GMXFS(ICNT,N1POS,1)
            THR4=GMXFS(ICNT,N2POS,1)
            THR5=GMXFS(ICNT,N3POS,1)
            THR6=GMXFS(ICNT,N1POS,2)
            THR7=GMXFS(ICNT,N2POS,2)
            THR8=GMXFS(ICNT,N3POS,2)
            THIRD=-THR1-THR2-THR3-THR4-THR5-THR6-THR7-THR8
C           THRDER(ISPOT,JJJDER(ICRD))=THR1
C           THRDER(ISPOT,LLLDER(ICRD))=THR2
C           THRDER(ISPOT,IIIDER(ICRD))=THIRD
            IF(ABS(THR1) .GT. CUTOFF) THEN
C             CALL DAMULT(THR1,I,J,K,L,ITYPE,JJJDER(ICRD),3)
              ETWO3(JJJDER(ICRD))=ETWO3(JJJDER(ICRD)) + THR1*DD
            END IF
            IF(ABS(THR2) .GT. CUTOFF) THEN
C             CALL DAMULT(THR2,I,J,K,L,ITYPE,LLLDER(ICRD),3)
              ETWO3(LLLDER(ICRD))=ETWO3(LLLDER(ICRD)) + THR2*DD
            END IF
            IF(ABS(THIRD) .GT. CUTOFF) THEN
C             CALL DAMULT(THIRD,I,J,K,L,ITYPE,IIIDER(ICRD),3)
              ETWO3(IIIDER(ICRD))=ETWO3(IIIDER(ICRD)) + THIRD*DD
            END IF
          END IF
C
          IF(ICRD .LE. 18) THEN
            N1POS=N3IIK(ICRD,1)
            THR1=GMXTHR(ICNT,N1POS,1)
            THR2=GMXTHR(ICNT,N1POS,2)
            THR3=GMXFS(ICNT,ICRD,1)
            THR4=GMXFS(ICNT,ICRD,2)
            THR13=-THR1-THR3
            THR24=-THR2-THR4
C           THRDER(ISPOT,IJJDER(ICRD))=THR13
C           THRDER(ISPOT,ILLDER(ICRD))=THR24
C           THRDER(ISPOT,JJLDER(ICRD))=THR3
C           THRDER(ISPOT,JLLDER(ICRD))=THR4
            IF(ABS(THR13) .GT. CUTOFF) THEN
C             CALL DAMULT(THR13,I,J,K,L,ITYPE,IJJDER(ICRD),3)
              ETWO3(IJJDER(ICRD))=ETWO3(IJJDER(ICRD)) + THR13*DD
            END IF
            IF(ABS(THR24) .GT. CUTOFF) THEN
C             CALL DAMULT(THR24,I,J,K,L,ITYPE,ILLDER(ICRD),3)
              ETWO3(ILLDER(ICRD))=ETWO3(ILLDER(ICRD)) + THR24*DD
            END IF
            IF(ABS(THR3) .GT. CUTOFF) THEN
C             CALL DAMULT(THIRD,I,J,K,L,ITYPE,JJLDER(ICRD),3)
              ETWO3(JJLDER(ICRD))=ETWO3(JJLDER(ICRD)) + THR3*DD
            END IF
            IF(ABS(THR4) .GT. CUTOFF) THEN
C             CALL DAMULT(THIRD,I,J,K,L,ITYPE,JLLDER(ICRD),3)
              ETWO3(JLLDER(ICRD))=ETWO3(JLLDER(ICRD)) + THR4*DD
            END IF
C
            N3POS=N3JKK(ICRD,1)
            N4POS=N3JKK(ICRD,2)
            THR3=GMXFS(ICNT,ICRD,1)
            THR4=GMXFS(ICNT,ICRD,2)
            THR5=GMXFS(ICNT,N3POS,1)
            THR6=GMXFS(ICNT,N3POS,2)
            THR7=GMXFS(ICNT,N4POS,1)
            THR8=GMXFS(ICNT,N4POS,2)
            THRIIJ=THR1 + THR4 + THR5 + THR7
            THRIIL=THR2 + THR3 + THR6 + THR8
C           THRDER(ISPOT,IIJDER(ICRD))=THRIIJ
C           THRDER(ISPOT,IILDER(ICRD))=THRIIL
            IF(ABS(THRIIJ) .GT. CUTOFF) THEN
C             CALL DAMULT(THRIIJ,I,J,K,L,ITYPE,IIJDER(ICRD),3)
              ETWO3(IIJDER(ICRD))=ETWO3(IIJDER(ICRD)) + THRIIJ*DD
            END IF
            IF(ABS(THRIIL) .GT. CUTOFF) THEN
C             CALL DAMULT(THRIIL,I,J,K,L,ITYPE,IILDER(ICRD),3)
              ETWO3(IILDER(ICRD))=ETWO3(IILDER(ICRD)) + THRIIL*DD
            END IF
          END IF
C
          I1=N3IJK(ICRD,5)
          I2=N3IJK(ICRD,6)
          IF(LL .GT. JJ) THEN
            I1=N3IJK(ICRD,6)
            I2=N3IJK(ICRD,5)
          END IF
          THR1=GMXFS(ICNT,I1,1)
          THR2=GMXFS(ICNT,I2,2)
          THR12=-THR1-THR2
C         THRDER(ISPOT,IJLDER(ICRD))=THR12
          IF(ABS(THR12) .GT. CUTOFF) THEN
C           CALL DAMULT(THR12,I,J,K,L,ITYPE,IJLDER(ICRD),3)
            ETWO3(IJLDER(ICRD))=ETWO3(IJLDER(ICRD)) + THR12*DD
          END IF
C
  300   CONTINUE
        DO 310 ICRD=1,18
          IF(ICRD .LE. 10) THEN
            GMXTHR(ICNT,ICRD,1)=0.0D0
            GMXTHR(ICNT,ICRD,2)=0.0D0
          END IF
          GMXFS(ICNT,ICRD,1)=0.0D0
          GMXFS(ICNT,ICRD,2)=0.0D0
  310   CONTINUE
C
C
 1000 CONTINUE
C
      RETURN
      END
      SUBROUTINE FOUR(SECDER,LABOUT,IUNIT,IUNIT4,INTSV,ETWO1,
     *ETWO2,FIRDER,GMXFIR,GMXSEC,GMXFF,LO,DAO,THRDER,GMXTHR,GMXFFF,
     *GMXFS,ETWO3)
      IMPLICIT REAL*8 (A-H,O-Z)
      LOGICAL EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      DIMENSION SECDER(I2N3N,IUNIT),LABOUT(IUNIT4)
      DIMENSION INTSV(500,4),ETWO1(N3N),ETWO2(I2N3N),FIRDER(N3N,IUNIT)
      DIMENSION GMXFIR(IMEM4,3,3),GMXSEC(IMEM4,6,3),GMXFF(IMEM4,9,3)
      DIMENSION LO(IMEM4*5),DAO(IMEM4)
      DIMENSION THRDER(I3N3N,IUNIT),GMXTHR(IMEM4,10,3),GMXFFF(IMEM4,27),
     *          GMXFS(IMEM4,18,6),ETWO3(I3N3N)
      COMMON/CENTS/IDER(3),JDER(3),KDER(3),LDER(3),IIDER(6)
     *,            JJDER(6),KKDER(6),LLDER(6),IJDER(9),IKDER(9)
     *,            ILDER(9),JKDER(9),JLDER(9),KLDER(9)
      COMMON/CENT3/IIIDER(10),JJJDER(10),KKKDER(10),LLLDER(10)
     *,            IIJDER(18),IJJDER(18),IIKDER(18),IKKDER(18)
     *,            IILDER(18),ILLDER(18),JJKDER(18),JKKDER(18)
     *,            JJLDER(18),JLLDER(18),KKLDER(18),KLLDER(18)
     *,            IJKDER(27),IJLDER(27),JKLDER(27),IKLDER(27)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/KEEPS/IDRVT,IDRVF
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/LOGIC/EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      COMMON/NARRY/N2II(6,2),N2IK(9),N2KI(9),N2IK2(9,3),N3III(10,3)
      COMMON/NARR2/N3IIK(18,4),N3IKK(18,3),N3IJK(27,6),N3JKK(18,2)
      COMMON/NINFO/INTOT,ISPOT,IFSEC,ISSEC,ITSEC,ILSEC
      COMMON/PASS /II,JJ,KK,LL
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/TAPES/ITAP30,ITAP38,ITAP42,ITAP45,ITAP46
      COMMON/TOLER/TOL(10)
C
      CUTOFF=TOL(5)
C
      RETURN
C
      ENTRY FOUREQ(ISTOP)
C
      DO 1000 ICNT=1,ISTOP
C
        ISPOT=ISPOT + 1
        IF(ISPOT .GT. IUNIT) THEN
          INTOT=INTOT + 1
        IF(INTOT.GT.498) THEN
          WRITE(6,*) ' INTOT EXCEEDS 498 IN FOUR',INTOT
          WRITE(6,*) ' MAXIMUM INTOT = 498 + 2'
          STOP
        END IF
          IF(INTOT .GT. 2) THEN
            INTSV(INTOT,1)=INTSV(INTOT-1,4) + ILSEC
          ELSE
            INTSV(INTOT,1)=3
          END IF
          IF(IDRVT .EQ. 1) THEN
            INTSV(INTOT,4)=INTSV(INTOT,1) + IFSEC
          END IF
          IF(IDRVT .EQ. 2) THEN
            INTSV(INTOT,2)=INTSV(INTOT,1) + IFSEC
            INTSV(INTOT,4)=INTSV(INTOT,2) + ISSEC
          END IF
          IF(IDRVT .EQ. 3) THEN
            INTSV(INTOT,2)=INTSV(INTOT,1) + IFSEC
            INTSV(INTOT,3)=INTSV(INTOT,2) + ISSEC
            INTSV(INTOT,4)=INTSV(INTOT,3) + ITSEC
          END IF
C
          ISIZE1=INTOWP(IUNIT*N3N)
          ISIZE2=INTOWP(IUNIT*I2N3N)
          ISIZE3=INTOWP(IUNIT*I3N3N)
          ISIZEL=IUNIT*4
          ISEC1=INTSV(INTOT,1)
          ISEC2=INTSV(INTOT,2)
          ISEC3=INTSV(INTOT,3)
          ISECL=INTSV(INTOT,4)
          INTSV(499,1)=ISIZE1
          INTSV(499,2)=ISIZE2
          INTSV(499,3)=ISIZE3
          INTSV(499,4)=ISIZEL
C
C:::::::::::::::::
C:::FORM TAPE38:::
C:::::::::::::::::
C
          CALL SREW(ITAP38)
          IF(IDRVT .EQ. 1) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
          END IF
          IF(IDRVT .EQ. 2) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
            CALL RWRIT(ITAP38,SECDER,ISIZE2,ISEC2)
          END IF
          IF(IDRVT .EQ. 3) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
            CALL RWRIT(ITAP38,SECDER,ISIZE2,ISEC2)
            CALL RWRIT(ITAP38,THRDER,ISIZE3,ISEC3)
          END IF
C
          CALL RWRIT(ITAP38,LABOUT,ISIZEL,ISECL)
          ISZ=IUNIT*N3N
          CALL ZERO(FIRDER,ISZ)
          IF(IDRVT .EQ. 2) THEN
            ISZ=IUNIT*I2N3N
            CALL ZERO(SECDER,ISZ)
          END IF
          IF(IDRVT .EQ. 3) THEN
            ISZ=IUNIT*I3N3N
            CALL ZERO(THRDER,ISZ)
          END IF
          ISPOT=1
        END IF
C
        ICNT1=(ICNT-1)*5 + 1
        ITYPE=LO(ICNT1)
        I=LO(ICNT1+1)
        J=LO(ICNT1+2)
        K=LO(ICNT1+3)
        L=LO(ICNT1+4)
        IJKL=(ISPOT-1)*4 + 1
        LABOUT(IJKL)=I
        LABOUT(IJKL+1)=J
        LABOUT(IJKL+2)=K
        LABOUT(IJKL+3)=L
        DD=DAO(ICNT)
        IF(EQUAL5) GO TO 150
C
C   FIRST DERIVATIVE
C
C   JJ.EQ.LL .NE. II .NE. KK     3 CENTER INTEGRAL
C
        DO 100 ICRD=1,3
          FIR1=GMXFIR(ICNT,ICRD,1)
          FIR2=GMXFIR(ICNT,ICRD,2)
          FIR12= -FIR1 - FIR2
          FIRDER(IDER(ICRD),ISPOT)= FIR1
          FIRDER(KDER(ICRD),ISPOT)= FIR2
          FIRDER(JDER(ICRD),ISPOT)= FIR12
          GMXFIR(ICNT,ICRD,1)= 0.0D0
          GMXFIR(ICNT,ICRD,2)= 0.0D0
          IF(ABS(FIR1) .GT. CUTOFF) THEN
            CALL DAMULT(FIR1,I,J,K,L,ITYPE,IDER(ICRD),1)
            ETWO1(IDER(ICRD))=ETWO1(IDER(ICRD)) + FIR1*DD
          END IF
          IF(ABS(FIR2) .GT. CUTOFF) THEN
            CALL DAMULT(FIR2,I,J,K,L,ITYPE,KDER(ICRD),1)
            ETWO1(KDER(ICRD))=ETWO1(KDER(ICRD)) + FIR2*DD
          END IF
          IF(ABS(FIR12) .GT. CUTOFF) THEN
            CALL DAMULT(FIR12,I,J,K,L,ITYPE,JDER(ICRD),1)
            ETWO1(JDER(ICRD))=ETWO1(JDER(ICRD)) + FIR12*DD
          END IF
  100   CONTINUE
        GO TO 250
  150   CONTINUE
C
C   JJ.EQ.LL .NE. II.EQ.KK               2 CENTER INTEGRAL
C
        DO 200 ICRD=1,3
          FIR1=GMXFIR(ICNT,ICRD,1)
          FIR2=GMXFIR(ICNT,ICRD,2)
          FIR12=FIR1 + FIR2
          FIRDER(IDER(ICRD),ISPOT)= FIR12
          FIRDER(JDER(ICRD),ISPOT)= -FIR12
          GMXFIR(ICNT,ICRD,1)= 0.0D0
          GMXFIR(ICNT,ICRD,2)= 0.0D0
          IF(ABS(FIR12) .GT. CUTOFF) THEN
            CALL DAMULT(FIR12,I,J,K,L,ITYPE,IDER(ICRD),1)
            ETWO1(IDER(ICRD))=ETWO1(KDER(ICRD)) + FIR12*DD
            CALL DAMULT(-FIR12,I,J,K,L,ITYPE,JDER(ICRD),1)
            ETWO1(JDER(ICRD))=ETWO1(JDER(ICRD)) - FIR12*DD
          END IF
  200   CONTINUE
        GO TO 350
C
C   SECOND DERIVATIVES
C
C   JJ.EQ.LL .NE. II .NE. KK     3 CENTER INTEGRAL
C
  250   CONTINUE
        DO 300 ICRD=1,9
          IF(ICRD .LE. 6) THEN
            SEC1=GMXSEC(ICNT,ICRD,1)
            SEC2=GMXSEC(ICNT,ICRD,2)
            SEC3=GMXFF(ICNT,N2II(ICRD,1),1)
            SEC4=GMXFF(ICNT,N2II(ICRD,2),1)
C           SECDER(IIDER(ICRD),ISPOT)= SEC1
C           SECDER(KKDER(ICRD),ISPOT)= SEC2
            SECOND=SEC1 + SEC2 + SEC3 + SEC4
C           SECDER(JJDER(ICRD),ISPOT)= SECOND
            IF(ABS(SEC1) .GT. CUTOFF) THEN
              CALL DAMULT(SEC1,I,J,K,L,ITYPE,IIDER(ICRD),2)
              ETWO2(IIDER(ICRD))=ETWO2(IIDER(ICRD)) + SEC1*DD
            END IF
            IF(ABS(SEC2) .GT. CUTOFF) THEN
              CALL DAMULT(SEC2,I,J,K,L,ITYPE,KKDER(ICRD),2)
              ETWO2(KKDER(ICRD))=ETWO2(KKDER(ICRD)) + SEC2*DD
            END IF
            IF(ABS(SECOND) .GT. CUTOFF) THEN
              CALL DAMULT(SECOND,I,J,K,L,ITYPE,JJDER(ICRD),2)
              ETWO2(JJDER(ICRD))=ETWO2(JJDER(ICRD)) + SECOND*DD
            END IF
          END IF
          SEC1=GMXSEC(ICNT,N2IK(ICRD),1)
          SEC2=GMXSEC(ICNT,N2IK(ICRD),2)
          SEC3=GMXFF(ICNT,ICRD,1)
          SEC4=GMXFF(ICNT,N2KI(ICRD),1)
          SEC13= - SEC1 - SEC3
          SEC24= - SEC2 - SEC4
C         SECDER(IJDER(ICRD),ISPOT)= SEC13
C         SECDER(JKDER(ICRD),ISPOT)= SEC24
C         SECDER(IKDER(ICRD),ISPOT)= SEC3
          IF(ABS(SEC13) .GT. CUTOFF) THEN
            CALL DAMULT(SEC13,I,J,K,L,ITYPE,IJDER(ICRD),2)
            ETWO2(IJDER(ICRD))=ETWO2(IJDER(ICRD)) + SEC13*DD
          END IF
          IF(ABS(SEC24) .GT. CUTOFF) THEN
            CALL DAMULT(SEC24,I,J,K,L,ITYPE,JKDER(ICRD),2)
            ETWO2(JKDER(ICRD))=ETWO2(JKDER(ICRD)) + SEC24*DD
          END IF
          IF(ABS(SEC3) .GT. CUTOFF) THEN
            CALL DAMULT(SEC3,I,J,K,L,ITYPE,IKDER(ICRD),2)
            ETWO2(IKDER(ICRD))=ETWO2(IKDER(ICRD)) + SEC3*DD
          END IF
  300   CONTINUE
        DO 310 ICRD=1,9
          GMXFF(ICNT,ICRD,1)= 0.0D0
          IF(ICRD .LE. 6) THEN
            GMXSEC(ICNT,ICRD,1)= 0.0D0
            GMXSEC(ICNT,ICRD,2)= 0.0D0
          END IF
  310   CONTINUE
        GO TO 450
  350   CONTINUE
C
C   JJ.EQ.LL .NE. II.EQ.KK               2 CENTER INTEGRAL
C
        DO 400 ICRD=1,6
          N1POS=N2II(ICRD,1)
          N2POS=N2II(ICRD,2)
          SEC1=GMXSEC(ICNT,ICRD,1)
          SEC2=GMXSEC(ICNT,ICRD,2)
          SEC3=GMXFF(ICNT,N1POS,1)
          SEC4=GMXFF(ICNT,N2POS,1)
          SECOND=SEC1 + SEC2 + SEC3 + SEC4
C         SECDER(IIDER(ICRD),ISPOT)= SECOND
C         SECDER(JJDER(ICRD),ISPOT)= SECOND
C         SECDER(IJDER(N1POS),ISPOT)= -SECOND
C         IF(N1POS .NE. N2POS) SECDER(IJDER(N2POS),ISPOT)= -SECOND
          IF(ABS(SECOND) .GT. CUTOFF) THEN
            CALL DAMULT(SECOND,I,J,K,L,ITYPE,IIDER(ICRD),2)
            ETWO2(IIDER(ICRD))=ETWO2(IIDER(ICRD)) + SECOND*DD
            CALL DAMULT(SECOND,I,J,K,L,ITYPE,JJDER(ICRD),2)
            ETWO2(JJDER(ICRD))=ETWO2(JJDER(ICRD)) + SECOND*DD
            CALL DAMULT(-SECOND,I,J,K,L,ITYPE,IJDER(N1POS),2)
            ETWO2(IJDER(N1POS))=ETWO2(IJDER(N1POS)) - SECOND*DD
            IF(N1POS .NE. N2POS) THEN
              CALL DAMULT(-SECOND,I,J,K,L,ITYPE,IJDER(N2POS),2)
              ETWO2(IJDER(N2POS))=ETWO2(IJDER(N2POS)) - SECOND*DD
            END IF
          END IF
  400   CONTINUE
        DO 410 ICRD=1,9
          GMXFF(ICNT,ICRD,1)= 0.0D0
          IF(ICRD .LE. 6) THEN
            GMXSEC(ICNT,ICRD,1)= 0.0D0
            GMXSEC(ICNT,ICRD,2)= 0.0D0
          END IF
  410   CONTINUE
        GO TO 550
C
C   THIRD DERIVATIVE
C
C   JJ.EQ.LL .NE. II .NE. KK     3 CENTER INTEGRAL
C
  450   CONTINUE
        DO 500 ICRD=1,27
          IF(ICRD .LE. 10) THEN
            THR1=GMXTHR(ICNT,ICRD,1)
            THR2=GMXTHR(ICNT,ICRD,2)
            N1POS=N3III(ICRD,1)
            N2POS=N3III(ICRD,2)
            N3POS=N3III(ICRD,3)
            THR3=GMXFS(ICNT,N1POS,1)
            THR4=GMXFS(ICNT,N2POS,1)
            THR5=GMXFS(ICNT,N3POS,1)
            THR6=GMXFS(ICNT,N1POS,2)
            THR7=GMXFS(ICNT,N2POS,2)
            THR8=GMXFS(ICNT,N3POS,2)
            THIRD=-THR1-THR2-THR3-THR4-THR5-THR6-THR7-THR8
C           THRDER(ISPOT,IIIDER(ICRD))=THR1
C           THRDER(ISPOT,KKKDER(ICRD))=THR2
C           THRDER(ISPOT,JJJDER(ICRD))=THIRD
            IF(ABS(THR1) .GT. CUTOFF) THEN
C             CALL DAMULT(THR1,I,J,K,L,ITYPE,IIIDER(ICRD),3)
              ETWO3(IIIDER(ICRD))=ETWO3(IIIDER(ICRD)) + THR1*DD
            END IF
            IF(ABS(THR2) .GT. CUTOFF) THEN
C             CALL DAMULT(THR2,I,J,K,L,ITYPE,KKKDER(ICRD),3)
              ETWO3(KKKDER(ICRD))=ETWO3(KKKDER(ICRD)) + THR2*DD
            END IF
            IF(ABS(THIRD) .GT. CUTOFF) THEN
C             CALL DAMULT(THIRD,I,J,K,L,ITYPE,JJJDER(ICRD),3)
              ETWO3(JJJDER(ICRD))=ETWO3(JJJDER(ICRD)) + THIRD*DD
            END IF
          END IF
C
          IF(ICRD .LE. 18) THEN
            N1POS=N3IIK(ICRD,1)
            THR1=GMXTHR(ICNT,N1POS,1)
            THR2=GMXTHR(ICNT,N1POS,2)
            THR3=GMXFS(ICNT,ICRD,1)
            THR4=GMXFS(ICNT,ICRD,2)
            THR13=-THR1-THR3
            THR24=-THR2-THR4
C           THRDER(ISPOT,IIJDER(ICRD))=THR13
C           THRDER(ISPOT,JKKDER(ICRD))=THR24
C           THRDER(ISPOT,IIKDER(ICRD))=THR3
C           THRDER(ISPOT,IKKDER(ICRD))=THR4
            IF(ABS(THR13) .GT. CUTOFF) THEN
C             CALL DAMULT(THR13,I,J,K,L,ITYPE,IIJDER(ICRD),3)
              ETWO3(IIJDER(ICRD))=ETWO3(IIJDER(ICRD)) + THR13*DD
            END IF
            IF(ABS(THR24) .GT. CUTOFF) THEN
C             CALL DAMULT(THR24,I,J,K,L,ITYPE,JKKDER(ICRD),3)
              ETWO3(JKKDER(ICRD))=ETWO3(JKKDER(ICRD)) + THR24*DD
            END IF
            IF(ABS(THR3) .GT. CUTOFF) THEN
C             CALL DAMULT(THIRD,I,J,K,L,ITYPE,IIKDER(ICRD),3)
              ETWO3(IIKDER(ICRD))=ETWO3(IIKDER(ICRD)) + THR3*DD
            END IF
            IF(ABS(THR4) .GT. CUTOFF) THEN
C             CALL DAMULT(THIRD,I,J,K,L,ITYPE,IKKDER(ICRD),3)
              ETWO3(IKKDER(ICRD))=ETWO3(IKKDER(ICRD)) + THR4*DD
            END IF
C
            N3POS=N3JKK(ICRD,1)
            N4POS=N3JKK(ICRD,2)
            THR3=GMXFS(ICNT,ICRD,1)
            THR4=GMXFS(ICNT,ICRD,2)
            THR5=GMXFS(ICNT,N3POS,1)
            THR6=GMXFS(ICNT,N3POS,2)
            THR7=GMXFS(ICNT,N4POS,1)
            THR8=GMXFS(ICNT,N4POS,2)
            THRIJJ=THR1 + THR4 + THR5 + THR7
            THRJJK=THR2 + THR3 + THR6 + THR8
C           THRDER(ISPOT,IJJDER(ICRD))=THRIJJ
C           THRDER(ISPOT,JJKDER(ICRD))=THRJJK
            IF(ABS(THRIJJ) .GT. CUTOFF) THEN
C             CALL DAMULT(THRIJJ,I,J,K,L,ITYPE,IJJDER(ICRD),3)
              ETWO3(IJJDER(ICRD))=ETWO3(IJJDER(ICRD)) + THRIJJ*DD
            END IF
            IF(ABS(THRJJK) .GT. CUTOFF) THEN
C             CALL DAMULT(THRJJK,I,J,K,L,ITYPE,JJKDER(ICRD),3)
              ETWO3(JJKDER(ICRD))=ETWO3(JJKDER(ICRD)) + THRJJK*DD
            END IF
          END IF
C
          I1=3
          I2=4
          IF(KK .GT. JJ) THEN
            I1=1
            I2=2
          END IF
          N1POS=N3IJK(ICRD,I1)
          N2POS=N3IJK(ICRD,I2)
          THR1=GMXFS(ICNT,N1POS,1)
          THR2=GMXFS(ICNT,N2POS,2)
          THR12=-THR1-THR2
C         THRDER(ISPOT,IJKDER(ICRD))=THR12
          IF(ABS(THR12) .GT. CUTOFF) THEN
C           CALL DAMULT(THR12,I,J,K,L,ITYPE,IJKDER(ICRD),3)
            ETWO3(IJKDER(ICRD))=ETWO3(IJKDER(ICRD)) + THR12*DD
          END IF
C
  500   CONTINUE
        DO 510 ICRD=1,18
          IF(ICRD .LE. 10) THEN
            GMXTHR(ICNT,ICRD,1)=0.0D0
            GMXTHR(ICNT,ICRD,2)=0.0D0
          END IF
          GMXFS(ICNT,ICRD,1)=0.0D0
          GMXFS(ICNT,ICRD,2)=0.0D0
  510   CONTINUE
        GO TO 650
C
C   JJ.EQ.LL .NE. II.EQ.KK               2 CENTER INTEGRAL
C
  550   CONTINUE
        DO 600 ICRD=1,10
          N1POS=N3III(ICRD,1)
          N2POS=N3III(ICRD,2)
          N3POS=N3III(ICRD,3)
          THR1=GMXTHR(ICNT,ICRD,1)
          THR2=GMXTHR(ICNT,ICRD,2)
          THR3=GMXFS(ICNT,N1POS,1)
          THR4=GMXFS(ICNT,N2POS,1)
          THR5=GMXFS(ICNT,N3POS,1)
          THR6=GMXFS(ICNT,N1POS,2)
          THR7=GMXFS(ICNT,N2POS,2)
          THR8=GMXFS(ICNT,N3POS,2)
          THIRD=THR1+THR2+THR3+THR4+THR5+THR6+THR7+THR8
C         THRDER(ISPOT,IIIDER(ICRD))= THIRD
C         THRDER(ISPOT,JJJDER(ICRD))=-THIRD
C         THRDER(ISPOT,IIJDER(N1POS))=-THIRD
C         THRDER(ISPOT,IJJDER(N1POS))= THIRD
C         IF(N3POS .NE. N1POS) THEN
C           THRDER(ISPOT,IIJDER(N3POS))=-THIRD
C           THRDER(ISPOT,IJJDER(N3POS))= THIRD
C           IF(N2POS .NE. N1POS) THEN
C             THRDER(ISPOT,IIJDER(N2POS))=-THIRD
C             THRDER(ISPOT,IJJDER(N2POS))= THIRD
C           END IF
C         END IF
          IF(ABS(THIRD) .GT. CUTOFF) THEN
C           CALL DAMULT(THIRD,I,J,K,L,ITYPE,IIIDER(ICRD),3)
            ETWO3(IIIDER(ICRD))=ETWO3(IIIDER(ICRD)) + THIRD*DD
C           CALL DAMULT(-THIRD,I,J,K,L,ITYPE,JJJDER(ICRD),3)
            ETWO3(JJJDER(ICRD))=ETWO3(JJJDER(ICRD)) - THIRD*DD
C           CALL DAMULT(-THIRD,I,J,K,L,ITYPE,IIJDER(N1POS),3)
            ETWO3(IIJDER(N1POS))=ETWO3(IIJDER(N1POS)) - THIRD*DD
C           CALL DAMULT(THIRD,I,J,K,L,ITYPE,IJJDER(N1POS),3)
            ETWO3(IJJDER(N1POS))=ETWO3(IJJDER(N1POS)) + THIRD*DD
            IF(N3POS .NE. N1POS) THEN
C             CALL DAMULT(-THIRD,I,J,K,L,ITYPE,IIJDER(N3POS),3)
              ETWO3(IIJDER(N3POS))=ETWO3(IIJDER(N3POS)) -THIRD*DD
C             CALL DAMULT(THIRD,I,J,K,L,ITYPE,IJJDER(N3POS),3)
              ETWO3(IJJDER(N3POS))=ETWO3(IJJDER(N3POS)) +THIRD*DD
              IF(N2POS .NE. N1POS) THEN
C               CALL DAMULT(-THIRD,I,J,K,L,ITYPE,IIJDER(N2POS),3)
                ETWO3(IIJDER(N2POS))=ETWO3(IIJDER(N2POS)) -THIRD*DD
C               CALL DAMULT(THIRD,I,J,K,L,ITYPE,IJJDER(N2POS),3)
                ETWO3(IJJDER(N2POS))=ETWO3(IJJDER(N2POS)) +THIRD*DD
              END IF
            END IF
          END IF
  600   CONTINUE
C
        DO 610 ICRD=1,18
          GMXFS(ICNT,ICRD,1)=0.0D0
          GMXFS(ICNT,ICRD,2)=0.0D0
          IF(ICRD .LE. 10) THEN
            GMXTHR(ICNT,ICRD,1)=0.0D0
            GMXTHR(ICNT,ICRD,2)=0.0D0
          END IF
  610   CONTINUE
C
  650   CONTINUE
C
 1000 CONTINUE
C
      RETURN
      END
C**********************************************************************
C   THIRD DERIVATIVE PROGRAM PART 2 : "THIRD1"                        *
C**********************************************************************
C
C**********************************************************************
C*   NOTICE OF PROGRAM MODIFICATION                                   *
C**********************************************************************
C*  BY:  RICHARD REMINGTON                         search:  c7-14-88  *
C*  DATE:  July  14,   1988                                           *
C*  REASON: Migration to run in 7Mb on 9370   and add a continue at   *
c*          label 395 to keep code at valid f77 langlvl.              *
C**********************************************************************
C                                                                     *
C   LAST UPDATED  : DECEMBER  02, 1985 BY YUKIO YAMAGUCHI             *
C   LAST MODIFIED : JANUARY   04, 1985 BY JG                          *
C                                                                     *
C**********************************************************************
C                                                                     *
C   ONE ELECTRON THRID DERIVATIVE ROUTINTES                           *
C                                                                     *
C   THIS VERSION HAS THE OPTION OF NOT STORING THE THIRD DERIVATIVE   *
C   INTEGRALS AND INSTEAD MULTIPLYING THEM BY THE APPROPRIATE DENSITY *
C   MATRIX                                                            *
C                                                                     *
C   SUBROUTINE INT1 IS THE DRIVER WITH :  STINT   OVERLAP AND KINETIC *
C                                                 ENERGY INTEGRALS    *
C                                         VINT    NUCLEAR ATTRACTION  *
C                                                 INTEGRALS           *
C                                                                     *
C######################################################################
      SUBROUTINE INT1(NMEM,LMNP1,NCON,NF,NSHELL
     1,               NFIRST,KST,IJORB
     2,               ZET,ETA,DEN1T,EONE1,EONE2,EONE3
     3,               GT,GU,GV,SX,SY,SZ
     4,               TX,TY,TZ,VX,VY,VZ,LAG
     5,               SXD,SYD,SZD,S1DER,S1LAG
     6,               TXD,TYD,TZD,VXD,VYD,VZD
     7,               V1DER,T1DER,STWO,S2DER,S2LAG,TTWO
     8,               VXTWO,VYTWO,VZTWO,V2DER,T2DER
     9,               V1B1K,FIRB,FIRK,SECMXB,SECMXK,MX1B1K
     X,               STHRE,S3LAG,S3DER,TTHRE
     1,               VXTHRE,VYTHRE,VZTHRE
     2,               V2B1K,V1B2K,V3DER,T3DER
     3,               THRMXB,THRMXK,MX2B1K,MX1B2K)
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER TSHELL,TPRIM
      REAL*8 MX1B1K,MX2B1K,MX1B2K,KAB,LAG
      LOGICAL BOTH,EQUAL,FUNS,IABCII,IABCJJ
      DIMENSION NMEM(TSHELL),LMNP1(TSHELL),NCON(TSHELL),NF(NS)
     *,         NSHELL(NS,TSHELL)
      DIMENSION NFIRST(NS,TSHELL),KST(NS,NS,NS),IJORB(IMEM2)
      DIMENSION ZET(TSHELL,TPRIM),ETA(TSHELL,TPRIM),DEN1T(NUMIJ)
     *,         EONE1(N3N),EONE2(I2N3N),EONE3(I3N3N)
      DIMENSION GT(LARGL2,NS,LARGL),GU(LARGL2,NS,LARGL)
     *,         GV(LARGL2,NS,LARGL)
     *,         SX(IANGSQ),SY(IANGSQ),SZ(IANGSQ)
      DIMENSION TX(IANGSQ),TY(IANGSQ),TZ(IANGSQ)
     *,         VX(IANGSQ),VY(IANGSQ),VZ(IANGSQ),LAG(NUMIJ)
      DIMENSION SXD(IANGSQ),SYD(IANGSQ),SZD(IANGSQ)
     *,         S1DER(NUMIJ,N3N),S1LAG(N3N)
      DIMENSION TXD(IANGSQ),TYD(IANGSQ),TZD(IANGSQ)
     *,         VXD(IANGSQ,2),VYD(IANGSQ,2),VZD(IANGSQ,2)
      DIMENSION V1DER(NUMIJ,N3N),T1DER(NUMIJ,N3N),STWO(IANGSQ,3)
     *,         S2DER(NUMIJ,I2N3N),S2LAG(I2N3N),TTWO(IANGSQ,3)
      DIMENSION VXTWO(IANGSQ,2),VYTWO(IANGSQ,2),VZTWO(IANGSQ,2)
     *,         V2DER(NUMIJ,I2N3N),T2DER(NUMIJ,I2N3N)
      DIMENSION V1B1K(IANGSQ,3),FIRB(IMEM2,3),FIRK(IMEM2,3)
     *,         SECMXB(IANGSQ,6),SECMXK(IMEM2,6),MX1B1K(IMEM2,9)
      DIMENSION STHRE(IANGSQ,3),S3LAG(I3N3N),S3DER(NUMIJ,I3N3N)
     *,         TTHRE(IANGSQ,3)
      DIMENSION VXTHRE(IANGSQ,2),VYTHRE(IANGSQ,2),VZTHRE(IANGSQ,2)
      DIMENSION V2B1K(IANGSQ,3),V1B2K(IANGSQ,3),V3DER(NUMIJ,I3N3N)
     *,         T3DER(NUMIJ,I3N3N)
      DIMENSION THRMXB(IMEM2,10),THRMXK(IMEM2,10),MX2B1K(IMEM2,18)
     *,         MX1B2K(IMEM2,18)
      DIMENSION SECBK(6),FIRBK(3),THRBK(10)
      COMMON/COORD/X(50),Y(50),Z(50),CHG(50)
      COMMON/EINFO/IPLACE(49),ISAME(49)
      COMMON/EXYZS/EX(686),EY(686),EZ(686)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/FIRDR/IDER(3),JDER(3),KDER(3)
      COMMON/IADRS/IPASS(35)
      COMMON/INDEX/IX(84),IY(84),IZ(84),JX(84),JY(84),JZ(84)
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR3/TSHELL,TPRIM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/IPAR5/IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL
      COMMON/KEEPS/IDRVT,IDRVF
      COMMON/NARRY/N2II(6,2),N2IK(9),N2KI(9),N2IK2(9,3),N3III(10,3)
      COMMON/NARR2/N3IIK(18,4),N3IKK(18,3),N3IJK(27,6),N3JKK(18,2)
      COMMON/POSNS/IJX(50),IJY(50),IJZ(50),KLX(50),KLY(50),KLZ(50)
      COMMON/SECDR/IKDER(9),IJDER(9),JKDER(9),IIDER(6),JJDER(6)
     *,            KKDER(6)
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/STSTP/NTU(200),NTL(200)
      COMMON/SVIFO/AA,BB,AA2,BB2,PFACT,IORB1,IORBMX,JORB1,JORBMX
     *,            IQN,JQN,II,JJ
      COMMON/THRDR/IIIDER(10),JJJDER(10),KKKDER(10),IIJDER(18)
     *,            IJJDER(18),IIKDER(18),IKKDER(18),JJKDER(18)
     *,            JKKDER(18),IJKDER(27)
      COMMON/TAPES/ITAP30,ITAP38,ITAP42,ITAP45,ITAP46
      COMMON/TOLER/TOL(10)
      COMMON/WORKS/JTAPE1,JTAPE2
      DATA  ASRTPI / 1.1283791670955126D0/
    2 FORMAT(/,2X,' OVERLAP FIRST DERIVATIVES')
    3 FORMAT(/,2X,' KINETIC ENERGY FIRST DERIVATIVES')
    4 FORMAT(/,2X,' DEGREE OF FREEDOM',I5)
    7 FORMAT(/,2X,' OVERLAP SECOND DERIVATIVES IABC=',I5)
    8 FORMAT(/,2X,' KINETIC ENERGY SECOND DERIVATIVES IABC=',I5)
    9 FORMAT(/,2X,' OVERLAP THIRD DERIVATIVES IABC=',I5)
   10 FORMAT(/,2X,' KINETIC ENERGY THIRD DERIVATIVES IABC=',I5)
   11 FORMAT(/,2X,' THE SECOND DERIVATIVE OF NUC ATTRACTION WITHOUT THE
     *KINETIC ENERGY SECOND DERIVATIVES ADDED IN')
   12 FORMAT(/,' D2/DADB IABC=',I5)
   13 FORMAT(/,2X,' THE THIRD DERIVATIVE OF NUC ATTRACTION WITOUT THE KI
     *NETIC ENERGY THIRD DERIVATIVES ADDED IN')
   14 FORMAT(/,2X,' D3/DADBDC   IABC=',I5)
   15 FORMAT(/,2X,' T + V FIRST DERIVATIVE IABC=',I5)
   16 FORMAT(/,2X,' T + V SECOND DERIVATIVE IABC=',I5)
   17 FORMAT(/,2X,' T + V THIRD DERIVATIVE  IABC=',I5)
   18 FORMAT(/,2X,' ONE ELECTRON FIRST DERVATIVE MATRIX',/)
   19 FORMAT(/,2X,' ONE ELECTRON SECOND DERVATIVE MATRIX',/)
   20 FORMAT(/,2X,' ONE ELECTRON THIRD DERIVATIVE MATRIX',/)
   21 FORMAT(/,2X,' FIRST DERIVATIVE OVERLAP * AO LAGRANGIAN ',/)
   22 FORMAT(/,2X,' SECOND DERIVATIVE OVERLAP * AO LAGRANGIAN ',/)
   23 FORMAT(/,2X,' THIRD DERIVATIVE OVERLAP * AO LAGRANGIAN ',/)
C
      ISIZ= 7
      ISIZ2= 14
      ISIZ3= 21
C
CCC   WRITE(6,*) ' ***INFORMATION IN THI111***'
CCC   WRITE(6,*) ' IOUT,INPUT,IDBG'
CCC   WRITE(6,*)   IOUT,INPUT,IDBG
CCC   WRITE(6,*) ' NS,N3N,I2N3N,I3N3N'
CCC   WRITE(6,*)   NS,N3N,I2N3N,I3N3N
CCC   WRITE(6,*) ' NBFAO,NUMIJ,NUMNUM'
CCC   WRITE(6,*)   NBFAO,NUMIJ,NUMNUM
CCC   WRITE(6,*) ' TSHELL,TPRIM'
CCC   WRITE(6,*)   TSHELL,TPRIM
CCC   WRITE(6,*) ' IMEM,IMEM2,IMEM4'
CCC   WRITE(6,*)   IMEM,IMEM2,IMEM4
CCC   WRITE(6,*) ' IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL'
CCC   WRITE(6,*)   IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL
CCC   WRITE(6,*) ' IDRVT,IDRVF'
CCC   WRITE(6,*)   IDRVT,IDRVF
CCC   WRITE(6,*) ' ITAP30,ITAP38,ITAP42,ITAP45,ITAP46'
CCC   WRITE(6,*)   ITAP30,ITAP38,ITAP42,ITAP45,ITAP46
CCC   WRITE(6,*) ' JTAPE1,JTAPE2'
CCC   WRITE(6,*)   JTAPE1,JTAPE2
C
CCC   WRITE(6,*) ' NMEM'
CCC   WRITE(6,*)   NMEM
CCC   WRITE(6,*) ' LMNP1'
CCC   WRITE(6,*)   LMNP1
CCC   WRITE(6,*) ' NCON'
CCC   WRITE(6,*)   NCON
CCC   WRITE(6,*) ' NF'
CCC   WRITE(6,*)   NF
C
CCC   DO 150 I=1,NS
CC150 WRITE(6,27) CHG(I),X(I),Y(I),Z(I)
CCC27 FORMAT(2X,F4.1,2X,3F20.10)
CCC   DO 151 I=1,TSHELL
CCC   WRITE(6,28) LMNP1(I),I
CCC   NOCNG=NCON(I)
CCC   DO 151 J=1,NOCNG
CCC   WRITE(6,29) ZET(I,J),ETA(I,J)
CC151 CONTINUE
CCC28 FORMAT(/,2X,' PRINCIPLE QUANTUM NUMBER = ',I2,' SHELL = ',I5)
CCC29 FORMAT(2X,2F20.10)
CCC   WRITE(6,*) ' NSHELL AND NFIRST'
CCC   DO 152 I=1,NS
CCC   DO 152 J=1,TSHELL
CC152 WRITE(6,*) NSHELL(I,J),NFIRST(I,J)
CCC   WRITE(6,*) ' NTU AND NTL'
CCC   DO 153 I=1,TSHELL
CC153 WRITE(6,*) NTU(I),NTL(I)
C
C   PICK UP THE AO LAGRAGIAN FROM THE MASTER TAPE
C
      CALL MREAD(LAG,24)
C
C   PREMULTIPLY THE DENSITY MATRIX BY 2 FOR IORB .NE. JORB
C   AS WELL AS THE AO LAGRAGIAN
C
      DO 34 IORB=1,NBFAO
        DO 33 JORB=1,IORB
          IJ=IOFF(IORB) + JORB
          FAC=2.0D0
          IF(IORB .EQ. JORB) FAC=1.0D0
          DEN1T(IJ)=DEN1T(IJ)*FAC
          LAG(IJ)=LAG(IJ)*FAC
   33 CONTINUE
   34 CONTINUE
C
      CALL NUCATT(GT,GU,GV)
      CALL ARRAY(KST)
      CALL ENEW
C
C   ZERO OUT THE SX,SY,SZ,SDX,SDY,SDZ,TDX,TDY, AND TDZ ARRAYS
C
      ISZ=NUMIJ*N3N
      CALL ZERO(S1DER,ISZ)
C*    CALL ZERO(T1DER,ISZ)
      IS=NUMIJ*I2N3N
      CALL ZERO(S2DER,IS)
C*    CALL ZERO(T2DER,IS)
      IS=N3N*NUMIJ
      CALL ZERO(V1DER,IS)
      IS=I2N3N*NUMIJ
      CALL ZERO(V2DER,IS)
      IF(IDRVF.EQ.3) THEN
        IS=I3N3N*NUMIJ
        CALL ZERO(V3DER,IS)
      END IF
      CALL ZERO(EONE1,N3N)
      CALL ZERO(EONE2,I2N3N)
      CALL ZERO(EONE3,I3N3N)
C
C   GO OVER THE SYMM DISTICNT ATOMS II,JJ
C
      DO 9000 II=1,NS
        INFNS=NF(II)
        X1=X(II)
        Y1=Y(II)
        Z1=Z(II)
        CALL IARRY(II,IDER,IIDER,IIIDER)
        DO 8500 JJ=1,II
          EQUAL=II.EQ.JJ
          JNFNS=NF(JJ)
          X2=X(JJ)
          Y2=Y(JJ)
          Z2=Z(JJ)
          X12=X1-X2
          Y12=Y1-Y2
          Z12=Z1-Z2
          AB2=X12*X12 + Y12*Y12 + Z12*Z12
          CALL IARRY(JJ,JDER,JJDER,JJJDER)
          CALL IJARRY(II,JJ,IDER,JDER,IJDER,IIJDER,IJJDER)
C
C   GO OVER THE NUMBER OF FUNCTIONS ON THE CENTERS II,JJ
C   INFNS= NO. ON II      JNFNS= NO. ON JJ
C
          DO 8000 I=1,INFNS
            ISHELL=NSHELL(II,I)
            IORB1=NFIRST(II,I)
            NUMI=NMEM(ISHELL)
            IQN=LMNP1(ISHELL)
            IGU=NCON(ISHELL)
            MAXI=NTU(ISHELL)
            MINI=NTL(ISHELL)
            JNFNMX=JNFNS
            IF(EQUAL) JNFNMX=I
            DO 7500J=1,JNFNMX
              JSHELL=NSHELL(JJ,J)
              IF(JSHELL .GT.ISHELL) GO TO 7500
              FUNS=ISHELL.EQ.JSHELL
              BOTH=EQUAL.AND.FUNS
              JORB1=NFIRST(JJ,J)
              NUMJ=NMEM(JSHELL)
              JQN=LMNP1(JSHELL)
              JGU=NCON(JSHELL)
              MAXJ=NTU(JSHELL)
              MINJ=NTL(JSHELL)
              FACT2=2.0D0*DBLE(JQN+1)
C
C   PREPARE THE INDICES DO THE PAIRS OF ORBITALS
C
              IJNUM=0
              DO 105 IR=MINI,MAXI
                NX=IX(IR)
                NY=IY(IR)
                NZ=IZ(IR)
                IF(BOTH) MAXJ=IR
                DO 100 JR=MINJ,MAXJ
                  IJNUM=IJNUM + 1
                  IJX(IJNUM)=NX+JX(JR)
                  IJY(IJNUM)=NY+JY(JR)
                  IJZ(IJNUM)=NZ+JZ(JR)
  100           CONTINUE
  105         CONTINUE
C
              DO 7000 IG=1,IGU
                AA=ZET(ISHELL,IG)
                CCA=ETA(ISHELL,IG)
                PAAX=AA*X1
                PAAY=AA*Y1
                PAAZ=AA*Z1
                JGUMX=JGU
                IF(BOTH) JGUMX=IG
                DO 6500 JG=1,JGUMX
                  FACT=1.0D0
                  IF(BOTH .AND. IG .NE. JG) FACT=2.0D0
                  BB=ZET(JSHELL,JG)
                  CCB=ETA(JSHELL,JG)
                  PBBX=BB*X2
                  PBBY=BB*Y2
                  PBBZ=BB*Z2
                  P=AA + BB
                  RECIPP=1.0D0/P
                  PX=(PAAX + PBBX)*RECIPP
                  PY=(PAAY + PBBY)*RECIPP
                  PZ=(PAAZ + PBBZ)*RECIPP
                  IF(EQUAL) THEN
                    PAX=0.0D0
                    PAY=0.0D0
                    PAZ=0.0D0
                    PBX=0.0D0
                    PBY=0.0D0
                    PBZ=0.0D0
                    GO TO 40
                  END IF
                  PAX=PX - X1
                  PBX=PX - X2
                  PAY=PY - Y1
                  PBY=PY - Y2
                  PAZ=PZ - Z1
                  PBZ=PZ - Z2
   40             CONTINUE
                  DUM=AA*BB*RECIPP*AB2
C
C   SKIP THE ENTIRE SET OF E COEFFS IF THE INTEGRAL WILL BE IGNORED
C
                  IF(DUM .GT. TOL(2)) GO TO 6500
C
                  KAB=DEXP(-DUM)
                  DUMMY=KAB*CCA*CCB*FACT*RECIPP
C
C   CALCULATE THE E ARRAYS
C
                  IQNMX=MAX0(IQN + 3,JQN + 3)
C
                  CALL ECAL(PAX,PAY,PAZ,PBX,PBY,PBZ,P,DUMMY,IQNMX,0)
C
C   CALCUATE THE R(T,U,V) OVER ALL ATOMS FOR THE NUCLEAR ATTRACTION INTS
C
                  CALL VCALCU(PX,PY,PZ,P,IQN,JQN,3)
C
                  AA2=AA*2.0D0
                  AAAA4=AA*AA*4.0D0
                  AAA8=AA*AA*AA*8.0D0
                  BB2=BB*2.0D0
                  BBBB4=BB*BB*4.0D0
                  BBS2=-BB*BB*2.0D0
                  AABB4=AA*BB*4.0D0
                  A4B2=AAAA4*BBS2
                  A2B2=AA2*BBS2
                  A8B2=AAA8*BBS2
                  PFACT=DSQRT(RECIPP)
                  IORBMX=IORB1 -1 + NUMI
                  JORBMX=JORB1 -1 + NUMJ
C
C   CALCULATE THE OVERLAP AND KINETIC ENERGY DERIVATIVES
C
C   BY TRANSLATIONAL INVARIANCE, S AND T DERIVATIVES ON THE SAME CENTER
C   ARE ZERO, SO WE DO NOT TRY TO CALCULATE THEM
C
                  IF(EQUAL) GOTO 400
                  CALL STINT(SX,SY,SZ,TX,TY,TZ,FIRB,FIRK,SXD,SYD,SZD
     *,                      TXD,TYD,TZD,S1DER,T1DER,SECMXB,SECMXK,STWO
     *,                      TTWO,S2DER,T2DER,THRMXB,THRMXK,STHRE,TTHRE
     *,                      S3DER,T3DER,S3LAG,IJORB,LAG,DEN1T
     *,                      EONE3,BOTH)
C
  400             CONTINUE
C
C   CALCULATE THE NUCLEAR ATTRACTION DERIVATIVES
C
                  CALL VINT(GT,GU,GV,VX,VY,VZ,FIRB,FIRK,VXD,VYD,VZD
     *,                     V1DER,SECMXB,SECMXK,MX1B1K,VXTWO,VYTWO,VZTWO
     *,                     V2DER,V1B1K,THRMXB,THRMXK,MX2B1K,MX1B2K
     *,                     V1B2K,V2B1K,VXTHRE,VYTHRE,VZTHRE,V3DER
     *,                     EONE3,IJORB,DEN1T,BOTH,EQUAL)
C
 6500           CONTINUE
 7000         CONTINUE
C
 7500       CONTINUE
 8000     CONTINUE
 8500   CONTINUE
 9000 CONTINUE
C
      IF(IPRNT .GT. 5) THEN
        WRITE(IOUT,2)
        DO 1010 IXC=1,N3N
          WRITE(IOUT,4)IXC
          CALL PRINT(S1DER(1,IXC),NUMIJ,NBFAO,IOUT)
 1010   CONTINUE
        WRITE(IOUT,3)
        DO 1020 IXC=1,N3N
          WRITE(IOUT,4)IXC
          CALL PRINT(T1DER(1,IXC),NUMIJ,NBFAO,IOUT)
 1020   CONTINUE
        DO 1030 IXC=1,I2N3N
          WRITE(IOUT,7)IXC
          CALL PRINT(S2DER(1,IXC),NUMIJ,NBFAO,IOUT)
 1030   CONTINUE
        DO 1040 IXC=1,I2N3N
          WRITE(IOUT,8)IXC
          CALL PRINT(T2DER(1,IXC),NUMIJ,NBFAO,IOUT)
 1040   CONTINUE
C
        IF(IDRVF.EQ.3) THEN
          DO 1050 IXC=1,I3N3N
            WRITE(IOUT,9)IXC
            CALL PRINT(S3DER(1,IXC),NUMIJ,NBFAO,IOUT)
 1050     CONTINUE
          DO 1060 IXC=1,I3N3N
            WRITE(IOUT,10)IXC
            CALL PRINT(T3DER(1,IXC),NUMIJ,NBFAO,IOUT)
 1060     CONTINUE
        END IF
      END IF
C
      IF(IPRNT .GT. 6) THEN
        WRITE(IOUT,11)
        DO 1070 IXC=1,I2N3N
          WRITE(IOUT,12)IXC
          CALL PRINT(V2DER(1,IXC),NUMIJ,NBFAO,IOUT)
 1070   CONTINUE
      END IF
C
      IF(IPRNT .GT. 3) THEN
        DO 1080 I=1,N3N
          WRITE(IOUT,15) I
          CALL PRINT(V1DER(1,I),NUMIJ,NBFAO,IOUT)
 1080   CONTINUE
        DO 1090 I=1,I2N3N
          WRITE(IOUT,16) I
          CALL PRINT(V2DER(1,I),NUMIJ,NBFAO,IOUT)
 1090   CONTINUE
C
        IF(IDRVF.EQ.3) THEN
          DO 1095 I=1,I3N3N
            WRITE(IOUT,17)I
            CALL PRINT(V3DER(1,I),NUMIJ,NBFAO,IOUT)
 1095     CONTINUE
        END IF
      END IF
C
C   TRANSFORM THE FIRST, SECOND AND THIRD DERIVATIVES
C   IF(IDRVF.EQ.3) THEN 3RD DERIVATIVE IS ALREADY DONE
C
      III=0
      DO 2400 I=1,NBFAO
        DO 2300 J=1,I
          III=III + 1
          DO 2000 IJ=1,N3N
            EONE1(IJ)=EONE1(IJ) + V1DER(III,IJ)*DEN1T(III)
 2000     CONTINUE
          DO 2100 IJ=1,I2N3N
            EONE2(IJ)=EONE2(IJ) + V2DER(III,IJ)*DEN1T(III)
 2100     CONTINUE
          IF(IDRVF.EQ.3) THEN
            DO 2200 IJ=1,I3N3N
              EONE3(IJ)=EONE3(IJ) + V3DER(III,IJ)*DEN1T(III)
 2200       CONTINUE
          END IF
 2300   CONTINUE
 2400 CONTINUE
C
      IF(IPRNT.GT.2) THEN
      WRITE(IOUT,18)
      DO 2500 I=1,NS
        II=(I-1)*3 + 1
        WRITE(IOUT,'(3F20.10)') EONE1(II),EONE1(II+1),EONE1(II+2)
 2500 CONTINUE
      WRITE(IOUT,19)
      CALL PRINT(EONE2,I2N3N,N3N,IOUT)
      WRITE(IOUT,20)
      CALL THROUT(EONE3,KST,I3N3N)
      END IF
C
C   MULTIPLY THE AO LAGRANIAN BY THE OVERLAP DERIVATIVES
C   IF(IDRVF.EQ.3) THEN THE 3RD DERIVATIVE IS ALREADY DONE
C
      DO 2900 I=1,NBFAO
        DO 2800 J=1,I
          IJ=IOFF(I) + J
          DO 2600 IABC=1,N3N
            S1LAG(IABC)=S1LAG(IABC) + S1DER(IJ,IABC)*LAG(IJ)
 2600     CONTINUE
          DO 2700 IABC=1,I2N3N
            S2LAG(IABC)=S2LAG(IABC) + S2DER(IJ,IABC)*LAG(IJ)
 2700     CONTINUE
          IF(IDRVF.EQ.3) THEN
            DO 2750 IABC=1,I3N3N
              S3LAG(IABC)=S3LAG(IABC) + S3DER(IJ,IABC)*LAG(IJ)
 2750       CONTINUE
          END IF
C
 2800   CONTINUE
 2900 CONTINUE
C
      IF(IPRNT.GT.2) THEN
      WRITE(IOUT,21)
      DO 2950 I=1,NS
        II=(I-1)*3 + 1
        WRITE(IOUT,'(3F20.10)') S1LAG(II),S1LAG(II+1),S1LAG(II+2)
 2950 CONTINUE
      WRITE(IOUT,22)
      CALL PRINT(S2LAG,I2N3N,N3N,IOUT)
      WRITE(IOUT,23)
      CALL THROUT(S3LAG,KST,I3N3N)
      END IF
C
C########################
C###JTAPE1 INFORMATION###
C########################
C
      CALL SREW(JTAPE1)
      IEA=INTOWP(N3N)
      IEAB=INTOWP(I2N3N)
      IEABC=INTOWP(I3N3N)
      ISA=INTOWP(N3N*NUMIJ)
      ISAB=INTOWP(I2N3N*NUMIJ)
      ISABC=INTOWP(I3N3N*NUMIJ)
      CALL RWRIT(JTAPE1,EONE1,IEA,IPASS(15))
      CALL RWRIT(JTAPE1,EONE2,IEAB,IPASS(16))
      CALL RWRIT(JTAPE1,EONE3,IEABC,IPASS(17))
      CALL RWRIT(JTAPE1,S1DER,ISA,IPASS(18))
      CALL RWRIT(JTAPE1,S2DER,ISAB,IPASS(19))
      IF(IDRVF.EQ.3) THEN
        CALL RWRIT(JTAPE1,S3DER,ISABC,IPASS(20))
      END IF
      CALL RWRIT(JTAPE1,V1DER,ISA,IPASS(21))
      CALL RWRIT(JTAPE1,V2DER,ISAB,IPASS(22))
      IF(IDRVF.EQ.3) THEN
        CALL RWRIT(JTAPE1,V3DER,ISABC,IPASS(23))
      END IF
      CALL RWRIT(JTAPE1,S1LAG,IEA,IPASS(24))
      CALL RWRIT(JTAPE1,S2LAG,IEAB,IPASS(25))
      CALL RWRIT(JTAPE1,S3LAG,IEABC,IPASS(26))
      CALL SREW(JTAPE1)
C
C###################
C###END OF JTAPE1###
C###################
C
      RETURN
      END
C**********************************************************************
C   THIRD DERIVATIVE PROGRAM PART 3 : "THIRD2"                        *
C**********************************************************************
C
C**********************************************************************
C*   NOTICE OF PROGRAM MODIFICATION                                   *
C**********************************************************************
C*  BY:  RICHARD REMINGTON                         search:  c7-14-88  *
C*  DATE:  July  14,   1988                                           *
C*  REASON: Migration to run in 7Mb on 9370   and also add a continue *
C*          at label 3995 in order to maintain f77 standard code.     *
C**********************************************************************
C                                                                     *
C   LAST UPDATED  ON :   JANUARY  23, 1987  BY YUKIO YAMAGUCHI        *
C   LAST UPDATED  ON :   DECEMBER 02, 1985  BY YUKIO YAMAGUCHI        *
C   LAST MODIFIED ON :   DECEMBER 18, 1984  BY JFG                    *
C                                                                     *
C**********************************************************************
C   TWO ELECTRON 3RD DERIVATIVE PROGRAM : LOOPS THROUGH FUNCTIONS     *
C                                         AND CONTRACTIONS            *
C                                                                     *
C                        GENERAL OPEN-SHELL FORMALISM                 *
C                                                                     *
C                   THIS VERSION WRITES OUT THE 22 AND 81 FILES       *
C                         1) ETWO1,ETWO2,ETWO3,DM1,AND DM2 ON FILE 22 *
C                         2) FIRDER AND LABELS ON FILE 81             *
C                           (NOTE: DM123 IS REALLY DM12)              *
C                                                                     *
C######################################################################
      SUBROUTINE INT2(NMEM,LMNP1,NCON,NF,NSHELL
     1,               NFIRST,KST,INTSV,LO,ITYPE,LABOUT
     2,               ZET,ETA,DA,DB,DC
     3,               ETWO1,ETWO2,ETWO3,DAO,GT,GU,GV
     4,               DM123,DNTYP,XX0,XY0,XZ0
     5,               XXFIR,XYFIR,XZFIR,XXSEC,XYSEC,XZSEC
     6,               XXMXFF,XYMXFF,XZMXFF
     7,               GMXFIR,GMXSEC,GMXFF
     8,               XXTHR,XYTHR,XZTHR,XXFFF,XYFFF,XZFFF
     9,               XXFSMX,XYFSMX,XZFSMX
     X,               GMXTHR,GMXFFF,GMXFS,FIRDER,SECDER,THRDER
     1,               ITOTDG,IUNIT,IUNIT4)
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER TSHELL,TPRIM
      LOGICAL BOTH1,BOTH2
      LOGICAL EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      REAL*8 KAB
      DIMENSION ITEST(10)
      DIMENSION NMEM(TSHELL),LMNP1(TSHELL),NCON(TSHELL),NF(NS)
     *,         NSHELL(NS,TSHELL)
      DIMENSION NFIRST(NS,TSHELL),KST(NS,NS,NS),INTSV(500,4)
     *,         LO(IMEM4*5),ITYPE(IMEM4),LABOUT(IUNIT4)
      DIMENSION ZET(TSHELL,TPRIM),ETA(TSHELL,TPRIM)
     *,         DA(NUMIJ,NTYPES),DB(NUMIJ,NTYPES),DC(NUMIJ,NTYPES)
      DIMENSION ETWO1(N3N),ETWO2(I2N3N),ETWO3(I3N3N),DAO(IMEM4)
     *,         GT(I4LARL,I2LARL),GU(I4LARL,I2LARL)
     *,         GV(I4LARL,I2LARL)
      DIMENSION DM123(NUMIJ,ITOTDG*NTYPES),DNTYP(NTYPES,NUMIJ,ITOTDG)
     *,         XX0(IANGSQ,IANGSQ),XY0(IANGSQ,IANGSQ),XZ0(IANGSQ,IANGSQ)
      DIMENSION XXFIR(IANGSQ,IANGSQ,3),XYFIR(IANGSQ,IANGSQ,3)
     *,         XZFIR(IANGSQ,IANGSQ,3),XXSEC(IANGSQ,IANGSQ,3)
     *,         XYSEC(IANGSQ,IANGSQ,3),XZSEC(IANGSQ,IANGSQ,3)
      DIMENSION XXMXFF(IANGSQ,IANGSQ,3),XYMXFF(IANGSQ,IANGSQ,3)
     *,         XZMXFF(IANGSQ,IANGSQ,3)
      DIMENSION GMXFIR(IMEM4,9,3),GMXSEC(IMEM4,6,3),GMXFF(IMEM4,9,3)
      DIMENSION XXTHR(IANGSQ,IANGSQ,3),XYTHR(IANGSQ,IANGSQ,3)
     *,         XZTHR(IANGSQ,IANGSQ,3),XXFFF(IANGSQ,IANGSQ)
     *,         XYFFF(IANGSQ,IANGSQ),XZFFF(IANGSQ,IANGSQ)
      DIMENSION XXFSMX(IANGSQ,IANGSQ,6),XYFSMX(IANGSQ,IANGSQ,6)
     *,         XZFSMX(IANGSQ,IANGSQ,6)
      DIMENSION GMXTHR(IMEM4,10,3),GMXFFF(IMEM4,27),GMXFS(IMEM4,18,6)
     *,         FIRDER(N3N,IUNIT),SECDER(I2N3N,IUNIT)
     *,         THRDER(I3N3N,IUNIT)
      COMMON/CALQN/ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET
      COMMON/CENTS/IDER(3),JDER(3),KDER(3),LDER(3),IIDER(6)
     *,            JJDER(6),KKDER(6),LLDER(6),IJDER(9),IKDER(9)
     *,            ILDER(9),JKDER(9),JLDER(9),KLDER(9)
      COMMON/CENT2/X1,Y1,Z1,X2,Y2,Z2,X3,Y3,Z3,X4,Y4,Z4
      COMMON/CENT3/IIIDER(10),JJJDER(10),KKKDER(10),LLLDER(10)
     *,            IIJDER(18),IJJDER(18),IIKDER(18),IKKDER(18)
     *,            IILDER(18),ILLDER(18),JJKDER(18),JKKDER(18)
     *,            JJLDER(18),JLLDER(18),KKLDER(18),KLLDER(18)
     *,            IJKDER(27),IJLDER(27),JKLDER(27),IKLDER(27)
      COMMON/COORD/X(50),Y(50),Z(50),CHG(50)
      COMMON/EXYZS/EX(686),EY(686),EZ(686)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/IADRS/IPASS(35)
      COMMON/INDEX/IX(84),IY(84),IZ(84),JX(84),JY(84),JZ(84)
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR3/TSHELL,TPRIM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/IPAR5/IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL
      COMMON/KEEPS/IDRVT,IDRVF
      COMMON/LOGIC/EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      COMMON/NINFO/INTOT,ISPOT,IFSEC,ISSEC,ITSEC,ILSEC
      COMMON/ORBIN/IORB1,JORB1,KORB1,LORB1,NUMI,NUMJ,NUMK,NUML
      COMMON/PASS /II,JJ,KK,LL
      COMMON/POSNS/IJX(50),IJY(50),IJZ(50),KLX(50),KLY(50),KLZ(50)
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/STSTP/NTU(200),NTL(200)
      COMMON/TAPES/ITAP30,ITAP38,ITAP42,ITAP45,ITAP46
      COMMON/TOLER/TOL(10)
      COMMON/TWINF/ISHELL,JSHELL,KSHELL,LSHELL
      COMMON/WORKS/JTAPE1,JTAPE2
      DATA ASRTPI / 1.1283791670955126D+00 /
    1 FORMAT(/,2X,' NUMBER OF INTEGRALS=',I5,' INTOT=',I5)
    2 FORMAT(/,2X,' TWO ELECTRON FIRST DERIVATIVE MATRIX',/)
    3 FORMAT(/,2X,' TWO ELECTRON SECOND DERIVATIVE MATRIX',/)
    4 FORMAT(/,' TWO ELECTRON FIRST DERIVATIVE (HALF TRANSFORMED)  IABC=
     *',I5)
    5 FORMAT(/,' TWO ELECTRON SECOND DERIVATIVE (HALF TRANSFORMED)  IABC
     *=',I5)
    6 FORMAT(F20.10,F20.10,F20.10)
    7 FORMAT(4I5,2X,10(F15.8,2X))
    8 FORMAT(/,2X,' FIRST DERIVATIVE INTEGRALS FOR ATOM NO.',I5)
    9 FORMAT(I5,I5,I5,I5,6F15.9)
   10 FORMAT(/,' TWO ELECTRON THIRD DERIVATIVE (HALF TRANSFORMED)  IABC=
     *',I5)
   11 FORMAT(/,2X,' TWO ELECTRON THRID DERIVATIVE MATRIX',/)
   18 FORMAT(/,' ****************** ')
   19 FORMAT(/,2X,' TAPE38 INFORMATION ')
   20 FORMAT(/,2X,' LOCATIONS :',/)
   21 FORMAT(/,2X,' THERE ARE A TOTAL OF',I4,' NECESSARY READS')
   22 FORMAT(/,2X,' FIRST DERIVATIVES ',/,
     *         2X,' LENGTH (IN INTEGER*4 WORDS) = ',I12,/,
     *         2X,' AT RECORDS : ')
   23 FORMAT(/,2X,' SECOND DERIVATIVES ',/,
     *         2X,' LENGTH (IN INTEGER*4 WORDS) = ',I12,/,
     *         2X,' AT RECORDS : ')
   24 FORMAT(/,2X,' THIRD DERIVATIVES ',/,
     *         2X,' LENGTH (IN INTEGER*4 WORDS) = ',I12,/,
     *         2X,' AT RECORDS : ')
   25 FORMAT(/,2X,' LABELS ',/,
     *         2X,' LENGTH (IN INTEGER*4 WORDS) = ',I12,/,
     *         2X,' AT RECORDS : ')
   26 FORMAT(10I10)
C
      INTCNT=1
      INTOT=1
      ISPOT=0
      PIFAC=DSQRT(ASRTPI)
C
C     WRITE(6,*) ' ***INFORMATION IN THI222***'
C     WRITE(6,*) ' IOUT,INPUT,IDBG'
C     WRITE(6,*)   IOUT,INPUT,IDBG
C     WRITE(6,*) ' NS,N3N,I2N3N,I3N3N'
C     WRITE(6,*)   NS,N3N,I2N3N,I3N3N
C     WRITE(6,*) ' NBFAO,NUMIJ,NUMNUM'
C     WRITE(6,*)   NBFAO,NUMIJ,NUMNUM
C     WRITE(6,*) ' TSHELL,TPRIM'
C     WRITE(6,*)   TSHELL,TPRIM
C     WRITE(6,*) ' IMEM,IMEM2,IMEM4'
C     WRITE(6,*)   IMEM,IMEM2,IMEM4
C     WRITE(6,*) ' IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL'
C     WRITE(6,*)   IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL
C     WRITE(6,*) ' IDRVT,IDRVF'
C     WRITE(6,*)   IDRVT,IDRVF
C     WRITE(6,*) ' ITAP30,ITAP38,ITAP42,ITAP45,ITAP46'
C     WRITE(6,*)   ITAP30,ITAP38,ITAP42,ITAP45,ITAP46
C     WRITE(6,*) ' JTAPE1,JTAPE2'
C     WRITE(6,*)   JTAPE1,JTAPE2
C     CALL PRINT(DA,NUMIJ*NTYPES,NBFAO,6)
C     CALL PRINT(DB,NUMIJ*NTYPES,NBFAO,6)
C     CALL PRINT(DC,NUMIJ*NTYPES,NBFAO,6)
C     WRITE(6,*) ' ITOTDG,IUNIT,IUNIT4'
C     WRITE(6,*)   ITOTDG,IUNIT,IUNIT4
C
C     WRITE(6,*) ' NMEM'
C     WRITE(6,*)   NMEM
C     WRITE(6,*) ' LMNP1'
C     WRITE(6,*)   LMNP1
C     WRITE(6,*) ' NCON'
C     WRITE(6,*)   NCON
C     WRITE(6,*) ' NF'
C     WRITE(6,*)   NF
C
C     DO 150 I=1,NS
C 150 WRITE(6,27) CHG(I),X(I),Y(I),Z(I)
C  27 FORMAT(2X,F4.1,2X,3F20.10)
C     DO 151 I=1,TSHELL
C     WRITE(6,28) LMNP1(I),I
C     NOCNG=NCON(I)
C     DO 151 J=1,NOCNG
C     WRITE(6,29) ZET(I,J),ETA(I,J)
C 151 CONTINUE
C  28 FORMAT(/,2X,' PRINCIPLE QUANTUM NUMBER = ',I2,' SHELL = ',I5)
C  29 FORMAT(2X,2F20.10)
C     WRITE(6,*) ' NSHELL AND NFIRST'
C     DO 152 I=1,NS
C     DO 152 J=1,TSHELL
C 152 WRITE(6,*) NSHELL(I,J),NFIRST(I,J)
C     WRITE(6,*) ' NTU AND NTL'
C     DO 153 I=1,TSHELL
C 153 WRITE(6,*) NTU(I),NTL(I)
C
C   SECTOR LENGHTS
C
      IFSEC=NREC(INTOWP(IUNIT*N3N))
      ISSEC=NREC(INTOWP(IUNIT*I2N3N))
      ITSEC=NREC(INTOWP(IUNIT*I3N3N))
      ILSEC=NREC(IUNIT4)
C
C   SET UP THE MULTIPLE ENTRY SUBROUTINES
C
      WRITE(IDBG,*) ' BEFORE ARRAY'
      CALL ARRAY(KST)
      CALL ENEW
      CALL RCALCU(GT,GU,GV)
C
      CALL AODMUL(DC,DC,DAO,LO,ITYPE)
C
      WRITE(IDBG,*) ' BEFORE CENT12'
      CALL CENT12(GT,GU,GV,XX0,XY0,XZ0,XXFIR,XYFIR,XZFIR,XXSEC,
     *XYSEC,XZSEC,XXMXFF,XYMXFF,XZMXFF,GMXFIR,GMXSEC,GMXFF,LO,
     *XXTHR,XYTHR,XZTHR,XXFFF,XYFFF,XZFFF,XXFSMX,XYFSMX,XZFSMX,GMXTHR,
     *GMXFFF,GMXFS)
      CALL CENT34(GT,GU,GV,XX0,XY0,XZ0,XXFIR,XYFIR,XZFIR,XXSEC,
     *XYSEC,XZSEC,XXMXFF,XYMXFF,XZMXFF,GMXFIR,GMXSEC,GMXFF,LO,
     *XXTHR,XYTHR,XZTHR,XXFFF,XYFFF,XZFFF,XXFSMX,XYFSMX,XZFSMX,GMXTHR,
     *GMXFFF,GMXFS)
      CALL CENT13(GT,GU,GV,XX0,XY0,XZ0,XXFIR,XYFIR,XZFIR,XXSEC,
     *XYSEC,XZSEC,XXMXFF,XYMXFF,XZMXFF,GMXFIR,GMXSEC,GMXFF,LO,
     *XXTHR,XYTHR,XZTHR,XXFFF,XYFFF,XZFFF,XXFSMX,XYFSMX,XZFSMX,GMXTHR,
     *GMXFFF,GMXFS)
      CALL CENT14(GT,GU,GV,XX0,XY0,XZ0,XXFIR,XYFIR,XZFIR,XXSEC,
     *XYSEC,XZSEC,XXMXFF,XYMXFF,XZMXFF,GMXFIR,GMXSEC,GMXFF,LO,
     *XXTHR,XYTHR,XZTHR,XXFFF,XYFFF,XZFFF,XXFSMX,XYFSMX,XZFSMX,GMXTHR,
     *GMXFFF,GMXFS)
      CALL CENT24(GT,GU,GV,XX0,XY0,XZ0,XXFIR,XYFIR,XZFIR,XXSEC,
     *XYSEC,XZSEC,XXMXFF,XYMXFF,XZMXFF,GMXFIR,GMXSEC,GMXFF,LO,
     *XXTHR,XYTHR,XZTHR,XXFFF,XYFFF,XZFFF,XXFSMX,XYFSMX,XZFSMX,GMXTHR,
     *GMXFFF,GMXFS)
      CALL CEN123(GT,GU,GV,XX0,XY0,XZ0,XXFIR,XYFIR,XZFIR,XXSEC,
     *XYSEC,XZSEC,XXMXFF,XYMXFF,XZMXFF,GMXFIR,GMXSEC,GMXFF,LO,
     *XXTHR,XYTHR,XZTHR,XXFFF,XYFFF,XZFFF,XXFSMX,XYFSMX,XZFSMX,GMXTHR,
     *GMXFFF,GMXFS)
C
      CALL DENSET(DM123,DNTYP,DA,DB,DC,ITOTDG)
C
      WRITE(IDBG,*) ' BEFORE ONE'
      CALL ONE(SECDER,LABOUT,IUNIT,IUNIT4,INTSV,ETWO1,ETWO2,
     *FIRDER,GMXFIR,GMXSEC,GMXFF,LO,DAO,THRDER,GMXTHR,GMXFFF,GMXFS,
     *ETWO3)
      CALL TWO(SECDER,LABOUT,IUNIT,IUNIT4,INTSV,ETWO1,ETWO2,
     *FIRDER,GMXFIR,GMXSEC,GMXFF,LO,DAO,THRDER,GMXTHR,GMXFFF,GMXFS,
     *ETWO3)
      CALL THREE(SECDER,LABOUT,IUNIT,IUNIT4,INTSV,ETWO1,ETWO2,
     *FIRDER,GMXFIR,GMXSEC,GMXFF,LO,DAO,THRDER,GMXTHR,GMXFFF,GMXFS,
     *ETWO3)
      CALL FOUR(SECDER,LABOUT,IUNIT,IUNIT4,INTSV,ETWO1,ETWO2,
     *FIRDER,GMXFIR,GMXSEC,GMXFF,LO,DAO,THRDER,GMXTHR,GMXFFF,GMXFS,
     *ETWO3)
      CALL FIVE(SECDER,LABOUT,IUNIT,IUNIT4,INTSV,ETWO1,ETWO2,
     *FIRDER,GMXFIR,GMXSEC,GMXFF,LO,DAO,THRDER,GMXTHR,GMXFFF,GMXFS,
     *ETWO3)
      CALL SIX(SECDER,LABOUT,IUNIT,IUNIT4,INTSV,ETWO1,ETWO2,
     *FIRDER,GMXFIR,GMXSEC,GMXFF,LO,DAO,THRDER,GMXTHR,GMXFFF,GMXFS,
     *ETWO3)
      WRITE(IDBG,*) ' AFTER SIX'
C
C   ZERO OUT THE COLLECTION ARRAY
C
      ISZ=IMEM4*9
      CALL ZERO(GMXFIR,ISZ)
      ISZ=IMEM4*18
      CALL ZERO(GMXSEC,ISZ)
      ISZ=IMEM4*27
      CALL ZERO(GMXFF,ISZ)
      ISZ=IMEM4*30
      CALL ZERO(GMXTHR,ISZ)
      ISZ=IMEM4*27
      CALL ZERO(GMXFFF,ISZ)
      ISZ=IMEM4*108
      CALL ZERO(GMXFS,ISZ)
      CALL ZERO(ETWO1,N3N)
      CALL ZERO(ETWO2,I2N3N)
      CALL ZERO(ETWO3,I3N3N)
      ISZ=NUMIJ*ITOTDG*NTYPES
      CALL ZERO(DM123,ISZ)
C
C%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
C%%%GO OVER THE SYMMETRY DISTICNT ATOMS II,JJ%%%
C%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
C
      WRITE(IDBG,*) ' BEFORE LOOP 9000'
      DO 9000 II=2,NS
        INFNS=NF(II)
        X1=X(II)
        Y1=Y(II)
        Z1=Z(II)
        CALL IARRY(II,IDER,IIDER,IIIDER)
C
        DO 8000 JJ=1,II
          EQUAL1=II.EQ.JJ
          JNFNS=NF(JJ)
          X2=X(JJ)
          Y2=Y(JJ)
          Z2=Z(JJ)
          X12=X1-X2
          Y12=Y1-Y2
          Z12=Z1-Z2
          AB2=X12*X12 + Y12*Y12 + Z12*Z12
          CALL IARRY(JJ,JDER,JJDER,JJJDER)
          CALL IJARRY(II,JJ,IDER,JDER,IJDER,IIJDER,IJJDER)
C
C##########################################################
C###GO OVER THE NUMBER OF FUNCTIONS ON THE CENTERS II,JJ###
C##########################################################
C
C   INFNS= NO. ON II      JNFNS= NO. ON JJ
C
          DO 7000 I=1,INFNS
            ISHELL=NSHELL(II,I)
            IORB1=NFIRST(II,I)
            NUMI=NMEM(ISHELL)
            IQN=LMNP1(ISHELL)
            MAXI=NTU(ISHELL)
            MINI=NTL(ISHELL)
            JNFNMX=JNFNS
            IF(EQUAL1) JNFNMX=I
            DO 6000 J=1,JNFNMX
              JSHELL=NSHELL(JJ,J)
              BOTH1=ISHELL.EQ.JSHELL
              IF(JSHELL .GT. ISHELL) GO TO 6000
              JORB1=NFIRST(JJ,J)
              NUMJ=NMEM(JSHELL)
              JQN=LMNP1(JSHELL)
              MAXJ=NTU(JSHELL)
              MINJ=NTL(JSHELL)
C
C   PREPARE THE INDICES DO THE PAIRS OF ORBITALS
C   ON CENTERS II AND JJ
C
              IJNUM=0
              DO 102 IR=MINI,MAXI
                NX=IX(IR)
                NY=IY(IR)
                NZ=IZ(IR)
                IF(BOTH1) MAXJ=IR
                DO 101 JR=MINJ,MAXJ
                  IJNUM=IJNUM + 1
                  IJX(IJNUM)=NX+JX(JR)
                  IJY(IJNUM)=NY+JY(JR)
                  IJZ(IJNUM)=NZ+JZ(JR)
  101           CONTINUE
  102         CONTINUE
C
C%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
C%%%GO OVER THE SYMMETRY DISTICNT ATOMS KK,LL%%%
C%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
C
      DO 5000 KK=1,II
        EQUAL3=KK.EQ.JJ
        EQUAL5=KK.EQ.II
        KNFNS=NF(KK)
        X3=X(KK)
        Y3=Y(KK)
        Z3=Z(KK)
        CALL IARRY(KK,KDER,KKDER,KKKDER)
        CALL IJARRY(II,KK,IDER,KDER,IKDER,IIKDER,IKKDER)
        IF(EQUAL3) GO TO 201
        IF(KK .GT. JJ) THEN
          CALL IJARRY(KK,JJ,KDER,JDER,JKDER,JKKDER,JJKDER)
          CALL IJKARY(II,KK,JJ,IJKDER)
        ELSE
          CALL IJARRY(JJ,KK,JDER,KDER,JKDER,JJKDER,JKKDER)
          CALL IJKARY(II,JJ,KK,IJKDER)
        END IF
  201   CONTINUE
C
        DO 4000 LL=1,KK
          EQUAL2=KK.EQ.LL
          EQUAL4=JJ.EQ.LL
          IF(EQUAL1 .AND. EQUAL2) THEN
c7-14-88    IF(II .EQ. KK) GO TO 2000
            IF(II .EQ. KK) GO TO 3995
          END IF
          LNFNS=NF(LL)
          X4=X(LL)
          Y4=Y(LL)
          Z4=Z(LL)
          X34=X3-X4
          Y34=Y3-Y4
          Z34=Z3-Z4
          CD2=X34*X34 + Y34*Y34 + Z34*Z34
          CALL IARRY(LL,LDER,LLDER,LLLDER)
          CALL IJARRY(KK,LL,KDER,LDER,KLDER,KKLDER,KLLDER)
          CALL IJARRY(II,LL,IDER,LDER,ILDER,IILDER,ILLDER)
          CALL IJKARY(II,KK,LL,IKLDER)
          IF(EQUAL4) GO TO 202
          IF(LL .GT. JJ) THEN
            CALL IJARRY(LL,JJ,LDER,JDER,JLDER,JLLDER,JJLDER)
            CALL IJKARY(II,LL,JJ,IJLDER)
            CALL IJKARY(KK,LL,JJ,JKLDER)
          ELSE
            CALL IJARRY(JJ,LL,JDER,LDER,JLDER,JJLDER,JLLDER)
            CALL IJKARY(II,JJ,LL,IJLDER)
            IF(KK .GT. JJ) THEN
              CALL IJKARY(KK,JJ,LL,JKLDER)
            ELSE
              CALL IJKARY(JJ,KK,LL,JKLDER)
            END IF
          END IF
  202     CONTINUE
C
C##########################################################
C###GO OVER THE NUMBER OF FUNCTIONS ON THE CENTERS KK,LL###
C##########################################################
C   KNFNS= NO. ON KK      LNFNS= NO. ON LL
C
          DO 3000 K=1,KNFNS
            KSHELL=NSHELL(KK,K)
            IF(KSHELL .GT. ISHELL) GO TO 3000
            KORB1=NFIRST(KK,K)
            NUMK=NMEM(KSHELL)
            KQN=LMNP1(KSHELL)
            MAXK=NTU(KSHELL)
            MINK=NTL(KSHELL)
            LNFNMX=LNFNS
            IF(EQUAL2) LNFNMX=K
            DO 2000 L=1,LNFNMX
              LSHELL=NSHELL(LL,L)
              BOTH2=KSHELL.EQ.LSHELL
              IF(LSHELL .GT. KSHELL) GO TO 2000
              LORB1=NFIRST(LL,L)
              NUML=NMEM(LSHELL)
              LQN=LMNP1(LSHELL)
              MAXL=NTU(LSHELL)
              MINL=NTL(LSHELL)
C
C   PREPARE THE INDICES DO THE PAIRS OF ORBITALS
C   OVER CENTERS KK AND LL
C
              KLNUM=0
              DO 104 IR=MINK,MAXK
                NX=IX(IR)
                NY=IY(IR)
                NZ=IZ(IR)
                IF(BOTH2) MAXL=IR
                DO 103 JR=MINL,MAXL
                  KLNUM=KLNUM + 1
                  KLX(KLNUM)=NX+JX(JR)
                  KLY(KLNUM)=NY+JY(JR)
                  KLZ(KLNUM)=NZ+JZ(JR)
  103           CONTINUE
  104         CONTINUE
C
C   TEST IF THE ENTIRE SHELL CAN BE IGNORED
C
              ISKIP=0
              CALL AODEN(BOTH1,BOTH2,ISKIP)
C             IF(ISKIP .EQ. 0) GO TO 2000
C
C   GO OVER THE CONTRACTION FUNCS ON ALL CENTERS
C
      IGU=NCON(ISHELL)
      JGU=NCON(JSHELL)
      KGU=NCON(KSHELL)
      LGU=NCON(LSHELL)
C
C:::::::::::::::::::::::::::::::::::::::
C:::GO OVER THE PRIMITIVES, IG AND JG:::
C:::::::::::::::::::::::::::::::::::::::
      DO 500 IG=1,IGU
        AA=ZET(ISHELL,IG)
        CCA=ETA(ISHELL,IG)
        PAAX=AA*X1
        PAAY=AA*Y1
        PAAZ=AA*Z1
        JGUMX=JGU
        IF(BOTH1) JGUMX=IG
        DO 400 JG=1,JGUMX
          FACT=1.0D0
          IF(BOTH1 .AND. IG .NE. JG) FACT=2.0D0
          BB=ZET(JSHELL,JG)
          CCB=ETA(JSHELL,JG)
          PBBX=BB*X2
          PBBY=BB*Y2
          PBBZ=BB*Z2
          P=AA + BB
          RECIPP=1.0D0/P
          PX=(PAAX + PBBX)*RECIPP
          PY=(PAAY + PBBY)*RECIPP
          PZ=(PAAZ + PBBZ)*RECIPP
          IF(EQUAL1) THEN
            PAX=0.0D0
            PAY=0.0D0
            PAZ=0.0D0
            PBX=0.0D0
            PBY=0.0D0
            PBZ=0.0D0
            GO TO 203
          END IF
          PAX=PX - X1
          PBX=PX - X2
          PAY=PY - Y1
          PBY=PY - Y2
          PAZ=PZ - Z1
          PBZ=PZ - Z2
  203     CONTINUE
          DUM1=AA*BB*RECIPP*AB2
C
C   SKIP THE ENTIRE SET OF E COEFFS IF THE INTEGRAL WILL BE IGNORED
C
          IF(DUM1 .GT. TOL(2)) GO TO 400
C
          KAB=DEXP(-DUM1)
          DUMMY=KAB*CCA*CCB*FACT*PIFAC*RECIPP
C
C   CALCULATE THE E ARRAYS
C
          IQNMX=MAX0(IQN+3,JQN+3)
          CALL ECAL(PAX,PAY,PAZ,PBX,PBY,PBZ,P,DUMMY,IQNMX,0)
C
C:::::::::::::::::::::::::::::::::::::::
C:::GO OVER THE PRIMITIVES, KG AND LG:::
C:::::::::::::::::::::::::::::::::::::::
          DO 300 KG=1,KGU
            CC=ZET(KSHELL,KG)
            CCC=ETA(KSHELL,KG)
            QCCX=CC*X3
            QCCY=CC*Y3
            QCCZ=CC*Z3
            LGUMX=LGU
            IF(BOTH2) LGUMX=KG
            DO 200 LG=1,LGUMX
              FACT=1.0D0
              IF(BOTH2 .AND. KG .NE. LG) FACT=2.0D0
              DD=ZET(LSHELL,LG)
              CCD=ETA(LSHELL,LG)
              QDDX=DD*X4
              QDDY=DD*Y4
              QDDZ=DD*Z4
              Q=CC + DD
              RECIPQ=1.0D0/Q
              QX=(QCCX + QDDX)*RECIPQ
              QY=(QCCY + QDDY)*RECIPQ
              QZ=(QCCZ + QDDZ)*RECIPQ
              IF(EQUAL2) THEN
                QAX=0.0D0
                QAY=0.0D0
                QAZ=0.0D0
                QBX=0.0D0
                QBY=0.0D0
                QBZ=0.0D0
                GO TO 204
              END IF
              QAX=QX - X3
              QBX=QX - X4
              QAY=QY - Y3
              QBY=QY - Y4
              QAZ=QZ - Z3
              QBZ=QZ - Z4
  204         CONTINUE
              DUM2=CC*DD*RECIPQ*CD2
C
C   SKIP THE ENTIRE SET OF E COEFFS IF THE INTEGRAL WILL BE IGNORED
C
              IF(DUM2 .GT. TOL(2)) GO TO 200
              DUM12=DUM1 + DUM2
              IF(DUM12 .GT. TOL(2)) GO TO 200
C
              KAB=DEXP(-DUM2)
              DUMMY=KAB*CCC*CCD*FACT*PIFAC*RECIPQ
C
C   CALCULATE THE E ARRAYS
C
              IQNMX=MAX0(KQN+3,LQN+3)
              CALL ECAL(QAX,QAY,QAZ,QBX,QBY,QBZ,Q,DUMMY,IQNMX,1)
C
C   INFORMATION FOR GCAL
C
              ALPHA=(P*Q)/(P+Q)
              QPX=QX-PX
              QPY=QY-PY
              QPZ=QZ-PZ
              W=ALPHA*(QPX*QPX + QPY*QPY + QPZ*QPZ)
              MAX=IQN + JQN + KQN + LQN - 3
              NROOTS=(MAX-1)/2 + 1
              PQ=DSQRT(P + Q)
              CALL GCAL(ALPHA,W,QPX,QPY,QPZ,MAX,PQ,NROOTS)
C
C   SUM UP CONTRIBUTIONS
C
              DO 105 IXC=1,10
                ITEST(IXC)=0
  105         CONTINUE
C
              IF(EQUAL1) THEN
                ITEST(3)=1
                ITEST(4)=1
                ITEST(5)=1
                IF(EQUAL3) THEN
                  ITEST(3)=0
                  ITEST(5)=0
                END IF
                CALL DER34(BOTH1,BOTH2,IQN,JQN,KQN,LQN,IGCNT,NROOTS,AA,
     *          BB,CC,DD,ITEST)
                GO TO 200
              END IF
              IF(EQUAL2) THEN
                ITEST(1)=1
                ITEST(2)=1
                ITEST(6)=1
                IF(EQUAL3) THEN
                  ITEST(2)=0
                  ITEST(6)=0
                END IF
                IF(EQUAL5) THEN
                  ITEST(1)=0
                  ITEST(6)=0
                END IF
              CALL DER12(BOTH1,BOTH2,IQN,JQN,KQN,LQN,IGCNT,NROOTS,AA,BB
     *        ,CC,DD,ITEST)
              GO TO 200
              END IF
              IF(EQUAL3) THEN
                ITEST(1)=1
                ITEST(4)=1
                ITEST(7)=1
                CALL DER14(BOTH1,BOTH2,IQN,JQN,KQN,LQN,IGCNT,NROOTS,AA,
     *          BB,CC,DD,ITEST)
                GO TO 200
              END IF
              IF(EQUAL4) THEN
                ITEST(1)=1
                ITEST(3)=1
                ITEST(8)=1
                CALL DER13(BOTH1,BOTH2,IQN,JQN,KQN,LQN,IGCNT,NROOTS,AA,
     *          BB,CC,DD,ITEST)
                GO TO 200
              END IF
              IF(EQUAL5) THEN
                ITEST(2)=1
                ITEST(4)=1
                ITEST(9)=1
                CALL DER24(BOTH1,BOTH2,IQN,JQN,KQN,LQN,IGCNT,NROOTS,AA,
     *          BB,CC,DD,ITEST)
                GO TO 200
              END IF
              ITEST(1)=1
              ITEST(2)=1
              ITEST(3)=1
              ITEST(6)=1
              ITEST(8)=1
              ITEST(10)=1
              CALL DER123(BOTH1,BOTH2,IQN,JQN,KQN,LQN,IGCNT,NROOTS,AA,BB
     *        ,CC,DD,ITEST)
C
  200     CONTINUE
  300     CONTINUE
C::::::::::::::::::::::::::::::::::
C:::END OF PRIMITIVES, KG AND LG:::
C::::::::::::::::::::::::::::::::::
C
  400   CONTINUE
  500 CONTINUE
C::::::::::::::::::::::::::::::::::
C:::END OF PRIMITIVES, IG AND JG:::
C::::::::::::::::::::::::::::::::::
C
      IF(EQUAL1) THEN
        CALL ONEEQU(IGCNT)
        GO TO 210
      END IF
      IF(EQUAL2) THEN
        CALL TWOEQU(IGCNT)
        GO TO 210
      END IF
      IF(EQUAL3) THEN
        CALL THREQU(IGCNT)
        GO TO 210
      END IF
      IF(EQUAL4) THEN
        CALL FOUREQ(IGCNT)
        GO TO 210
      END IF
      IF(EQUAL5) THEN
        CALL FIVEQU(IGCNT)
        GO TO 210
      END IF
      CALL ALLFOR(IGCNT)
C
  210 CONTINUE
C
 2000      CONTINUE
 3000     CONTINUE
C#########################################################
C###END OF THE NUMBER OF FUNCTIONS ON THE CENTERS KK,LL###
C#########################################################
C
c7-14-88
 3995      CONTINUE
 4000   CONTINUE
 5000 CONTINUE
C%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
C%%%END OF THE SYMMETRY DISTICNT ATOMS KK,LL%%%
C%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
C
 6000       CONTINUE
 7000     CONTINUE
C#########################################################
C###END OF THE NUMBER OF FUNCTIONS ON THE CENTERS II,JJ###
C#########################################################
C
 8000   CONTINUE
 9000 CONTINUE
C%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
C%%%END OF THE SYMMETRY DISTINCT ATOMS II,JJ%%%
C%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
C
C:::::::::::::::::
C:::FORM TAPE38:::
C:::::::::::::::::
C
C   WRITE OUT ANY LEFT OVER PART OF THE TWO E- INTS
C
      INTOT=INTOT + 1
C***********************************************************************
C   LIMITATION OF DERIVATIVE INTEGRALS
      IF(INTOT.GT.498) THEN
        WRITE(6,*) ' INTOT EXCEEDS THE LIMIT, INTOT = ',INTOT
        WRITE(6,*) ' MAXIMUM INTOT = 498 + 2'
        STOP
      END IF
C***********************************************************************
      IF(INTOT .GT. 2) THEN
        INTSV(INTOT,1)=INTSV(INTOT-1,4) + ILSEC
      ELSE
        INTSV(2,1)=3
      END IF
C
      ISIZE3=INTOWP(IUNIT*I3N3N)
      ISIZE2=INTOWP(IUNIT*I2N3N)
      ISIZE1=INTOWP(IUNIT*N3N)
      ISZLAB=IUNIT*4
C
      IF(IDRVT .EQ. 1) THEN
        INTSV(INTOT,4)=INTSV(INTOT,1) + IFSEC
      END IF
      IF(IDRVT .EQ. 2) THEN
        INTSV(INTOT,2)=INTSV(INTOT,1) + IFSEC
        INTSV(INTOT,4)=INTSV(INTOT,2) + ISSEC
      END IF
      IF(IDRVT .EQ. 3) THEN
        INTSV(INTOT,2)=INTSV(INTOT,1) + IFSEC
        INTSV(INTOT,3)=INTSV(INTOT,2) + ISSEC
        INTSV(INTOT,4)=INTSV(INTOT,3) + ITSEC
      END IF
C
      CALL SREW(ITAP38)
      ISEC1=INTSV(INTOT,1)
      CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
C
      IF(IDRVT .EQ. 2) THEN
        ISEC2=INTSV(INTOT,2)
        CALL RWRIT(ITAP38,SECDER,ISIZE2,ISEC2)
      END IF
C
      IF(IDRVT .EQ. 3) THEN
        ISEC2=INTSV(INTOT,2)
        ISEC3=INTSV(INTOT,3)
        CALL RWRIT(ITAP38,SECDER,ISIZE2,ISEC2)
        CALL RWRIT(ITAP38,THRDER,ISIZE3,ISEC3)
      END IF
C
      ISECL=INTSV(INTOT,4)
      CALL RWRIT(ITAP38,LABOUT,ISZLAB,ISECL)
C
      INTSV(1,1)=IUNIT
      INTSV(1,2)=N3N
      INTSV(1,3)=I2N3N
      INTSV(1,4)=I3N3N
      INTSV(500,1)=INTOT
      CALL RWRIT(ITAP38,INTSV,2000,1)
      CALL SREW(ITAP38)
C***NOTICE THE LIMIT OF INTOT ABOVE***
C
C:::::::::::::::::::
C:::END OF TAPE81:::
C:::::::::::::::::::
C
      INTTM1=INTOT - 1
      WRITE(IDBG,18)
      WRITE(IDBG,19)
      WRITE(IDBG,18)
      WRITE(IDBG,21)INTTM1
      WRITE(IDBG,20)
      WRITE(IDBG,22)ISIZE1
      WRITE(IDBG,26)(INTSV(IJ,1), IJ=2,INTOT)
      IF(IDRVT .EQ. 1) THEN
        WRITE(IDBG,25)ISZLAB
        WRITE(IDBG,26)(INTSV(IJ,4), IJ=2,INTOT)
      END IF
      IF(IDRVT .EQ. 2) THEN
        WRITE(IDBG,23)ISIZE2
        WRITE(IDBG,26)(INTSV(IJ,2), IJ=2,INTOT)
        WRITE(IDBG,25)ISZLAB
        WRITE(IDBG,26)(INTSV(IJ,4), IJ=2,INTOT)
      END IF
      IF(IDRVT .EQ. 3) THEN
        WRITE(IDBG,23)ISIZE2
        WRITE(IDBG,26)(INTSV(IJ,2), IJ=2,INTOT)
        WRITE(IDBG,24)ISIZE3
        WRITE(IDBG,26)(INTSV(IJ,3), IJ=2,INTOT)
        WRITE(IDBG,25)ISZLAB
        WRITE(IDBG,26)(INTSV(IJ,4), IJ=2,INTOT)
      END IF
C
      IMORE=(INTOT-2)*IUNIT + ISPOT
      IF(IPRNT.GT.3) THEN
       WRITE(IDBG,2)
       DO 110 I=1,NS
        IXZX=(I-1)*3 + 1
        WRITE(IDBG,6) ETWO1(IXZX),ETWO1(IXZX+1),ETWO1(IXZX+2)
  110 CONTINUE
       WRITE(IDBG,3)
       CALL PRINT(ETWO2,I2N3N,N3N,IOUT)
       WRITE(IOUT,11)
       CALL THROUT(ETWO3,KST,I3N3N)
      END IF
C
C########################
C###JTAPE1 INFORMATION###
C########################
C
C     WRITE(6,*) ' IPASS IN THI222'
C     WRITE(6,*)   IPASS
      CALL SREW(JTAPE1)
      IEA=INTOWP(N3N)
      IEAB=INTOWP(I2N3N)
      IEABC=INTOWP(I3N3N)
      ISZ=(N3N+I2N3N)*NUMIJ*NTYPES
      IF(IDRVF.EQ.3) THEN
        ISZ=(N3N+I2N3N+I3N3N)*NUMIJ*NTYPES
      END IF
      ITA=INTOWP(ISZ)
C     DO 160 IABC=1,N3N
C     WRITE(6,*) ' DM123 MATRIX,IABC = ',IABC
C     CALL PRINT(DM123(1,IABC),NUMIJ,NBFAO,6)
C 160 CONTINUE
C     DO 161 IABC=1,N3N
C     WRITE(6,*) ' DNTYP MATRIX,IABC = ',IABC
C     CALL PRINT(DNTYP(1,1,IABC),NUMIJ,NBFAO,6)
C 161 CONTINUE
      CALL RWRIT(JTAPE1,ETWO1,IEA,IPASS(27))
      CALL RWRIT(JTAPE1,ETWO2,IEAB,IPASS(28))
      CALL RWRIT(JTAPE1,ETWO3,IEABC,IPASS(29))
      CALL RWRIT(JTAPE1,DM123,ITA,IPASS(30))
      CALL SREW(JTAPE1)
C
C###################
C###END OF JTAPE1###
C###################
C
      RETURN
      END
      SUBROUTINE INTYPE(I,J,K,L,IX)
C
C   THIS ROUTINE FINDS THE TYPE OF INTEGRAL
C
C
      IF(I-L) 202,201,202
C   (11/11)
  201 IX=1
      GO TO 230
  202 IF(J-L) 208,203,211
  203 IF(K-L) 205,204,205
C   (21/11)=(12/11)=(11/21)=(11/12)
  204 IX=4
      GO TO 230
  205 IF(I-K) 207,206,207
C   (21/21)=(21/12)=(12/21)=(12/12)
  206 IX=5
      GO TO 230
C   (31/21)=(31/12)=(13/21)=(13/12)=(21/31)=(21/13)=(12/31)=(12/13)
  207 IX=11
      GO TO 230
  208 IF(K-L) 210,209,210
C   (31/22)=(13/22)=(22/31)=(22/13)
  209 IX=8
      GO TO 230
C   (41/32)=(41/23)=(14/32)=(14/23)=(32/41)=(32/14)=(23/41)=(23/14)
  210 IX=14
      GO TO 230
  211 IF(I-J) 212,212,217
  212 IF(I-K) 213,213,214
C   (22/21)=(22/12)=(21/22)=(12/22)
  213 IX=3
      GO TO 230
  214 IF(K-L) 215,215,216
C   (22/11)=(11/22)
  215 IX=2
      GO TO 230
C   (33/21)=(33/12)=(21/33)=(12/33)
  216 IX=6
      GO TO 230
  217 IF(I-K) 218,218,219
C   (32/31)=(32/13)=(23/31)=(23/13)=(31/32)=(31/23)=(13/32)=(13/23)
  218 IX=9
      GO TO 230
  219 IF(J-K) 220,221,222
C   (42/31)=(42/13)=(24/31)=(24/13)=(31/42)=(31/24)=(13/42)=(13/24)
  220 IX=13
      GO TO 230
C   (32/21)=(32/12)=(23/21)=(23/12)=(21/32)=(21/23)=(12/32)=(12/23)
  221 IX=10
      GO TO 230
  222 IF(K-L) 223,223,224
C   (32/11)=(23/11)=(11/32)=(11/23)
  223 IX=7
      GO TO 230
C   (43/21)=(43/12)=(34/21)=(34/12)=(21/43)=(21/34)=(12/43)=(12/34)
  224 IX=12
C
  230 CONTINUE
C
      RETURN
      END
      SUBROUTINE MKFILE(REP1,REP2,REP3
     *,                 EONE1,EONE2,EONE3
     *,                 S1LAG,S2LAG,S3LAG
     *,                 ETWO1,ETWO2,ETWO3
     *,                 EA,EAB,EABC,E2A
     *,                 B,BB,IBMAT,SX,KST)
      IMPLICIT REAL*8 (A-H,O-Z)
      DIMENSION REP1(N3N),REP2(I2N3N),REP3(I3N3N)
     *,         EONE1(N3N),EONE2(I2N3N),EONE3(I3N3N)
     *,         S1LAG(N3N),S2LAG(I2N3N),S3LAG(I3N3N)
     *,         ETWO1(N3N),ETWO2(I2N3N),ETWO3(I3N3N)
     *,         EA(N3N),EAB(I2N3N),EABC(I3N3N),E2A(N3N,N3N)
     *,         B(NUMIJ,IBMAT*NTYPES),BB(NTYPES,NUMIJ,IBMAT)
     *,         SX(NUMIJ),KST(NS,NS,NS)
      DIMENSION I30(20)
      COMMON/CALQN/ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET
      COMMON/COORD/X(50),Y(50),Z(50),CHG(50)
      COMMON/DATAS/NS,N3N,I2N3N,I3N3N,NBFAO,NUMIJ,NUMIJ2
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/IADRS/IPASS(35)
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/SIZES/INA,INAB,INABC,ISA,ISAB,ISABC
      COMMON/TAPES/ITAP30,ITAP38,ITAP42,ITAP45,ITAP46
      COMMON/WORKS/JTAPE1,JTAPE2
    1 FORMAT(3F20.10)
    2 FORMAT(/,2X,' NUCLEAR REPULSION FIRST DERIVATIVES ')
    3 FORMAT(/,2X,' NUCLEAR REPULSION SECOND DERIVATIVES ')
    4 FORMAT(/,2X,' NUCLEAR REPULSION THIRD DERIVATIVES ')
    5 FORMAT(/,2X,' ONE ELECTRON FIRST DERIVATIVE MATRIX ')
    6 FORMAT(/,2X,' ONE ELECTRON SECOND DERIVATIVE MATRIX ')
    7 FORMAT(/,2X,' ONE ELECTRON THIRD DERIVATIVE MATRIX ')
    8 FORMAT(/,2X,' TWO ELECTRON FIRST DERIVATIVE MATRIX ')
    9 FORMAT(/,2X,' TWO ELECTRON SECOND DERIVATIVE MATRIX ')
   10 FORMAT(/,2X,' TWO ELECTRON THIRD DERIVATIVE MATRIX ')
   11 FORMAT(/,2X,' OVERLAP FIRST DERIVATIVE * AO LAGRAGIAN ')
   12 FORMAT(/,2X,' OVERLAP SECOND DERIVATIVE * AO LAGRAGIAN ')
   13 FORMAT(/,2X,' OVERLAP THIRD DERIVATIVE * AO LAGRAGIAN ')
   14 FORMAT(/,2X,' TOTAL EA ')
   15 FORMAT(/,2X,' TOTAL EAB ')
   16 FORMAT(/,2X,' TOTAL EABC ')
   17 FORMAT(/,2X,' SYMMETRIZED EAB'/)
   18 FORMAT(20A4)
   19 FORMAT(I5,F20.10)
cbfy 20 FORMAT(4F20.10)
   20 FORMAT(20x,3F20.10)
C
C   START READING IN
C
C     WRITE(6,*) ' IPASS IN MKFILE'
C     WRITE(6,*)   IPASS
      CALL ARRAY(KST)
C
C:::::::::::::::::::::::::::::::::::::
C::: NUCLEAR REPULSION CONTRIBUTION:::
C:::::::::::::::::::::::::::::::::::::
C
      CALL ZERO(REP1,N3N)
      CALL ZERO(REP2,I2N3N)
      CALL ZERO(REP3,I3N3N)
      CALL SREW(JTAPE1)
      CALL RREAD(JTAPE1,REP1,INA,IPASS(12))
      CALL RREAD(JTAPE1,REP2,INAB,IPASS(13))
      CALL RREAD(JTAPE1,REP3,INABC,IPASS(14))
C
      IF(IPRNT.LT.1) GO TO 201
      WRITE(IOUT,2)
      CALL MATOUT(REP1,3,NS,3,NS,IOUT)
      WRITE(IOUT,3)
      CALL PRINT(REP2,I2N3N,N3N,IOUT)
      WRITE(IOUT,4)
      CALL THROUT(REP3,KST,I3N3N)
C
C:::::::::::::::::::::::::::::::
C:::ONE ELECTRON CONTRIBUTION:::
C:::::::::::::::::::::::::::::::
C
  201 CONTINUE
      CALL ZERO(EONE1,N3N)
      CALL ZERO(EONE2,I2N3N)
      CALL ZERO(EONE3,I3N3N)
      CALL RREAD(JTAPE1,EONE1,INA,IPASS(15))
      CALL RREAD(JTAPE1,EONE2,INAB,IPASS(16))
      CALL RREAD(JTAPE1,EONE3,INABC,IPASS(17))
C
      IF(IPRNT.LT.1) GO TO 202
      WRITE(IOUT,5)
      CALL MATOUT(EONE1,3,NS,3,NS,IOUT)
      WRITE(IOUT,6)
      CALL PRINT(EONE2,I2N3N,N3N,IOUT)
      WRITE(IOUT,7)
      CALL THROUT(EONE3,KST,I3N3N)
C
C:::::::::::::::::::::::::::::::
C:::TWO ELECTRON CONTRIBUTION:::
C:::::::::::::::::::::::::::::::
C
  202 CONTINUE
      CALL ZERO(ETWO1,N3N)
      CALL ZERO(ETWO2,I2N3N)
      CALL ZERO(ETWO3,I3N3N)
      CALL RREAD(JTAPE1,ETWO1,INA,IPASS(27))
      CALL RREAD(JTAPE1,ETWO2,INAB,IPASS(28))
      CALL RREAD(JTAPE1,ETWO3,INABC,IPASS(29))
C
      IF(IPRNT.LT.1) GO TO 203
      WRITE(IOUT,8)
      CALL MATOUT(ETWO1,3,NS,3,NS,IOUT)
      WRITE(IOUT,9)
      CALL PRINT(ETWO2,I2N3N,N3N,IOUT)
      WRITE(IOUT,10)
      CALL THROUT(ETWO3,KST,I3N3N)
C
C::::::::::::::::::::::::::
C:::OVERLAP CONTRIBUTION:::
C::::::::::::::::::::::::::
C
  203 CONTINUE
      CALL ZERO(S1LAG,N3N)
      CALL ZERO(S2LAG,I2N3N)
      CALL ZERO(S3LAG,I3N3N)
      CALL RREAD(JTAPE1,S1LAG,INA,IPASS(24))
      CALL RREAD(JTAPE1,S2LAG,INAB,IPASS(25))
      CALL RREAD(JTAPE1,S3LAG,INABC,IPASS(26))
C
      IF(IPRNT.LT.1) GO TO 204
      WRITE(IOUT,11)
      CALL MATOUT(S1LAG,3,NS,3,NS,IOUT)
      WRITE(IOUT,12)
      CALL PRINT(S2LAG,I2N3N,N3N,IOUT)
      WRITE(IOUT,13)
      CALL THROUT(S3LAG,KST,I3N3N)
C
C::::::::::::::::::::::::::::::
C:::SUM UP ALL CONTRIBUTIONS:::
C::::::::::::::::::::::::::::::
C
  204 CONTINUE
      DO 101 I=1,N3N
      EA(I)=REP1(I)+EONE1(I)+ETWO1(I)-S1LAG(I)
  101 CONTINUE
      DO 102 I=1,I2N3N
      EAB(I)=REP2(I)+EONE2(I)+ETWO2(I)-S2LAG(I)
  102 CONTINUE
      DO 103 I=1,I3N3N
      EABC(I)=REP3(I)+EONE3(I)+ETWO3(I)-S3LAG(I)
  103 CONTINUE
      DO 104 I=1,N3N
      DO 104 J=1,N3N
      IJ=IOFF(MAX0(I,J))+MIN0(I,J)
      E2A(I,J)=EAB(IJ)
  104 CONTINUE
C
C***  IF(IPRNT.LT.1) GO TO 205
      WRITE(IOUT,14)
      CALL MATOUT(EA,3,NS,3,NS,IOUT)
      WRITE(IOUT,15)
      CALL PRINT(EAB,I2N3N,N3N,IOUT)
      WRITE(IOUT,16)
      CALL THROUT(EABC,KST,I3N3N)
      WRITE(IOUT,17)
      CALL MATOUT(E2A,N3N,N3N,N3N,N3N,IOUT)
C
  205 CONTINUE
      NTREAD=NTYPES
C
C::::::::::::::::::::::::::::
C:::FORM TAPE42 AND TAPE45:::
C::::::::::::::::::::::::::::
C
      CALL RFILE(ITAP42)
      CALL RFILE(ITAP45)
      CALL SWRIT(ITAP42,EA,INA)
      CALL SWRIT(ITAP42,E2A,N3N*N3N*2)
C
C   OVERLAP DERIVATIVE INTEGRALS
      CALL RREAD(JTAPE1,B,ISA,IPASS(18))
      DO 105 IABC=1,N3N
      CALL SWRIT(ITAP42,B(1,IABC),NUMIJ2)
  105 CONTINUE
      CALL RREAD(JTAPE1,B,ISAB,IPASS(19))
      DO 106 IABC=1,I2N3N
      CALL SWRIT(ITAP45,B(1,IABC),NUMIJ2)
  106 CONTINUE
C*    IF(IDRVF.EQ.3) THEN
C*    CALL RREAD(JTAPE1,B,ISABC,IPASS(20))
C*    DO 107 IABC=1,I3N3N
C*    CALL SWRIT(ITAP45,B(1,IABC),NUMIJ2)
C*107 CONTINUE
C*    END IF
C
C   ONE ELECTRON DERIVATIVE INTEGRALS
      CALL RREAD(JTAPE1,B,ISA,IPASS(21))
      DO 108 IABC=1,N3N
      CALL SWRIT(ITAP42,B(1,IABC),NUMIJ2)
  108 CONTINUE
      CALL RREAD(JTAPE1,B,ISAB,IPASS(22))
      DO 109 IABC=1,I2N3N
      CALL SWRIT(ITAP45,B(1,IABC),NUMIJ2)
  109 CONTINUE
C*    IF(IDRVF.EQ.3) THEN
C*    CALL RREAD(JTAPE1,B,ISABC,IPASS(23))
C*    DO 110 IABC=1,I3N3N
C*    CALL SWRIT(ITAP45,B(1,IABC),NUMIJ2)
C*110 CONTINUE
C*    END IF
C
C   TWO ELECTRON DERIVATIVE INTEGRALS
      ISIZ2=IBMAT*NUMIJ2*NTYPES
      IF(ISTYPE.NE.1) GO TO 206
C
C   CLOSED SHELL CASE
      CALL RREAD(JTAPE1,B,ISIZ2,IPASS(30))
      DO 111 IABC=1,N3N
C*    WRITE(6,*) ' IABC = ',IABC
C*    CALL PRINT(B(1,IABC),NUMIJ,NBFAO,IOUT)
      CALL SWRIT(ITAP42,B(1,IABC),NUMIJ2)
  111 CONTINUE
      DO 112 IABC=1,I2N3N
      IXYZ=IABC+N3N
      CALL SWRIT(ITAP45,B(1,IXYZ),NUMIJ2)
  112 CONTINUE
C*    DO 113 IABC=1,I3N3N
C*    IXYZ=IABC+N3N+I2N3N
C*    CALL SWRIT(ITAP45,B(1,IXYZ),NUMIJ2)
C*113 CONTINUE
      GO TO 210
C
C   GENERAL OPEN-SHELL AND TCSCF
  206 CONTINUE
      CALL RREAD(JTAPE1,BB,ISIZ2,IPASS(30))
      DO 125 ITYP=1,NTREAD
C
      DO 116 IABC=1,N3N
      DO 115 I=1,NUMIJ
  115 SX(I)=BB(ITYP,I,IABC)
C*    WRITE(6,*) ' ITYP = ',ITYP,' IABC = ',IABC
C*    CALL PRINT(SX,NUMIJ,NBFAO,IOUT)
      CALL SWRIT(ITAP42,SX,NUMIJ2)
  116 CONTINUE
      DO 118 IABC=1,I2N3N
      IXYZ=IABC+N3N
      DO 117 I=1,NUMIJ
  117 SX(I)=BB(ITYP,I,IXYZ)
      CALL SWRIT(ITAP45,SX,NUMIJ2)
  118 CONTINUE
C*    DO 120 IABC=1,I3N3N
C*    IXYZ=IABC+N3N+I2N3N
C*    DO 119 I=1,NUMIJ
C*119 SX(I)=BB(ITYP,I,IXYZ)
C*    CALL SWRIT(ITAP45,SX,NUMIJ2)
C*120 CONTINUE
C
  125 CONTINUE
C
C:::::::::::::::::
C:::FORM TAPE46:::
C:::::::::::::::::
C
  210 CONTINUE
      CALL RFILE(ITAP46)
      CALL SWRIT(ITAP46,EABC,INABC)
C
C:::::::::::::::::
C:::FORM TAPE11:::
C:::::::::::::::::
C
      ITAP11=11
cbfy
c     REWIND ITAP11
c     READ(ITAP11,18) (I30(I),I=1,20)
c     READ(ITAP11,19) NATOM,ESCF
c     DO 130 I=1,NATOM
c     READ(ITAP11,20) CHG(I),X(I),Y(I),Z(I)
c 130 CONTINUE
c     REWIND ITAP11
c     WRITE(ITAP11,18) (I30(I),I=1,20)
c     WRITE(ITAP11,19) NATOM,ESCF
c     DO 131 I=1,NATOM
c     WRITE(ITAP11,20) CHG(I),X(I),Y(I),Z(I)
c 131 CONTINUE
cbfy
      DO 132 I=1,NS
      II=(I-1)*3
      WRITE(ITAP11,20)        EA(II+1),EA(II+2),EA(II+3)
  132 CONTINUE
      REWIND ITAP11
C
      CALL SREW(ITAP42)
      CALL SREW(ITAP45)
      CALL SREW(ITAP46)
      CALL SREW(JTAPE1)
      RETURN
      END
      SUBROUTINE NUCATT(GTT,GUU,GVV)
      IMPLICIT REAL*8 (A-H,O-Z)
      LOGICAL EFGRAD,SECOND,THIRD
      DIMENSION GT(10),GU(10),GV(10)
      DIMENSION GTT(LARGL2,NS,LARGL),GUU(LARGL2,NS,LARGL)
     *,         GVV(LARGL2,NS,LARGL)
      COMMON/COORD/X(50),Y(50),Z(50),CHG(50)
      COMMON/IPAR1/NS,N3N,I2N3,I3N3N
      COMMON/IPAR5/IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL
      COMMON/ROOT /WS,U(9),W(9),NROOTS
      COMMON/TOLER/TOL(10)
C
      RETURN
C
      ENTRY VCALCU(PX,PY,PZ,P,IQN,JQN,ITEST)
C
C  ITEST = 0 ........ NORMAL NUCLEAR ATTRACTION
C  ITEST = 1 ........ USED DO ELECTRIC FIELD GRADIENT CALCULATION
C                     AND IN NUCLEAR ATTRACTION DERIVATIVE
      EFGRAD=ITEST.EQ.1
      SECOND=ITEST.EQ.2
      THIRD=ITEST.EQ.3
C
C   SUM OVER ALL NUCLEAR CENTRES
C
      NROOTS=(IQN + JQN -2)/2 + 1
      IF(EFGRAD) NROOTS=NROOTS + 1
      IF(SECOND) NROOTS=NROOTS + 2
      IF(THIRD)  NROOTS=NROOTS + 3
      MAX=IQN + JQN - 1
      IF(EFGRAD) MAX=MAX + 1
      IF(SECOND) MAX=MAX + 2
      IF(THIRD)  MAX=MAX + 3
C
C
      DO 500 IC=1,NS
        ZNUC=-CHG(IC)
        CX=X(IC)
        CY=Y(IC)
        CZ=Z(IC)
        BT=CX-PX
        BU=CY-PY
        BV=CZ-PZ
        IF(ABS(BT) .LT. TOL(3)) BT=0.0D0
        IF(ABS(BU) .LT. TOL(3)) BU=0.0D0
        IF(ABS(BV) .LT. TOL(3)) BV=0.0D0
        CP2=BT*BT + BU*BU + BV*BV
        WS=P*CP2
        IF(NROOTS .LE. 3) CALL RT123
        IF(NROOTS .EQ. 4) CALL ROOT4
        IF(NROOTS .EQ. 5) CALL ROOT5
        IF(NROOTS .GE. 6) CALL DROOT
        GU(1)=1.0D0
        GV(1)=1.0D0
        DO 400 IROOT=1,NROOTS
          ROOT2=U(IROOT)/(1+U(IROOT))
          A2=P*ROOT2
          GT(1)=W(IROOT)*ZNUC
          GT(2)= 2.0D0*BT*A2*W(IROOT)*ZNUC
          GU(2)= 2.0D0*BU*A2
          GV(2)= 2.0D0*BV*A2
          MAXM1=MAX-1
c7-14-88      IF(MAXM1 .LT. 2) GO TO 300
          IF(MAXM1 .LT. 2) GO TO 305
          A2X2=2.0D0*A2
          DO 300 I=2,MAXM1
            GT(I+1)=A2X2*(BT*GT(I) - (I-1)*GT(I-1))
            GU(I+1)=A2X2*(BU*GU(I) - (I-1)*GU(I-1))
            GV(I+1)=A2X2*(BV*GV(I) - (I-1)*GV(I-1))
  300     CONTINUE
c7-14-88  300     CONTINUE
  305     CONTINUE
C
          DO 200 I=1,MAX
            GTT(I,IC,IROOT)= GT(I)
            GUU(I,IC,IROOT)= GU(I)
            GVV(I,IC,IROOT)= GV(I)
  200     CONTINUE
C
  400   CONTINUE
C
  500 CONTINUE
C
      RETURN
      END
C**********************************************************************
C   THIR DERIVATIVE PROGRAM PART 6 : "TRLIN3"                         *
C**********************************************************************
C
C**********************************************************************
C*   NOTICE OF PROGRAM MODIFICATION                                   *
C**********************************************************************
C*  BY:  RICHARD REMINGTON                         search:  c7-14-88  *
C*  DATE:  July  14,   1988                                           *
C*  REASON: Migration to run in 7Mb on 9370                           *
C**********************************************************************
C                                                                     *
C   LAST UPDATED             : JANUARY   23, 1987 BY YUKIO YAMAGUCHI  *
C                                                                     *
C   LAST UPDATED             : NOVEMBER  26, 1985 BY YUKIO YAMAGUCHI  *
C                                                                     *
C   LAST MODIFIED FOR IBM ON : DECEMBER  18, 1984 BY JFG              *
C                                                                     *
C**********************************************************************
C                                                                     *
C   TWO ELECTRON 3RD DERIVATIVE PROGRAM : TRANSLATIONAL INVARIANCE    *
C                                                                     *
C                                                                     *
C                                 WRITES TO TAPE 38                   *
C                                   INTSV,FIRDER,                     *
C                                       LABLES                        *
C                                                                     *
C                                 WRITES TO TAPE 22                   *
C                                        DM123                        *
C                                                                     *
C######################################################################
      SUBROUTINE ONE(SECDER,LABOUT,IUNIT,IUNIT4,INTSV,ETWO1,ETWO2
     *,FIRDER,GMXFIR,GMXSEC,GMXFF,LO,DAO,THRDER,GMXTHR,GMXFFF,GMXFS
     *,ETWO3)
      IMPLICIT REAL*8 (A-H,O-Z)
      LOGICAL EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      DIMENSION SECDER(I2N3N,IUNIT),LABOUT(IUNIT4)
      DIMENSION INTSV(500,4),ETWO1(N3N),ETWO2(I2N3N),FIRDER(N3N,IUNIT)
      DIMENSION GMXFIR(IMEM4,3,3),GMXSEC(IMEM4,6,3),GMXFF(IMEM4,9,3)
      DIMENSION LO(IMEM4*5),DAO(IMEM4)
      DIMENSION THRDER(I3N3N,IUNIT),GMXTHR(IMEM4,10,3),GMXFFF(IMEM4,27),
     *          GMXFS(IMEM4,18,6),ETWO3(I3N3N)
      COMMON/CENTS/IDER(3),JDER(3),KDER(3),LDER(3),IIDER(6)
     *,            JJDER(6),KKDER(6),LLDER(6),IJDER(9),IKDER(9)
     *,            ILDER(9),JKDER(9),JLDER(9),KLDER(9)
      COMMON/CENT3/IIIDER(10),JJJDER(10),KKKDER(10),LLLDER(10)
     *,            IIJDER(18),IJJDER(18),IIKDER(18),IKKDER(18)
     *,            IILDER(18),ILLDER(18),JJKDER(18),JKKDER(18)
     *,            JJLDER(18),JLLDER(18),KKLDER(18),KLLDER(18)
     *,            IJKDER(27),IJLDER(27),JKLDER(27),IKLDER(27)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/KEEPS/IDRVT,IDRVF
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/LOGIC/EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      COMMON/NINFO/INTOT,ISPOT,IFSEC,ISSEC,ITSEC,ILSEC
      COMMON/NARRY/N2II(6,2),N2IK(9),N2KI(9),N2IK2(9,3),N3III(10,3)
      COMMON/NARR2/N3IIK(18,4),N3IKK(18,3),N3IJK(27,6),N3JKK(18,2)
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/TAPES/ITAP30,ITAP38,ITAP42,ITAP45,ITAP46
      COMMON/TOLER/TOL(10)
C
      CUTOFF=TOL(5)
C
      RETURN
C
      ENTRY ONEEQU(ISTOP)
C
      DO 1000 ICNT=1,ISTOP
C
        ISPOT=ISPOT + 1
        IF(ISPOT .GT. IUNIT) THEN
          INTOT=INTOT + 1
          IF(INTOT.GT.498) THEN
            WRITE(6,*) ' INTOT EXCEEDS 498 IN ONE',INTOT
            WRITE(6,*) ' MAXIMU INTOT = 498 + 2'
            STOP
          END IF
          IF(INTOT .GT. 2) THEN
            INTSV(INTOT,1)=INTSV(INTOT-1,4) + ILSEC
          ELSE
            INTSV(INTOT,1)=3
          END IF
          IF(IDRVT .EQ. 1) THEN
            INTSV(INTOT,4)=INTSV(INTOT,1) + IFSEC
          END IF
          IF(IDRVT .EQ. 2) THEN
            INTSV(INTOT,2)=INTSV(INTOT,1) + IFSEC
            INTSV(INTOT,4)=INTSV(INTOT,2) + ISSEC
          END IF
          IF(IDRVT .EQ. 3) THEN
            INTSV(INTOT,2)=INTSV(INTOT,1) + IFSEC
            INTSV(INTOT,3)=INTSV(INTOT,2) + ISSEC
            INTSV(INTOT,4)=INTSV(INTOT,3) + ITSEC
          END IF
C
          ISIZE1=INTOWP(IUNIT*N3N)
          ISIZE2=INTOWP(IUNIT*I2N3N)
          ISIZE3=INTOWP(IUNIT*I3N3N)
          ISIZEL=IUNIT*4
          ISEC1=INTSV(INTOT,1)
          ISEC2=INTSV(INTOT,2)
          ISEC3=INTSV(INTOT,3)
          ISECL=INTSV(INTOT,4)
          INTSV(499,1)=ISIZE1
          INTSV(499,2)=ISIZE2
          INTSV(499,3)=ISIZE3
          INTSV(499,4)=ISIZEL
C
C:::::::::::::::::
C:::FORM TAPE38:::
C:::::::::::::::::
C
          CALL SREW(ITAP38)
          IF(IDRVT .EQ. 1) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
          END IF
          IF(IDRVT .EQ. 2) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
            CALL RWRIT(ITAP38,SECDER,ISIZE2,ISEC2)
          END IF
          IF(IDRVT .EQ. 3) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
            CALL RWRIT(ITAP38,SECDER,ISIZE2,ISEC2)
            CALL RWRIT(ITAP38,THRDER,ISIZE3,ISEC3)
          END IF
C
          CALL RWRIT(ITAP38,LABOUT,ISIZEL,ISECL)
          ISZ=IUNIT*N3N
          CALL ZERO(FIRDER,ISZ)
          IF(IDRVT .EQ. 2) THEN
            ISZ=IUNIT*I2N3N
            CALL ZERO(SECDER,ISZ)
          END IF
          IF(IDRVT .EQ. 3) THEN
            ISZ=IUNIT*I3N3N
            CALL ZERO(THRDER,ISZ)
          END IF
          ISPOT=1
        END IF
C
        ICNT1=(ICNT-1)*5 + 1
        ITYPE=LO(ICNT1)
        I=LO(ICNT1+1)
        J=LO(ICNT1+2)
        K=LO(ICNT1+3)
        L=LO(ICNT1+4)
        IJKL=(ISPOT-1)*4 + 1
        LABOUT(IJKL)=I
        LABOUT(IJKL+1)=J
        LABOUT(IJKL+2)=K
        LABOUT(IJKL+3)=L
        DD=DAO(ICNT)
C
        IF(EQUAL3) GO TO 250
        IF(EQUAL2) GO TO 150
C
C   FIRST DERIVATIVE
C
C   II.EQ.JJ .NE. KK .NE. LL     3 CENTER INTEGRAL
C
        DO 100 ICRD=1,3
          FIR1=GMXFIR(ICNT,ICRD,1)
          FIR2=GMXFIR(ICNT,ICRD,2)
          FIR12= -FIR1 - FIR2
          FIRDER(KDER(ICRD),ISPOT)= FIR1
          FIRDER(LDER(ICRD),ISPOT)= FIR2
          FIRDER(IDER(ICRD),ISPOT)= FIR12
          GMXFIR(ICNT,ICRD,1)= 0.0D0
          GMXFIR(ICNT,ICRD,2)= 0.0D0
          IF(ABS(FIR1) .GT. CUTOFF) THEN
            CALL DAMULT(FIR1,I,J,K,L,ITYPE,KDER(ICRD),1)
            ETWO1(KDER(ICRD))=ETWO1(KDER(ICRD)) + FIR1*DD
          END IF
          IF(ABS(FIR2) .GT. CUTOFF) THEN
            CALL DAMULT(FIR2,I,J,K,L,ITYPE,LDER(ICRD),1)
            ETWO1(LDER(ICRD))=ETWO1(LDER(ICRD)) + FIR2*DD
          END IF
          IF(ABS(FIR12) .GT. CUTOFF) THEN
            CALL DAMULT(FIR12,I,J,K,L,ITYPE,IDER(ICRD),1)
            ETWO1(IDER(ICRD))=ETWO1(IDER(ICRD)) + FIR12*DD
          END IF
  100   CONTINUE
        GO TO 350
  150   CONTINUE
C
C   II.EQ.JJ .NE. KK.EQ.LL               2 CENTER INTEGRAL
C
        DO 200 ICRD=1,3
          FIR1=GMXFIR(ICNT,ICRD,1)
          FIR2=GMXFIR(ICNT,ICRD,2)
          FIR12=FIR1 + FIR2
          FIRDER(KDER(ICRD),ISPOT)= FIR12
          FIRDER(IDER(ICRD),ISPOT)= -FIR12
          GMXFIR(ICNT,ICRD,1)= 0.0D0
          GMXFIR(ICNT,ICRD,2)= 0.0D0
          IF(ABS(FIR12) .GT. CUTOFF) THEN
            CALL DAMULT(FIR12,I,J,K,L,ITYPE,KDER(ICRD),1)
            ETWO1(KDER(ICRD))=ETWO1(KDER(ICRD)) + FIR12*DD
            CALL DAMULT(-FIR12,I,J,K,L,ITYPE,IDER(ICRD),1)
            ETWO1(IDER(ICRD))=ETWO1(IDER(ICRD)) - FIR12*DD
          END IF
  200   CONTINUE
        GO TO 450
  250   CONTINUE
C
C   II.EQ.JJ.EQ.KK .NE. LL      2 CENTER INTEGRAL
C
        DO 300 ICRD=1,3
          FIR=GMXFIR(ICNT,ICRD,1)
          FIRDER(LDER(ICRD),ISPOT)= FIR
          FIRDER(IDER(ICRD),ISPOT)= -FIR
          GMXFIR(ICNT,ICRD,1)= 0.0D0
          IF(ABS(FIR) .GT. CUTOFF) THEN
            CALL DAMULT(FIR,I,J,K,L,ITYPE,LDER(ICRD),1)
            ETWO1(LDER(ICRD))=ETWO1(LDER(ICRD)) + FIR*DD
            CALL DAMULT(-FIR,I,J,K,L,ITYPE,IDER(ICRD),1)
            ETWO1(IDER(ICRD))=ETWO1(IDER(ICRD)) - FIR*DD
          END IF
  300   CONTINUE
        GO TO 550
C
C   SECOND DERIVATIVES
C
C   II.EQ.JJ .NE. KK .NE. LL                3 CENTER INTEGRAL
C
  350   CONTINUE
        DO 400 ICRD=1,9
          IF(ICRD .LE. 6) THEN
            SEC1=GMXSEC(ICNT,ICRD,1)
            SEC2=GMXSEC(ICNT,ICRD,2)
            SEC3=GMXFF(ICNT,N2II(ICRD,1),1)
            SEC4=GMXFF(ICNT,N2II(ICRD,2),1)
C           SECDER(KKDER(ICRD),ISPOT)= SEC1
C           SECDER(LLDER(ICRD),ISPOT)= SEC2
            SECOND=SEC1 + SEC2 + SEC3 + SEC4
C           SECDER(IIDER(ICRD),ISPOT)= SECOND
            IF(ABS(SEC1) .GT. CUTOFF) THEN
              CALL DAMULT(SEC1,I,J,K,L,ITYPE,KKDER(ICRD),2)
              ETWO2(KKDER(ICRD))=ETWO2(KKDER(ICRD)) + SEC1*DD
            END IF
            IF(ABS(SEC2) .GT. CUTOFF) THEN
              CALL DAMULT(SEC2,I,J,K,L,ITYPE,LLDER(ICRD),2)
              ETWO2(LLDER(ICRD))=ETWO2(LLDER(ICRD)) + SEC2*DD
            END IF
            IF(ABS(SECOND) .GT. CUTOFF) THEN
              CALL DAMULT(SECOND,I,J,K,L,ITYPE,IIDER(ICRD),2)
              ETWO2(IIDER(ICRD))=ETWO2(IIDER(ICRD)) + SECOND*DD
            END IF
          END IF
          SEC1=GMXSEC(ICNT,N2IK(ICRD),1)
          SEC2=GMXSEC(ICNT,N2IK(ICRD),2)
          SEC3=GMXFF(ICNT,N2KI(ICRD),1)
          SEC4=GMXFF(ICNT,ICRD,1)
          SEC13= - SEC1 - SEC3
          SEC24= - SEC2 - SEC4
C         SECDER(IKDER(ICRD),ISPOT)= SEC13
C         SECDER(ILDER(ICRD),ISPOT)= SEC24
C         SECDER(KLDER(ICRD),ISPOT)= SEC4
          IF(ABS(SEC13) .GT. CUTOFF) THEN
            CALL DAMULT(SEC13,I,J,K,L,ITYPE,IKDER(ICRD),2)
            ETWO2(IKDER(ICRD))=ETWO2(IKDER(ICRD)) + SEC13*DD
          END IF
          IF(ABS(SEC24) .GT. CUTOFF) THEN
            CALL DAMULT(SEC24,I,J,K,L,ITYPE,ILDER(ICRD),2)
            ETWO2(ILDER(ICRD))=ETWO2(ILDER(ICRD)) + SEC24*DD
          END IF
          IF(ABS(SEC4) .GT. CUTOFF) THEN
            CALL DAMULT(SEC4,I,J,K,L,ITYPE,KLDER(ICRD),2)
            ETWO2(KLDER(ICRD))=ETWO2(KLDER(ICRD)) + SEC4*DD
          END IF
  400   CONTINUE
        DO 410 ICRD=1,9
          GMXFF(ICNT,ICRD,1)= 0.0D0
          IF(ICRD .LE. 6) THEN
            GMXSEC(ICNT,ICRD,1)= 0.0D0
            GMXSEC(ICNT,ICRD,2)= 0.0D0
          END IF
  410   CONTINUE
        GO TO 650
  450   CONTINUE
C
C   II.EQ.JJ .NE. KK.EQ.LL               2 CENTER INTEGRAL
C
        DO 500 ICRD=1,6
          N1POS=N2II(ICRD,1)
          N2POS=N2II(ICRD,2)
          SEC1=GMXSEC(ICNT,ICRD,1)
          SEC2=GMXSEC(ICNT,ICRD,2)
          SEC3=GMXFF(ICNT,N1POS,1)
          SEC4=GMXFF(ICNT,N2POS,1)
          SECOND=SEC1 + SEC2 + SEC3 + SEC4
C         SECDER(KKDER(ICRD),ISPOT)= SECOND
C         SECDER(IIDER(ICRD),ISPOT)= SECOND
C         SECDER(IKDER(N1POS),ISPOT)= -SECOND
C         IF(N1POS .NE. N2POS) SECDER(IKDER(N2POS),ISPOT)= -SECOND
          IF(ABS(SECOND) .GT. CUTOFF) THEN
            CALL DAMULT(SECOND,I,J,K,L,ITYPE,KKDER(ICRD),2)
            ETWO2(KKDER(ICRD))=ETWO2(KKDER(ICRD)) + SECOND*DD
            CALL DAMULT(SECOND,I,J,K,L,ITYPE,IIDER(ICRD),2)
            ETWO2(IIDER(ICRD))=ETWO2(IIDER(ICRD)) + SECOND*DD
            CALL DAMULT(-SECOND,I,J,K,L,ITYPE,IKDER(N1POS),2)
            ETWO2(IKDER(N1POS))=ETWO2(IKDER(N1POS)) - SECOND*DD
            IF(N1POS .NE. N2POS) THEN
              CALL DAMULT(-SECOND,I,J,K,L,ITYPE,IKDER(N2POS),2)
              ETWO2(IKDER(N2POS))=ETWO2(IKDER(N2POS)) - SECOND*DD
            END IF
           END IF
  500   CONTINUE
        DO 510 ICRD=1,9
          GMXFF(ICNT,ICRD,1)= 0.0D0
          IF(ICRD .LE. 6) THEN
            GMXSEC(ICNT,ICRD,1)= 0.0D0
            GMXSEC(ICNT,ICRD,2)= 0.0D0
          END IF
  510   CONTINUE
        GO TO 750
  550   CONTINUE
C
C   II.EQ.JJ.EQ.KK .NE. LL      2 CENTER INTEGRAL
C
        DO 600 ICRD=1,6
          N1POS=N2II(ICRD,1)
          N2POS=N2II(ICRD,2)
          SEC=GMXSEC(ICNT,ICRD,1)
C         SECDER(LLDER(ICRD),ISPOT)= SEC
C         SECDER(IIDER(ICRD),ISPOT)= SEC
C         SECDER(ILDER(N1POS),ISPOT)= -SEC
C         IF(N1POS .NE. N2POS) SECDER(ILDER(N2POS),ISPOT)= -SEC
          IF(ABS(SEC) .GT. CUTOFF) THEN
            CALL DAMULT(SEC,I,J,K,L,ITYPE,LLDER(ICRD),2)
            ETWO2(LLDER(ICRD))=ETWO2(LLDER(ICRD)) + SEC*DD
            CALL DAMULT(SEC,I,J,K,L,ITYPE,IIDER(ICRD),2)
            ETWO2(IIDER(ICRD))=ETWO2(IIDER(ICRD)) + SEC*DD
            CALL DAMULT(-SEC,I,J,K,L,ITYPE,ILDER(N1POS),2)
            ETWO2(ILDER(N1POS))=ETWO2(ILDER(N1POS)) - SEC*DD
            IF(N1POS .NE. N2POS) THEN
              CALL DAMULT(-SEC,I,J,K,L,ITYPE,ILDER(N2POS),2)
              ETWO2(ILDER(N2POS))=ETWO2(ILDER(N2POS)) - SEC*DD
            END IF
          END IF
  600   CONTINUE
        DO 610 ICRD=1,6
          GMXSEC(ICNT,ICRD,1)= 0.0D0
  610   CONTINUE
        GO TO 850
C
C   THIRD DERIVATIVE
C
C   II.EQ.JJ .NE. KK .NE. LL     3 CENTER INTEGRAL
C
  650   CONTINUE
        DO 700 ICRD=1,27
          IF(ICRD .LE. 10) THEN
            THR1=GMXTHR(ICNT,ICRD,1)
            THR2=GMXTHR(ICNT,ICRD,2)
            N1POS=N3III(ICRD,1)
            N2POS=N3III(ICRD,2)
            N3POS=N3III(ICRD,3)
            THR3=GMXFS(ICNT,N1POS,1)
            THR4=GMXFS(ICNT,N2POS,1)
            THR5=GMXFS(ICNT,N3POS,1)
            THR6=GMXFS(ICNT,N1POS,2)
            THR7=GMXFS(ICNT,N2POS,2)
            THR8=GMXFS(ICNT,N3POS,2)
            THIRD=-THR1-THR2-THR3-THR4-THR5-THR6-THR7-THR8
C           THRDER(ISPOT,KKKDER(ICRD))=THR1
C           THRDER(ISPOT,LLLDER(ICRD))=THR2
C           THRDER(ISPOT,IIIDER(ICRD))=THIRD
            IF(ABS(THR1) .GT. CUTOFF) THEN
C             CALL DAMULT(THR1,I,J,K,L,ITYPE,KKKDER(ICRD),3)
              ETWO3(KKKDER(ICRD))=ETWO3(KKKDER(ICRD)) + THR1*DD
            END IF
            IF(ABS(THR2) .GT. CUTOFF) THEN
C             CALL DAMULT(THR2,I,J,K,L,ITYPE,LLLDER(ICRD),3)
              ETWO3(LLLDER(ICRD))=ETWO3(LLLDER(ICRD)) + THR2*DD
            END IF
            IF(ABS(THIRD) .GT. CUTOFF) THEN
C             CALL DAMULT(THIRD,I,J,K,L,ITYPE,IIIDER(ICRD),3)
              ETWO3(IIIDER(ICRD))=ETWO3(IIIDER(ICRD)) + THIRD*DD
            END IF
          END IF
C
          IF(ICRD .LE. 18) THEN
            N1POS=N3IIK(ICRD,1)
            THR1=GMXTHR(ICNT,N1POS,1)
            THR2=GMXTHR(ICNT,N1POS,2)
            THR3=GMXFS(ICNT,ICRD,1)
            THR4=GMXFS(ICNT,ICRD,2)
            THR13=-THR1-THR3
            THR24=-THR2-THR4
C           THRDER(ISPOT,IKKDER(ICRD))=THR13
C           THRDER(ISPOT,ILLDER(ICRD))=THR24
C           THRDER(ISPOT,KKLDER(ICRD))=THR3
C           THRDER(ISPOT,KLLDER(ICRD))=THR4
            IF(ABS(THR13) .GT. CUTOFF) THEN
C             CALL DAMULT(THR13,I,J,K,L,ITYPE,IKKDER(ICRD),3)
              ETWO3(IKKDER(ICRD))=ETWO3(IKKDER(ICRD)) + THR13*DD
            END IF
            IF(ABS(THR24) .GT. CUTOFF) THEN
C             CALL DAMULT(THR24,I,J,K,L,ITYPE,ILLDER(ICRD),3)
              ETWO3(ILLDER(ICRD))=ETWO3(ILLDER(ICRD)) + THR24*DD
            END IF
            IF(ABS(THR3) .GT. CUTOFF) THEN
C             CALL DAMULT(THIRD,I,J,K,L,ITYPE,KKLDER(ICRD),3)
              ETWO3(KKLDER(ICRD))=ETWO3(KKLDER(ICRD)) + THR3*DD
            END IF
            IF(ABS(THR4) .GT. CUTOFF) THEN
C             CALL DAMULT(THIRD,I,J,K,L,ITYPE,KLLDER(ICRD),3)
              ETWO3(KLLDER(ICRD))=ETWO3(KLLDER(ICRD)) + THR4*DD
            END IF
C
            N3POS=N3JKK(ICRD,1)
            N4POS=N3JKK(ICRD,2)
            THR3=GMXFS(ICNT,ICRD,1)
            THR4=GMXFS(ICNT,ICRD,2)
            THR5=GMXFS(ICNT,N3POS,1)
            THR6=GMXFS(ICNT,N3POS,2)
            THR7=GMXFS(ICNT,N4POS,1)
            THR8=GMXFS(ICNT,N4POS,2)
            THRIIK=THR1 + THR4 + THR5 + THR7
            THRIIL=THR2 + THR3 + THR6 + THR8
C           THRDER(ISPOT,IIKDER(ICRD))=THRIIK
C           THRDER(ISPOT,IILDER(ICRD))=THRIIL
            IF(ABS(THRIIK) .GT. CUTOFF) THEN
C             CALL DAMULT(THRIIK,I,J,K,L,ITYPE,IIKDER(ICRD),3)
              ETWO3(IIKDER(ICRD))=ETWO3(IIKDER(ICRD)) + THRIIK*DD
            END IF
            IF(ABS(THRIIL) .GT. CUTOFF) THEN
C             CALL DAMULT(THRIIL,I,J,K,L,ITYPE,IILDER(ICRD),3)
              ETWO3(IILDER(ICRD))=ETWO3(IILDER(ICRD)) + THRIIL*DD
            END IF
          END IF
C
          N1POS=N3IJK(ICRD,5)
          N2POS=N3IJK(ICRD,6)
          THR1=GMXFS(ICNT,N1POS,1)
          THR2=GMXFS(ICNT,N2POS,2)
          THR12=-THR1-THR2
C         THRDER(ISPOT,IKLDER(ICRD))=THR12
          IF(ABS(THR12) .GT. CUTOFF) THEN
C           CALL DAMULT(THR12,I,J,K,L,ITYPE,IKLDER(ICRD),3)
            ETWO3(IKLDER(ICRD))=ETWO3(IKLDER(ICRD)) + THR12*DD
          END IF
C
  700   CONTINUE
        DO 710 ICRD=1,18
          IF(ICRD .LE. 10) THEN
            GMXTHR(ICNT,ICRD,1)=0.0D0
            GMXTHR(ICNT,ICRD,2)=0.0D0
          END IF
          GMXFS(ICNT,ICRD,1)=0.0D0
          GMXFS(ICNT,ICRD,2)=0.0D0
  710   CONTINUE
        GO TO 950
C
C   II.EQ.JJ .NE. KK.EQ.LL               2 CENTER INTEGRAL
C
  750   CONTINUE
        DO 800 ICRD=1,10
          N1POS=N3III(ICRD,1)
          N2POS=N3III(ICRD,2)
          N3POS=N3III(ICRD,3)
          THR1=GMXTHR(ICNT,ICRD,1)
          THR2=GMXTHR(ICNT,ICRD,2)
          THR3=GMXFS(ICNT,N1POS,1)
          THR4=GMXFS(ICNT,N2POS,1)
          THR5=GMXFS(ICNT,N3POS,1)
          THR6=GMXFS(ICNT,N1POS,2)
          THR7=GMXFS(ICNT,N2POS,2)
          THR8=GMXFS(ICNT,N3POS,2)
          THIRD=THR1+THR2+THR3+THR4+THR5+THR6+THR7+THR8
C         THRDER(ISPOT,KKKDER(ICRD))= THIRD
C         THRDER(ISPOT,IIIDER(ICRD))=-THIRD
C         THRDER(ISPOT,IKKDER(N1POS))=-THIRD
C         THRDER(ISPOT,IIKDER(N1POS))= THIRD
C         IF(N3POS .NE. N1POS) THEN
C           THRDER(ISPOT,IKKDER(N3POS))= -THIRD
C           THRDER(ISPOT,IIKDER(N3POS))= THIRD
C           IF(N2POS .NE. N1POS) THEN
C             THRDER(ISPOT,IKKDER(N2POS))=-THIRD
C             THRDER(ISPOT,IIKDER(N2POS))= THIRD
C           END IF
C         END IF
          IF(ABS(THIRD) .GT. CUTOFF) THEN
C           CALL DAMULT(THIRD,I,J,K,L,ITYPE,KKKDER(ICRD),3)
            ETWO3(KKKDER(ICRD))=ETWO3(KKKDER(ICRD)) + THIRD*DD
C           CALL DAMULT(-THIRD,I,J,K,L,ITYPE,IIIDER(ICRD),3)
            ETWO3(IIIDER(ICRD))=ETWO3(IIIDER(ICRD)) - THIRD*DD
C           CALL DAMULT(-THIRD,I,J,K,L,ITYPE,IKKDER(N1POS),3)
            ETWO3(IKKDER(N1POS))=ETWO3(IKKDER(N1POS)) - THIRD*DD
C           CALL DAMULT(THIRD,I,J,K,L,ITYPE,IIKDER(N1POS),3)
            ETWO3(IIKDER(N1POS))=ETWO3(IIKDER(N1POS)) + THIRD*DD
            IF(N3POS .NE. N1POS) THEN
C             CALL DAMULT(-THIRD,I,J,K,L,ITYPE,IKKDER(N3POS),3)
              ETWO3(IKKDER(N3POS))=ETWO3(IKKDER(N3POS)) -THIRD*DD
C             CALL DAMULT(THIRD,I,J,K,L,ITYPE,IIKDER(N3POS),3)
              ETWO3(IIKDER(N3POS))=ETWO3(IIKDER(N3POS)) +THIRD*DD
              IF(N2POS .NE. N1POS) THEN
C               CALL DAMULT(-THIRD,I,J,K,L,ITYPE,IKKDER(N2POS),3)
                ETWO3(IKKDER(N2POS))=ETWO3(IKKDER(N2POS)) -THIRD*DD
C               CALL DAMULT(THIRD,I,J,K,L,ITYPE,IIKDER(N2POS),3)
                ETWO3(IIKDER(N2POS))=ETWO3(IIKDER(N2POS)) +THIRD*DD
              END IF
            END IF
          END IF
  800   CONTINUE
C
        DO 810 ICRD=1,18
          GMXFS(ICNT,ICRD,1)=0.0D0
          GMXFS(ICNT,ICRD,2)=0.0D0
          IF(ICRD .LE. 10) THEN
            GMXTHR(ICNT,ICRD,1)=0.0D0
            GMXTHR(ICNT,ICRD,2)=0.0D0
          END IF
  810   CONTINUE
        GO TO 950
C
C   II.EQ.JJ.EQ.KK .NE. LL      2 CENTER INTEGRAL
C
  850   CONTINUE
        DO 900 ICRD=1,10
          THR1=GMXTHR(ICNT,ICRD,1)
          N1POS=N3III(ICRD,1)
          N2POS=N3III(ICRD,2)
          N3POS=N3III(ICRD,3)
C         THRDER(ISPOT,LLLDER(ICRD))=THR1
C         THRDER(ISPOT,IIIDER(ICRD))=-THR1
C         THRDER(ISPOT,ILLDER(N1POS))=-THR1
C         THRDER(ISPOT,IILDER(N1POS))= THR1
C         IF(N3POS .NE. N1POS) THEN
C           THRDER(ISPOT,ILLDER(N3POS))=-THR1
C           THRDER(ISPOT,IILDER(N3POS))= THR1
C           IF(N2POS .NE. N1POS) THEN
C             THRDER(ISPOT,ILLDER(N2POS))=-THR1
C             THRDER(ISPOT,IILDER(N2POS))= THR1
C           END IF
C         END IF
          IF(ABS(THR1) .GT. CUTOFF) THEN
C           CALL DAMULT(THR1,I,J,K,L,ITYPE,LLLDER(ICRD),3)
            ETWO3(LLLDER(ICRD))=ETWO3(LLLDER(ICRD)) + THR1*DD
C           CALL DAMULT(-THR1,I,J,K,L,ITYPE,IIIDER(ICRD),3)
            ETWO3(IIIDER(ICRD))=ETWO3(IIIDER(ICRD)) - THR1*DD
C           CALL DAMULT(-THR1,I,J,K,L,ITYPE,ILLDER(N1POS),3)
            ETWO3(ILLDER(N1POS))=ETWO3(ILLDER(N1POS)) - THR1*DD
C           CALL DAMULT(THR1,I,J,K,L,ITYPE,IILDER(N1POS),3)
            ETWO3(IILDER(N1POS))=ETWO3(IILDER(N1POS)) + THR1*DD
            IF(N3POS .NE. N1POS) THEN
C             CALL DAMULT(-THR1,I,J,K,L,ITYPE,ILLDER(N3POS),3)
              ETWO3(ILLDER(N3POS))=ETWO3(ILLDER(N3POS)) - THR1*DD
C             CALL DAMULT(THR1,I,J,K,L,ITYPE,IILDER(N3POS),3)
              ETWO3(IILDER(N3POS))=ETWO3(IILDER(N3POS)) + THR1*DD
              IF(N2POS .NE. N1POS) THEN
C               CALL DAMULT(-THR1,I,J,K,L,ITYPE,ILLDER(N2POS),3)
                ETWO3(ILLDER(N2POS))=ETWO3(ILLDER(N2POS)) - THR1*DD
C               CALL DAMULT(THR1,I,J,K,L,ITYPE,IILDER(N2POS),3)
                ETWO3(IILDER(N2POS))=ETWO3(IILDER(N2POS)) + THR1*DD
              END IF
            END IF
          END IF
          GMXTHR(ICNT,ICRD,1)=0.0D0
  900   CONTINUE
C
  950   CONTINUE
C
 1000 CONTINUE
C
      RETURN
      END
      SUBROUTINE RCALCU(GT,GU,GV)
      IMPLICIT REAL*8 (A-H,O-Z)
      DIMENSION GT(I4LARL,I2LARL),GU(I4LARL,I2LARL)
      DIMENSION GV(I4LARL,I2LARL)
      COMMON/CALQN/ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET
      COMMON/IPAR5/IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL
      COMMON/ROOT /WS,U(9),W(9),NROOTS
C
      RETURN
C
      ENTRY GCAL(ALPHA,WQP,BT,BU,BV,MAX,PQ,NROOT)
C
C   ZERO OUT THE R ARRAY
C
      WS=WQP
      NROOTS=NROOT + NDERIV
      MAX=MAX + NDERIV
      DO 105 I=1,MAX
        DO 100 J=1,NROOTS
          GT(I,J)=0.0D0
          GU(I,J)=0.0D0
          GV(I,J)=0.0D0
  100   CONTINUE
  105 CONTINUE
C
C   GET THE RYS ROOTS AND WEIGHTS
C
      IF(NROOTS .LE. 3) CALL RT123
      IF(NROOTS .EQ. 4) CALL ROOT4
      IF(NROOTS .EQ. 5) CALL ROOT5
      IF(NROOTS .GE. 6) CALL DROOT
C
C   FORM GT, GU, AND GV OVER NROOTS
C   AND SUM INTO R ARRAY
C
      DO 300 IROOT=1,NROOTS
        ROOT2=U(IROOT)/(1+U(IROOT))
        A=DSQRT(ALPHA*ROOT2)
        GT(1,IROOT)= 1.0D0*W(IROOT)/PQ
        GU(1,IROOT)= 1.0D0
        GV(1,IROOT)= 1.0D0
        GT(2,IROOT)= 2.0D0*BT*A*A*W(IROOT)/PQ
        GU(2,IROOT)= 2.0D0*BU*A*A
        GV(2,IROOT)= 2.0D0*BV*A*A
        MAXM1=MAX-1
c7-14-88    IF(MAXM1 .LT. 2) GO TO 200
        IF(MAXM1 .LT. 2) GO TO 205
        DO 200 I=2,MAXM1
          GT(I+1,IROOT)=2.0D0*A*A*(BT*GT(I,IROOT) - (I-1)*GT(I-1,IROOT))
          GU(I+1,IROOT)=2.0D0*A*A*(BU*GU(I,IROOT) - (I-1)*GU(I-1,IROOT))
          GV(I+1,IROOT)=2.0D0*A*A*(BV*GV(I,IROOT) - (I-1)*GV(I-1,IROOT))
  200   CONTINUE
c7-14-88   200   CONTINUE
  205   CONTINUE
  300 CONTINUE
C
      RETURN
      END
      SUBROUTINE RDBAS(NMEM,LMNP1,NCON,NF,NSHELL,NFIRST,ZET,ETA
     *,                MPOINT,MCONST,NCALCS)
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER TSHELL,TPRIM
      DIMENSION NMEM(TSHELL),LMNP1(TSHELL),NCON(TSHELL),NF(NS)
     *,         NSHELL(NS,TSHELL),NFIRST(NS,TSHELL)
     *,         ZET(TSHELL,TPRIM),ETA(TSHELL,TPRIM)
      DIMENSION I30(200),A30(100),IXX(300),IZET(600),ICHG(200),IETA(600)
     *,         KPRIM(200),KNUC(200),KTYPE(200),KNG(200),KLOC(200)
     *,         KMIN(200),KMAX(200),CONTR(300),GEOM(3,50),EXP(300)
     *,         ZAN(100),COEFF(100),ISAVE(100)
      COMMON/CALIF/LPARA(1024),APARA(1024)
      COMMON/CALQN/ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET
      COMMON/COORD/X(50),Y(50),Z(50),CHG(50)
      COMMON/EINFO/IPLACE(49),ISAME(49)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR3/TSHELL,TPRIM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/IPAR5/IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL
      COMMON/IPAR6/IMTOT
      COMMON/KEEPS/IDRVT,IDRVF
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/STSTP/NTU(200),NTL(200)
      COMMON/TAPES/ITAP30,ITAP38,ITAP42,ITAP45,ITAP46
      EQUIVALENCE (IXX,GEOM),(I30,A30),(IZET,EXP),(ICHG,ZAN)
     *,           (IETA,CONTR)
      DATA PI32 / 5.56832799683170D00/
    1 FORMAT(/,2X,' RUNNING A FIRST DERIVATIVE CALCULATION ',/)
    2 FORMAT(/,2X,' RUNNING A SECOND DERIVATIVE CALCULATION ',/)
    3 FORMAT(/,2X,' RUNNING A THIRD DERIVATIVE CALCULATION ',/)
    4 FORMAT(/,3X,20A4)
    5 FORMAT(20A4)
    6 FORMAT(I5,F20.10)
    7 FORMAT(4F20.10)
    8 FORMAT(//,2X,' NS     = ',I8,/,
     *          2X,' TSHELL = ',I8,/,
     *          2X,' NBFAO  = ',I8,/,
     *          2X,' NUMIJ  = ',I8,/,
     *          2X,' IOCC   = ',I8,/,
     *          2X,' KOCC   = ',I8,/,
     *          2X,' JOCC   = ',I8,/,
     *          2X,' ISTYPE = ',I8,/,
     *          2X,' ICTYPE = ',I8,/,
     *          2X,' NDERIV = ',I8,/,
     *          2X,' NTYPES = ',I8)
    9 FORMAT(   2X,' IMEM   = ',I8,/,
     *          2X,' IMEM2  = ',I8,/,
     *          2X,' IMEM4  = ',I8,/,
     *          2X,' LARGL  = ',I8,/,
     *          2X,' NUMNUM = ',I8,/,
     *          2X,' IDRVT  = ',I8,/,
     *          2X,' IDRVF  = ',I8,/,
     *          2X,' N3N    = ',I8,/,
     *          2X,' I2N3N  = ',I8,/,
     *          2X,' I3N3N  = ',I8,/,
     *          2X,' IPRNT  = ',I8)
   10 FORMAT(//,2X,' ENUC =',F20.10,/,
     *          2X,' ESCF =',F20.10,/)
   11 FORMAT(/,2X,' CHARGE AND GEOMETRY OF THE SYSTEM ',/)
   12 FORMAT(2X,F4.1,2X,3F20.10)
   13 FORMAT(/,2X,' EXPONENTS AND CONTRANCTION COEFFICIENTS',/)
   14 FORMAT(/,2X,' PRINCIPLE QUANTUM NUMBER =',I2,'     SHELL = ',I5)
   15 FORMAT(2F20.10)
C
      IF(NDERIV .EQ. 1) WRITE(IOUT,1)
      IF(NDERIV .EQ. 2) WRITE(IOUT,2)
      IF(NDERIV .EQ. 3) WRITE(IOUT,3)
      NUMIJ=IOFF(NBFAO+1)
C
C   ESTABLISH THE SIZES OF THE DERIVATIVES
C
      N3N=NS*3
      I2N3N=IOFF(N3N) + N3N
      I3N3N=0
      DO 110 I=1,N3N
        I3N3N=I3N3N + IOFF(I) + I
  110 CONTINUE
C
C   READ IN LABELS
C
      CALL SREW(ITAP30)
      JUNK=101+MCONST+MPOINT+NCALCS-1
      CALL WREADW(ITAP30,LOCCAL,1,JUNK,JUNK)
      CALL WREADW(ITAP30,I30,60,LOCCAL,LOCCAL)
      WRITE(IOUT,4) (I30(I),I=1,20)
C
C   STORE INFORMATION ON TAPE11
      ITAP11=11
      REWIND ITAP11
      WRITE(ITAP11,5) (I30(I),I=1,20)
C
C   READ IN GEOMETRY
C
      LOCCAL=LOCCAL+20
      CALL WREADW(ITAP30,IXX,INTOWP(N3N),LOCCAL,LOCCAL)
C
      DO 120 I=1,NS
        X(I)=GEOM(1,I)
        Y(I)=GEOM(2,I)
        Z(I)=GEOM(3,I)
  120 CONTINUE
C
C   READ IN THE NUCLEAR REPULSION AND SCF ENERGIES
C
      CALL WREADW(ITAP30,I30,INTOWP(10),LOCCAL,LOCCAL)
      ENUC=A30(1)
      ESCF=A30(2)
C
      JUNK=101+MCONST
      CALL WREADW(ITAP30,I30,MPOINT,JUNK,JUNK)
C
C   READ IN BASIS SET
C
      CALL WREADW(ITAP30,ICHG,INTOWP(NS),I30(1),JUNK)
      CALL WREADW(ITAP30,IZET,INTOWP(TPRIM),I30(5),JUNK)
      CALL WREADW(ITAP30,IETA,INTOWP(TPRIM*3),I30(6),JUNK)
      CALL WREADW(ITAP30,KPRIM,TSHELL,I30(7),JUNK)
      CALL WREADW(ITAP30,KNUC,TSHELL,I30(8),JUNK)
      CALL WREADW(ITAP30,KTYPE,TSHELL,I30(9),JUNK)
      CALL WREADW(ITAP30,KNG,TSHELL,I30(10),JUNK)
      CALL WREADW(ITAP30,KLOC,TSHELL,I30(11),JUNK)
      CALL WREADW(ITAP30,KMIN,TSHELL,I30(12),JUNK)
      CALL WREADW(ITAP30,KMAX,TSHELL,I30(13),JUNK)
C
      IJ=0
      DO 135 I=1,3
        DO 130 J=1,TPRIM
          IJ=IJ+1
          VALU=CONTR(IJ)
          IF(VALU .NE. 0.0) THEN
            COEFF(J)=VALU
          END IF
  130   CONTINUE
  135 CONTINUE
      DO 138 I=1,NS
        CHG(I)=ZAN(I)
  138 CONTINUE
C
      WRITE(ITAP11,6) NS,ESCF
      DO 125 I=1,NS
      WRITE(ITAP11,7) CHG(I),X(I),Y(I),Z(I)
  125 CONTINUE
cbfy  REWIND ITAP11
C
      LARGL=0
      NSHELL(1,1)=1
      NFIRST(1,1)=1
      NF(1)=1
      IMEM=NBFAO - KLOC(TSHELL) + 1
      NMEM(TSHELL)=IMEM
      DO 145 I=1,TSHELL
        ISAVE(I)=0
        NTU(I)=KMAX(I)
        NTL(I)=KMIN(I)
        LMNP1(I)=KTYPE(I)
        IF(LMNP1(I) .GT. LARGL) LARGL=LMNP1(I)
        NCON(I)=KNG(I)
        NPRIMS=KPRIM(I)
        NCNG=KNG(I)
        NPRIME=NPRIMS+NCNG-1
        K=0
        DO 140 J=NPRIMS,NPRIME
          K=K+1
          ZET(I,K)=EXP(J)
          ETA(I,K)=COEFF(J)
  140   CONTINUE
        IF(I .LE. (TSHELL-1)) THEN
          IMEM=KLOC(I+1) - KLOC(I)
          NMEM(I)=IMEM
        END IF
        IF(I .GE. 2) THEN
          IATOM=KNUC(I)
          IATMM1=KNUC(I-1)
          IF(IATOM .EQ. IATMM1) THEN
            NF(IATOM)=NF(IATOM) + 1
          ELSE
            NF(IATOM)=1
          END IF
          NSHELL(IATOM,NF(IATOM))=I
          NFIRST(IATOM,NF(IATOM))=KLOC(I)
        END IF
  145 CONTINUE
C
      ISAVE(1)=NMEM(1)
      DO 155 I=2,TSHELL
        DO 150 J=1,I-1
          IF(NMEM(I) .EQ. ISAVE(J)) GO TO 150
          IF(J .EQ. (I-1)) ISAVE(J)=NMEM(I)
  150   CONTINUE
  155 CONTINUE
      IMTOT=0
      DO 158 I=1,TSHELL
        IMTOT=IMTOT + ISAVE(I)
  158 CONTINUE
C
C   FIGURE OUT SIZE OF E MATRICES
C
      IESZ=343
C
      IMEM2=0
      IMEM4=0
      NUMNUM=0
      DO 174 II=1,NS
        INFNS=NF(II)
        DO 172 JJ=1,II
          JNFNS=NF(JJ)
          DO 170 I=1,INFNS
            ISHELL=NSHELL(II,I)
            IMEM=NMEM(ISHELL)
            JNFNMX=JNFNS
            IF(II .EQ. JJ) JNFNMX=I
            DO 168 J=1,JNFNMX
              JSHELL=NSHELL(JJ,J)
              JMEM=NMEM(JSHELL)
              IJMEM=IMEM*JMEM
              IF(ISHELL .EQ. JSHELL) IJMEM=IOFF(IMEM) + IMEM
              IF(IJMEM .GT. IMEM2) IMEM2=IJMEM
              IF(II .EQ. 1) GO TO 168
              DO 166 KK=1,II
                KNFNS=NF(KK)
                LLMAX=KK
                DO 164 LL=1,LLMAX
                  LNFNS=NF(LL)
                  LNFNMX=LNFNS
                  IF(KK.EQ.LL) THEN
                    IF(II .EQ. KK .AND. JJ .EQ. KK) GO TO 164
                  END IF
                  DO 162 K=1,KNFNS
                    KSHELL=NSHELL(KK,K)
                    IF(KSHELL .GT. ISHELL) GO TO 162
                    KMEM=NMEM(KSHELL)
                    IF(KK .EQ. LL) LNFNMX=K
                    DO 160 L=1,LNFNMX
                      LSHELL=NSHELL(LL,L)
                      IF(ISHELL .EQ. KSHELL) THEN
C                       IF(LSHELL .GT. JSHELL) GO TO 160
                      END IF
                      LMEM=NMEM(LSHELL)
                      KLMEM=KMEM*LMEM
                      IF(KSHELL .EQ. LSHELL) KLMEM=IOFF(KMEM) + KMEM
                      IJKLMM=IJMEM*KLMEM
                      IF(ISHELL .EQ. KSHELL) THEN
                        IF(JSHELL .EQ. LSHELL) THEN
                          IJKLMM=(IOFF(IMEM)+IMEM)*(IOFF(JMEM)+JMEM)
                        ELSE
                          IJKLMM=(IOFF(IMEM)+IMEM)*JMEM*LMEM
                        END IF
                      END IF
                      IF(IJKLMM .GT. IMEM4) IMEM4=IJKLMM
                      NUMNUM=NUMNUM + IJKLMM
  160               CONTINUE
  162             CONTINUE
  164           CONTINUE
  166         CONTINUE
  168       CONTINUE
  170     CONTINUE
  172   CONTINUE
  174 CONTINUE
C
C   PLAY WITH CONTRACTION COEFFICIENTS
C
C   (ACTUALLY WE GET THE COEFFICIENTS*NORMALIZATION CONSTANTS FROM
C   TAPE30, BUT THEY NEED TO BE MODIFIED SO AS TO WORK WITH MY INTEGRALS
C   THEY EXTRA SQRT(PI**3/2))
C
      PIFAC=DSQRT(PI32)
      DO 185 I=1,TSHELL
        NCNG=KNG(I)
        DO 180 J=1,NCNG
          ETA(I,J)=ETA(I,J)*PIFAC
  180   CONTINUE
  185 CONTINUE
C
C   WRITE OUT THE INFORMATION GATHERED
C
      IOCC=LPARA(7)
      KOCC=LPARA(8)
      JOCC=LPARA(9)
      WRITE(IOUT,8) NS,TSHELL,NBFAO,NUMIJ,IOCC,KOCC,JOCC,
     *              ISTYPE,ICTYPE,NDERIV,NTYPES
      WRITE(IOUT,9) IMEM,IMEM2,IMEM4,LARGL,NUMNUM,IDRVT,IDRVF,
     *              N3N,I2N3N,I3N3N,IPRNT
      WRITE(IOUT,10) ENUC,ESCF
      IF(IPRNT.LE.3) GO TO 220
      WRITE(IOUT,11)
      DO 190 I=1,NS
        WRITE(IOUT,12) CHG(I),X(I),Y(I),Z(I)
  190 CONTINUE
      WRITE(IOUT,13)
      DO 210 I=1,TSHELL
        WRITE(IOUT,14) LMNP1(I),I
        NOCNG=NCON(I)
        DO 200 J=1,NOCNG
          WRITE(IOUT,15) ZET(I,J),ETA(I,J)
  200   CONTINUE
  210 CONTINUE
  220 CONTINUE
CCC   WRITE(6,*) ' NMEM'
CCC   WRITE(6,*)   NMEM
CCC   WRITE(6,*) ' LMNP1'
CCC   WRITE(6,*)   LMNP1
CCC   WRITE(6,*) ' NCON'
CCC   WRITE(6,*)   NCON
CCC   WRITE(6,*) ' NF'
CCC   WRITE(6,*)   NF
CCC   WRITE(6,*) ' NSHELL AND NFIRST'
CCC   DO 230 I=1,NS
CCC   DO 230 J=1,TSHELL
CC230 WRITE(6,*) NSHELL(I,J),NFIRST(I,J)
CCC   WRITE(6,*) ' NTU AND NTL'
CCC   DO 240 I=1,TSHELL
CC240 WRITE(6,*) NTU(I),NTL(I)
C
      CALL SREW(ITAP30)
      RETURN
      END
      SUBROUTINE RDVECS(DA,DB,DC,D1T,OCC,EIG,EAO,NBASIS)
      IMPLICIT REAL*8(A-H,O-Z)
      DIMENSION OCC(NBASIS),EIG(NBASIS),EAO(NBASIS,NBASIS)
      DIMENSION DA(NUMIJ,NTYPES),DB(NUMIJ,NTYPES),DC(NUMIJ,NTYPES)
      DIMENSION D1T(NUMIJ)
      DIMENSION ALPC(15),BETC(15),FOCC(10),NSORB(10)
      DIMENSION NSTR(10),NEND(10),MOTYP(256)
      COMMON/CALIF/LPARA(1024),APARA(1024)
      COMMON/CALQN/ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/MINFO/ALP(10,10),BET(10,10)
      COMMON/SIGNS/IOFF(256),IPRNT
    1 FORMAT(/,2X,' ALPC MATRIX ',/)
    2 FORMAT(/,2X,' BETC MATRIX ',/)
    3 FORMAT(/,2X,' ALP MATRIX ',/)
    4 FORMAT(/,2X,' BET MATRIX ',/)
    5 FORMAT(//,2X,' NO.',8X,' FOCC',6X,' NSORB',7X,' NSTR',7X,' NEND'/)
    6 FORMAT(2X,I4,3X,F10.5,7X,I5,7X,I5,7X,I5)
    7 FORMAT(/,2X,' AO-MO EIGENVECTOR, VALUES, AND OCCUPATION ',/)
    8 FORMAT(/,2X,' TOTAL DENSITY MATRIX'/)
    9 FORMAT(/,2X,' DA DENSITY MATRIX ITYPE = ',I5,/)
   10 FORMAT(/,2X,' DB DENSITY MATRIX ITYPE = ',I5,/)
   11 FORMAT(/,2X,' DC DENSITY MATRIX ITYPE = ',I5,/)
C
C   GET MORE INFORMATION FROM THE MASTER FILE
      CALL MREAD(APARA,3)
C
      DO 101 I=1,10
      NSORB(I)=LPARA(I+40)
      FOCC(I)=APARA(I+40)
  101 CONTINUE
C
      DO 102 I=1,15
      ALPC(I)=APARA(I+10)
      BETC(I)=APARA(I+25)
  102 CONTINUE
C
      IF(IPRNT.GT.2) THEN
      WRITE(IOUT,1)
      CALL PRINT(ALPC,15,NTYPES,IOUT)
      WRITE(IOUT,2)
      CALL PRINT(BETC,15,NTYPES,IOUT)
      END IF
C
C   FORM ALP AND BET MATRICES
      DO 103 I=1,NTYPES+1
      DO 103 J=1,NTYPES+1
      ALP(I,J)=0.0D+00
      BET(I,J)=0.0D+00
  103 CONTINUE
      IJ=0
      DO 104 I=1,NTYPES
      DO 104 J=1,I
      IJ=IJ+1
      ALP(I,J)= (1.0D0-ALPC(IJ))*FOCC(I)*FOCC(J)*0.5D0
      BET(I,J)=-(1.0D0-BETC(IJ))*FOCC(I)*FOCC(J)*0.25D0
      IF(I.EQ.J) GO TO 104
      ALP(J,I)=ALP(I,J)
      BET(J,I)=BET(I,J)
  104 CONTINUE
C
      WRITE(IOUT,3)
      CALL MATOUT(ALP,10,10,NTYPES+1,NTYPES+1,IOUT)
      WRITE(IOUT,4)
      CALL MATOUT(BET,10,10,NTYPES+1,NTYPES+1,IOUT)
C
C   FORM NSTR, NEND AND MOTYP ARRAYS
      NSTR(1)=1
      NEND(1)=NSORB(1)
      DO 105 ITYP=2,NTYPES+1
      NSTR(ITYP)=NEND(ITYP-1)+1
      NEND(ITYP)=NSTR(ITYP)+NSORB(ITYP)-1
  105 CONTINUE
      DO 107 ITYP=1,NTYPES+1
      DO 106 I=NSTR(ITYP),NEND(ITYP)
      MOTYP(I)=ITYP
  106 CONTINUE
  107 CONTINUE
      WRITE(IOUT,5)
      DO 108 I=1,NTYPES+1
  108 WRITE(IOUT,6) I,FOCC(I),NSORB(I),NSTR(I),NEND(I)
C
C    READ IN THE AO EIGENVECTORS, OCCUPATIONS, AND EIGENVALUES
C
      CALL MREAD(EIG,17)
      CALL MREAD(OCC,18)
      CALL MREAD(EAO,20)
      IF(IPRNT .GT. 2) THEN
        WRITE(IOUT,7)
        CALL EIGOUT(EAO,EIG,OCC,NBASIS,NBASIS,NBFAO,NBFAO,IOUT)
      END IF
C
C    FORM THE TOTAL DENSITY MATRIX
      CALL ZERO(D1T,NUMIJ)
      IJ=0
      DO 112 I=1,NBFAO
      DO 112 J=1,I
      IJ=IJ+1
      VALU=0.0D+00
      DO 111 K=1,NBASIS
      IF(OCC(K).LE.0.0D+00) GO TO 111
      VALU=VALU+EAO(I,K)*EAO(J,K)*OCC(K)
  111 CONTINUE
      D1T(IJ)=VALU
  112 CONTINUE
      IF(IPRNT.GT.2) THEN
      WRITE(IOUT,8)
      CALL PRINT(D1T,NUMIJ,NBFAO,IOUT)
      END IF
C
C   FORM SHELL DENSITY MATRICES
      IJ=0
      DO 120 I=1,NBFAO
      DO 120 J=1,I
      IJ=IJ+1
      DO 115 ITYP=1,NTYPES
      SUMA=0.0D+00
      SUMB=0.0D+00
      DO 114 KTYP=1,NTYPES
      DO 113 K=NSTR(KTYP),NEND(KTYP)
      FAC=EAO(I,K)*EAO(J,K)
      SUMA=SUMA+ALP(ITYP,KTYP)*FAC
      SUMB=SUMB+BET(ITYP,KTYP)*FAC
  113 CONTINUE
  114 CONTINUE
      DA(IJ,ITYP)=SUMA
      DB(IJ,ITYP)=SUMB
  115 CONTINUE
  120 CONTINUE
C
      DO 125 ITYP=1,NTYPES
      IJ=0
      IST=NSTR(ITYP)
      IED=NEND(ITYP)
      DO 122 I=1,NBFAO
      DO 122 J=1,I
      IJ=IJ+1
      SUMC=0.0D+00
      DO 121 K=IST,IED
      FAC=EAO(I,K)*EAO(J,K)
      SUMC=SUMC+FAC
  121 CONTINUE
      DC(IJ,ITYP)=SUMC
  122 CONTINUE
  125 CONTINUE
C
      IF(IPRNT .GT. 2) THEN
      DO 130 ITYP=1,NTYPES
      WRITE(IOUT,9)ITYP
      CALL PRINT(DA(1,ITYP),NUMIJ,NBFAO,IOUT)
      WRITE(IOUT,10)ITYP
      CALL PRINT(DB(1,ITYP),NUMIJ,NBFAO,IOUT)
      WRITE(IOUT,11)ITYP
      CALL PRINT(DC(1,ITYP),NUMIJ,NBFAO,IOUT)
  130 CONTINUE
      END IF
C
      RETURN
      END
      SUBROUTINE REPUL(KST,REP1,REP2,REP3)
      IMPLICIT REAL*8(A-H,O-Z)
      DIMENSION KST(NS,NS,NS)
      DIMENSION REP1(N3N),REP2(I2N3N),REP3(I3N3N)
      DIMENSION IDER(3),JDER(3),IIDER(6),JJDER(6),IJDER(9)
      DIMENSION IIIDER(10),JJJDER(10),IIJDER(18),IJJDER(18)
      COMMON/CALQN/ISTYPE,ICTYPE,NDERIV,NTYPES,NBSET
      COMMON/COORD/X(50),Y(50),Z(50),CHG(50)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/IADRS/IPASS(35)
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/KEEPS/IDRVT,IDRVF
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/WORKS/JTAPE1,JTAPE2
    1 FORMAT(/,2X,' NUCLEAR REPULSION = ',F20.10)
    2 FORMAT(/,2X,' NUCLEAR REPULSION FIRST DERIVATIVES',/)
    3 FORMAT(3F20.10)
    4 FORMAT(/,2X,' NUCLEAR REPULSION SECOND DERIVATIVES',/)
    5 FORMAT(/,2X,' NUCLEAR REPULSION THIRD DERIVATIVES',/)
C
      CALL ZERO(REP1,N3N)
      CALL ZERO(REP2,I2N3N)
      CALL ZERO(REP3,I3N3N)
      CALL ARRAY(KST)
C
      REP=0.0D0
      DO 200 I=2,NS
        CALL IARRY(I,IDER,IIDER,IIIDER)
        DO 100 J=1,I-1
          CALL IARRY(J,JDER,JJDER,JJJDER)
          CALL IJARRY(I,J,IDER,JDER,IJDER,IIJDER,IJJDER)
          XAB=X(I)-X(J)
          YAB=Y(I)-Y(J)
          ZAB=Z(I)-Z(J)
          RAB=XAB*XAB + YAB*YAB + ZAB*ZAB
          CAB=CHG(I)*CHG(J)
          SQRTR=DSQRT(RAB)
          REP0=CAB/SQRTR
          REP=REP + REP0
          REP0R=REP0/RAB
          DERX=-REP0*XAB/RAB
          DERY=-REP0*YAB/RAB
          DERZ=-REP0*ZAB/RAB
          DERXX=3.0D0*DERX*XAB/RAB
          DERYY=3.0D0*DERY*YAB/RAB
          DERZZ=3.0D0*DERZ*ZAB/RAB
          DERXY=3.0D0*DERX*YAB/RAB
          DERYZ=3.0D0*DERY*ZAB/RAB
          DERXZ=3.0D0*DERX*ZAB/RAB
          DERXR=DERX/RAB
          DERYR=DERY/RAB
          DERZR=DERZ/RAB
          DERXXX=5.0D0*DERXX*XAB/RAB
          DERYYY=5.0D0*DERYY*YAB/RAB
          DERZZZ=5.0D0*DERZZ*ZAB/RAB
          DERXXY=5.0D0*DERXX*YAB/RAB
          DERXXZ=5.0D0*DERXX*ZAB/RAB
          DERYYX=5.0D0*DERYY*XAB/RAB
          DERYYZ=5.0D0*DERYY*ZAB/RAB
          DERZZX=5.0D0*DERZZ*XAB/RAB
          DERZZY=5.0D0*DERZZ*YAB/RAB
          DERXYZ=5.0D0*DERXY*ZAB/RAB
C
C   FIRST DERIVATIVES
C
          REP1(IDER(1))=REP1(IDER(1)) + DERX
          REP1(IDER(2))=REP1(IDER(2)) + DERY
          REP1(IDER(3))=REP1(IDER(3)) + DERZ
C
          REP1(JDER(1))=REP1(JDER(1)) - DERX
          REP1(JDER(2))=REP1(JDER(2)) - DERY
          REP1(JDER(3))=REP1(JDER(3)) - DERZ
C
C   SECOND DERIVATIVES
C
          REP2(IIDER(1))=REP2(IIDER(1)) - REP0R - DERXX
          REP2(IIDER(2))=REP2(IIDER(2)) - DERXY
          REP2(IIDER(3))=REP2(IIDER(3)) - REP0R - DERYY
          REP2(IIDER(4))=REP2(IIDER(4)) - DERXZ
          REP2(IIDER(5))=REP2(IIDER(5)) - DERYZ
          REP2(IIDER(6))=REP2(IIDER(6)) - REP0R- DERZZ
C
          REP2(JJDER(1))=REP2(JJDER(1)) - REP0R- DERXX
          REP2(JJDER(2))=REP2(JJDER(2)) - DERXY
          REP2(JJDER(3))=REP2(JJDER(3)) - REP0R- DERYY
          REP2(JJDER(4))=REP2(JJDER(4)) - DERXZ
          REP2(JJDER(5))=REP2(JJDER(5)) - DERYZ
          REP2(JJDER(6))=REP2(JJDER(6)) - REP0R- DERZZ
C
          REP2(IJDER(1))=REP2(IJDER(1)) + REP0R+ DERXX
          REP2(IJDER(2))=REP2(IJDER(2)) + DERXY
          REP2(IJDER(3))=REP2(IJDER(3)) + DERXZ
          REP2(IJDER(4))=REP2(IJDER(4)) + DERXY
          REP2(IJDER(5))=REP2(IJDER(5)) + REP0R+ DERYY
          REP2(IJDER(6))=REP2(IJDER(6)) + DERYZ
          REP2(IJDER(7))=REP2(IJDER(7)) + DERXZ
          REP2(IJDER(8))=REP2(IJDER(8)) + DERYZ
          REP2(IJDER(9))=REP2(IJDER(9)) + REP0R+ DERZZ
C
C   THIRD DERIVATIVES
C
          REP3(IIIDER(1))=REP3(IIIDER(1)) - 9.0D0*DERXR + DERXXX
          REP3(IIIDER(2))=REP3(IIIDER(2)) - 3.0D0*DERYR + DERXXY
          REP3(IIIDER(3))=REP3(IIIDER(3)) - 3.0D0*DERXR + DERYYX
          REP3(IIIDER(4))=REP3(IIIDER(4)) - 9.0D0*DERYR + DERYYY
          REP3(IIIDER(5))=REP3(IIIDER(5)) - 3.0D0*DERZR + DERXXZ
          REP3(IIIDER(6))=REP3(IIIDER(6)) + DERXYZ
          REP3(IIIDER(7))=REP3(IIIDER(7)) - 3.0D0*DERZR + DERYYZ
          REP3(IIIDER(8))=REP3(IIIDER(8)) - 3.0D0*DERXR + DERZZX
          REP3(IIIDER(9))=REP3(IIIDER(9)) - 3.0D0*DERYR + DERZZY
          REP3(IIIDER(10))=REP3(IIIDER(10)) - 9.0D0*DERZR + DERZZZ
C
          REP3(JJJDER(1))=REP3(JJJDER(1)) + 9.0D0*DERXR - DERXXX
          REP3(JJJDER(2))=REP3(JJJDER(2)) + 3.0D0*DERYR - DERXXY
          REP3(JJJDER(3))=REP3(JJJDER(3)) + 3.0D0*DERXR - DERYYX
          REP3(JJJDER(4))=REP3(JJJDER(4)) + 9.0D0*DERYR - DERYYY
          REP3(JJJDER(5))=REP3(JJJDER(5)) + 3.0D0*DERZR - DERXXZ
          REP3(JJJDER(6))=REP3(JJJDER(6)) - DERXYZ
          REP3(JJJDER(7))=REP3(JJJDER(7)) + 3.0D0*DERZR - DERYYZ
          REP3(JJJDER(8))=REP3(JJJDER(8)) + 3.0D0*DERXR - DERZZX
          REP3(JJJDER(9))=REP3(JJJDER(9)) + 3.0D0*DERYR - DERZZY
          REP3(JJJDER(10))=REP3(JJJDER(10)) + 9.0D0*DERZR - DERZZZ
C
          REP3(IIJDER(1))=REP3(IIJDER(1)) + 9.0D0*DERXR - DERXXX
          REP3(IIJDER(2))=REP3(IIJDER(2)) + 3.0D0*DERYR - DERXXY
          REP3(IIJDER(3))=REP3(IIJDER(3)) + 3.0D0*DERZR - DERXXZ
          REP3(IIJDER(4))=REP3(IIJDER(4)) + 3.0D0*DERYR - DERXXY
          REP3(IIJDER(5))=REP3(IIJDER(5)) + 3.0D0*DERXR - DERYYX
          REP3(IIJDER(6))=REP3(IIJDER(6)) - DERXYZ
          REP3(IIJDER(7))=REP3(IIJDER(7)) + 3.0D0*DERZR - DERXXZ
          REP3(IIJDER(8))=REP3(IIJDER(8)) - DERXYZ
          REP3(IIJDER(9))=REP3(IIJDER(9)) + 3.0D0*DERXR - DERZZX
          REP3(IIJDER(10))=REP3(IIJDER(10)) + 3.0D0*DERXR - DERYYX
          REP3(IIJDER(11))=REP3(IIJDER(11)) + 9.0D0*DERYR - DERYYY
          REP3(IIJDER(12))=REP3(IIJDER(12)) + 3.0D0*DERZR - DERYYZ
          REP3(IIJDER(13))=REP3(IIJDER(13)) - DERXYZ
          REP3(IIJDER(14))=REP3(IIJDER(14)) + 3.0D0*DERZR - DERYYZ
          REP3(IIJDER(15))=REP3(IIJDER(15)) + 3.0D0*DERYR - DERZZY
          REP3(IIJDER(16))=REP3(IIJDER(16)) + 3.0D0*DERXR - DERZZX
          REP3(IIJDER(17))=REP3(IIJDER(17)) + 3.0D0*DERYR - DERZZY
          REP3(IIJDER(18))=REP3(IIJDER(18)) + 9.0D0*DERZR - DERZZZ
C
          REP3(IJJDER(1))=REP3(IJJDER(1)) - 9.0D0*DERXR + DERXXX
          REP3(IJJDER(2))=REP3(IJJDER(2)) - 3.0D0*DERYR + DERXXY
          REP3(IJJDER(3))=REP3(IJJDER(3)) - 3.0D0*DERZR + DERXXZ
          REP3(IJJDER(4))=REP3(IJJDER(4)) - 3.0D0*DERYR + DERXXY
          REP3(IJJDER(5))=REP3(IJJDER(5)) - 3.0D0*DERXR + DERYYX
          REP3(IJJDER(6))=REP3(IJJDER(6)) + DERXYZ
          REP3(IJJDER(7))=REP3(IJJDER(7)) - 3.0D0*DERZR + DERXXZ
          REP3(IJJDER(8))=REP3(IJJDER(8)) + DERXYZ
          REP3(IJJDER(9))=REP3(IJJDER(9)) - 3.0D0*DERXR + DERZZX
          REP3(IJJDER(10))=REP3(IJJDER(10)) - 3.0D0*DERXR + DERYYX
          REP3(IJJDER(11))=REP3(IJJDER(11)) - 9.0D0*DERYR + DERYYY
          REP3(IJJDER(12))=REP3(IJJDER(12)) - 3.0D0*DERZR + DERYYZ
          REP3(IJJDER(13))=REP3(IJJDER(13)) + DERXYZ
          REP3(IJJDER(14))=REP3(IJJDER(14)) - 3.0D0*DERZR + DERYYZ
          REP3(IJJDER(15))=REP3(IJJDER(15)) - 3.0D0*DERYR + DERZZY
          REP3(IJJDER(16))=REP3(IJJDER(16)) - 3.0D0*DERXR + DERZZX
          REP3(IJJDER(17))=REP3(IJJDER(17)) - 3.0D0*DERYR + DERZZY
          REP3(IJJDER(18))=REP3(IJJDER(18)) - 9.0D0*DERZR + DERZZZ
 100    CONTINUE
 200  CONTINUE
C
      IF(IPRNT .LE. 2) GO TO 400
      WRITE(IOUT,1)REP
      WRITE(IOUT,2)
      DO 300 I=1,NS
        II=(I-1)*3 + 1
        WRITE(IOUT,3)REP1(II),REP1(II+1),REP1(II+2)
 300  CONTINUE
      WRITE(IOUT,4)
      CALL PRINT(REP2,I2N3N,N3N,IOUT)
      WRITE(IOUT,5)
      CALL THROUT(REP3,KST,I3N3N)
  400 CONTINUE
C
C########################
C###JTAPE1 INFORMATION###
C########################
C
C   SIZES OF ARRAYS TO BE WRITEN OUT
C
      INA=INTOWP(N3N)
      INAB=INTOWP(I2N3N)
      INABC=INTOWP(I3N3N)
      ISA=INTOWP(NUMIJ*N3N)
      ISAB=INTOWP(NUMIJ*I2N3N)
      ISABC=INTOWP(NUMIJ*I3N3N)
      ISZ=(N3N+I2N3N)*NUMIJ*NTYPES
      ITA=INTOWP(ISZ)
      IF(IDRVF.EQ.3) THEN
        ISZ=(N3N+I2N3N+I3N3N)*NUMIJ*NTYPES
        ITA=INTOWP(ISZ)
      END IF
C
C   SOME INTERESTING NUMBERS AND LENGTHS
C
      IPASS(1)=NS
      IPASS(2)=NUMIJ
      IPASS(3)=NBFAO
      IPASS(4)=I2N3N
      IPASS(5)=I3N3N
      IPASS(6)=INA
      IPASS(7)=INAB
      IPASS(8)=INABC
      IPASS(9)=ISA
      IPASS(10)=ISAB
      IPASS(11)=ISABC
C
C   POSITONS OF ARRAYS ON THE TAPE
C
C   NUCLEAR REPULSION DERIVATIVES
      IPASS(12)=2
      IPASS(13)=IPASS(12) + NREC(INA)
      IPASS(14)=IPASS(13) + NREC(INAB)
C   ONE ELECTRON DERIVATIVES
      IPASS(15)=IPASS(14) + NREC(INABC)
      IPASS(16)=IPASS(15) + NREC(INA)
      IPASS(17)=IPASS(16) + NREC(INAB)
C   SA , SAB , AND SABC MATRICES
      IPASS(18)=IPASS(17) + NREC(INABC)
      IPASS(19)=IPASS(18) + NREC(ISA)
      IPASS(20)=IPASS(19) + NREC(ISAB)
C   HA , HAB , AND HAB MATRICES
      IF(IDRVF.EQ.3) THEN
        IPASS(21)=IPASS(20) + NREC(ISABC)
      ELSE
        IPASS(21)=IPASS(20)
      END IF
      IPASS(22)=IPASS(21) + NREC(ISA)
      IPASS(23)=IPASS(22) + NREC(ISAB)
C   OVERLAP DERIVATIVE CONTRIBUTIONS
      IF(IDRVF.EQ.3) THEN
        IPASS(24)=IPASS(23) + NREC(ISABC)
      ELSE
        IPASS(24)=IPASS(23)
      END IF
      IPASS(25)=IPASS(24) + NREC(INA)
      IPASS(26)=IPASS(25) + NREC(INAB)
C   TWO ELECTRON DERIVATIVES
      IPASS(27)=IPASS(26) + NREC(INABC)
      IPASS(28)=IPASS(27) + NREC(INA)
      IPASS(29)=IPASS(28) + NREC(INAB)
C   TA , TAB , AND TABC MATRICES
      IPASS(30)=IPASS(29) + NREC(INABC)
      IPASS(31)=IPASS(30) + NREC(ITA)
C
CCC   WRITE(6,*) ' IPASS IN REPUL'
CCC   WRITE(6,*)   IPASS
C
C   WRITE THE ARRAYS OUT!
C
      CALL SREW(JTAPE1)
      CALL RWRIT(JTAPE1,IPASS,35,1)
      CALL RWRIT(JTAPE1,REP1,INA,IPASS(12))
      CALL RWRIT(JTAPE1,REP2,INAB,IPASS(13))
      CALL RWRIT(JTAPE1,REP3,INABC,IPASS(14))
      CALL SREW(JTAPE1)
C
C###################
C###END OF JTAPE1###
C###################
C
      RETURN
      END
      SUBROUTINE SIX(SECDER,LABOUT,IUNIT,IUNIT4,INTSV,ETWO1,ETWO2
     *,FIRDER,GMXFIR,GMXSEC,GMXFF,LO,DAO,THRDER,GMXTHR,GMXFFF,GMXFS
     *,ETWO3)
      IMPLICIT REAL*8 (A-H,O-Z)
      LOGICAL EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      DIMENSION SECDER(I2N3N,IUNIT),LABOUT(IUNIT4)
      DIMENSION INTSV(500,4),ETWO1(N3N),ETWO2(I2N3N),FIRDER(N3N,IUNIT)
      DIMENSION GMXFIR(IMEM4,3,3),GMXSEC(IMEM4,6,3),GMXFF(IMEM4,9,3)
      DIMENSION LO(IMEM4*5),DAO(IMEM4)
      DIMENSION THRDER(I3N3N,IUNIT),GMXTHR(IMEM4,10,3),GMXFFF(IMEM4,27),
     *          GMXFS(IMEM4,18,6),ETWO3(I3N3N)
      DIMENSION T2INT(6),T3INT(10)
      COMMON/CENTS/IDER(3),JDER(3),KDER(3),LDER(3),IIDER(6)
     *,            JJDER(6),KKDER(6),LLDER(6),IJDER(9),IKDER(9)
     *,            ILDER(9),JKDER(9),JLDER(9),KLDER(9)
      COMMON/CENT3/IIIDER(10),JJJDER(10),KKKDER(10),LLLDER(10)
     *,            IIJDER(18),IJJDER(18),IIKDER(18),IKKDER(18)
     *,            IILDER(18),ILLDER(18),JJKDER(18),JKKDER(18)
     *,            JJLDER(18),JLLDER(18),KKLDER(18),KLLDER(18)
     *,            IJKDER(27),IJLDER(27),JKLDER(27),IKLDER(27)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/KEEPS/IDRVT,IDRVF
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/LOGIC/EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      COMMON/NARRY/N2II(6,2),N2IK(9),N2KI(9),N2IK2(9,3),N3III(10,3)
      COMMON/NARR2/N3IIK(18,4),N3IKK(18,3),N3IJK(27,6),N3JKK(18,2)
      COMMON/NARR3/N3LLI(18,6),N3LLL(10,6),N3ABC(27,4)
      COMMON/NINFO/INTOT,ISPOT,IFSEC,ISSEC,ITSEC,ILSEC
      COMMON/PASS /II,JJ,KK,LL
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/TAPES/ITAP30,ITAP38,ITAP42,ITAP45,ITAP46
      COMMON/TOLER/TOL(10)
C
      CUTOFF=TOL(5)
C
      RETURN
C
      ENTRY ALLFOR(ISTOP)
C
C     CONTINUE
      DO 1000 ICNT=1,ISTOP
C
        ISPOT=ISPOT + 1
        IF(ISPOT .GT. IUNIT) THEN
          INTOT=INTOT + 1
        IF(INTOT.GT.498) THEN
          WRITE(6,*) ' INTOT EXCEEDS 498 IN SIX',INTOT
          WRITE(6,*) ' MAXIMUM INTOT = 498 +2'
          STOP
        END IF
          IF(INTOT .GT. 2) THEN
            INTSV(INTOT,1)=INTSV(INTOT-1,4) + ILSEC
          ELSE
            INTSV(INTOT,1)=3
          END IF
          IF(IDRVT .EQ. 1) THEN
            INTSV(INTOT,4)=INTSV(INTOT,1) + IFSEC
          END IF
          IF(IDRVT .EQ. 2) THEN
            INTSV(INTOT,2)=INTSV(INTOT,1) + IFSEC
            INTSV(INTOT,4)=INTSV(INTOT,2) + ISSEC
          END IF
          IF(IDRVT .EQ. 3) THEN
            INTSV(INTOT,2)=INTSV(INTOT,1) + IFSEC
            INTSV(INTOT,3)=INTSV(INTOT,2) + ISSEC
            INTSV(INTOT,4)=INTSV(INTOT,3) + ITSEC
          END IF
C
          ISIZE1=INTOWP(IUNIT*N3N)
          ISIZE2=INTOWP(IUNIT*I2N3N)
          ISIZE3=INTOWP(IUNIT*I3N3N)
          ISIZEL=IUNIT*4
          ISEC1=INTSV(INTOT,1)
          ISEC2=INTSV(INTOT,2)
          ISEC3=INTSV(INTOT,3)
          ISECL=INTSV(INTOT,4)
          INTSV(499,1)=ISIZE1
          INTSV(499,2)=ISIZE2
          INTSV(499,3)=ISIZE3
          INTSV(499,4)=ISIZEL
C
C:::::::::::::::::
C:::FORM TAPE38:::
C:::::::::::::::::
C
          CALL SREW(ITAP38)
          IF(IDRVT .EQ. 1) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
          END IF
          IF(IDRVT .EQ. 2) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
            CALL RWRIT(ITAP38,SECDER,ISIZE2,ISEC2)
          END IF
          IF(IDRVT .EQ. 3) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
            CALL RWRIT(ITAP38,SECDER,ISIZE2,ISEC2)
            CALL RWRIT(ITAP38,THRDER,ISIZE3,ISEC3)
          END IF
C
          CALL RWRIT(ITAP38,LABOUT,ISIZEL,ISECL)
          ISZ=IUNIT*N3N
          CALL ZERO(FIRDER,ISZ)
          IF(IDRVT .EQ. 2) THEN
            ISZ=IUNIT*I2N3N
            CALL ZERO(SECDER,ISZ)
          END IF
          IF(IDRVT .EQ. 3) THEN
            ISZ=IUNIT*I3N3N
            CALL ZERO(THRDER,ISZ)
          END IF
          ISPOT=1
        END IF
C
        ICNT1=(ICNT-1)*5 + 1
        ITYPE=LO(ICNT1)
        I=LO(ICNT1+1)
        J=LO(ICNT1+2)
        K=LO(ICNT1+3)
        L=LO(ICNT1+4)
        IJKL=(ISPOT-1)*4 + 1
        LABOUT(IJKL)=I
        LABOUT(IJKL+1)=J
        LABOUT(IJKL+2)=K
        LABOUT(IJKL+3)=L
        DD=DAO(ICNT)
C
C   FIRST DERIVATIVE
C
C   II .NE. JJ .NE. KK .NE. LL     4 CENTER INTEGRAL
C
        DO 100 ICRD=1,3
          FIR1=GMXFIR(ICNT,ICRD,1)
          FIR2=GMXFIR(ICNT,ICRD,2)
          FIR3=GMXFIR(ICNT,ICRD,3)
          FIR123= -FIR1 - FIR2 - FIR3
          FIRDER(IDER(ICRD),ISPOT)= FIR1
          FIRDER(JDER(ICRD),ISPOT)= FIR2
          FIRDER(KDER(ICRD),ISPOT)= FIR3
          FIRDER(LDER(ICRD),ISPOT)= FIR123
          GMXFIR(ICNT,ICRD,1)= 0.0D0
          GMXFIR(ICNT,ICRD,2)= 0.0D0
          GMXFIR(ICNT,ICRD,3)= 0.0D0
          IF(ABS(FIR1) .GT. CUTOFF) THEN
            CALL DAMULT(FIR1,I,J,K,L,ITYPE,IDER(ICRD),1)
            ETWO1(IDER(ICRD))=ETWO1(IDER(ICRD)) + FIR1*DD
          END IF
          IF(ABS(FIR2) .GT. CUTOFF) THEN
            CALL DAMULT(FIR2,I,J,K,L,ITYPE,JDER(ICRD),1)
            ETWO1(JDER(ICRD))=ETWO1(JDER(ICRD)) + FIR2*DD
          END IF
          IF(ABS(FIR3) .GT. CUTOFF) THEN
            CALL DAMULT(FIR3,I,J,K,L,ITYPE,KDER(ICRD),1)
            ETWO1(KDER(ICRD))=ETWO1(KDER(ICRD)) + FIR3*DD
          END IF
          IF(ABS(FIR123) .GT. CUTOFF) THEN
            CALL DAMULT(FIR123,I,J,K,L,ITYPE,LDER(ICRD),1)
            ETWO1(LDER(ICRD))=ETWO1(LDER(ICRD)) + FIR123*DD
          END IF
  100   CONTINUE
C
C   SECOND DERIVATIVES
C
C   II .NE. JJ .NE. KK .NE. LL     4 CENTER INTEGRAL
C
C
        DO 200 ICRD=1,9
          IF(ICRD .LE. 6) THEN
            N1POS=N2II(ICRD,1)
            N2POS=N2II(ICRD,2)
            SEC1=GMXSEC(ICNT,ICRD,1)
            SEC2=GMXSEC(ICNT,ICRD,2)
            SEC3=GMXSEC(ICNT,ICRD,3)
            SEC12=GMXFF(ICNT,N1POS,1) + GMXFF(ICNT,N2POS,1)
            SEC13=GMXFF(ICNT,N1POS,2) + GMXFF(ICNT,N2POS,2)
            SEC23=GMXFF(ICNT,N1POS,3) + GMXFF(ICNT,N2POS,3)
            SECOND= SEC1 + SEC2 + SEC3 + SEC12 + SEC13 + SEC23
C           SECDER(IIDER(ICRD),ISPOT)= SEC1
C           SECDER(JJDER(ICRD),ISPOT)= SEC2
C           SECDER(KKDER(ICRD),ISPOT)= SEC3
C           SECDER(LLDER(ICRD),ISPOT)= SECOND
            IF(ABS(SEC1) .GT. CUTOFF) THEN
              CALL DAMULT(SEC1,I,J,K,L,ITYPE,IIDER(ICRD),2)
              ETWO2(IIDER(ICRD))=ETWO2(IIDER(ICRD)) + SEC1*DD
            END IF
            IF(ABS(SEC2) .GT. CUTOFF) THEN
              CALL DAMULT(SEC2,I,J,K,L,ITYPE,JJDER(ICRD),2)
              ETWO2(JJDER(ICRD))=ETWO2(JJDER(ICRD)) + SEC2*DD
            END IF
            IF(ABS(SEC3) .GT. CUTOFF) THEN
              CALL DAMULT(SEC3,I,J,K,L,ITYPE,KKDER(ICRD),2)
              ETWO2(KKDER(ICRD))=ETWO2(KKDER(ICRD)) + SEC3*DD
            END IF
            IF(ABS(SECOND) .GT. CUTOFF) THEN
              CALL DAMULT(SECOND,I,J,K,L,ITYPE,LLDER(ICRD),2)
              ETWO2(LLDER(ICRD))=ETWO2(LLDER(ICRD)) + SECOND*DD
            END IF
          END IF
          N1POS=N2IK(ICRD)
          SEC1=GMXSEC(ICNT,N1POS,1)
          SEC2=GMXSEC(ICNT,N1POS,2)
          SEC3=GMXSEC(ICNT,N1POS,3)
          SEC12=GMXFF(ICNT,ICRD,1)
          SEC21=GMXFF(ICNT,N2KI(ICRD),1)
          SEC13=GMXFF(ICNT,ICRD,2)
          SEC31=GMXFF(ICNT,N2KI(ICRD),2)
          SEC23=GMXFF(ICNT,ICRD,3)
          SEC32=GMXFF(ICNT,N2KI(ICRD),3)
          SECB=SEC32
          IF(KK .GT. JJ) THEN
            SECD=SEC32
          ELSE
            SECD=SEC23
          END IF
          IF(JJ .GT. LL) THEN
            SECA=SEC23
            SECC=SEC21
          ELSE
            SECA=SEC32
            SECC=SEC12
          END IF
          SECIL=-SEC1-SEC12-SEC13
          SECJL=-SEC2-SECC-SECA
          SECKL=-SEC3-SEC31-SECB
C         SECDER(IJDER(ICRD),ISPOT)= SEC12
C         SECDER(IKDER(ICRD),ISPOT)= SEC13
C         SECDER(JKDER(ICRD),ISPOT)= SECD
C         SECDER(ILDER(ICRD),ISPOT)= SECIL
C         SECDER(JLDER(ICRD),ISPOT)= SECJL
C         SECDER(KLDER(ICRD),ISPOT)= SECKL
          IF(ABS(SEC12) .GT. CUTOFF) THEN
            CALL DAMULT(SEC12,I,J,K,L,ITYPE,IJDER(ICRD),2)
            ETWO2(IJDER(ICRD))=ETWO2(IJDER(ICRD)) + SEC12*DD
          END IF
          IF(ABS(SEC13) .GT. CUTOFF) THEN
            CALL DAMULT(SEC13,I,J,K,L,ITYPE,IKDER(ICRD),2)
            ETWO2(IKDER(ICRD))=ETWO2(IKDER(ICRD)) + SEC13*DD
          END IF
          IF(ABS(SECD) .GT. CUTOFF) THEN
            CALL DAMULT(SECD,I,J,K,L,ITYPE,JKDER(ICRD),2)
            ETWO2(JKDER(ICRD))=ETWO2(JKDER(ICRD)) + SECD*DD
          END IF
          IF(ABS(SECIL) .GT. CUTOFF) THEN
            CALL DAMULT(SECIL,I,J,K,L,ITYPE,ILDER(ICRD),2)
            ETWO2(ILDER(ICRD))=ETWO2(ILDER(ICRD)) + SECIL*DD
          END IF
          IF(ABS(SECJL) .GT. CUTOFF) THEN
            CALL DAMULT(SECJL,I,J,K,L,ITYPE,JLDER(ICRD),2)
            ETWO2(JLDER(ICRD))=ETWO2(JLDER(ICRD)) + SECJL*DD
          END IF
          IF(ABS(SECKL) .GT. CUTOFF) THEN
            CALL DAMULT(SECKL,I,J,K,L,ITYPE,KLDER(ICRD),2)
            ETWO2(KLDER(ICRD))=ETWO2(KLDER(ICRD)) + SECKL*DD
          END IF
  200   CONTINUE
        DO 210 ICRD=1,9
          GMXFF(ICNT,ICRD,1)= 0.0D0
          GMXFF(ICNT,ICRD,2)= 0.0D0
          GMXFF(ICNT,ICRD,3)= 0.0D0
          IF(ICRD .LE. 6) THEN
            GMXSEC(ICNT,ICRD,1)= 0.0D0
            GMXSEC(ICNT,ICRD,2)= 0.0D0
            GMXSEC(ICNT,ICRD,3)= 0.0D0
          END IF
  210   CONTINUE
C
C   THIRD DERIVATIVES
C
C   II .NE. JJ .NE. KK .NE. LL        4 CENTER INTEGRAL
C
        DO 300 ICRD=1,27
          IF(ICRD .LE. 10) THEN
            N1=N3III(ICRD,1)
            N2=N3III(ICRD,2)
            N3=N3III(ICRD,3)
            N4=N3LLL(ICRD,1)
            N5=N3LLL(ICRD,2)
            N6=N3LLL(ICRD,3)
            N7=N3LLL(ICRD,4)
            N8=N3LLL(ICRD,5)
            N9=N3LLL(ICRD,6)
            THR1=GMXTHR(ICNT,ICRD,1)
            THR2=GMXTHR(ICNT,ICRD,2)
            THR3=GMXTHR(ICNT,ICRD,3)
            THR12=GMXFS(ICNT,N1,1) + GMXFS(ICNT,N2,1) + GMXFS(ICNT,N3,1)
            THR21=GMXFS(ICNT,N1,2) + GMXFS(ICNT,N2,2) + GMXFS(ICNT,N3,2)
            THR13=GMXFS(ICNT,N1,3) + GMXFS(ICNT,N2,3) + GMXFS(ICNT,N3,3)
            THR31=GMXFS(ICNT,N1,4) + GMXFS(ICNT,N2,4) + GMXFS(ICNT,N3,4)
            THR23=GMXFS(ICNT,N1,5) + GMXFS(ICNT,N2,5) + GMXFS(ICNT,N3,5)
            THR32=GMXFS(ICNT,N1,6) + GMXFS(ICNT,N2,6) + GMXFS(ICNT,N3,6)
            THR123=GMXFFF(ICNT,N4) + GMXFFF(ICNT,N5) + GMXFFF(ICNT,N6)
     *        +    GMXFFF(ICNT,N7) + GMXFFF(ICNT,N8) + GMXFFF(ICNT,N9)
            THIRD=THR1 + THR2 + THR3 + THR12 + THR21 + THR13 + THR31
     *        +   THR23 + THR32 + THR123
            IF(ABS(THR1) .GT. CUTOFF) THEN
C             CALL DAMULT(THR1,I,J,K,L,ITYPE,IIIDER(ICRD),3)
              ETWO3(IIIDER(ICRD))=ETWO3(IIIDER(ICRD)) + THR1*DD
            END IF
            IF(ABS(THR2) .GT. CUTOFF) THEN
C             CALL DAMULT(THR2,I,J,K,L,ITYPE,JJJDER(ICRD),3)
              ETWO3(JJJDER(ICRD))=ETWO3(JJJDER(ICRD)) + THR2*DD
            END IF
            IF(ABS(THR3) .GT. CUTOFF) THEN
C             CALL DAMULT(THR3,I,J,K,L,ITYPE,KKKDER(ICRD),3)
              ETWO3(KKKDER(ICRD))=ETWO3(KKKDER(ICRD)) + THR3*DD
            END IF
            IF(ABS(THIRD) .GT. CUTOFF) THEN
C             CALL DAMULT(-THIRD,I,J,K,L,ITYPE,LLLDER(ICRD),3)
C             IF(LLLDER(ICRD) .NE. 6) THEN
              ETWO3(LLLDER(ICRD))=ETWO3(LLLDER(ICRD)) - THIRD*DD
C             END IF
            END IF
          END IF
C
          ITEST=1
C         IF(ITEST .EQ. 1) GO TO 546
C
          IF(ICRD .LE. 18) THEN
            N1=N3IIK(ICRD,1)
            THR112=GMXFS(ICNT,ICRD,1)
            THR221=GMXFS(ICNT,ICRD,2)
            THR113=GMXFS(ICNT,ICRD,3)
            THR331=GMXFS(ICNT,ICRD,4)
            THR223=GMXFS(ICNT,ICRD,5)
            THR332=GMXFS(ICNT,ICRD,6)
            THR114=-GMXTHR(ICNT,N1,1) - GMXFS(ICNT,ICRD,1) -
     *              GMXFS(ICNT,ICRD,3)
            THR224=-GMXTHR(ICNT,N1,2) - GMXFS(ICNT,ICRD,2) -
     *              GMXFS(ICNT,ICRD,5)
            THR334=-GMXTHR(ICNT,N1,3) - GMXFS(ICNT,ICRD,4) -
     *              GMXFS(ICNT,ICRD,6)
C           THRDER(ISPOT,IIJDER(ICRD))=THR112
C           THRDER(ISPOT,IJJDER(ICRD))=THR221
C           THRDER(ISPOT,IIKDER(ICRD))=THR113
C           THRDER(ISPOT,IKKDER(ICRD))=THR331
C           THRDER(ISPOT,JJKDER(ICRD))=THR223
C           THRDER(ISPOT,JKKDER(ICRD))=THR332
C           THRDER(ISPOT,IILDER(ICRD))=THR114
C           THRDER(ISPOT,JJLDER(ICRD))=THR224
C           THRDER(ISPOT,KKLDER(ICRD))=THR334
            IF(ABS(THR112) .GT. CUTOFF) THEN
C             CALL DAMULT(THR112,I,J,K,L,ITYPE,IIJDER(ICRD),3)
              ETWO3(IIJDER(ICRD))=ETWO3(IIJDER(ICRD)) + THR112*DD
            END IF
            IF(ABS(THR221) .GT. CUTOFF) THEN
C             CALL DAMULT(THR221,I,J,K,L,ITYPE,IJJDER(ICRD),3)
              ETWO3(IJJDER(ICRD))=ETWO3(IJJDER(ICRD)) + THR221*DD
            END IF
            IF(ABS(THR113) .GT. CUTOFF) THEN
C             CALL DAMULT(THR113,I,J,K,L,ITYPE,IIKDER(ICRD),3)
              ETWO3(IIKDER(ICRD))=ETWO3(IIKDER(ICRD)) + THR113*DD
            END IF
            IF(ABS(THR331) .GT. CUTOFF) THEN
C             CALL DAMULT(THR331,I,J,K,L,ITYPE,IKKDER(ICRD),3)
              ETWO3(IKKDER(ICRD))=ETWO3(IKKDER(ICRD)) + THR331*DD
            END IF
            IF(ABS(THR223) .GT. CUTOFF) THEN
C             CALL DAMULT(THR223,I,J,K,L,ITYPE,JJKDER(ICRD),3)
              ETWO3(JJKDER(ICRD))=ETWO3(JJKDER(ICRD)) + THR223*DD
            END IF
            IF(ABS(THR332) .GT. CUTOFF) THEN
C             CALL DAMULT(THR332,I,J,K,L,ITYPE,JKKDER(ICRD),3)
              ETWO3(JKKDER(ICRD))=ETWO3(JKKDER(ICRD)) + THR332*DD
            END IF
            IF(ABS(THR114) .GT. CUTOFF) THEN
C             CALL DAMULT(THR114,I,J,K,L,ITYPE,IILDER(ICRD),3)
              ETWO3(IILDER(ICRD))=ETWO3(IILDER(ICRD)) + THR114*DD
            END IF
            IF(ABS(THR224) .GT. CUTOFF) THEN
C             CALL DAMULT(THR224,I,J,K,L,ITYPE,JJLDER(ICRD),3)
              ETWO3(JJLDER(ICRD))=ETWO3(JJLDER(ICRD)) + THR224*DD
            END IF
            IF(ABS(THR334) .GT. CUTOFF) THEN
C             CALL DAMULT(THR334,I,J,K,L,ITYPE,KKLDER(ICRD),3)
              ETWO3(KKLDER(ICRD))=ETWO3(KKLDER(ICRD)) + THR334*DD
            END IF
C
  546       CONTINUE
C           IF(ITEST .EQ. 1) GO TO 566
C
            N1=N3IIK(ICRD,1)
            N2=ICRD
            N3=N3JKK(ICRD,1)
            N4=N3JKK(ICRD,2)
            N5=N3LLI(ICRD,1)
            N6=N3LLI(ICRD,2)
            N7=N3LLI(ICRD,5)
            N8=N3LLI(ICRD,6)
            N9=N3LLI(ICRD,3)
            N10=N3LLI(ICRD,4)
            THR144=GMXTHR(ICNT,N1,1) +
     *              GMXFS(ICNT,N3,1) + GMXFS(ICNT,N4,1) +
     *              GMXFS(ICNT,N3,3) + GMXFS(ICNT,N4,3) +
     *              GMXFS(ICNT,N2,2) + GMXFS(ICNT,N2,4) +
     *               GMXFFF(ICNT,N5) +  GMXFFF(ICNT,N6)
            THR244=GMXTHR(ICNT,N1,2) +
     *              GMXFS(ICNT,N3,2) + GMXFS(ICNT,N4,2) +
     *              GMXFS(ICNT,N3,5) + GMXFS(ICNT,N4,5) +
     *              GMXFS(ICNT,N2,1) + GMXFS(ICNT,N2,6) +
     *               GMXFFF(ICNT,N9) +  GMXFFF(ICNT,N10)
            THR344=GMXTHR(ICNT,N1,3) +
     *              GMXFS(ICNT,N3,4) + GMXFS(ICNT,N4,4) +
     *              GMXFS(ICNT,N3,6) + GMXFS(ICNT,N4,6) +
     *              GMXFS(ICNT,N2,5) + GMXFS(ICNT,N2,3) +
     *               GMXFFF(ICNT,N7) + GMXFFF(ICNT,N8)
            IF(ABS(THR144) .GT. CUTOFF) THEN
C             CALL DAMULT(THR144,I,J,K,L,ITYPE,ILLDER(ICRD),3)
              ETWO3(ILLDER(ICRD))=ETWO3(ILLDER(ICRD)) + THR144*DD
            END IF
            IF(ABS(THR244) .GT. CUTOFF) THEN
C             CALL DAMULT(THR244,I,J,K,L,ITYPE,JLLDER(ICRD),3)
              ETWO3(JLLDER(ICRD))=ETWO3(JLLDER(ICRD)) + THR244*DD
            END IF
            IF(ABS(THR344) .GT. CUTOFF) THEN
C             CALL DAMULT(THR344,I,J,K,L,ITYPE,KLLDER(ICRD),3)
              ETWO3(KLLDER(ICRD))=ETWO3(KLLDER(ICRD)) + THR344*DD
            END IF
          END IF
C
C         IF(ITEST .EQ. 1) GO TO 566
C
          IF(KK .GT. JJ) THEN
            N0=N3ABC(ICRD,1)
          ELSE
            N0=ICRD
          END IF
          IF(LL .GT. JJ) THEN
            N4=N3IJK(ICRD,3)
            N5=N3IJK(ICRD,4)
            N1=N3ABC(ICRD,1)
          ELSE
            N4=N3IJK(ICRD,1)
            N5=N3IJK(ICRD,2)
            N1=ICRD
          END IF
          N3=N3ABC(ICRD,1)
          N6=N3IJK(ICRD,1)
          N7=N3IJK(ICRD,2)
          IF(JJ .GT. KK) THEN
            N8=N3IJK(ICRD,1)
            N9=N3IJK(ICRD,2)
            N2=N3ABC(ICRD,2)
          ELSE
            IF(JJ .GT. LL) THEN
              N8=N3IJK(ICRD,2)
              N9=N3IJK(ICRD,1)
              N2=N3ABC(ICRD,3)
            ELSE
              N8=N3IJK(ICRD,4)
              N9=N3IJK(ICRD,3)
              N2=N3ABC(ICRD,4)
            END IF
          END IF
          THRABC=GMXFFF(ICNT,N0)
          THR12=GMXFS(ICNT,N4,1) + GMXFS(ICNT,N5,2)
          THR13=GMXFS(ICNT,N6,3) + GMXFS(ICNT,N7,4)
          THR23=GMXFS(ICNT,N8,5) + GMXFS(ICNT,N9,6)
          THRA=GMXFFF(ICNT,N2)
          THRB=GMXFFF(ICNT,N3)
          THRC=GMXFFF(ICNT,N1)
          THIRD1=-THR12-THRC
          THIRD2=-THR13-THRB
          THIRD3=-THR23-THRA
C         THRDER(ISPOT,IJKDER(ICRD))=THRABC
C         THRDER(ISPOT,IJLDER(ICRD))=THIRD1
C         THRDER(ISPOT,IKLDER(ICRD))=THIRD2
C         THRDER(ISPOT,JKLDER(ICRD))=THIRD3
          IF(ABS(THRABC) .GT. CUTOFF) THEN
C           CALL DAMULT(THRABC,I,J,K,L,ITYPE,IJKDER(ICRD),3)
            ETWO3(IJKDER(ICRD))=ETWO3(IJKDER(ICRD)) + THRABC*DD
          END IF
          IF(ABS(THIRD1) .GT. CUTOFF) THEN
C           CALL DAMULT(THIRD1,I,J,K,L,ITYPE,IJLDER(ICRD),3)
            ETWO3(IJLDER(ICRD))=ETWO3(IJLDER(ICRD)) + THIRD1*DD
          END IF
          IF(ABS(THIRD2) .GT. CUTOFF) THEN
C           CALL DAMULT(THIRD2,I,J,K,L,ITYPE,IKLDER(ICRD),3)
            ETWO3(IKLDER(ICRD))=ETWO3(IKLDER(ICRD)) + THIRD2*DD
          END IF
          IF(ABS(THIRD3) .GT. CUTOFF) THEN
C           CALL DAMULT(THIRD3,I,J,K,L,ITYPE,JKLDER(ICRD),3)
            ETWO3(JKLDER(ICRD))=ETWO3(JKLDER(ICRD)) + THIRD3*DD
          END IF
C
  566   CONTINUE
C
  300   CONTINUE
C
        DO 310 ICRD=1,27
          IF(ICRD .LE. 10) THEN
            GMXTHR(ICNT,ICRD,1)=0.0D0
            GMXTHR(ICNT,ICRD,2)=0.0D0
            GMXTHR(ICNT,ICRD,3)=0.0D0
          END IF
          IF(ICRD .LE. 18) THEN
            GMXFS(ICNT,ICRD,1)=0.0D0
            GMXFS(ICNT,ICRD,2)=0.0D0
            GMXFS(ICNT,ICRD,3)=0.0D0
            GMXFS(ICNT,ICRD,4)=0.0D0
            GMXFS(ICNT,ICRD,5)=0.0D0
            GMXFS(ICNT,ICRD,6)=0.0D0
          END IF
          GMXFFF(ICNT,ICRD)=0.0D0
  310   CONTINUE
C
 1000 CONTINUE
C
      RETURN
      END
      SUBROUTINE STINT(SX,SY,SZ,TX,TY,TZ,S1DERB,T1DERB,SXD,SYD,SZD,TXD
     *,                TYD,TZD,S1DER,T1DER,S2DERB,T2DERB,STWO,TTWO,S2DER
     *,                T2DER,S3DERB,T3DERB,STHRE,TTHRE,S3DER,T3DER,S3LAG
     *,                IJORB,LAG,DEN1T,EONE3,BOTH)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 LAG
      LOGICAL BOTH
      DIMENSION SX(IANGSQ),SY(IANGSQ),SZ(IANGSQ),TX(IANGSQ),TY(IANGSQ)
     *,         TZ(IANGSQ),SXD(IANGSQ),SYD(IANGSQ),SZD(IANGSQ)
     *,         TXD(IANGSQ),TYD(IANGSQ),TZD(IANGSQ)
      DIMENSION STWO(IANGSQ,3),TTWO(IANGSQ,3),S2DER(NUMIJ,6)
     *,         T2DER(NUMIJ,6),S2DERB(IMEM2,6),T2DERB(IMEM2,6)
      DIMENSION STHRE(IANGSQ,3),S3DER(NUMIJ,10),TTHRE(IANGSQ,3)
     *,         T3DER(NUMIJ,10),S3DERB(IMEM2,10),T3DERB(IMEM2,10)
      DIMENSION EONE3(I3N3N)
      DIMENSION LAG(NUMIJ),S3LAG(I3N3N)
      DIMENSION IJORB(IMEM2),S1DERB(IMEM2,3),T1DERB(IMEM2,3)
     *,         S1DER(NUMIJ,N3N),T1DER(NUMIJ,N3N),DEN1T(NUMIJ)
      COMMON/EINFO/IPLACE(49),ISAME(49)
      COMMON/EXYZS/EX(686),EY(686),EZ(686)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/FIRDR/IDER(3),JDER(3),KDER(3)
      COMMON/INDEX/IX(84),IY(84),IZ(84),JX(84),JY(84),JZ(84)
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/IPAR5/IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL
      COMMON/KEEPS/IDRVT,IDRVF
      COMMON/NARRY/N2II(6,2),N2IK(9),N2KI(9),N2IK2(9,3),N3III(10,3)
      COMMON/NARR2/N3IIK(18,4),N3IKK(18,3),N3IJK(27,6),N3JKK(18,2)
      COMMON/POSNS/IJX(50),IJY(50),IJZ(50),KLX(50),KLY(50),KLZ(50)
      COMMON/SECDR/IKDER(9),IJDER(9),JKDER(9),IIDER(6),JJDER(6)
     *,            KKDER(6)
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/STSTP/NTU(200),NTL(200)
      COMMON/SVIFO/AA,BB,AA2,BB2,PFACT,IORB1,IORBMX,JORB1,JORBMX
     *,            IQN,JQN,II,JJ
      COMMON/THRDR/IIIDER(10),JJJDER(10),KKKDER(10),IIJDER(18)
     *,            IJJDER(18),IIKDER(18),IKKDER(18),JJKDER(18)
     *,            JKKDER(18),IJKDER(27)
C
C
C%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
C%%%OVERLAP AND KINETIC ENERGY ROUTINES%%%
C%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
C
      ISIZ= 7
      ISIZ2= 14
      ISIZ3= 21
C
      RHALF=-0.5D0
      AAAA4=AA*AA*4.0D0
      AAA8=AA*AA*AA*8.0D0
      BBBB4=BB*BB*4.0D0
      BBS2=-BB*BB*2.0D0
      AABB4=AA*BB*4.0D0
      A4B2=AAAA4*BBS2
      A2B2=AA2*BBS2
      A8B2=AAA8*BBS2
C
      IN=-IANG
      IM=-ISIZ
C
      ISZ=IMEM2*3
      CALL ZERO(S1DERB,ISZ)
      CALL ZERO(T1DERB,ISZ)
      ISZ=IMEM2*6
      CALL ZERO(S2DERB,ISZ)
      CALL ZERO(T2DERB,ISZ)
      ISZ=IMEM2*10
      CALL ZERO(S3DERB,ISZ)
      CALL ZERO(T3DERB,ISZ)
C
      DO 250 INO=1,IQN
        IN=IN + IANG
        IM=IM + ISIZ
C
        DUMI=DBLE(INO-1)
        DUMISQ=DUMI*DUMI
        DM1=DBLE(INO-2)
        DSQ=DUMISQ*DM1
        D2NP1=DBLE(2*INO-1)
        A2DIDP=AA2*DUMI*(DM1 + D2NP1)
        DP1=DBLE(INO+1)
        AA4DPD=AAAA4*(D2NP1 + DP1)
        DIM1=DBLE((INO-1)*(INO-2))
        A2DI=AA2*DBLE(2*INO-1)
        B2DI=BBS2*DUMI
C
        DO 200 JNO=1,JQN
          JN=IN + JNO
          JM=IM + JNO
          DUMJM1=DBLE((JNO-1)*(JNO-2))
          DJM1H=DUMJM1*RHALF
          ADJM1H=AA2*DJM1H
          DIJM1H=DUMI*DJM1H
          BDJ2=BB*DBLE(2*JNO-1)
          A2BDJ2=AA2*BDJ2
          DIBDJ2=DUMI*BDJ2
C
          IPL=IPLACE(JM)
          IF(INO .GT. 1) THEN
            JM1M0=JM-ISIZ
            IM1M0=IPLACE(JM1M0)
            JM1P2=JM+2-ISIZ
            IM1P2=IPLACE(JM1P2)
            IF(JNO .GT. 2) THEN
              JM1M2=JM-2-ISIZ
              IM1M2=IPLACE(JM1M2)
            END IF
            IF(INO .GT. 2) THEN
              JM2M0=JM-ISIZ2
              IM2M0=IPLACE(JM2M0)
              JM2P2=JM+2-ISIZ2
              IM2P2=IPLACE(JM2P2)
              IF(JNO .GT. 2) THEN
                JM2M2=JM-2-ISIZ2
                IM2M2=IPLACE(JM2M2)
              END IF
            END IF
          END IF
          IF(JNO .GT. 2) THEN
            JM0M2=JM-2
            IM0M2=IPLACE(JM0M2)
            JP1M2=JM-2+ISIZ
            IP1M2=IPLACE(JP1M2)
            JP2M2=JM-2+ISIZ2
            IP2M2=IPLACE(JP2M2)
            JP3M2=JM-2+ISIZ3
            IP3M2=IPLACE(JP3M2)
          END IF
C
          JP0P2=JM+2
          IP0P2=IPLACE(JP0P2)
          JP1P0=JM+ISIZ
          IP1P0=IPLACE(JP1P0)
          JP2P0=JM+ISIZ2
          IP2P0=IPLACE(JP2P0)
          JP3P0=JM+ISIZ3
          IP3P0=IPLACE(JP3P0)
          JP3P2=JM+ISIZ3+2
          IP3P2=IPLACE(JP3P2)
C
          JP1P2=JM+2+ISIZ
          IP1P2=IPLACE(JP1P2)
          JP2P2=JM+2+ISIZ2
          IP2P2=IPLACE(JP2P2)
C
C   NORMAL OVERLAP INTERGALS
C
          SX(JN)=EX(IPL)
          SY(JN)=EY(IPL)
          SZ(JN)=EZ(IPL)
C
C   FIRST DERIVATIVES OF THE OVERLAP INTEGRALS
C
          SXD(JN)=AA2*EX(IP1P0)
          SYD(JN)=AA2*EY(IP1P0)
          SZD(JN)=AA2*EZ(IP1P0)
C
          IF(INO .GT. 1) THEN
            SXD(JN)=SXD(JN) - DUMI*EX(IM1M0)
            SYD(JN)=SYD(JN) - DUMI*EY(IM1M0)
            SZD(JN)=SZD(JN) - DUMI*EZ(IM1M0)
          END IF
C
C   SECOND DERIVATIVES OF THE OVERLAP INTEGERALS
C
          SXX=0.0D0
          SYY=0.0D0
          SZZ=0.0D0
C
C   DIAGONAL ELEMENTS   (DERIVATIVE ON CENTER A)
C
          SXX=SXX + AAAA4*EX(IP2P0)
          SYY=SYY + AAAA4*EY(IP2P0)
          SZZ=SZZ + AAAA4*EZ(IP2P0)
C
          IF(INO .GT. 2) THEN
            SXX=SXX + DIM1*EX(IM2M0)
            SYY=SYY + DIM1*EY(IM2M0)
            SZZ=SZZ + DIM1*EZ(IM2M0)
          END IF
C
          SXX=SXX - A2DI*EX(IPL)
          SYY=SYY - A2DI*EY(IPL)
          SZZ=SZZ - A2DI*EZ(IPL)
C
          STWO(JN,1)=SXX
          STWO(JN,2)=SYY
          STWO(JN,3)=SZZ
C
C   THIRD DERIVATIVES OF THE OVERLAP INTEGRALS (SAME COORD ONLY)
C
          SXXX=0.0D0
          SYYY=0.0D0
          SZZZ=0.0D0
C
          SXXX=SXXX + AAA8*EX(IP3P0)
          SYYY=SYYY + AAA8*EY(IP3P0)
          SZZZ=SZZZ + AAA8*EZ(IP3P0)
C
          SXXX=SXXX - AA4DPD*EX(IP1P0)
          SYYY=SYYY - AA4DPD*EY(IP1P0)
          SZZZ=SZZZ - AA4DPD*EZ(IP1P0)
C
          IF(INO .GT. 1) THEN
            SXXX=SXXX + A2DIDP*EX(IM1M0)
            SYYY=SYYY + A2DIDP*EY(IM1M0)
            SZZZ=SZZZ + A2DIDP*EZ(IM1M0)
          END IF
C
          STHRE(JN,1)=SXXX
          STHRE(JN,2)=SYYY
          STHRE(JN,3)=SZZZ
   42     CONTINUE
C
C   NORMAL KINETIC ENERGY INTEGRALS
C
          TX(JN)=EX(IP0P2)*BBS2
          TY(JN)=EY(IP0P2)*BBS2
          TZ(JN)=EZ(IP0P2)*BBS2
C
          TX(JN)=TX(JN) + SX(JN)*BDJ2
          TY(JN)=TY(JN) + SY(JN)*BDJ2
          TZ(JN)=TZ(JN) + SZ(JN)*BDJ2
C
          IF(JNO .GT. 2) THEN
            TX(JN)=TX(JN) + EX(IM0M2)*DJM1H
            TY(JN)=TY(JN) + EY(IM0M2)*DJM1H
            TZ(JN)=TZ(JN) + EZ(IM0M2)*DJM1H
          END IF
C
C   DERIVATIVES OF THE KINETIC ENERGY TERMS
C
          TXD(JN)=A2BDJ2*EX(IP1P0)
          TYD(JN)=A2BDJ2*EY(IP1P0)
          TZD(JN)=A2BDJ2*EZ(IP1P0)
          IF(INO .GT. 1) THEN
            TXD(JN)=TXD(JN) - DIBDJ2*EX(IM1M0)
            TYD(JN)=TYD(JN) - DIBDJ2*EY(IM1M0)
            TZD(JN)=TZD(JN) - DIBDJ2*EZ(IM1M0)
          END IF
C
          TXD(JN)=TXD(JN) + A2B2*EX(IP1P2)
          TYD(JN)=TYD(JN) + A2B2*EY(IP1P2)
          TZD(JN)=TZD(JN) + A2B2*EZ(IP1P2)
C
          IF(INO .GT. 1) THEN
            TXD(JN)=TXD(JN) - B2DI*EX(IM1P2)
            TYD(JN)=TYD(JN) - B2DI*EY(IM1P2)
            TZD(JN)=TZD(JN) - B2DI*EZ(IM1P2)
          END IF
C
          IF(JNO .GT. 2) THEN
            TXD(JN)=TXD(JN) + ADJM1H*EX(IP1M2)
            TYD(JN)=TYD(JN) + ADJM1H*EY(IP1M2)
            TZD(JN)=TZD(JN) + ADJM1H*EZ(IP1M2)
C
            IF(INO .GT. 1) THEN
              TXD(JN)=TXD(JN) - DIJM1H*EX(IM1M2)
              TYD(JN)=TYD(JN) - DIJM1H*EY(IM1M2)
              TZD(JN)=TZD(JN) - DIJM1H*EZ(IM1M2)
            END IF
          END IF
C
C   SECOND DERIVATIVES OF THE KINETIC ENERGY   DIAGONAL TERMS ONLY
C
          TXX=0.0D0
          TYY=0.0D0
          TZZ=0.0D0
C
          IF(JNO .GT. 2) THEN
            DUMMY=AAAA4*DJM1H
            TXX=TXX + DUMMY*EX(IP2M2)
            TYY=TYY + DUMMY*EY(IP2M2)
            TZZ=TZZ + DUMMY*EZ(IP2M2)
C
            IF(INO .GT. 2) THEN
              DUMMY=DIM1*DJM1H
              TXX=TXX + DUMMY*EX(IM2M2)
              TYY=TYY + DUMMY*EY(IM2M2)
              TZZ=TZZ + DUMMY*EZ(IM2M2)
            END IF
C
            DUMMY=A2DI*DJM1H
            TXX=TXX - DUMMY*EX(IM0M2)
            TYY=TYY - DUMMY*EY(IM0M2)
            TZZ=TZZ - DUMMY*EZ(IM0M2)
          END IF
C
          DUMMY=AAAA4*BDJ2
          TXX=TXX + DUMMY*EX(IP2P0)
          TYY=TYY + DUMMY*EY(IP2P0)
          TZZ=TZZ + DUMMY*EZ(IP2P0)
C
          IF(INO .GT. 2) THEN
            DUMMY=DIM1*BDJ2
            TXX=TXX + DUMMY*EX(IM2M0)
            TYY=TYY + DUMMY*EY(IM2M0)
            TZZ=TZZ + DUMMY*EZ(IM2M0)
          END IF
C
          DUMMY=A2DI*BDJ2
          TXX=TXX - DUMMY*EX(IPL)
          TYY=TYY - DUMMY*EY(IPL)
          TZZ=TZZ - DUMMY*EZ(IPL)
C
          DUMMY=A4B2
          TXX=TXX + DUMMY*EX(IP2P2)
          TYY=TYY + DUMMY*EY(IP2P2)
          TZZ=TZZ + DUMMY*EZ(IP2P2)
C
          IF(INO .GT. 2) THEN
            DUMMY=DIM1*BBS2
            TXX=TXX + DUMMY*EX(IM2P2)
            TYY=TYY + DUMMY*EY(IM2P2)
            TZZ=TZZ + DUMMY*EZ(IM2P2)
          END IF
C
          DUMMY=A2DI*BBS2
          TXX=TXX - DUMMY*EX(IP0P2)
          TYY=TYY - DUMMY*EY(IP0P2)
          TZZ=TZZ - DUMMY*EZ(IP0P2)
C
          TTWO(JN,1)= TXX
          TTWO(JN,2)= TYY
          TTWO(JN,3)= TZZ
C
C   THIRD DERIVATIVES OF THE KINETIC ENERGY  DIAGONAL TERMS ONLY
C
          TXXX=0.0D0
          TYYY=0.0D0
          TZZZ=0.0D0
C
          IF(JNO .GT. 2) THEN
            DUMMY=AAA8*DJM1H
            TXXX=TXXX + DUMMY*EX(IP3M2)
            TYYY=TYYY + DUMMY*EY(IP3M2)
            TZZZ=TZZZ + DUMMY*EZ(IP3M2)
C
            IF(INO .GT. 1) THEN
              DUMMY=A2DIDP*DJM1H
              TXXX=TXXX + DUMMY*EX(IM1M2)
              TYYY=TYYY + DUMMY*EY(IM1M2)
              TZZZ=TZZZ + DUMMY*EZ(IM1M2)
            END IF
C
            DUMMY=AA4DPD*DJM1H
            TXXX=TXXX - DUMMY*EX(IP1M2)
            TYYY=TYYY - DUMMY*EY(IP1M2)
            TZZZ=TZZZ - DUMMY*EZ(IP1M2)
          END IF
C
          DUMMY=AAA8*BDJ2
          TXXX=TXXX + DUMMY*EX(IP3P0)
          TYYY=TYYY + DUMMY*EY(IP3P0)
          TZZZ=TZZZ + DUMMY*EZ(IP3P0)
C
          IF(INO .GT. 1) THEN
            DUMMY=A2DIDP*BDJ2
            TXXX=TXXX + DUMMY*EX(IM1M0)
            TYYY=TYYY + DUMMY*EY(IM1M0)
            TZZZ=TZZZ + DUMMY*EZ(IM1M0)
          END IF
C
          DUMMY=AA4DPD*BDJ2
          TXXX=TXXX - DUMMY*EX(IP1P0)
          TYYY=TYYY - DUMMY*EY(IP1P0)
          TZZZ=TZZZ - DUMMY*EZ(IP1P0)
C
          DUMMY=A8B2
          TXXX=TXXX + DUMMY*EX(IP3P2)
          TYYY=TYYY + DUMMY*EY(IP3P2)
          TZZZ=TZZZ + DUMMY*EZ(IP3P2)
C
          IF(INO .GT. 1) THEN
            DUMMY=A2DIDP*BBS2
            TXXX=TXXX + DUMMY*EX(IM1P2)
            TYYY=TYYY + DUMMY*EY(IM1P2)
            TZZZ=TZZZ + DUMMY*EZ(IM1P2)
          END IF
C
          DUMMY=AA4DPD*BBS2
          TXXX=TXXX - DUMMY*EX(IP1P2)
          TYYY=TYYY - DUMMY*EY(IP1P2)
          TZZZ=TZZZ - DUMMY*EZ(IP1P2)
C
          TTHRE(JN,1)= TXXX
          TTHRE(JN,2)= TYYY
          TTHRE(JN,3)= TZZZ
  200   CONTINUE
  250 CONTINUE
C
C   SUM UP THE CONTRIBUTIONS DO OVERLAP AND KINETIC INTEGRALS
C
      ICOUNT=0
      DO  350 IORB=IORB1,IORBMX
        IF(BOTH) JORBMX=IORB
        DO 300 JORB=JORB1,JORBMX
          ICOUNT=ICOUNT + 1
          IJPOSN=IOFF(MAX0(IORB,JORB)) + MIN0(IORB,JORB)
          IJORB(ICOUNT)=IJPOSN
C
C   OVERLAP TERM
C
          IPOSX=IJX(ICOUNT)
          IPOSY=IJY(ICOUNT)
          IPOSZ=IJZ(ICOUNT)
C
C   FIRST DERIVATIVES
C
          S1DERB(ICOUNT,1) = SXD(IPOSX)*SY(IPOSY)*SZ(IPOSZ)*PFACT
          S1DERB(ICOUNT,2) = SX(IPOSX)*SYD(IPOSY)*SZ(IPOSZ)*PFACT
          S1DERB(ICOUNT,3) = SX(IPOSX)*SY(IPOSY)*SZD(IPOSZ)*PFACT
C
C   SECOND DERIVATIVES
C
          S2DERB(ICOUNT,1) = STWO(IPOSX,1)*SY(IPOSY)*SZ(IPOSZ)*PFACT
          S2DERB(ICOUNT,2) = SXD(IPOSX)*SYD(IPOSY)*SZ(IPOSZ)*PFACT
          S2DERB(ICOUNT,3) = SX(IPOSX)*STWO(IPOSY,2)*SZ(IPOSZ)*PFACT
          S2DERB(ICOUNT,4) = SXD(IPOSX)*SY(IPOSY)*SZD(IPOSZ)*PFACT
          S2DERB(ICOUNT,5) = SX(IPOSX)*SYD(IPOSY)*SZD(IPOSZ)*PFACT
          S2DERB(ICOUNT,6) = SX(IPOSX)*SY(IPOSY)*STWO(IPOSZ,3)*PFACT
C
C   THIRD DERIVATIVES
C
          S3DERB(ICOUNT,1) = STHRE(IPOSX,1)*SY(IPOSY)*SZ(IPOSZ)*PFACT
          S3DERB(ICOUNT,2) = STWO(IPOSX,1)*SYD(IPOSY)*SZ(IPOSZ)*PFACT
          S3DERB(ICOUNT,3) = SXD(IPOSX)*STWO(IPOSY,2)*SZ(IPOSZ)*PFACT
          S3DERB(ICOUNT,4) = SX(IPOSX)*STHRE(IPOSY,2)*SZ(IPOSZ)*PFACT
          S3DERB(ICOUNT,5) = STWO(IPOSX,1)*SY(IPOSY)*SZD(IPOSZ)*PFACT
          S3DERB(ICOUNT,6) = SXD(IPOSX)*SYD(IPOSY)*SZD(IPOSZ)*PFACT
          S3DERB(ICOUNT,7) = SX(IPOSX)*STWO(IPOSY,2)*SZD(IPOSZ)*PFACT
          S3DERB(ICOUNT,8) = SXD(IPOSX)*SY(IPOSY)*STWO(IPOSZ,3)*PFACT
          S3DERB(ICOUNT,9) = SX(IPOSX)*SYD(IPOSY)*STWO(IPOSZ,3)*PFACT
          S3DERB(ICOUNT,10) = SX(IPOSX)*SY(IPOSY)*STHRE(IPOSZ,3)*PFACT
C
C   KINETIC ENERGY TERM
C
C   FIRST DERIVATIVES
C
          T1DERB(ICOUNT,1) = (TXD(IPOSX)*SY(IPOSY)*SZ(IPOSZ)
     *                     +  SXD(IPOSX)*TY(IPOSY)*SZ(IPOSZ)
     *                     +  SXD(IPOSX)*SY(IPOSY)*TZ(IPOSZ))*PFACT
          T1DERB(ICOUNT,2) = (TX(IPOSX)*SYD(IPOSY)*SZ(IPOSZ)
     *                     +  SX(IPOSX)*TYD(IPOSY)*SZ(IPOSZ)
     *                     +  SX(IPOSX)*SYD(IPOSY)*TZ(IPOSZ))*PFACT
          T1DERB(ICOUNT,3) = (TX(IPOSX)*SY(IPOSY)*SZD(IPOSZ)
     *                     +  SX(IPOSX)*TY(IPOSY)*SZD(IPOSZ)
     *                     +  SX(IPOSX)*SY(IPOSY)*TZD(IPOSZ))*PFACT
C
C   SECOND DERIVATIVES
C
                      T2DERB(ICOUNT,1)=
     *                  (TTWO(IPOSX,1)*SY(IPOSY)*SZ(IPOSZ) +
     *                   STWO(IPOSX,1)*TY(IPOSY)*SZ(IPOSZ) +
     *                   STWO(IPOSX,1)*SY(IPOSY)*TZ(IPOSZ))*PFACT
                      T2DERB(ICOUNT,2)=
     *                  (TXD(IPOSX)*SYD(IPOSY)*SZ(IPOSZ) +
     *                   SXD(IPOSX)*TYD(IPOSY)*SZ(IPOSZ) +
     *                   SXD(IPOSX)*SYD(IPOSY)*TZ(IPOSZ))*PFACT
                      T2DERB(ICOUNT,3)=
     *                  (TX(IPOSX)*STWO(IPOSY,2)*SZ(IPOSZ) +
     *                   SX(IPOSX)*TTWO(IPOSY,2)*SZ(IPOSZ) +
     *                   SX(IPOSX)*STWO(IPOSY,2)*TZ(IPOSZ))*PFACT
                      T2DERB(ICOUNT,4)=
     *                  (TXD(IPOSX)*SY(IPOSY)*SZD(IPOSZ) +
     *                   SXD(IPOSX)*TY(IPOSY)*SZD(IPOSZ) +
     *                   SXD(IPOSX)*SY(IPOSY)*TZD(IPOSZ))*PFACT
                      T2DERB(ICOUNT,5)=
     *                  (TX(IPOSX)*SYD(IPOSY)*SZD(IPOSZ) +
     *                   SX(IPOSX)*TYD(IPOSY)*SZD(IPOSZ) +
     *                   SX(IPOSX)*SYD(IPOSY)*TZD(IPOSZ))*PFACT
                      T2DERB(ICOUNT,6)=
     *                  (TX(IPOSX)*SY(IPOSY)*STWO(IPOSZ,3) +
     *                   SX(IPOSX)*TY(IPOSY)*STWO(IPOSZ,3) +
     *                   SX(IPOSX)*SY(IPOSY)*TTWO(IPOSZ,3))*PFACT
C
C   THIRD DERIVATIVES
C
                      T3DERB(ICOUNT,1)=
     *                  (TTHRE(IPOSX,1)*SY(IPOSY)*SZ(IPOSZ) +
     *                   STHRE(IPOSX,1)*TY(IPOSY)*SZ(IPOSZ) +
     *                   STHRE(IPOSX,1)*SY(IPOSY)*TZ(IPOSZ))*PFACT
                      T3DERB(ICOUNT,2)=
     *                  (TTWO(IPOSX,1)*SYD(IPOSY)*SZ(IPOSZ) +
     *                   STWO(IPOSX,1)*TYD(IPOSY)*SZ(IPOSZ) +
     *                   STWO(IPOSX,1)*SYD(IPOSY)*TZ(IPOSZ))*PFACT
                      T3DERB(ICOUNT,3)=
     *                  (TXD(IPOSX)*STWO(IPOSY,2)*SZ(IPOSZ) +
     *                   SXD(IPOSX)*TTWO(IPOSY,2)*SZ(IPOSZ) +
     *                   SXD(IPOSX)*STWO(IPOSY,2)*TZ(IPOSZ))*PFACT
                      T3DERB(ICOUNT,4)=
     *                  (TX(IPOSX)*STHRE(IPOSY,2)*SZ(IPOSZ) +
     *                   SX(IPOSX)*TTHRE(IPOSY,2)*SZ(IPOSZ) +
     *                   SX(IPOSX)*STHRE(IPOSY,2)*TZ(IPOSZ))*PFACT
                      T3DERB(ICOUNT,5)=
     *                  (TTWO(IPOSX,1)*SY(IPOSY)*SZD(IPOSZ) +
     *                   STWO(IPOSX,1)*TY(IPOSY)*SZD(IPOSZ) +
     *                   STWO(IPOSX,1)*SY(IPOSY)*TZD(IPOSZ))*PFACT
                      T3DERB(ICOUNT,6)=
     *                  (TXD(IPOSX)*SYD(IPOSY)*SZD(IPOSZ) +
     *                   SXD(IPOSX)*TYD(IPOSY)*SZD(IPOSZ) +
     *                   SXD(IPOSX)*SYD(IPOSY)*TZD(IPOSZ))*PFACT
                      T3DERB(ICOUNT,7)=
     *                  (TX(IPOSX)*STWO(IPOSY,2)*SZD(IPOSZ) +
     *                   SX(IPOSX)*TTWO(IPOSY,2)*SZD(IPOSZ) +
     *                   SX(IPOSX)*STWO(IPOSY,2)*TZD(IPOSZ))*PFACT
                      T3DERB(ICOUNT,8)=
     *                  (TXD(IPOSX)*SY(IPOSY)*STWO(IPOSZ,3) +
     *                   SXD(IPOSX)*TY(IPOSY)*STWO(IPOSZ,3) +
     *                   SXD(IPOSX)*SY(IPOSY)*TTWO(IPOSZ,3))*PFACT
                      T3DERB(ICOUNT,9)=
     *                  (TX(IPOSX)*SYD(IPOSY)*STWO(IPOSZ,3) +
     *                   SX(IPOSX)*TYD(IPOSY)*STWO(IPOSZ,3) +
     *                   SX(IPOSX)*SYD(IPOSY)*TTWO(IPOSZ,3))*PFACT
                      T3DERB(ICOUNT,10)=
     *                  (TX(IPOSX)*SY(IPOSY)*STHRE(IPOSZ,3) +
     *                   SX(IPOSX)*TY(IPOSY)*STHRE(IPOSZ,3) +
     *                   SX(IPOSX)*SY(IPOSY)*TTHRE(IPOSZ,3))*PFACT
  300               CONTINUE
  350             CONTINUE
                  DO 400 ICNT=1,ICOUNT
                    IJ=IJORB(ICNT)
C
C   FIRST DERIVATIVES
C
                    DO 360 ICRD=1,3
                      SFIR1=S1DERB(ICNT,ICRD)
                      TFIR1=T1DERB(ICNT,ICRD)
                      S1DER(IJ,IDER(ICRD))=S1DER(IJ,IDER(ICRD))
     *                                      + SFIR1
                      S1DER(IJ,JDER(ICRD))=S1DER(IJ,JDER(ICRD))
     *                                      - SFIR1
                      T1DER(IJ,IDER(ICRD))=T1DER(IJ,IDER(ICRD))
     *                                      + TFIR1
                      T1DER(IJ,JDER(ICRD))=T1DER(IJ,JDER(ICRD))
     *                                      - TFIR1
  360               CONTINUE
C
C   SECOND DERIVATIVES
C
                    DO 370 ICRD=1,6
                      SSEC1=S2DERB(ICNT,ICRD)
                      TSEC1=T2DERB(ICNT,ICRD)
                      S2DER(IJ,IIDER(ICRD))=S2DER(IJ,IIDER(ICRD))
     *                                       + SSEC1
                      S2DER(IJ,JJDER(ICRD))=S2DER(IJ,JJDER(ICRD))
     *                                       + SSEC1
                      T2DER(IJ,IIDER(ICRD))=T2DER(IJ,IIDER(ICRD))
     *                                       + TSEC1
                      T2DER(IJ,JJDER(ICRD))=T2DER(IJ,JJDER(ICRD))
     *                                       + TSEC1
                      N1POS=N2II(ICRD,1)
                      N2POS=N2II(ICRD,2)
                      S2DER(IJ,IJDER(N1POS))=S2DER(IJ,IJDER(N1POS))
     *                                        - SSEC1
                      T2DER(IJ,IJDER(N1POS))=T2DER(IJ,IJDER(N1POS))
     *                                        - TSEC1
                      IF(N2POS .NE. N1POS) THEN
                        S2DER(IJ,IJDER(N2POS))=S2DER(IJ,IJDER(N2POS))
     *                                          - SSEC1
                        T2DER(IJ,IJDER(N2POS))=T2DER(IJ,IJDER(N2POS))
     *                                          - TSEC1
                      END IF
  370               CONTINUE
C
C   THIRD DERIVATIVES
C
                    IF(IDRVF.LE.2) GOTO 385
                    DO 380 ICRD=1,10
                      STHR1=S3DERB(ICNT,ICRD)
                      TTHR1=T3DERB(ICNT,ICRD)
                      S3DER(IJ,IIIDER(ICRD))=S3DER(IJ,IIIDER(ICRD))
     *                                        + STHR1
                      S3DER(IJ,JJJDER(ICRD))=S3DER(IJ,JJJDER(ICRD))
     *                                        - STHR1
                      T3DER(IJ,IIIDER(ICRD))=T3DER(IJ,IIIDER(ICRD))
     *                                        + TTHR1
                      T3DER(IJ,JJJDER(ICRD))=T3DER(IJ,JJJDER(ICRD))
     *                                        - TTHR1
                      N1POS=N3III(ICRD,1)
                      N2POS=N3III(ICRD,2)
                      N3POS=N3III(ICRD,3)
                      S3DER(IJ,IIJDER(N1POS))=S3DER(IJ,IIJDER(N1POS))
     *                                         - STHR1
                      S3DER(IJ,IJJDER(N1POS))=S3DER(IJ,IJJDER(N1POS))
     *                                         + STHR1
                      T3DER(IJ,IIJDER(N1POS))=T3DER(IJ,IIJDER(N1POS))
     *                                         - TTHR1
                      T3DER(IJ,IJJDER(N1POS))=T3DER(IJ,IJJDER(N1POS))
     *                                         + TTHR1
                      IF(N3POS .NE. N1POS) THEN
                        S3DER(IJ,IIJDER(N3POS))=S3DER(IJ,IIJDER(N3POS)
     *                                       )    - STHR1
                        S3DER(IJ,IJJDER(N3POS))=S3DER(IJ,IJJDER(N3POS)
     *                                       )    + STHR1
                        T3DER(IJ,IIJDER(N3POS))=T3DER(IJ,IIJDER(N3POS)
     *                                      )   - TTHR1
                        T3DER(IJ,IJJDER(N3POS))=T3DER(IJ,IJJDER(N3POS)
     *                                      )   + TTHR1
                        IF(N2POS .NE. N1POS) THEN
                          S3DER(IJ,IIJDER(N2POS))=S3DER(IJ,IIJDER
     *                                       (N2POS)) - STHR1
                          S3DER(IJ,IJJDER(N2POS))=S3DER(IJ,IJJDER
     *                                       (N2POS)) + STHR1
                          T3DER(IJ,IIJDER(N2POS))=T3DER(IJ,IIJDER
     *                                       (N2POS)) - TTHR1
                          T3DER(IJ,IJJDER(N2POS))=T3DER(IJ,IJJDER
     *                                       (N2POS)) + TTHR1
                        END IF
                      END IF
  380               CONTINUE
                    GOTO 395
C
C   THE FOLLOWING SECTION IS FOR NOT STORING THE ACTUAL THIRD
C   DERIVATIVES
C
  385               CONTINUE
C
                    DO 390 ICRD=1,10
                      STHR1=S3DERB(ICNT,ICRD)*LAG(IJ)
                      TTHR1=T3DERB(ICNT,ICRD)*DEN1T(IJ)
                      S3LAG(IIIDER(ICRD))=S3LAG(IIIDER(ICRD))
     *                                        + STHR1
                      S3LAG(JJJDER(ICRD))=S3LAG(JJJDER(ICRD))
     *                                        - STHR1
                      EONE3(IIIDER(ICRD))=EONE3(IIIDER(ICRD))
     *                                        + TTHR1
                      EONE3(JJJDER(ICRD))=EONE3(JJJDER(ICRD))
     *                                        - TTHR1
                      N1POS=N3III(ICRD,1)
                      N2POS=N3III(ICRD,2)
                      N3POS=N3III(ICRD,3)
                      S3LAG(IIJDER(N1POS))=S3LAG(IIJDER(N1POS))
     *                                         - STHR1
                      S3LAG(IJJDER(N1POS))=S3LAG(IJJDER(N1POS))
     *                                         + STHR1
                      EONE3(IIJDER(N1POS))=EONE3(IIJDER(N1POS))
     *                                         - TTHR1
                      EONE3(IJJDER(N1POS))=EONE3(IJJDER(N1POS))
     *                                         + TTHR1
                      IF(N3POS .NE. N1POS) THEN
                        S3LAG(IIJDER(N3POS))=S3LAG(IIJDER(N3POS)
     *                                       )    - STHR1
                        S3LAG(IJJDER(N3POS))=S3LAG(IJJDER(N3POS)
     *                                       )    + STHR1
                        EONE3(IIJDER(N3POS))=EONE3(IIJDER(N3POS)
     *                                      )   - TTHR1
                        EONE3(IJJDER(N3POS))=EONE3(IJJDER(N3POS)
     *                                      )   + TTHR1
                        IF(N2POS .NE. N1POS) THEN
                          S3LAG(IIJDER(N2POS))=S3LAG(IIJDER
     *                                       (N2POS)) - STHR1
                          S3LAG(IJJDER(N2POS))=S3LAG(IJJDER
     *                                       (N2POS)) + STHR1
                          EONE3(IIJDER(N2POS))=EONE3(IIJDER
     *                                       (N2POS)) - TTHR1
                          EONE3(IJJDER(N2POS))=EONE3(IJJDER
     *                                       (N2POS)) + TTHR1
                        END IF
                      END IF
  390    CONTINUE
C7-14-88
  395    CONTINUE
  400  CONTINUE
C
      RETURN
      END
      SUBROUTINE THREE(SECDER,LABOUT,IUNIT,IUNIT4,INTSV,ETWO1,
     *ETWO2,FIRDER,GMXFIR,GMXSEC,GMXFF,LO,DAO,THRDER,GMXTHR,GMXFFF,
     *GMXFS,ETWO3)
      IMPLICIT REAL*8 (A-H,O-Z)
      LOGICAL EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      DIMENSION SECDER(I2N3N,IUNIT),LABOUT(IUNIT4)
      DIMENSION INTSV(500,4),ETWO1(N3N),ETWO2(I2N3N),FIRDER(N3N,IUNIT)
      DIMENSION GMXFIR(IMEM4,3,3),GMXSEC(IMEM4,6,3),GMXFF(IMEM4,9,3)
      DIMENSION LO(IMEM4*5),DAO(IMEM4)
      DIMENSION THRDER(I3N3N,IUNIT),GMXTHR(IMEM4,10,3),GMXFFF(IMEM4,27),
     *          GMXFS(IMEM4,18,6),ETWO3(I3N3N)
      COMMON/CENTS/IDER(3),JDER(3),KDER(3),LDER(3),IIDER(6)
     *,            JJDER(6),KKDER(6),LLDER(6),IJDER(9),IKDER(9)
     *,            ILDER(9),JKDER(9),JLDER(9),KLDER(9)
      COMMON/CENT3/IIIDER(10),JJJDER(10),KKKDER(10),LLLDER(10)
     *,            IIJDER(18),IJJDER(18),IIKDER(18),IKKDER(18)
     *,            IILDER(18),ILLDER(18),JJKDER(18),JKKDER(18)
     *,            JJLDER(18),JLLDER(18),KKLDER(18),KLLDER(18)
     *,            IJKDER(27),IJLDER(27),JKLDER(27),IKLDER(27)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/KEEPS/IDRVT,IDRVF
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/LOGIC/EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      COMMON/NARRY/N2II(6,2),N2IK(9),N2KI(9),N2IK2(9,3),N3III(10,3)
      COMMON/NARR2/N3IIK(18,4),N3IKK(18,3),N3IJK(27,6),N3JKK(18,2)
      COMMON/NINFO/INTOT,ISPOT,IFSEC,ISSEC,ITSEC,ILSEC
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/TAPES/ITAP30,ITAP38,ITAP42,ITAP45,ITAP46
      COMMON/TOLER/TOL(10)
C
      CUTOFF=TOL(5)
C
      RETURN
C
      ENTRY THREQU(ISTOP)
C
      DO 1000 ICNT=1,ISTOP
C
        ISPOT=ISPOT + 1
        IF(ISPOT .GT. IUNIT) THEN
          INTOT=INTOT + 1
        IF(INTOT.GT.498) THEN
          WRITE(6,*) ' INTOT EXCEEDS 498 IN THREE',INTOT
          WRITE(6,*) ' MAXIMUM INTOT = 498 + 2'
        END IF
          IF(INTOT .GT. 2) THEN
            INTSV(INTOT,1)=INTSV(INTOT-1,4) + ILSEC
          ELSE
            INTSV(INTOT,1)=3
          END IF
          IF(IDRVT .EQ. 1) THEN
            INTSV(INTOT,4)=INTSV(INTOT,1) + IFSEC
          END IF
          IF(IDRVT .EQ. 2) THEN
            INTSV(INTOT,2)=INTSV(INTOT,1) + IFSEC
            INTSV(INTOT,4)=INTSV(INTOT,2) + ISSEC
          END IF
          IF(IDRVT .EQ. 3) THEN
            INTSV(INTOT,2)=INTSV(INTOT,1) + IFSEC
            INTSV(INTOT,3)=INTSV(INTOT,2) + ISSEC
            INTSV(INTOT,4)=INTSV(INTOT,3) + ITSEC
          END IF
C
          ISIZE1=INTOWP(IUNIT*N3N)
          ISIZE2=INTOWP(IUNIT*I2N3N)
          ISIZE3=INTOWP(IUNIT*I3N3N)
          ISIZEL=IUNIT*4
          ISEC1=INTSV(INTOT,1)
          ISEC2=INTSV(INTOT,2)
          ISEC3=INTSV(INTOT,3)
          ISECL=INTSV(INTOT,4)
          INTSV(499,1)=ISIZE1
          INTSV(499,2)=ISIZE2
          INTSV(499,3)=ISIZE3
          INTSV(499,4)=ISIZEL
C
C:::::::::::::::::
C:::FORM TAPE38:::
C:::::::::::::::::
C
          CALL SREW(ITAP38)
          IF(IDRVT .EQ. 1) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
          END IF
          IF(IDRVT .EQ. 2) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
            CALL RWRIT(ITAP38,SECDER,ISIZE2,ISEC2)
          END IF
          IF(IDRVT .EQ. 3) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
            CALL RWRIT(ITAP38,SECDER,ISIZE2,ISEC2)
            CALL RWRIT(ITAP38,THRDER,ISIZE3,ISEC3)
          END IF
C
          CALL RWRIT(ITAP38,LABOUT,ISIZEL,ISECL)
          ISZ=IUNIT*N3N
          CALL ZERO(FIRDER,ISZ)
          IF(IDRTV .EQ. 2) THEN
            ISZ=IUNIT*I2N3N
            CALL ZERO(SECDER,ISZ)
          END IF
          IF(IDRTV .EQ. 3) THEN
            ISZ=IUNIT*I3N3N
            CALL ZERO(THRDER,ISZ)
          END IF
          ISPOT=1
        END IF
C
        ICNT1=(ICNT-1)*5 + 1
        ITYPE=LO(ICNT1)
        I=LO(ICNT1+1)
        J=LO(ICNT1+2)
        K=LO(ICNT1+3)
        L=LO(ICNT1+4)
        IJKL=(ISPOT-1)*4 + 1
        LABOUT(IJKL)=I
        LABOUT(IJKL+1)=J
        LABOUT(IJKL+2)=K
        LABOUT(IJKL+3)=L
        DD=DAO(ICNT)
C
C   FIRST DERIVATIVE
C
C   JJ.EQ.KK .NE. II .NE. LL     3 CENTER INTEGRAL
C
        DO 100 ICRD=1,3
          FIR1=GMXFIR(ICNT,ICRD,1)
          FIR2=GMXFIR(ICNT,ICRD,2)
          FIR12= -FIR1 - FIR2
          FIRDER(IDER(ICRD),ISPOT)= FIR1
          FIRDER(LDER(ICRD),ISPOT)= FIR2
          FIRDER(KDER(ICRD),ISPOT)= FIR12
          GMXFIR(ICNT,ICRD,1)= 0.0D0
          GMXFIR(ICNT,ICRD,2)= 0.0D0
          IF(ABS(FIR1) .GT. CUTOFF) THEN
            CALL DAMULT(FIR1,I,J,K,L,ITYPE,IDER(ICRD),1)
            ETWO1(IDER(ICRD))=ETWO1(IDER(ICRD)) + FIR1*DD
          END IF
          IF(ABS(FIR2) .GT. CUTOFF) THEN
            CALL DAMULT(FIR2,I,J,K,L,ITYPE,LDER(ICRD),1)
            ETWO1(LDER(ICRD))=ETWO1(LDER(ICRD)) + FIR2*DD
          END IF
          IF(ABS(FIR12) .GT. CUTOFF) THEN
            CALL DAMULT(FIR12,I,J,K,L,ITYPE,KDER(ICRD),1)
            ETWO1(KDER(ICRD))=ETWO1(KDER(ICRD)) + FIR12*DD
          END IF
  100   CONTINUE
C
C   SECOND DERIVATIVES
C
C   JJ.EQ.KK .NE. II .NE. LL     3 CENTER INTEGRAL
C
        DO 200 ICRD=1,9
          IF(ICRD .LE. 6) THEN
            SEC1=GMXSEC(ICNT,ICRD,1)
            SEC2=GMXSEC(ICNT,ICRD,2)
            SEC3=GMXFF(ICNT,N2II(ICRD,1),1)
            SEC4=GMXFF(ICNT,N2II(ICRD,2),1)
C           SECDER(IIDER(ICRD),ISPOT)= SEC1
C           SECDER(LLDER(ICRD),ISPOT)= SEC2
            SECOND=SEC1 + SEC2 + SEC3 + SEC4
C           SECDER(KKDER(ICRD),ISPOT)= SECOND
            IF(ABS(SEC1) .GT. CUTOFF) THEN
              CALL DAMULT(SEC1,I,J,K,L,ITYPE,IIDER(ICRD),2)
              ETWO2(IIDER(ICRD))=ETWO2(IIDER(ICRD)) + SEC1*DD
            END IF
            IF(ABS(SEC2) .GT. CUTOFF) THEN
              CALL DAMULT(SEC2,I,J,K,L,ITYPE,LLDER(ICRD),2)
              ETWO2(LLDER(ICRD))=ETWO2(LLDER(ICRD)) + SEC2*DD
            END IF
            IF(ABS(SECOND) .GT. CUTOFF) THEN
              CALL DAMULT(SECOND,I,J,K,L,ITYPE,KKDER(ICRD),2)
              ETWO2(KKDER(ICRD))=ETWO2(KKDER(ICRD)) + SECOND*DD
            END IF
          END IF
          SEC1=GMXSEC(ICNT,N2IK(ICRD),1)
          SEC2=GMXSEC(ICNT,N2IK(ICRD),2)
          SEC3=GMXFF(ICNT,ICRD,1)
          SEC4=GMXFF(ICNT,ICRD,1)
          SEC13= - SEC1 - SEC3
          SEC24= - SEC2 - SEC4
C         SECDER(IKDER(ICRD),ISPOT)= SEC13
C         SECDER(KLDER(ICRD),ISPOT)= SEC24
C         SECDER(ILDER(ICRD),ISPOT)= SEC3
          IF(ABS(SEC13) .GT. CUTOFF) THEN
            CALL DAMULT(SEC13,I,J,K,L,ITYPE,IKDER(ICRD),2)
            ETWO2(IKDER(ICRD))=ETWO2(IKDER(ICRD)) + SEC13*DD
          END IF
          IF(ABS(SEC24) .GT. CUTOFF) THEN
            CALL DAMULT(SEC24,I,J,K,L,ITYPE,KLDER(ICRD),2)
            ETWO2(KLDER(ICRD))=ETWO2(KLDER(ICRD)) + SEC24*DD
          END IF
          IF(ABS(SEC3) .GT. CUTOFF) THEN
            CALL DAMULT(SEC3,I,J,K,L,ITYPE,ILDER(ICRD),2)
            ETWO2(ILDER(ICRD))=ETWO2(ILDER(ICRD)) + SEC3*DD
          END IF
  200   CONTINUE
        DO 210 ICRD=1,9
          GMXFF(ICNT,ICRD,1)= 0.0D0
          IF(ICRD .LE. 6) THEN
            GMXSEC(ICNT,ICRD,1)= 0.0D0
            GMXSEC(ICNT,ICRD,2)= 0.0D0
          END IF
  210   CONTINUE
C
C   THIRD DERIVATIVES
C
C   JJ.EQ.KK .NE. II .NE. LL     3 CENTER INTEGRAL
C
        DO 300 ICRD=1,27
          IF(ICRD .LE. 10) THEN
            THR1=GMXTHR(ICNT,ICRD,1)
            THR2=GMXTHR(ICNT,ICRD,2)
            N1POS=N3III(ICRD,1)
            N2POS=N3III(ICRD,2)
            N3POS=N3III(ICRD,3)
            THR3=GMXFS(ICNT,N1POS,1)
            THR4=GMXFS(ICNT,N2POS,1)
            THR5=GMXFS(ICNT,N3POS,1)
            THR6=GMXFS(ICNT,N1POS,2)
            THR7=GMXFS(ICNT,N2POS,2)
            THR8=GMXFS(ICNT,N3POS,2)
            THIRD=-THR1-THR2-THR3-THR4-THR5-THR6-THR7-THR8
C           THRDER(ISPOT,IIIDER(ICRD))=THR1
C           THRDER(ISPOT,LLLDER(ICRD))=THR2
C           THRDER(ISPOT,JJJDER(ICRD))=THIRD
            IF(ABS(THR1) .GT. CUTOFF) THEN
C             CALL DAMULT(THR1,I,J,K,L,ITYPE,IIIDER(ICRD),3)
              ETWO3(IIIDER(ICRD))=ETWO3(IIIDER(ICRD)) + THR1*DD
            END IF
            IF(ABS(THR2) .GT. CUTOFF) THEN
C             CALL DAMULT(THR2,I,J,K,L,ITYPE,LLLDER(ICRD),3)
              ETWO3(LLLDER(ICRD))=ETWO3(LLLDER(ICRD)) + THR2*DD
            END IF
            IF(ABS(THIRD) .GT. CUTOFF) THEN
C             CALL DAMULT(THIRD,I,J,K,L,ITYPE,JJJDER(ICRD),3)
              ETWO3(JJJDER(ICRD))=ETWO3(JJJDER(ICRD)) + THIRD*DD
            END IF
          END IF
C
          IF(ICRD .LE. 18) THEN
            N1POS=N3IIK(ICRD,1)
            THR1=GMXTHR(ICNT,N1POS,1)
            THR2=GMXTHR(ICNT,N1POS,2)
            THR3=GMXFS(ICNT,ICRD,1)
            THR4=GMXFS(ICNT,ICRD,2)
            THR13=-THR1-THR3
            THR24=-THR2-THR4
C           THRDER(ISPOT,IIJDER(ICRD))=THR13
C           THRDER(ISPOT,JLLDER(ICRD))=THR24
C           THRDER(ISPOT,IILDER(ICRD))=THR3
C           THRDER(ISPOT,ILLDER(ICRD))=THR4
            IF(ABS(THR13) .GT. CUTOFF) THEN
C             CALL DAMULT(THR13,I,J,K,L,ITYPE,IIJDER(ICRD),3)
              ETWO3(IIJDER(ICRD))=ETWO3(IIJDER(ICRD)) + THR13*DD
            END IF
            IF(ABS(THR24) .GT. CUTOFF) THEN
C             CALL DAMULT(THR24,I,J,K,L,ITYPE,JLLDER(ICRD),3)
              ETWO3(JLLDER(ICRD))=ETWO3(JLLDER(ICRD)) + THR24*DD
            END IF
            IF(ABS(THR3) .GT. CUTOFF) THEN
C             CALL DAMULT(THIRD,I,J,K,L,ITYPE,IILDER(ICRD),3)
              ETWO3(IILDER(ICRD))=ETWO3(IILDER(ICRD)) + THR3*DD
            END IF
            IF(ABS(THR4) .GT. CUTOFF) THEN
C             CALL DAMULT(THIRD,I,J,K,L,ITYPE,ILLDER(ICRD),3)
              ETWO3(ILLDER(ICRD))=ETWO3(ILLDER(ICRD)) + THR4*DD
            END IF
C
            N3POS=N3JKK(ICRD,1)
            N4POS=N3JKK(ICRD,2)
            THR3=GMXFS(ICNT,ICRD,1)
            THR4=GMXFS(ICNT,ICRD,2)
            THR5=GMXFS(ICNT,N3POS,1)
            THR6=GMXFS(ICNT,N3POS,2)
            THR7=GMXFS(ICNT,N4POS,1)
            THR8=GMXFS(ICNT,N4POS,2)
            THRIJJ=THR1 + THR4 + THR5 + THR7
            THRJJL=THR2 + THR3 + THR6 + THR8
C           THRDER(ISPOT,IJJDER(ICRD))=THRIJJ
C           THRDER(ISPOT,JJLDER(ICRD))=THRJJL
            IF(ABS(THRIJJ) .GT. CUTOFF) THEN
C             CALL DAMULT(THRIJJ,I,J,K,L,ITYPE,IJJDER(ICRD),3)
              ETWO3(IJJDER(ICRD))=ETWO3(IJJDER(ICRD)) + THRIJJ*DD
            END IF
            IF(ABS(THRJJL) .GT. CUTOFF) THEN
C             CALL DAMULT(THRJJL,I,J,K,L,ITYPE,JJLDER(ICRD),3)
              ETWO3(JJLDER(ICRD))=ETWO3(JJLDER(ICRD)) + THRJJL*DD
            END IF
          END IF
C
          N1POS=N3IJK(ICRD,3)
          N2POS=N3IJK(ICRD,4)
          THR1=GMXFS(ICNT,N1POS,1)
          THR2=GMXFS(ICNT,N2POS,2)
          THR12=-THR1-THR2
C         THRDER(ISPOT,IJLDER(ICRD))=THR12
          IF(ABS(THR12) .GT. CUTOFF) THEN
C           CALL DAMULT(THR12,I,J,K,L,ITYPE,IJLDER(ICRD),3)
            ETWO3(IJLDER(ICRD))=ETWO3(IJLDER(ICRD)) + THR12*DD
          END IF
C
  300   CONTINUE
        DO 310 ICRD=1,18
          IF(ICRD .LE. 10) THEN
            GMXTHR(ICNT,ICRD,1)=0.0D0
            GMXTHR(ICNT,ICRD,2)=0.0D0
          END IF
          GMXFS(ICNT,ICRD,1)=0.0D0
          GMXFS(ICNT,ICRD,2)=0.0D0
  310   CONTINUE
C
 1000 CONTINUE
C
      RETURN
      END
      SUBROUTINE THROUT(ETHREE,KST,ISZ)
      IMPLICIT REAL*8(A-H,O-Z)
      DIMENSION ETHREE(ISZ),KST(NS,NS,NS)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
    1 FORMAT(/,2X,' ATOM 1  ATOM 2  ATOM 3   DEGREES OF FREEDOM')
    2 FORMAT(/,3X,I3,5X,I3,5X,I3,7X,I5,' TO ',I5,/)
    3 FORMAT(5(F20.10,5X))
C
C   WRITE OUT THRID DERIVATIVE INFORMATION
C
      DO 300 I=1,NS
        DO 200 J=1,I
          DO 100 K=1,J
            ISRT=KST(I,J,K)
            IF(I .EQ. J) THEN
              IF(I .EQ. K) THEN
                IADD=9
              ELSE
                IADD=17
              END IF
            ELSE
              IF(J .EQ. K) THEN
                IADD=17
              ELSE
                IADD=26
              END IF
            END IF
            IEND=ISRT+IADD
            WRITE(IOUT,1)
            WRITE(IOUT,2)I,J,K,ISRT,IEND
            WRITE(IOUT,3) (ETHREE(II), II=ISRT,IEND)
 100      CONTINUE
 200    CONTINUE
 300  CONTINUE
C
      RETURN
      END
      SUBROUTINE TWO(SECDER,LABOUT,IUNIT,IUNIT4,INTSV,ETWO1,ETWO2
     *,FIRDER,GMXFIR,GMXSEC,GMXFF,LO,DAO,THRDER,GMXTHR,GMXFFF,GMXFS
     *,ETWO3)
      IMPLICIT REAL*8 (A-H,O-Z)
      LOGICAL EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      DIMENSION SECDER(I2N3N,IUNIT),LABOUT(IUNIT4)
      DIMENSION INTSV(500,4),ETWO1(N3N),ETWO2(I2N3N),FIRDER(N3N,IUNIT)
      DIMENSION GMXFIR(IMEM4,3,3),GMXSEC(IMEM4,6,3),GMXFF(IMEM4,9,3)
      DIMENSION LO(IMEM4*5),DAO(IMEM4)
      DIMENSION THRDER(I3N3N,IUNIT),GMXTHR(IMEM4,10,3),GMXFFF(IMEM4,27),
     *          GMXFS(IMEM4,18,6),ETWO3(I3N3N)
      COMMON/CENTS/IDER(3),JDER(3),KDER(3),LDER(3),IIDER(6)
     *,            JJDER(6),KKDER(6),LLDER(6),IJDER(9),IKDER(9)
     *,            ILDER(9),JKDER(9),JLDER(9),KLDER(9)
      COMMON/CENT3/IIIDER(10),JJJDER(10),KKKDER(10),LLLDER(10)
     *,            IIJDER(18),IJJDER(18),IIKDER(18),IKKDER(18)
     *,            IILDER(18),ILLDER(18),JJKDER(18),JKKDER(18)
     *,            JJLDER(18),JLLDER(18),KKLDER(18),KLLDER(18)
     *,            IJKDER(27),IJLDER(27),JKLDER(27),IKLDER(27)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/KEEPS/IDRVT,IDRVF
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/LOGIC/EQUAL1,EQUAL2,EQUAL3,EQUAL4,EQUAL5
      COMMON/NARRY/N2II(6,2),N2IK(9),N2KI(9),N2IK2(9,3),N3III(10,3)
      COMMON/NARR2/N3IIK(18,4),N3IKK(18,3),N3IJK(27,6),N3JKK(18,2)
      COMMON/NINFO/INTOT,ISPOT,IFSEC,ISSEC,ITSEC,ILSEC
      COMMON/PASS /II,JJ,KK,LL
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/TAPES/ITAP30,ITAP38,ITAP42,ITAP45,ITAP46
      COMMON/TOLER/TOL(10)
C
      CUTOFF=TOL(5)
C
      RETURN
C
      ENTRY TWOEQU(ISTOP)
C
      DO 1000 ICNT=1,ISTOP
C
        ISPOT=ISPOT + 1
        IF(ISPOT .GT. IUNIT) THEN
          INTOT=INTOT + 1
          IF(INTOT.GT.498) THEN
            WRITE(6,*) ' INTOT EXCEEDS 498 IN TWO',INTOT
            WRITE(6,*) ' MAXIMUM INTOT = 498 + 2'
            STOP
          END IF
          IF(INTOT .GT. 2) THEN
            INTSV(INTOT,1)=INTSV(INTOT-1,4) + ILSEC
          ELSE
            INTSV(INTOT,1)=3
          END IF
          IF(IDRVT .EQ. 1) THEN
            INTSV(INTOT,4)=INTSV(INTOT,1) + IFSEC
          END IF
          IF(IDRVT .EQ. 2) THEN
            INTSV(INTOT,2)=INTSV(INTOT,1) + IFSEC
            INTSV(INTOT,4)=INTSV(INTOT,2) + ISSEC
          END IF
          IF(IDRVT .EQ. 3) THEN
            INTSV(INTOT,2)=INTSV(INTOT,1) + IFSEC
            INTSV(INTOT,3)=INTSV(INTOT,2) + ISSEC
            INTSV(INTOT,4)=INTSV(INTOT,3) + ITSEC
          END IF
C
          ISIZE1=INTOWP(IUNIT*N3N)
          ISIZE2=INTOWP(IUNIT*I2N3N)
          ISIZE3=INTOWP(IUNIT*I3N3N)
          ISIZEL=IUNIT*4
          ISEC1=INTSV(INTOT,1)
          ISEC2=INTSV(INTOT,2)
          ISEC3=INTSV(INTOT,3)
          ISECL=INTSV(INTOT,4)
          INTSV(499,1)=ISIZE1
          INTSV(499,2)=ISIZE2
          INTSV(499,3)=ISIZE3
          INTSV(499,4)=ISIZEL
C
C:::::::::::::::::
C:::FORM TAPE38:::
C:::::::::::::::::
C
          CALL SREW(ITAP38)
          IF(IDRVT .EQ. 1) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
          END IF
          IF(IDRVT .EQ. 2) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
            CALL RWRIT(ITAP38,SECDER,ISIZE2,ISEC2)
          END IF
          IF(IDRVT .EQ. 3) THEN
            CALL RWRIT(ITAP38,FIRDER,ISIZE1,ISEC1)
            CALL RWRIT(ITAP38,SECDER,ISIZE2,ISEC2)
            CALL RWRIT(ITAP38,THRDER,ISIZE3,ISEC3)
          END IF
C
          CALL RWRIT(ITAP38,LABOUT,ISIZEL,ISECL)
          ISZ=IUNIT*N3N
          CALL ZERO(FIRDER,ISZ)
          IF(IDRVT .EQ. 2) THEN
            ISZ=IUNIT*I2N3N
            CALL ZERO(SECDER,ISZ)
          END IF
          IF(IDRVT .EQ. 3) THEN
            ISZ=IUNIT*I3N3N
            CALL ZERO(THRDER,ISZ)
          END IF
          ISPOT=1
        END IF
C
        ICNT1=(ICNT-1)*5 + 1
        ITYPE=LO(ICNT1)
        I=LO(ICNT1+1)
        J=LO(ICNT1+2)
        K=LO(ICNT1+3)
        L=LO(ICNT1+4)
        IJKL=(ISPOT-1)*4 + 1
        LABOUT(IJKL)=I
        LABOUT(IJKL+1)=J
        LABOUT(IJKL+2)=K
        LABOUT(IJKL+3)=L
        DD=DAO(ICNT)
C
        IF(EQUAL3) GO TO 150
        IF(EQUAL5) GO TO 250
C
C   FIRST DERIVATIVES
C
C   KK.EQ.LL .NE. II .NE. JJ               3 CENTER INTEGRAL
C
        DO 100 ICRD=1,3
          FIR1=GMXFIR(ICNT,ICRD,1)
          FIR2=GMXFIR(ICNT,ICRD,2)
          FIR12= -FIR1 - FIR2
          FIRDER(IDER(ICRD),ISPOT)= FIR1
          FIRDER(JDER(ICRD),ISPOT)= FIR2
          FIRDER(KDER(ICRD),ISPOT)= FIR12
          GMXFIR(ICNT,ICRD,1)= 0.0D0
          GMXFIR(ICNT,ICRD,2)= 0.0D0
          IF(ABS(FIR1) .GT. CUTOFF) THEN
            CALL DAMULT(FIR1,I,J,K,L,ITYPE,IDER(ICRD),1)
            ETWO1(IDER(ICRD))=ETWO1(IDER(ICRD)) + FIR1*DD
          END IF
          IF(ABS(FIR2) .GT. CUTOFF) THEN
            CALL DAMULT(FIR2,I,J,K,L,ITYPE,JDER(ICRD),1)
            ETWO1(JDER(ICRD))=ETWO1(JDER(ICRD)) + FIR2*DD
          END IF
          IF(ABS(FIR12) .GT. CUTOFF) THEN
            CALL DAMULT(FIR12,I,J,K,L,ITYPE,KDER(ICRD),1)
            ETWO1(KDER(ICRD))=ETWO1(KDER(ICRD)) + FIR12*DD
          END IF
  100   CONTINUE
        GO TO 350
  150   CONTINUE
C
C   KK.EQ.LL.EQ.JJ .NE. II               2 CENTER INTEGRAL
C
        DO 200 ICRD=1,3
          FIR1=GMXFIR(ICNT,ICRD,1)
          FIRDER(IDER(ICRD),ISPOT)= FIR1
          FIRDER(KDER(ICRD),ISPOT)= -FIR1
          GMXFIR(ICNT,ICRD,1)= 0.0D0
          IF(ABS(FIR1) .GT. CUTOFF) THEN
            CALL DAMULT(FIR1,I,J,K,L,ITYPE,IDER(ICRD),1)
            ETWO1(IDER(ICRD))=ETWO1(IDER(ICRD)) + FIR1*DD
            CALL DAMULT(-FIR1,I,J,K,L,ITYPE,KDER(ICRD),1)
            ETWO1(KDER(ICRD))=ETWO1(KDER(ICRD)) - FIR1*DD
          END IF
  200   CONTINUE
        GO TO 450
  250   CONTINUE
C
C   KK.EQ.LL.EQ.II .NE. JJ      2 CENTER INTEGRAL
C
        DO 300 ICRD=1,3
          FIR=GMXFIR(ICNT,ICRD,1)
          FIRDER(JDER(ICRD),ISPOT)= FIR
          FIRDER(IDER(ICRD),ISPOT)= -FIR
          GMXFIR(ICNT,ICRD,1)= 0.0D0
          IF(ABS(FIR) .GT. CUTOFF) THEN
            CALL DAMULT(FIR,I,J,K,L,ITYPE,JDER(ICRD),1)
            ETWO1(JDER(ICRD))=ETWO1(JDER(ICRD)) + FIR*DD
            CALL DAMULT(-FIR,I,J,K,L,ITYPE,IDER(ICRD),1)
            ETWO1(IDER(ICRD))=ETWO1(IDER(ICRD)) - FIR*DD
          END IF
  300   CONTINUE
        GO TO 550
C
C   SECOND DERIVATVES
C
C   KK.EQ.LL .NE. II .NE. JJ     3 CENTER INTEGRAL
C
  350   CONTINUE
        DO 400 ICRD=1,9
          IF(ICRD .LE. 6) THEN
            SEC1=GMXSEC(ICNT,ICRD,1)
            SEC2=GMXSEC(ICNT,ICRD,2)
            SEC3=GMXFF(ICNT,N2II(ICRD,1),1)
            SEC4=GMXFF(ICNT,N2II(ICRD,2),1)
C           SECDER(IIDER(ICRD),ISPOT)= SEC1
C           SECDER(JJDER(ICRD),ISPOT)= SEC2
            SECOND=SEC1 + SEC2 + SEC3 + SEC4
C           SECDER(KKDER(ICRD),ISPOT)= SECOND
            IF(ABS(SEC1) .GT. CUTOFF) THEN
              CALL DAMULT(SEC1,I,J,K,L,ITYPE,IIDER(ICRD),2)
              ETWO2(IIDER(ICRD))=ETWO2(IIDER(ICRD)) + SEC1*DD
            END IF
            IF(ABS(SEC2) .GT. CUTOFF) THEN
              CALL DAMULT(SEC2,I,J,K,L,ITYPE,JJDER(ICRD),2)
              ETWO2(JJDER(ICRD))=ETWO2(JJDER(ICRD)) + SEC2*DD
            END IF
            IF(ABS(SECOND) .GT. CUTOFF) THEN
              CALL DAMULT(SECOND,I,J,K,L,ITYPE,KKDER(ICRD),2)
              ETWO2(KKDER(ICRD))=ETWO2(KKDER(ICRD)) + SECOND*DD
            END IF
          END IF
          SEC1=GMXSEC(ICNT,N2IK(ICRD),1)
          SEC2=GMXSEC(ICNT,N2IK(ICRD),2)
          SEC3=GMXFF(ICNT,ICRD,1)
          SEC4=GMXFF(ICNT,N2KI(ICRD),1)
          IF(KK .GT. JJ) SEC4=GMXFF(ICNT,ICRD,1)
          SEC13= - SEC1 - SEC3
          SEC24= - SEC2 - SEC4
C         SECDER(IKDER(ICRD),ISPOT)= SEC13
C         SECDER(JKDER(ICRD),ISPOT)= SEC24
C         SECDER(IJDER(ICRD),ISPOT)= SEC3
          IF(ABS(SEC13) .GT. CUTOFF) THEN
            CALL DAMULT(SEC13,I,J,K,L,ITYPE,IKDER(ICRD),2)
            ETWO2(IKDER(ICRD))=ETWO2(IKDER(ICRD)) + SEC13*DD
          END IF
          IF(ABS(SEC24) .GT. CUTOFF) THEN
            CALL DAMULT(SEC24,I,J,K,L,ITYPE,JKDER(ICRD),2)
            ETWO2(JKDER(ICRD))=ETWO2(JKDER(ICRD)) + SEC24*DD
          END IF
          IF(ABS(SEC3) .GT. CUTOFF) THEN
            CALL DAMULT(SEC3,I,J,K,L,ITYPE,IJDER(ICRD),2)
            ETWO2(IJDER(ICRD))=ETWO2(IJDER(ICRD)) + SEC3*DD
          END IF
  400   CONTINUE
        DO 410 ICRD=1,9
          GMXFF(ICNT,ICRD,1)= 0.0D0
          IF(ICRD .LE. 6) THEN
            GMXSEC(ICNT,ICRD,1)= 0.0D0
            GMXSEC(ICNT,ICRD,2)= 0.0D0
          END IF
  410   CONTINUE
        GO TO 650
  450   CONTINUE
C
C   KK.EQ.LL.EQ.JJ  .NE. II              2 CENTER INTEGRAL
C
        DO 500 ICRD=1,6
          N1POS=N2II(ICRD,1)
          N2POS=N2II(ICRD,2)
          SEC1=GMXSEC(ICNT,ICRD,1)
C         SECDER(IIDER(ICRD),ISPOT)= SEC1
C         SECDER(KKDER(ICRD),ISPOT)= SEC1
C         SECDER(IKDER(N1POS),ISPOT)= -SEC1
C         IF(N1POS .NE. N2POS) SECDER(IKDER(N2POS),ISPOT)= -SEC1
          IF(ABS(SEC1) .GT. CUTOFF) THEN
            CALL DAMULT(SEC1,I,J,K,L,ITYPE,IIDER(ICRD),2)
            ETWO2(IIDER(ICRD))=ETWO2(IIDER(ICRD)) + SEC1*DD
            CALL DAMULT(SEC1,I,J,K,L,ITYPE,KKDER(ICRD),2)
            ETWO2(KKDER(ICRD))=ETWO2(KKDER(ICRD)) + SEC1*DD
            CALL DAMULT(-SEC1,I,J,K,L,ITYPE,IKDER(N1POS),2)
            ETWO2(IKDER(N1POS))=ETWO2(IKDER(N1POS)) - SEC1*DD
            IF(N1POS .NE. N2POS) THEN
              CALL DAMULT(-SEC1,I,J,K,L,ITYPE,IKDER(N2POS),2)
              ETWO2(IKDER(N2POS))=ETWO2(IKDER(N2POS)) - SEC1*DD
            END IF
          END IF
  500   CONTINUE
        DO 510 ICRD=1,6
          GMXSEC(ICNT,ICRD,1)= 0.0D0
  510   CONTINUE
        GO TO 750
  550   CONTINUE
C
C   KK.EQ.LL.EQ.II .NE. JJ      2 CENTER INTEGRAL
C
        DO 600 ICRD=1,6
          N1POS=N2II(ICRD,1)
          N2POS=N2II(ICRD,2)
          SEC=GMXSEC(ICNT,ICRD,1)
C         SECDER(JJDER(ICRD),ISPOT)= SEC
C         SECDER(IIDER(ICRD),ISPOT)= SEC
C         SECDER(IJDER(N1POS),ISPOT)= -SEC
C         IF(N1POS .NE. N2POS) SECDER(IJDER(N2POS),ISPOT)= -SEC
          IF(ABS(SEC) .GT. CUTOFF) THEN
            CALL DAMULT(SEC,I,J,K,L,ITYPE,JJDER(ICRD),2)
            ETWO2(JJDER(ICRD))=ETWO2(JJDER(ICRD)) + SEC*DD
            CALL DAMULT(SEC,I,J,K,L,ITYPE,IIDER(ICRD),2)
            ETWO2(IIDER(ICRD))=ETWO2(IIDER(ICRD)) + SEC*DD
            CALL DAMULT(-SEC,I,J,K,L,ITYPE,IJDER(N1POS),2)
            ETWO2(IJDER(N1POS))=ETWO2(IJDER(N1POS)) - SEC*DD
            IF(N1POS .NE. N2POS) THEN
              CALL DAMULT(-SEC,I,J,K,L,ITYPE,IJDER(N2POS),2)
              ETWO2(IJDER(N2POS))=ETWO2(IJDER(N2POS)) - SEC*DD
            END IF
          END IF
  600   CONTINUE
        DO 610 ICRD=1,6
          GMXSEC(ICNT,ICRD,1)= 0.0D0
  610   CONTINUE
        GO TO 850
C
C   THIRD DERIVATIVES
C
C   KK.EQ.LL .NE. II .NE. JJ               3 CENTER INTEGRAL
C
  650   CONTINUE
        DO 700 ICRD=1,27
          IF(ICRD .LE. 10) THEN
            THR1=GMXTHR(ICNT,ICRD,1)
            THR2=GMXTHR(ICNT,ICRD,2)
            N1POS=N3III(ICRD,1)
            N2POS=N3III(ICRD,2)
            N3POS=N3III(ICRD,3)
            THR3=GMXFS(ICNT,N1POS,1)
            THR4=GMXFS(ICNT,N2POS,1)
            THR5=GMXFS(ICNT,N3POS,1)
            THR6=GMXFS(ICNT,N1POS,2)
            THR7=GMXFS(ICNT,N2POS,2)
            THR8=GMXFS(ICNT,N3POS,2)
            THIRD=-THR1-THR2-THR3-THR4-THR5-THR6-THR7-THR8
C           THRDER(ISPOT,IIIDER(ICRD))=THR1
C           THRDER(ISPOT,JJJDER(ICRD))=THR2
C           THRDER(ISPOT,KKKDER(ICRD))=THIRD
            IF(ABS(THR1) .GT. CUTOFF) THEN
C             CALL DAMULT(THR1,I,J,K,L,ITYPE,IIIDER(ICRD),3)
              ETWO3(IIIDER(ICRD))=ETWO3(IIIDER(ICRD)) + THR1*DD
            END IF
            IF(ABS(THR2) .GT. CUTOFF) THEN
C             CALL DAMULT(THR2,I,J,K,L,ITYPE,JJJDER(ICRD),3)
              ETWO3(JJJDER(ICRD))=ETWO3(JJJDER(ICRD)) + THR2*DD
            END IF
            IF(ABS(THIRD) .GT. CUTOFF) THEN
C             CALL DAMULT(THIRD,I,J,K,L,ITYPE,KKKDER(ICRD),3)
              ETWO3(KKKDER(ICRD))=ETWO3(KKKDER(ICRD)) + THIRD*DD
            END IF
          END IF
C
          IF(ICRD .LE. 18) THEN
            N1POS=N3IIK(ICRD,1)
            THR1=GMXTHR(ICNT,N1POS,1)
            THR2=GMXTHR(ICNT,N1POS,2)
            THR3=GMXFS(ICNT,ICRD,1)
            THR4=GMXFS(ICNT,ICRD,2)
            THR13=-THR1-THR3
            THR24=-THR2-THR4
C           THRDER(ISPOT,IIKDER(ICRD))=THR13
C           THRDER(ISPOT,JJKDER(ICRD))=THR24
C           THRDER(ISPOT,IIJDER(ICRD))=THR3
C           THRDER(ISPOT,IJJDER(ICRD))=THR4
            IF(ABS(THR13) .GT. CUTOFF) THEN
C             CALL DAMULT(THR13,I,J,K,L,ITYPE,IIKDER(ICRD),3)
              ETWO3(IIKDER(ICRD))=ETWO3(IIKDER(ICRD)) + THR13*DD
            END IF
            IF(ABS(THR24) .GT. CUTOFF) THEN
C             CALL DAMULT(THR24,I,J,K,L,ITYPE,JJKDER(ICRD),3)
              ETWO3(JJKDER(ICRD))=ETWO3(JJKDER(ICRD)) + THR24*DD
            END IF
            IF(ABS(THR3) .GT. CUTOFF) THEN
C             CALL DAMULT(THIRD,I,J,K,L,ITYPE,IIJDER(ICRD),3)
              ETWO3(IIJDER(ICRD))=ETWO3(IIJDER(ICRD)) + THR3*DD
            END IF
            IF(ABS(THR4) .GT. CUTOFF) THEN
C             CALL DAMULT(THIRD,I,J,K,L,ITYPE,IJJDER(ICRD),3)
              ETWO3(IJJDER(ICRD))=ETWO3(IJJDER(ICRD)) + THR4*DD
            END IF
C
            N3POS=N3JKK(ICRD,1)
            N4POS=N3JKK(ICRD,2)
            THR3=GMXFS(ICNT,ICRD,1)
            THR4=GMXFS(ICNT,ICRD,2)
            THR5=GMXFS(ICNT,N3POS,1)
            THR6=GMXFS(ICNT,N3POS,2)
            THR7=GMXFS(ICNT,N4POS,1)
            THR8=GMXFS(ICNT,N4POS,2)
            THRIKK=THR1 + THR4 + THR5 + THR7
            THRJKK=THR2 + THR3 + THR6 + THR8
C           THRDER(ISPOT,IKKDER(ICRD))=THRIKK
C           THRDER(ISPOT,JKKDER(ICRD))=THRJKK
            IF(ABS(THRIKK) .GT. CUTOFF) THEN
C             CALL DAMULT(THRIKK,I,J,K,L,ITYPE,IKKDER(ICRD),3)
              ETWO3(IKKDER(ICRD))=ETWO3(IKKDER(ICRD)) + THRIKK*DD
            END IF
            IF(ABS(THRJKK) .GT. CUTOFF) THEN
C             CALL DAMULT(THRJKK,I,J,K,L,ITYPE,JKKDER(ICRD),3)
              ETWO3(JKKDER(ICRD))=ETWO3(JKKDER(ICRD)) + THRJKK*DD
            END IF
          END IF
C
          I1=1
          I2=2
          IF(KK .GT. JJ) THEN
            I1=3
            I2=4
          END IF
          N1POS=N3IJK(ICRD,I1)
          N2POS=N3IJK(ICRD,I2)
          THR1=GMXFS(ICNT,N1POS,1)
          THR2=GMXFS(ICNT,N2POS,2)
          THR12=-THR1-THR2
C         THRDER(ISPOT,IJKDER(ICRD))=THR12
          IF(ABS(THR12) .GT. CUTOFF) THEN
C           CALL DAMULT(THR12,I,J,K,L,ITYPE,IJKDER(ICRD),3)
            ETWO3(IJKDER(ICRD))=ETWO3(IJKDER(ICRD)) + THR12*DD
          END IF
C
  700   CONTINUE
        DO 710 ICRD=1,18
          IF(ICRD .LE. 10) THEN
            GMXTHR(ICNT,ICRD,1)=0.0D0
            GMXTHR(ICNT,ICRD,2)=0.0D0
          END IF
          GMXFS(ICNT,ICRD,1)=0.0D0
          GMXFS(ICNT,ICRD,2)=0.0D0
  710   CONTINUE
        GO TO 950
C
C   KK.EQ.LL.EQ.JJ .NE. II               2 CENTER INTEGRAL
C
  750   CONTINUE
        DO 800 ICRD=1,10
          THR1=GMXTHR(ICNT,ICRD,1)
          N1POS=N3III(ICRD,1)
          N2POS=N3III(ICRD,2)
          N3POS=N3III(ICRD,3)
C         THRDER(ISPOT,IIIDER(ICRD))=THR1
C         THRDER(ISPOT,KKKDER(ICRD))=-THR1
C         THRDER(ISPOT,IIKDER(N1POS))=-THR1
C         THRDER(ISPOT,IKKDER(N1POS))= THR1
C         IF(N3POS .NE. N1POS) THEN
C           THRDER(ISPOT,IIKDER(N3POS))=-THR1
C           THRDER(ISPOT,IKKDER(N3POS))= THR1
C           IF(N2POS .NE. N1POS) THEN
C             THRDER(ISPOT,IIKDER(N2POS))=-THR1
C             THRDER(ISPOT,IKKDER(N2POS))= THR1
C           END IF
C         END IF
          IF(ABS(THR1) .GT. CUTOFF) THEN
C           CALL DAMULT(THR1,I,J,K,L,ITYPE,IIIDER(ICRD),3)
            ETWO3(IIIDER(ICRD))=ETWO3(IIIDER(ICRD)) + THR1*DD
C           CALL DAMULT(-THR1,I,J,K,L,ITYPE,KKKDER(ICRD),3)
            ETWO3(KKKDER(ICRD))=ETWO3(KKKDER(ICRD)) - THR1*DD
C           CALL DAMULT(-THR1,I,J,K,L,ITYPE,IIKDER(N1POS),3)
            ETWO3(IIKDER(N1POS))=ETWO3(IIKDER(N1POS)) - THR1*DD
C           CALL DAMULT(THR1,I,J,K,L,ITYPE,IKKDER(N1POS),3)
            ETWO3(IKKDER(N1POS))=ETWO3(IKKDER(N1POS)) + THR1*DD
            IF(N3POS .NE. N1POS) THEN
C             CALL DAMULT(-THR1,I,J,K,L,ITYPE,IIKDER(N3POS),3)
              ETWO3(IIKDER(N3POS))=ETWO3(IIKDER(N3POS)) - THR1*DD
C             CALL DAMULT(THR1,I,J,K,L,ITYPE,IKKDER(N3POS),3)
              ETWO3(IKKDER(N3POS))=ETWO3(IKKDER(N3POS)) + THR1*DD
              IF(N2POS .NE. N1POS) THEN
C               CALL DAMULT(-THR1,I,J,K,L,ITYPE,IIKDER(N2POS),3)
                ETWO3(IIKDER(N2POS))=ETWO3(IIKDER(N2POS)) - THR1*DD
C               CALL DAMULT(THR1,I,J,K,L,ITYPE,IKKDER(N2POS),3)
                ETWO3(IKKDER(N2POS))=ETWO3(IKKDER(N2POS)) + THR1*DD
              END IF
            END IF
          END IF
          GMXTHR(ICNT,ICRD,1)=0.0D0
  800   CONTINUE
        GO TO 950
C
C   KK.EQ.LL.EQ.II .NE. JJ      2 CENTER INTEGRAL
C
  850   CONTINUE
        DO 900 ICRD=1,10
          THR1=GMXTHR(ICNT,ICRD,1)
          N1POS=N3III(ICRD,1)
          N2POS=N3III(ICRD,2)
          N3POS=N3III(ICRD,3)
C         THRDER(ISPOT,JJJDER(ICRD))=THR1
C         THRDER(ISPOT,IIIDER(ICRD))=-THR1
C         THRDER(ISPOT,IJJDER(N1POS))=-THR1
C         THRDER(ISPOT,IIJDER(N1POS))= THR1
C         IF(N3POS .NE. N1POS) THEN
C           THRDER(ISPOT,IJJDER(N3POS))=-THR1
C           THRDER(ISPOT,IIJDER(N3POS))= THR1
C           IF(N2POS .NE. N1POS) THEN
C             THRDER(ISPOT,IJJDER(N2POS))=-THR1
C             THRDER(ISPOT,IIJDER(N2POS))= THR1
C           END IF
C         END IF
          IF(ABS(THR1) .GT. CUTOFF) THEN
C           CALL DAMULT(THR1,I,J,K,L,ITYPE,JJJDER(ICRD),3)
            ETWO3(JJJDER(ICRD))=ETWO3(JJJDER(ICRD)) + THR1*DD
C           CALL DAMULT(-THR1,I,J,K,L,ITYPE,IIIDER(ICRD),3)
            ETWO3(IIIDER(ICRD))=ETWO3(IIIDER(ICRD)) - THR1*DD
C           CALL DAMULT(-THR1,I,J,K,L,ITYPE,IJJDER(N1POS),3)
            ETWO3(IJJDER(N1POS))=ETWO3(IJJDER(N1POS)) - THR1*DD
C           CALL DAMULT(THR1,I,J,K,L,ITYPE,IIJDER(N1POS),3)
            ETWO3(IIJDER(N1POS))=ETWO3(IIJDER(N1POS)) + THR1*DD
            IF(N3POS .NE. N1POS) THEN
C             CALL DAMULT(-THR1,I,J,K,L,ITYPE,IJJDER(N3POS),3)
              ETWO3(IJJDER(N3POS))=ETWO3(IJJDER(N3POS)) - THR1*DD
C             CALL DAMULT(THR1,I,J,K,L,ITYPE,IIJDER(N3POS),3)
              ETWO3(IIJDER(N3POS))=ETWO3(IIJDER(N3POS)) + THR1*DD
              IF(N2POS .NE. N1POS) THEN
C               CALL DAMULT(-THR1,I,J,K,L,ITYPE,IJJDER(N2POS),3)
                ETWO3(IJJDER(N2POS))=ETWO3(IJJDER(N2POS)) - THR1*DD
C               CALL DAMULT(THR1,I,J,K,L,ITYPE,IIJDER(N2POS),3)
                ETWO3(IIJDER(N2POS))=ETWO3(IIJDER(N2POS)) + THR1*DD
              END IF
            END IF
          END IF
          GMXTHR(ICNT,ICRD,1)=0.0D0
  900   CONTINUE
C
  950   CONTINUE
C
 1000 CONTINUE
C
      RETURN
      END
      SUBROUTINE VINT(GT,GU,GV,VX,VY,VZ,FIRB,FIRK,VXD,VYD,VZD
     *,               V1DER,SECMXB,SECMXK,MX1B1K,VXTWO,VYTWO,VZTWO
     *,               V2DER,V1B1K,THRMXB,THRMXK,MX2B1K,MX1B2K
     *,               V1B2K,V2B1K,VXTHRE,VYTHRE,VZTHRE,V3DER,EONE3
     *,               IJORB,DEN1T,BOTH,EQUAL)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 MX1B1K,MX2B1K,MX1B2K
      LOGICAL BOTH,EQUAL,IABCII,IABCJJ
      DIMENSION GT(LARGL2,NS,LARGL),GU(LARGL2,NS,LARGL)
     *,         GV(LARGL2,NS,LARGL)
      DIMENSION VX(IANGSQ),VY(IANGSQ),VZ(IANGSQ),VXD(IANGSQ,2)
     *,         VYD(IANGSQ,2),VZD(IANGSQ,2),V1DER(NUMIJ,N3N)
     *,         FIRB(IMEM2,3),FIRK(IMEM2,3),IJORB(IMEM2)
      DIMENSION VXTWO(IANGSQ,2),VYTWO(IANGSQ,2),VZTWO(IANGSQ,2)
     *,         V2DER(NUMIJ,I2N3N),V1B1K(IANGSQ,3),SECMXB(IMEM2,6)
     *,         SECMXK(IMEM2,6),MX1B1K(IMEM2,9)
      DIMENSION VXTHRE(IANGSQ,2),VYTHRE(IANGSQ,2),VZTHRE(IANGSQ,2)
     *,         V3DER(NUMIJ,I3N3N),V2B1K(IANGSQ,3),V1B2K(IANGSQ,3)
     *,         THRMXB(IMEM2,10),THRMXK(IMEM2,10),MX2B1K(IMEM2,18)
     *,         MX1B2K(IMEM2,18)
      DIMENSION SECBK(6),FIRBK(3),THRBK(10),EONE3(I3N3N),DEN1T(NUMIJ)
      COMMON/EINFO/IPLACE(49),ISAME(49)
      COMMON/EXYZS/EX(686),EY(686),EZ(686)
      COMMON/FILES/IOUT,INPUT,IDBG
      COMMON/FIRDR/IDER(3),JDER(3),KDER(3)
      COMMON/INDEX/IX(84),IY(84),IZ(84),JX(84),JY(84),JZ(84)
      COMMON/IPAR1/NS,N3N,I2N3N,I3N3N
      COMMON/IPAR2/NBFAO,NUMIJ,NUMNUM
      COMMON/IPAR4/IMEM,IMEM2,IMEM4
      COMMON/IPAR5/IANG,IANGSQ,LARGL,LARGL2,I2LARL,I4LARL
      COMMON/KEEP3/IDRVT,IDRVF
      COMMON/NARRY/N2II(6,2),N2IK(9),N2KI(9),N2IK2(9,3),N3III(10,3)
      COMMON/NARR2/N3IIK(18,4),N3IKK(18,3),N3IJK(27,6),N3JKK(18,2)
      COMMON/POSNS/IJX(50),IJY(50),IJZ(50),KLX(50),KLY(50),KLZ(50)
      COMMON/SECDR/IKDER(9),IJDER(9),JKDER(9),IIDER(6),JJDER(6)
     *,            KKDER(6)
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/STSTP/NTU(200),NTL(200)
      COMMON/SVIFO/AA,BB,AA2,BB2,PFACT,IORB1,IORBMX,JORB1,JORBMX
     *,            IQN,JQN,II,JJ
      COMMON/THRDR/IIIDER(10),JJJDER(10),KKKDER(10),IIJDER(18)
     *,            IJJDER(18),IIKDER(18),IKKDER(18),JJKDER(18)
     *,            JKKDER(18),IJKDER(27)
      DATA  ASRTPI / 1.1283791670955126D0/
C
C
C%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
C%%%NUCLEAR ATTRACTION TERM%%%
C%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
C
      ISIZ= 7
      ISIZ2= 14
      ISIZ3= 21
C
      AAAA4=AA*AA*4.0D0
      AAA8=AA*AA*AA*8.0D0
      BB2=BB*2.0D0
      BBBB4=BB*BB*4.0D0
      BBS2=-BB*BB*2.0D0
      AABB4=AA*BB*4.0D0
      A4B2=AAAA4*BBS2
      A2B2=AA2*BBS2
      A8B2=AAA8*BBS2
      A8=AA*AA*AA*8.0D0
      B8=BB*BB*BB*8.0D0
      A4=AA2*AA2
      B4=BB2*BB2
      AB4=AA2*BB2
      BBA8=BB*BB*AA*8.0D0
      AAB8=AA*AA*BB*8.0D0
      NROOTS=(IQN+JQN-2)/2 + 4
C
      DO 6000 IABC=1,NS
        IABCII=IABC.EQ.II
        IABCJJ=IABC.EQ.JJ
        IF(EQUAL .AND. IABC .EQ. II) GO TO 6000
        CALL IARRY(IABC,KDER,KKDER,KKKDER)
        IF(IABCII .OR. IABCJJ) GO TO 55
        IF(IABC .GT. II) THEN
          CALL IJARRY(IABC,II,KDER,IDER,IKDER,IKKDER,IIKDER)
          CALL IJARRY(IABC,JJ,KDER,JDER,JKDER,JKKDER,JJKDER)
          CALL IJKARY(IABC,II,JJ,IJKDER)
        ELSE
          CALL IJARRY(II,IABC,IDER,KDER,IKDER,IIKDER,IKKDER)
          IF(IABC .GT. JJ) THEN
            CALL IJARRY(IABC,JJ,KDER,JDER,JKDER,JKKDER,JJKDER)
            CALL IJKARY(II,IABC,JJ,IJKDER)
          ELSE
            CALL IJARRY(JJ,IABC,JDER,KDER,JKDER,JJKDER,JKKDER)
            CALL IJKARY(II,JJ,IABC,IJKDER)
          END IF
        END IF
   55   CONTINUE
        ISZ=IMEM2*3
        CALL ZERO(FIRB,ISZ)
        ISZ=IMEM2*6
        CALL ZERO(SECMXB,ISZ)
        ISZ=IMEM2*10
        CALL ZERO(THRMXB,ISZ)
        ISZ=IMEM2*9
        CALL ZERO(MX1B1K,ISZ)
        ISZ=IMEM2*18
        CALL ZERO(MX2B1K,ISZ)
        CALL ZERO(MX1B2K,ISZ)
        ISZ=IMEM2*3
        CALL ZERO(FIRK,ISZ)
        ISZ=IMEM2*6
        CALL ZERO(SECMXK,ISZ)
        ISZ=IMEM2*10
        CALL ZERO(THRMXK,ISZ)
        DO 5000 IROOT=1,NROOTS
          IN=-IANG
          IM=-ISIZ
          DO 4000 INO=1,IQN
            DUMI=DBLE(INO-1)
            DUMI2=DBLE(2*INO-1)
            DUMM2=DBLE(INO-2)
            DUMP2=DBLE(INO+1)
            DUMIM1=DBLE((INO-1)*(INO-2))
            A2DI=AA2*DUMI2
            IN=IN + IANG
            IM=IM + ISIZ
            DO 3000 JNO=1,JQN
              JN=IN + JNO
              JM=IM + JNO
C
              DUMJ=DBLE(JNO-1)
              DUMJ2=DBLE(2*JNO-1)
              DUNN2=DBLE(JNO-2)
              DUNP2=DBLE(JNO+1)
              DUMJM1=DBLE((JNO-1)*(JNO-2))
              B2DJ=BB2*DUMJ2
              B2DI=BB2*DUMI
              DIDJ=DUMI*DUMJ
              MM1=AA2*DUMI*(DUMM2 + DUMI2)
              NM1=BB2*DUMJ*(DUNN2 + DUMJ2)
              MP1=AA2*AA2*(DUMI2 + DUMP2)
              NP1=BB2*BB2*(DUMJ2 + DUNP2)
              MNP0P1=AA2*BB2*DUMI2
              MNP1P0=AA2*BB2*DUMJ2
              MNM2M1=DUMI*DUMJ*DUMM2
              MNP2M1=AA2*AA2*DUMJ
              MNP0M1=AA2*DUMJ*DUMI2
              MNP1M2=AA2*DUMJ*DUNN2
              MNM2P1=BB2*DUMI*DUMM2
              MNM1M2=DUMI*DUMJ*DUNN2
              MNM1P2=BB2*BB2*DUMI
              MNM1P0=BB2*DUMI*DUMJ2
              A2DJ=AA2*DUMJ
C
              IPL=IPLACE(JM)
              IF(JNO .GT. 2) THEN
                JM0M2=JM-2
                IM0M2=IPLACE(JM0M2)
                JP1M2=JM+ISIZ-2
                IP1M2=IPLACE(JP1M2)
              END IF
              IF(JNO .GT. 1) THEN
                JM0M1=JM-1
                IM0M1=IPLACE(JM0M1)
                JP1M1=JM-1+ISIZ
                IP1M1=IPLACE(JP1M1)
                JP2M1=JM+ISIZ2-1
                IP2M1=IPLACE(JP2M1)
                IF(INO .GT. 1) THEN
                  JM1M1=JM-1-ISIZ
                  IM1M1=IPLACE(JM1M1)
                  IF(JNO .GT. 2) THEN
                    JM1M2=JM-ISIZ-2
                    IM1M2=IPLACE(JM1M2)
                  END IF
                  IF(INO .GT. 2) THEN
                    JM2M1=JM-ISIZ2-1
                    IM2M1=IPLACE(JM2M1)
                  END IF
                END IF
              END IF
              IF(INO .GT. 2) THEN
                JM2M0=JM-ISIZ2
                IM2M0=IPLACE(JM2M0)
                JM2P1=JM-ISIZ2+1
                IM2P1=IPLACE(JM2P1)
              END IF
              IF(INO .GT. 1) THEN
                JM1M0=JM-ISIZ
                IM1M0=IPLACE(JM1M0)
                JM1P1=JM-ISIZ+1
                IM1P1=IPLACE(JM1P1)
                JM1P2=JM-ISIZ+2
                IM1P2=IPLACE(JM1P2)
              END IF
              JP0P1=JM+1
              IP0P1=IPLACE(JP0P1)
              JP1P0=JM+ISIZ
              IP1P0=IPLACE(JP1P0)
              JP0P2=JM+2
              IP0P2=IPLACE(JP0P2)
              JP2P0=JM+ISIZ2
              IP2P0=IPLACE(JP2P0)
              JP2P1=JM+ISIZ2+1
              IP2P1=IPLACE(JP2P1)
              JP3P0=JM+ISIZ3
              IP3P0=IPLACE(JP3P0)
              JP0P3=JM+3
              IP0P3=IPLACE(JP0P3)
              JP1P1=JM+1+ISIZ
              IP1P1=IPLACE(JP1P1)
              JP1P2=JM+ISIZ+2
              IP1P2=IPLACE(JP1P2)
C
C   THE NORMAL NUCLEAR ATTRACTION TERMS
C
              IJNO=INO + JNO - 1
              VXX=0.0D0
              VYY=0.0D0
              VZZ=0.0D0
              MAX=IJNO
              ITWO=2
              IF(ISAME(JM) .EQ. 1) ITWO=1
              DO 410 IMAX=1,MAX
                ISPOT=IPL + (IMAX-1)*ITWO
                VXX= VXX + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                VYY= VYY + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                VZZ= VZZ + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  410         CONTINUE
              VX(JN)=VXX
              VY(JN)=VYY
              VZ(JN)=VZZ
C
C   FIRST DERIVATIVES ON BRA
C
              IF(IABCII) GO TO 465
              MAX=IJNO + 1
              ITWO=2
              IF(ISAME(JP1P0) .EQ. 1) ITWO=1
              VXP1B=0.0D0
              VYP1B=0.0D0
              VZP1B=0.0D0
              DO 420 IMAX=1,MAX
                ISPOT=IP1P0 + (IMAX-1)*ITWO
                VXP1B=VXP1B + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                VYP1B=VYP1B + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                VZP1B=VZP1B + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  420         CONTINUE
              VXDERB=VXP1B*AA2
              VYDERB=VYP1B*AA2
              VZDERB=VZP1B*AA2
C
              IF(INO .GT. 1) THEN
                VXM1B=0.0D0
                VYM1B=0.0D0
                VZM1B=0.0D0
                MAX=IJNO -1
                ITWO=2
                IF(ISAME(JM1M0) .EQ. 1) ITWO=1
                DO 430 IMAX=1,MAX
                  ISPOT=IM1M0 + (IMAX-1)*ITWO
                  VXM1B=VXM1B + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                  VYM1B=VYM1B + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                  VZM1B=VZM1B + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  430           CONTINUE
C
                VXDERB=VXDERB - VXM1B*DUMI
                VYDERB=VYDERB - VYM1B*DUMI
                VZDERB=VZDERB - VZM1B*DUMI
              END IF
C
              VXD(JN,1)= VXDERB
              VYD(JN,1)= VYDERB
              VZD(JN,1)= VZDERB
C
C   SECOND DERIVATIVES ON BRA
C
              MAX=IJNO + 2
              ITWO=2
              IF(ISAME(JP2P0) .EQ. 1) ITWO=1
              VXX=0.0D0
              VYY=0.0D0
              VZZ=0.0D0
              DO 440 IMAX=1,MAX
                ISPOT=IP2P0 + (IMAX-1)*ITWO
                VXX=VXX + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                VYY=VYY + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                VZZ=VZZ + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  440         CONTINUE
              VXDERB= VXX*AAAA4
              VYDERB= VYY*AAAA4
              VZDERB= VZZ*AAAA4
C
              IF(INO .GT. 2) THEN
                MAX=IJNO - 2
                ITWO=2
                IF(ISAME(JM2M0) .EQ. 1) ITWO=1
                VXX=0.0D0
                VYY=0.0D0
                VZZ=0.0D0
                DO 450 IMAX=1,MAX
                  ISPOT=IM2M0 + (IMAX-1)*ITWO
                  VXX=VXX + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                  VYY=VYY + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                  VZZ=VZZ + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  450           CONTINUE
                VXDERB=VXDERB + VXX*2.0D0
                VYDERB=VYDERB + VYY*2.0D0
                VZDERB=VZDERB + VZZ*2.0D0
              END IF
C
              VXDERB=VXDERB - A2DI*VX(JN)
              VYDERB=VYDERB - A2DI*VY(JN)
              VZDERB=VZDERB - A2DI*VZ(JN)
C
              VXTWO(JN,1)= VXDERB
              VYTWO(JN,1)= VYDERB
              VZTWO(JN,1)= VZDERB
C
C   BRA THIRD DERIVATIVES
C
              MAX=IJNO + 3
              ITWO=2
              IF(ISAME(JP3P0) .EQ. 1) ITWO=1
              VXXX=0.0D0
              VYYY=0.0D0
              VZZZ=0.0D0
              DO 460 IMAX=1,MAX
                ISPOT=IP3P0 + (IMAX-1)*ITWO
                VXXX=VXXX + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                VYYY=VYYY + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                VZZZ=VZZZ + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  460         CONTINUE
              VX3B= A8*VXXX
              VY3B= A8*VYYY
              VZ3B= A8*VZZZ
C
              IF(INO .GT. 1) THEN
                DUMMY=6.0D0*AA*DUMI*DUMI
                VX3B=VX3B + DUMMY*VXM1B
                VY3B=VY3B + DUMMY*VYM1B
                VZ3B=VZ3B + DUMMY*VZM1B
              END IF
C
              DUMMY=A4*3.0D0*INO
              VX3B= VX3B - DUMMY*VXP1B
              VY3B= VY3B - DUMMY*VYP1B
              VZ3B= VZ3B - DUMMY*VZP1B
C
              VXTHRE(JN,1)=  VX3B
              VYTHRE(JN,1)=  VY3B
              VZTHRE(JN,1)=  VZ3B
  465         CONTINUE
C
C   FIRST DERIVATIVES ON KET
C
              IF(IABCJJ) GO TO 515
              MAX=IJNO + 1
              ITWO=2
              IF(ISAME(JP0P1) .EQ. 1) ITWO=1
              VXP1K=0.0D0
              VYP1K=0.0D0
              VZP1K=0.0D0
              DO 470 IMAX=1,MAX
                ISPOT=IP0P1 + (IMAX-1)*ITWO
                VXP1K=VXP1K + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                VYP1K=VYP1K + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                VZP1K=VZP1K + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  470         CONTINUE
              VXDERK= VXP1K*BB2
              VYDERK= VYP1K*BB2
              VZDERK= VZP1K*BB2
 
              IF(JNO .GT. 1) THEN
                MAX=IJNO - 1
                ITWO=2
                IF(ISAME(JM0M1) .EQ. 1) ITWO=1
                VXM1K=0.0D0
                VYM1K=0.0D0
                VZM1K=0.0D0
                DO 480 IMAX=1,MAX
                  ISPOT=IM0M1 + (IMAX-1)*ITWO
                  VXM1K=VXM1K + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                  VYM1K=VYM1K + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                  VZM1K=VZM1K + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  480           CONTINUE
                VXDERK=VXDERK - VXM1K*DUMJ
                VYDERK=VYDERK - VYM1K*DUMJ
                VZDERK=VZDERK - VZM1K*DUMJ
              END IF
C
              VXD(JN,2)= VXDERK
              VYD(JN,2)= VYDERK
              VZD(JN,2)= VZDERK
C
C   SECOND DERIVATIVES ON THE KET
C
              MAX=IJNO + 2
              ITWO=2
              IF(ISAME(JP0P2) .EQ. 1) ITWO=1
              VXX=0.0D0
              VYY=0.0D0
              VZZ=0.0D0
              DO 490 IMAX=1,MAX
                ISPOT=IP0P2 + (IMAX-1)*ITWO
                VXX=VXX + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                VYY=VYY + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                VZZ=VZZ + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  490         CONTINUE
              VXDERK= VXX*BBBB4
              VYDERK= VYY*BBBB4
              VZDERK= VZZ*BBBB4
C
              IF(JNO .GT. 2) THEN
                MAX=IJNO -2
                ITWO=2
                IF(ISAME(JM0M2) .EQ. 1) ITWO=1
                VXX=0.0D0
                VYY=0.0D0
                VZZ=0.0D0
                DO 500 IMAX=1,MAX
                  ISPOT=IM0M2 + (IMAX-1)*ITWO
                  VXX=VXX + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                  VYY=VYY + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                  VZZ=VZZ + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  500           CONTINUE
                VXDERK=VXDERK + VXX*DUMJM1
                VYDERK=VYDERK + VYY*DUMJM1
                VZDERK=VZDERK + VZZ*DUMJM1
              END IF
C
              VXDERK=VXDERK - B2DJ*VX(JN)
              VYDERK=VYDERK - B2DJ*VY(JN)
              VZDERK=VZDERK - B2DJ*VZ(JN)
C
              VXTWO(JN,2)=  VXDERK
              VYTWO(JN,2)=  VYDERK
              VZTWO(JN,2)=  VZDERK
C
C   KET THIRD DERIVATIVES
C
              MAX=IJNO + 3
              ITWO=2
              IF(ISAME(JP0P3) .EQ. 1) ITWO=1
              VXXX=0.0D0
              VYYY=0.0D0
              VZZZ=0.0D0
              DO 510 IMAX=1,MAX
                ISPOT=IP0P3 + (IMAX-1)*ITWO
                VXXX=VXXX + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                VYYY=VYYY + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                VZZZ=VZZZ + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  510         CONTINUE
              VX3K= B8*VXXX
              VY3K= B8*VYYY
              VZ3K= B8*VZZZ
C
              IF(JNO .GT. 1) THEN
                DUMMY=6.0D0*BB*DUMJ*DUMJ
                VX3K=VX3K + DUMMY*VXM1K
                VY3K=VY3K + DUMMY*VYM1K
                VZ3K=VZ3K + DUMMY*VZM1K
              END IF
C
              DUMMY=B4*3.0D0*JNO
              VX3K= VX3K - DUMMY*VXP1K
              VY3K= VY3K - DUMMY*VYP1K
              VZ3K= VZ3K - DUMMY*VZP1K
C
              VXTHRE(JN,2)=  VX3K
              VYTHRE(JN,2)=  VY3K
              VZTHRE(JN,2)=  VZ3K
  515         CONTINUE
C
C   SIMULTANOUS FIRST DERIVATIVES ON BRA AND KET : VXXTEM
C
              IF(IABCII .OR. IABCJJ) GO TO 560
              VXX=0.0D0
              VYY=0.0D0
              VZZ=0.0D0
              MAX=IJNO + 2
              ITWO=2
              IF(ISAME(JP1P1) .EQ. 1) ITWO=1
              DO 520 IMAX=1,MAX
                ISPOT=IP1P1 + (IMAX-1)*ITWO
                VXX=VXX + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                VYY=VYY + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                VZZ=VZZ + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  520         CONTINUE
              VXXTEM= AABB4*VXX
              VYYTEM= AABB4*VYY
              VZZTEM= AABB4*VZZ
C
              IF(INO .LE. 1) GO TO 545
              VXX=0.0D0
              VYY=0.0D0
              VZZ=0.0D0
              MAX=IJNO
              ITWO=2
              IF(ISAME(JM1P1) .EQ. 1) ITWO=1
              DO 530 IMAX=1,MAX
                ISPOT=IM1P1 + (IMAX-1)*ITWO
                IPLUS=IMAX + 1
                VXX=VXX + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                VYY=VYY + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                VZZ=VZZ + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  530         CONTINUE
              VXXTEM=VXXTEM - VXX*B2DI
              VYYTEM=VYYTEM - VYY*B2DI
              VZZTEM=VZZTEM - VZZ*B2DI
C
              IF(JNO .LE. 1) GO TO 545
              VXX=0.0D0
              VYY=0.0D0
              VZZ=0.0D0
              MAX=IJNO - 2
              ITWO=2
              IF(ISAME(JM1M1) .EQ. 1) ITWO=1
              DO 540 IMAX=1,MAX
                ISPOT=IM1M1 + (IMAX-1)*ITWO
                VXX=VXX + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                VYY=VYY + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                VZZ=VZZ + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  540         CONTINUE
              VXXTEM=VXXTEM + DIDJ*VXX
              VYYTEM=VYYTEM + DIDJ*VYY
              VZZTEM=VZZTEM + DIDJ*VZZ
  545         CONTINUE
C
              IF(JNO .LE. 1) GO TO 555
              VXX=0.0D0
              VYY=0.0D0
              VZZ=0.0D0
              MAX=IJNO
              ITWO=2
              IF(ISAME(JP1M1) .EQ. 1) ITWO=1
              DO 550 IMAX=1,MAX
                ISPOT=IP1M1 + (IMAX-1)*ITWO
                VXX=VXX + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                VYY=VYY + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                VZZ=VZZ + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  550         CONTINUE
              VXXTEM=VXXTEM - A2DJ*VXX
              VYYTEM=VYYTEM - A2DJ*VYY
              VZZTEM=VZZTEM - A2DJ*VZZ
C
  555         CONTINUE
C
              V1B1K(JN,1)= VXXTEM
              V1B1K(JN,2)= VYYTEM
              V1B1K(JN,3)= VZZTEM
  560         CONTINUE
C
C   SIMULTANEOUS SECOND DERIVATIVES ON BRA AND FIRST ON KET : V2B1K
C
C                        AND
C
C   SIMULTANEOUS FIRST DERIVATIVES ON BRA AND SECOND ON KET : V1B2K
C
              IF(IABCII .OR. IABCJJ) GO TO 3000
              MAX=IJNO + 3
              ITWO=2
              JTWO=2
              IF(ISAME(JP2P1) .EQ. 1) ITWO=1
              IF(ISAME(JP1P2) .EQ. 1) JTWO=1
              VXP2P1=0.0D0
              VYP2P1=0.0D0
              VZP2P1=0.0D0
              VXP1P2=0.0D0
              VYP1P2=0.0D0
              VZP1P2=0.0D0
              DO 570 IMAX=1,MAX
                IMAXM1=IMAX-1
                ISPOT=IP2P1 + IMAXM1*ITWO
                JSPOT=IP1P2 + IMAXM1*JTWO
                VXP2P1=VXP2P1 + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                VYP2P1=VYP2P1 + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                VZP2P1=VZP2P1 + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
                VXP1P2=VXP1P2 + EX(JSPOT)*GT(IMAX,IABC,IROOT)
                VYP1P2=VYP1P2 + EY(JSPOT)*GU(IMAX,IABC,IROOT)
                VZP1P2=VZP1P2 + EZ(JSPOT)*GV(IMAX,IABC,IROOT)
  570         CONTINUE
              VX2B1K= AAB8*VXP2P1
              VY2B1K= AAB8*VYP2P1
              VZ2B1K= AAB8*VZP2P1
              VX1B2K= BBA8*VXP1P2
              VY1B2K= BBA8*VYP1P2
              VZ1B2K= BBA8*VZP1P2
C
              DUMMY=AB4*DUMI2
              VX2B1K= VX2B1K - DUMMY*VXP1K
              VY2B1K= VY2B1K - DUMMY*VYP1K
              VZ2B1K= VZ2B1K - DUMMY*VZP1K
              DUMMY=AB4*DUMJ2
              VX1B2K= VX1B2K - DUMMY*VXP1B
              VY1B2K= VY1B2K - DUMMY*VYP1B
              VZ1B2K= VZ1B2K - DUMMY*VZP1B
C
              IF(INO .GT. 2) THEN
                MAX=IJNO - 1
                ITWO=2
                IF(ISAME(JM2P1) .EQ. 1) ITWO=1
                VXM2P1=0.0D0
                VYM2P1=0.0D0
                VZM2P1=0.0D0
                DO 580 IMAX=1,MAX
                  IMAXM1=IMAX-1
                  ISPOT=IM2P1 + IMAXM1*ITWO
                  VXM2P1=VXM2P1 + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                  VYM2P1=VYM2P1 + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                  VZM2P1=VZM2P1 + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  580           CONTINUE
                DUMMY=BB2*DUMIM1
                VX2B1K= VX2B1K + DUMMY*VXM2P1
                VY2B1K= VY2B1K + DUMMY*VYM2P1
                VZ2B1K= VZ2B1K + DUMMY*VZM2P1
C
                IF(JNO .GT. 1) THEN
                  MAX=IJNO - 3
                  ITWO=2
                  IF(ISAME(JM2M1) .EQ. 1) ITWO=1
                  VXM2M1=0.0D0
                  VYM2M1=0.0D0
                  VZM2M1=0.0D0
                  DO 590 IMAX=1,MAX
                    IMAXM1=IMAX-1
                    ISPOT=IM2M1 + IMAXM1*ITWO
                    VXM2M1=VXM2M1 + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                    VYM2M1=VYM2M1 + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                    VZM2M1=VZM2M1 + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  590             CONTINUE
                  DUMMY=DUMIM1*DUMJ
                  VX2B1K= VX2B1K - DUMMY*VXM2M1
                  VY2B1K= VY2B1K - DUMMY*VYM2M1
                  VZ2B1K= VZ2B1K - DUMMY*VZM2M1
                END IF
              END IF
C
              IF(JNO .GT. 1) THEN
                MAX=IJNO + 1
                ITWO=2
                IF(ISAME(JP2M1) .EQ. 1) ITWO=1
                VXP2M1=0.0D0
                VYP2M1=0.0D0
                VZP2M1=0.0D0
                DO 600 IMAX=1,MAX
                  IMAXM1=IMAX-1
                  ISPOT=IP2M1 + IMAXM1*ITWO
                  VXP2M1=VXP2M1 + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                  VYP2M1=VYP2M1 + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                  VZP2M1=VZP2M1 + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  600           CONTINUE
                DUMMY=A4*DUMJ
                VX2B1K= VX2B1K - DUMMY*VXP2M1
                VY2B1K= VY2B1K - DUMMY*VYP2M1
                VZ2B1K= VZ2B1K - DUMMY*VZP2M1
 
                DUMMY=AA2*DUMJ*DUMI2
                VX2B1K= VX2B1K + DUMMY*VXM1K
                VY2B1K= VY2B1K + DUMMY*VYM1K
                VZ2B1K= VZ2B1K + DUMMY*VZM1K
              END IF
 
              IF(JNO .GT. 2) THEN
                MAX=IJNO - 1
                ITWO=2
                IF(ISAME(JP1M2) .EQ. 1) ITWO=1
                VXP1M2=0.0D0
                VYP1M2=0.0D0
                VZP1M2=0.0D0
                DO 610 IMAX=1,MAX
                  IMAXM1=IMAX-1
                  ISPOT=IP1M2 + IMAXM1*ITWO
                  VXP1M2=VXP1M2 + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                  VYP1M2=VYP1M2 + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                  VZP1M2=VZP1M2 + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  610           CONTINUE
                DUMMY=AA2*DUMJM1
                VX1B2K= VX1B2K + DUMMY*VXP1M2
                VY1B2K= VY1B2K + DUMMY*VYP1M2
                VZ1B2K= VZ1B2K + DUMMY*VZP1M2
C
                IF(INO .GT. 1) THEN
                  MAX=IJNO - 3
                  ITWO=2
                  IF(ISAME(JM1M2) .EQ. 1) ITWO=1
                  VXM1M2=0.0D0
                  VYM1M2=0.0D0
                  VZM1M2=0.0D0
                  DO 620 IMAX=1,MAX
                    IMAXM1=IMAX-1
                    ISPOT=IM1M2 + IMAXM1*ITWO
                    VXM1M2=VXM1M2 + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                    VYM1M2=VYM1M2 + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                    VZM1M2=VZM1M2 + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  620             CONTINUE
                  DUMMY=DUMJM1*DUMI
                  VX1B2K= VX1B2K - DUMMY*VXM1M2
                  VY1B2K= VY1B2K - DUMMY*VYM1M2
                  VZ1B2K= VZ1B2K - DUMMY*VZM1M2
                END IF
              END IF
C
              IF(INO .GT. 1) THEN
                MAX=IJNO + 1
                ITWO=2
                IF(ISAME(JM1P2) .EQ. 1) ITWO=1
                VXM1P2=0.0D0
                VYM1P2=0.0D0
                VZM1P2=0.0D0
                DO 630 IMAX=1,MAX
                  IMAXM1=IMAX-1
                  ISPOT=IM1P2 + IMAXM1*ITWO
                  VXM1P2=VXM1P2 + EX(ISPOT)*GT(IMAX,IABC,IROOT)
                  VYM1P2=VYM1P2 + EY(ISPOT)*GU(IMAX,IABC,IROOT)
                  VZM1P2=VZM1P2 + EZ(ISPOT)*GV(IMAX,IABC,IROOT)
  630           CONTINUE
                DUMMY=B4*DUMI
                VX1B2K= VX1B2K - DUMMY*VXM1P2
                VY1B2K= VY1B2K - DUMMY*VYM1P2
                VZ1B2K= VZ1B2K - DUMMY*VZM1P2
C
                DUMMY=BB2*DUMI*DUMJ2
                VX1B2K= VX1B2K + DUMMY*VXM1B
                VY1B2K= VY1B2K + DUMMY*VYM1B
                VZ1B2K= VZ1B2K + DUMMY*VZM1B
              END IF
C
              V2B1K(JN,1)= VX2B1K
              V2B1K(JN,2)= VY2B1K
              V2B1K(JN,3)= VZ2B1K
 
              V1B2K(JN,1)= VX1B2K
              V1B2K(JN,2)= VY1B2K
              V1B2K(JN,3)= VZ1B2K
C
 3000       CONTINUE
 4000     CONTINUE
C
C   SUM UP THE CONTRIBUTIONS
C
          ICNT=0
          DO 900 IORB=IORB1,IORBMX
            IF(BOTH) JORBMX=IORB
            DO 800 JORB=JORB1,JORBMX
              ICNT=ICNT + 1
              IPOSX=IJX(ICNT)
              IPOSY=IJY(ICNT)
              IPOSZ=IJZ(ICNT)
              IJPOSN=IOFF(MAX0(IORB,JORB)) + MIN0(IORB,JORB)
              IJORB(ICNT)=IJPOSN
C
              Z0TEMP=VZ(IPOSZ)*ASRTPI
              Z1TEMB=VZD(IPOSZ,1)*ASRTPI
              Z1TEMK=VZD(IPOSZ,2)*ASRTPI
              Z2TEMB=VZTWO(IPOSZ,1)*ASRTPI
              Z2TEMK=VZTWO(IPOSZ,2)*ASRTPI
              Z1B1K=V1B1K(IPOSZ,3)*ASRTPI
              Z2B1K=V2B1K(IPOSZ,3)*ASRTPI
              Z1B2K=V1B2K(IPOSZ,3)*ASRTPI
              Z3TEMB=VZTHRE(IPOSZ,1)*ASRTPI
              Z3TEMK=VZTHRE(IPOSZ,2)*ASRTPI
C
              IF(IABCII) GO TO 710
              FIRB(ICNT,1)=FIRB(ICNT,1) + VXD(IPOSX,1)*VY(IPOSY)*Z0TEMP
              FIRB(ICNT,2)=FIRB(ICNT,2) + VYD(IPOSY,1)*VX(IPOSX)*Z0TEMP
              FIRB(ICNT,3)=FIRB(ICNT,3) + VX(IPOSX)*VY(IPOSY)*Z1TEMB
  710         CONTINUE
C
              IF(IABCJJ) GO TO 715
              FIRK(ICNT,1)=FIRK(ICNT,1) + VXD(IPOSX,2)*VY(IPOSY)*Z0TEMP
              FIRK(ICNT,2)=FIRK(ICNT,2) + VYD(IPOSY,2)*VX(IPOSX)*Z0TEMP
              FIRK(ICNT,3)=FIRK(ICNT,3) + VX(IPOSX)*VY(IPOSY)*Z1TEMK
  715         CONTINUE
C
C   SECOND DERIVATIVES
C
              IF(IABCII) GO TO 720
              SECMXB(ICNT,1)=SECMXB(ICNT,1) + VXTWO(IPOSX,1)*VY(IPOSY)
     *                      *Z0TEMP
              SECMXB(ICNT,2)=SECMXB(ICNT,2) + VXD(IPOSX,1)*VYD(IPOSY,1)
     *                      *Z0TEMP
              SECMXB(ICNT,3)=SECMXB(ICNT,3) + VYTWO(IPOSY,1)*VX(IPOSX)
     *                      *Z0TEMP
              SECMXB(ICNT,4)=SECMXB(ICNT,4) + VXD(IPOSX,1)*VY(IPOSY)
     *                      *Z1TEMB
              SECMXB(ICNT,5)=SECMXB(ICNT,5) + VYD(IPOSY,1)*VX(IPOSX)
     *                      *Z1TEMB
              SECMXB(ICNT,6)=SECMXB(ICNT,6) + VX(IPOSX)*VY(IPOSY)*Z2TEMB
  720         CONTINUE
C
                          IF(IABCJJ) GO TO 725
                          SECMXK(ICNT,1)=SECMXK(ICNT,1) + VXTWO(IPOSX,2
     *                    )*VY(IPOSY)*Z0TEMP
                          SECMXK(ICNT,2)=SECMXK(ICNT,2) + VXD(IPOSX,2)*
     *                    VYD(IPOSY,2)*Z0TEMP
                          SECMXK(ICNT,3)=SECMXK(ICNT,3) + VYTWO(IPOSY,2
     *                    )*VX(IPOSX)*Z0TEMP
                          SECMXK(ICNT,4)=SECMXK(ICNT,4) + VXD(IPOSX,2)*
     *                    VY(IPOSY)*Z1TEMK
                          SECMXK(ICNT,5)=SECMXK(ICNT,5) + VYD(IPOSY,2)*
     *                    VX(IPOSX)*Z1TEMK
                          SECMXK(ICNT,6)=SECMXK(ICNT,6) + VX(IPOSX)*VY(
     *                    IPOSY)*Z2TEMK
  725                     CONTINUE
C
                          IF(IABCII .OR. IABCJJ) GO TO 730
                          MX1B1K(ICNT,1)=MX1B1K(ICNT,1) + V1B1K(IPOSX,
     *                    1)*VY(IPOSY)*Z0TEMP
                          MX1B1K(ICNT,2)=MX1B1K(ICNT,2) + VXD(IPOSX,1)*
     *                    VYD(IPOSY,2)*Z0TEMP
                          MX1B1K(ICNT,3)=MX1B1K(ICNT,3) + VXD(IPOSX,1)*
     *                    VY(IPOSY)*Z1TEMK
                          MX1B1K(ICNT,4)=MX1B1K(ICNT,4) + VXD(IPOSX,2)*
     *                    VYD(IPOSY,1)*Z0TEMP
                          MX1B1K(ICNT,5)=MX1B1K(ICNT,5) + V1B1K(IPOSY,
     *                    2)*VX(IPOSX)*Z0TEMP
                          MX1B1K(ICNT,6)=MX1B1K(ICNT,6) + VX(IPOSX)*VYD
     *                    (IPOSY,1)*Z1TEMK
                          MX1B1K(ICNT,7)=MX1B1K(ICNT,7) + VXD(IPOSX,2)*
     *                    VY(IPOSY)*Z1TEMB
                          MX1B1K(ICNT,8)=MX1B1K(ICNT,8) + VYD(IPOSY,2)*
     *                    VX(IPOSX)*Z1TEMB
                          MX1B1K(ICNT,9)=MX1B1K(ICNT,9) + VX(IPOSX)*VY(
     *                    IPOSY)*Z1B1K
  730                     CONTINUE
C
C   THIRD DERIVATIVES
C
                          IF(IABCII) GO TO 735
                          THRMXB(ICNT,1)=THRMXB(ICNT,1) + VXTHRE(IPOSX,
     *                    1)*VY(IPOSY)*Z0TEMP
                          THRMXB(ICNT,2)=THRMXB(ICNT,2) + VXTWO(IPOSX,1)
     *                    *VYD(IPOSY,1)*Z0TEMP
                          THRMXB(ICNT,3)=THRMXB(ICNT,3) + VXD(IPOSX,1)*
     *                    VYTWO(IPOSY,1)*Z0TEMP
                          THRMXB(ICNT,4)=THRMXB(ICNT,4) + VX(IPOSX)*
     *                    VYTHRE(IPOSY,1)*Z0TEMP
                          THRMXB(ICNT,5)=THRMXB(ICNT,5) + VXTWO(IPOSX,1)
     *                    *VY(IPOSY)*Z1TEMB
                          THRMXB(ICNT,6)=THRMXB(ICNT,6) + VXD(IPOSX,1)*
     *                    VYD(IPOSY,1)*Z1TEMB
                          THRMXB(ICNT,7)=THRMXB(ICNT,7) + VX(IPOSX)*
     *                    VYTWO(IPOSY,1)*Z1TEMB
                          THRMXB(ICNT,8)=THRMXB(ICNT,8) + VXD(IPOSX,1)*
     *                    VY(IPOSY)*Z2TEMB
                          THRMXB(ICNT,9)=THRMXB(ICNT,9) + VX(IPOSX)*
     *                    VYD(IPOSY,1)*Z2TEMB
                          THRMXB(ICNT,10)=THRMXB(ICNT,10) + VX(IPOSX)*
     *                    VY(IPOSY)*Z3TEMB
  735                     CONTINUE
C
                          IF(IABCJJ) GO TO 740
                          THRMXK(ICNT,1)=THRMXK(ICNT,1) + VXTHRE(IPOSX,
     *                    2)*VY(IPOSY)*Z0TEMP
                          THRMXK(ICNT,2)=THRMXK(ICNT,2) + VXTWO(IPOSX,2)
     *                    *VYD(IPOSY,2)*Z0TEMP
                          THRMXK(ICNT,3)=THRMXK(ICNT,3) + VXD(IPOSX,2)*
     *                    VYTWO(IPOSY,2)*Z0TEMP
                          THRMXK(ICNT,4)=THRMXK(ICNT,4) + VX(IPOSX)*
     *                    VYTHRE(IPOSY,2)*Z0TEMP
                          THRMXK(ICNT,5)=THRMXK(ICNT,5) + VXTWO(IPOSX,2)
     *                    *VY(IPOSY)*Z1TEMK
                          THRMXK(ICNT,6)=THRMXK(ICNT,6) + VXD(IPOSX,2)*
     *                    VYD(IPOSY,2)*Z1TEMK
                          THRMXK(ICNT,7)=THRMXK(ICNT,7) + VX(IPOSX)*
     *                    VYTWO(IPOSY,2)*Z1TEMK
                          THRMXK(ICNT,8)=THRMXK(ICNT,8) + VXD(IPOSX,2)*
     *                    VY(IPOSY)*Z2TEMK
                          THRMXK(ICNT,9)=THRMXK(ICNT,9) + VX(IPOSX)*
     *                    VYD(IPOSY,2)*Z2TEMK
                          THRMXK(ICNT,10)=THRMXK(ICNT,10) + VX(IPOSX)*
     *                    VY(IPOSY)*Z3TEMK
  740                     CONTINUE
C
                          IF(IABCII .OR. IABCJJ) GO TO 800
                          MX2B1K(ICNT,1)=MX2B1K(ICNT,1) + V2B1K(IPOSX,1)
     *                    *VY(IPOSY)*Z0TEMP
                          MX2B1K(ICNT,2)=MX2B1K(ICNT,2) + VXTWO(IPOSX,1)
     *                    *VYD(IPOSY,2)*Z0TEMP
                          MX2B1K(ICNT,3)=MX2B1K(ICNT,3) + VXTWO(IPOSX,1)
     *                    *VY(IPOSY)*Z1TEMK
                          MX2B1K(ICNT,4)=MX2B1K(ICNT,4) + V1B1K(IPOSX,1)
     *                    *VYD(IPOSY,1)*Z0TEMP
                          MX2B1K(ICNT,5)=MX2B1K(ICNT,5) + V1B1K(IPOSY,2)
     *                    *VXD(IPOSX,1)*Z0TEMP
                          MX2B1K(ICNT,6)=MX2B1K(ICNT,6) + VXD(IPOSX,1)*
     *                    VYD(IPOSY,1)*Z1TEMK
                          MX2B1K(ICNT,7)=MX2B1K(ICNT,7) + V1B1K(IPOSX,1)
     *                    *VY(IPOSY)*Z1TEMB
                          MX2B1K(ICNT,8)=MX2B1K(ICNT,8) + VXD(IPOSX,1)*
     *                    VYD(IPOSY,2)*Z1TEMB
                          MX2B1K(ICNT,9)=MX2B1K(ICNT,9) + VXD(IPOSX,1)*
     *                    VY(IPOSY)*Z1B1K
                          MX2B1K(ICNT,10)=MX2B1K(ICNT,10) + VXD(IPOSX,2)
     *                    *VYTWO(IPOSY,1)*Z0TEMP
                          MX2B1K(ICNT,11)=MX2B1K(ICNT,11) + VX(IPOSX)*
     *                    V2B1K(IPOSY,2)*Z0TEMP
                          MX2B1K(ICNT,12)=MX2B1K(ICNT,12) + VX(IPOSX)*
     *                    VYTWO(IPOSY,1)*Z1TEMK
                          MX2B1K(ICNT,13)=MX2B1K(ICNT,13) + VXD(IPOSX,2)
     *                    *VYD(IPOSY,1)*Z1TEMB
                          MX2B1K(ICNT,14)=MX2B1K(ICNT,14) + VX(IPOSX)*
     *                    V1B1K(IPOSY,2)*Z1TEMB
                          MX2B1K(ICNT,15)=MX2B1K(ICNT,15) + VX(IPOSX)*
     *                    VYD(IPOSY,1)*Z1B1K
                          MX2B1K(ICNT,16)=MX2B1K(ICNT,16) + VXD(IPOSX,2)
     *                    *VY(IPOSY)*Z2TEMB
                          MX2B1K(ICNT,17)=MX2B1K(ICNT,17) + VX(IPOSX)*
     *                    VYD(IPOSY,2)*Z2TEMB
                          MX2B1K(ICNT,18)=MX2B1K(ICNT,18) + VX(IPOSX)*
     *                    VY(IPOSY)*Z2B1K
C
                          MX1B2K(ICNT,1)=MX1B2K(ICNT,1) + V1B2K(IPOSX,1)
     *                    *VY(IPOSY)*Z0TEMP
                          MX1B2K(ICNT,2)=MX1B2K(ICNT,2) + VXTWO(IPOSX,2)
     *                    *VYD(IPOSY,1)*Z0TEMP
                          MX1B2K(ICNT,3)=MX1B2K(ICNT,3) + VXTWO(IPOSX,2)
     *                    *VY(IPOSY)*Z1TEMB
                          MX1B2K(ICNT,4)=MX1B2K(ICNT,4) + V1B1K(IPOSX,1)
     *                    *VYD(IPOSY,2)*Z0TEMP
                          MX1B2K(ICNT,5)=MX1B2K(ICNT,5) + V1B1K(IPOSY,2)
     *                    *VXD(IPOSX,2)*Z0TEMP
                          MX1B2K(ICNT,6)=MX1B2K(ICNT,6) + VXD(IPOSX,2)*
     *                    VYD(IPOSY,2)*Z1TEMB
                          MX1B2K(ICNT,7)=MX1B2K(ICNT,7) + V1B1K(IPOSX,1)
     *                    *VY(IPOSY)*Z1TEMK
                          MX1B2K(ICNT,8)=MX1B2K(ICNT,8) + VXD(IPOSX,2)*
     *                    VYD(IPOSY,1)*Z1TEMK
                          MX1B2K(ICNT,9)=MX1B2K(ICNT,9) + VXD(IPOSX,2)*
     *                    VY(IPOSY)*Z1B1K
                          MX1B2K(ICNT,10)=MX1B2K(ICNT,10) + VXD(IPOSX,1)
     *                    *VYTWO(IPOSY,2)*Z0TEMP
                          MX1B2K(ICNT,11)=MX1B2K(ICNT,11) + VX(IPOSX)*
     *                    V1B2K(IPOSY,2)*Z0TEMP
                          MX1B2K(ICNT,12)=MX1B2K(ICNT,12) + VX(IPOSX)*
     *                    VYTWO(IPOSY,2)*Z1TEMB
                          MX1B2K(ICNT,13)=MX1B2K(ICNT,13) + VXD(IPOSX,1)
     *                    *VYD(IPOSY,2)*Z1TEMK
                          MX1B2K(ICNT,14)=MX1B2K(ICNT,14) + VX(IPOSX)*
     *                    V1B1K(IPOSY,2)*Z1TEMK
                          MX1B2K(ICNT,15)=MX1B2K(ICNT,15) + VX(IPOSX)*
     *                    VYD(IPOSY,2)*Z1B1K
                          MX1B2K(ICNT,16)=MX1B2K(ICNT,16) + VXD(IPOSX,1)
     *                    *VY(IPOSY)*Z2TEMK
                          MX1B2K(ICNT,17)=MX1B2K(ICNT,17) + VX(IPOSX)*
     *                    VYD(IPOSY,1)*Z2TEMK
                          MX1B2K(ICNT,18)=MX1B2K(ICNT,18) + VX(IPOSX)*
     *                    VY(IPOSY)*Z1B2K
  800                   CONTINUE
  900                 CONTINUE
                      ISTOP=ICNT
C
 5000               CONTINUE
C
C   WE NOW PUT THE DERIVATIVES TOGETHER
C
                    DO 5500 ICNT=1,ISTOP
                      IJ=IJORB(ICNT)
C
C   FIRST DERIVATIVES
C
                      DO 910 ICRD=1,3
                        FIRBK(ICRD)= FIRB(ICNT,ICRD) + FIRK(ICNT,ICRD)
C                       WRITE(IOUT,'(F20.10)')FIRBK(ICRD)
  910                 CONTINUE
                      IF(EQUAL) THEN
                        DO 920 ICRD=1,3
                          V1DER(IJ,IDER(ICRD))= V1DER(IJ,IDER(ICRD))
     *                                         + FIRBK(ICRD)
                          V1DER(IJ,KDER(ICRD))= V1DER(IJ,KDER(ICRD))
     *                                         - FIRBK(ICRD)
  920                   CONTINUE
C
                      ELSE
                        DO 930 ICRD=1,3
                          IF(IABCII) THEN
                            V1DER(IJ,IDER(ICRD))= V1DER(IJ,IDER(ICRD))
     *                                           - FIRK(ICNT,ICRD)
                          ELSE
                            V1DER(IJ,IDER(ICRD))= V1DER(IJ,IDER(ICRD))
     *                                           + FIRB(ICNT,ICRD)
                            IF(.NOT. IABCJJ) THEN
                              V1DER(IJ,KDER(ICRD))=V1DER(IJ,KDER(ICRD)
     *                        )                   - FIRBK(ICRD)
                            END IF
                          END IF
C
                          IF(IABCJJ) THEN
                            V1DER(IJ,JDER(ICRD))=V1DER(IJ,JDER(ICRD))
     *                                           - FIRB(ICNT,ICRD)
                          ELSE
                            V1DER(IJ,JDER(ICRD))=V1DER(IJ,JDER(ICRD))
     *                                           + FIRK(ICNT,ICRD)
                          END IF
  930                   CONTINUE
C
                      END IF
C
C   SECOND DERIVATIVES
C
                    DO 940 ICRD=1,6
                      SECBK(ICRD)=SECMXB(ICNT,ICRD) + SECMXK(ICNT,ICRD)
  940               CONTINUE
C
                    IF(EQUAL) THEN
                      DO 950 ICRD=1,9
                        IF(ICRD .LE. 6) THEN
                          N1POS=N2II(ICRD,1)
                          N2POS=N2II(ICRD,2)
                          VALUE=SECBK(ICRD) + MX1B1K(ICNT,N1POS)
     *                                      + MX1B1K(ICNT,N2POS)
                          V2DER(IJ,IIDER(ICRD))= V2DER(IJ,IIDER(ICRD))
     *                       + VALUE
                          V2DER(IJ,KKDER(ICRD))= V2DER(IJ,KKDER(ICRD))
     *                       + VALUE
                        END IF
                        N1POS=N2IK2(ICRD,1)
                        N2POS=N2IK2(ICRD,2)
                        N3POS=N2IK2(ICRD,3)
                        V2DER(IJ,IKDER(ICRD))= V2DER(IJ,IKDER(ICRD))
     *                       - SECBK(N1POS) - MX1B1K(ICNT,N2POS)
     *                       - MX1B1K(ICNT,N3POS)
  950                 CONTINUE
                    ELSE
                      DO 960 ICRD=1,9
                        IF(ICRD .LE. 6) THEN
                          IF(IABCII) THEN
                            V2DER(IJ,IIDER(ICRD))= V2DER(IJ,IIDER(ICRD
     *                      ))                + SECMXK(ICNT,ICRD)
                          ELSE
                            V2DER(IJ,IIDER(ICRD))= V2DER(IJ,IIDER(ICRD
     *                      ))                + SECMXB(ICNT,ICRD)
                          END IF
                          IF(IABCJJ) THEN
                            V2DER(IJ,JJDER(ICRD))= V2DER(IJ,JJDER(ICRD
     *                      ))                + SECMXB(ICNT,ICRD)
                          ELSE
                            V2DER(IJ,JJDER(ICRD))= V2DER(IJ,JJDER(ICRD
     *                      ))                + SECMXK(ICNT,ICRD)
                            IF(.NOT. IABCII) THEN
                              V2DER(IJ,KKDER(ICRD))=V2DER(IJ,KKDER(ICR
     *                                     D)) + SECBK(ICRD)
     *                                   + MX1B1K(ICNT,N2II(ICRD,1))
     *                                   + MX1B1K(ICNT,N2II(ICRD,2))
                            END IF
                          END IF
                        END IF
C
C   MIXED CENTER SECOND DERIVATIVES
C
                        IDRC=ICRD
                        JDRC=ICRD
                        IF(IABC .LT. JJ) JDRC=N2KI(ICRD)
                        IF(IABC .GT. II) IDRC=N2KI(ICRD)
                        IF(IABCII) THEN
                          V2DER(IJ,IJDER(ICRD))= V2DER(IJ,IJDER(ICRD))
     *                                        - SECMXK(ICNT,N2IK(ICRD))
                        ELSE
                          IF(.NOT. IABCJJ) THEN
                            V2DER(IJ,IJDER(ICRD))=V2DER(IJ,IJDER(ICRD)
     *                      )      + MX1B1K(ICNT,ICRD)
                            V2DER(IJ,IKDER(ICRD))=V2DER(IJ,IKDER(ICRD)
     *                      )      - SECMXB(ICNT,N2IK(ICRD))
     *                             - MX1B1K(ICNT,IDRC)
                          END IF
                        END IF
                        IF(IABCJJ) THEN
                          V2DER(IJ,IJDER(ICRD))=V2DER(IJ,IJDER(ICRD))
     *                             - SECMXB(ICNT,N2IK(ICRD))
                        ELSE
                          IF(.NOT. IABCII) THEN
                            V2DER(IJ,JKDER(ICRD))=V2DER(IJ,JKDER(ICRD)
     *                      )    -  SECMXK(ICNT,N2IK(ICRD))
     *                           -  MX1B1K(ICNT,JDRC)
                          END IF
                        END IF
  960                 CONTINUE
                    END IF
C
C   THIRD DERIVATIVES
C
                      DO 970 ICRD=1,10
                        THRBK(ICRD)=THRMXB(ICNT,ICRD)+ THRMXK(ICNT,ICRD)
  970                 CONTINUE
                      IF(IDRVF.LE.2) GO TO 975
C
                      IF(EQUAL) THEN
                        DO 980 ICRD=1,18
                          IF(ICRD .LE. 10) THEN
                            N1POS=N3III(ICRD,1)
                            N2POS=N3III(ICRD,2)
                            N3POS=N3III(ICRD,3)
                            VALUE=THRBK(ICRD)
     *                       +   MX2B1K(ICNT,N1POS) + MX1B2K(ICNT,N1POS)
     *                       +   MX2B1K(ICNT,N2POS) + MX1B2K(ICNT,N2POS)
     *                       +   MX2B1K(ICNT,N3POS) + MX1B2K(ICNT,N3POS)
                            V3DER(IJ,IIIDER(ICRD))=V3DER(IJ,IIIDER
     *                           (ICRD)) + VALUE
                            V3DER(IJ,KKKDER(ICRD))=V3DER(IJ,KKKDER
     *                           (ICRD)) - VALUE
                          END IF
C
C   MIXED CENTER
C
                         N1POS=N3IIK(ICRD,1)
                         N2POS=N3IIK(ICRD,2)
                         N3POS=N3IIK(ICRD,3)
                         N4POS=N3IIK(ICRD,4)
                         VALUE= THRBK(N1POS)
     *                       + MX2B1K(ICNT,N2POS) + MX1B2K(ICNT,N2POS)
     *                       + MX2B1K(ICNT,N3POS) + MX1B2K(ICNT,N3POS)
     *                       + MX2B1K(ICNT,N4POS) + MX1B2K(ICNT,N4POS)
                         FAC1=-1.0D0
                         FAC2=1.0D0
                         V3DER(IJ,IIKDER(ICRD))=V3DER(IJ,IIKDER(ICRD))
     *                         + FAC1*VALUE
                         V3DER(IJ,IKKDER(ICRD))=V3DER(IJ,IKKDER(ICRD))
     *                         + FAC2*VALUE
  980                  CONTINUE
                     ELSE
                       DO 990 ICRD=1,27
                         IF(ICRD .LE. 10) THEN
                           IF(IABCII) THEN
                             V3DER(IJ,IIIDER(ICRD))=V3DER(IJ,IIIDER
     *                       (ICRD))  - THRMXK(ICNT,ICRD)
                           ELSE
                             V3DER(IJ,IIIDER(ICRD))=V3DER(IJ,IIIDER
     *                       (ICRD)) +  THRMXB(ICNT,ICRD)
                             IF(IABCJJ) THEN
                               V3DER(IJ,JJJDER(ICRD))=V3DER(IJ,JJJDER
     *                         (ICRD)) - THRMXB(ICNT,ICRD)
                             ELSE
                               N1POS=N3III(ICRD,1)
                               N2POS=N3III(ICRD,2)
                               N3POS=N3III(ICRD,3)
                               VALUE=THRBK(ICRD)
     *                         + MX2B1K(ICNT,N1POS) + MX1B2K(ICNT,N1POS)
     *                         + MX2B1K(ICNT,N2POS) + MX1B2K(ICNT,N2POS)
     *                         + MX2B1K(ICNT,N3POS) + MX1B2K(ICNT,N3POS)
                               V3DER(IJ,KKKDER(ICRD))=V3DER(IJ,KKKDER
     *                         (ICRD)) - VALUE
                             END IF
                           END IF
                           IF(.NOT. IABCJJ) THEN
                             V3DER(IJ,JJJDER(ICRD))=V3DER(IJ,JJJDER
     *                       (ICRD)) +  THRMXK(ICNT,ICRD)
                           END IF
                        END IF
                        IF(ICRD .LE. 18) THEN
                          N1POS=N3IIK(ICRD,1)
                          N4POS=N3IIK(ICRD,4)
                          IF(IABCII) THEN
                            V3DER(IJ,IIJDER(ICRD))=V3DER(IJ,IIJDER
     *                      (ICRD)) + THRMXK(ICNT,N1POS)
                            V3DER(IJ,IJJDER(ICRD))=V3DER(IJ,IJJDER
     *                      (ICRD)) - THRMXK(ICNT,N1POS)
                          ELSE
                            IF(IABCJJ) THEN
                              V3DER(IJ,IIJDER(ICRD))=V3DER(IJ,IIJDER
     *                        (ICRD)) - THRMXB(ICNT,N1POS)
                              V3DER(IJ,IJJDER(ICRD))=V3DER(IJ,IJJDER
     *                        (ICRD)) + THRMXB(ICNT,N1POS)
                            ELSE
                              N2POS=N3IKK(ICRD,1)
                              N3POS=N3IKK(ICRD,2)
                              N4POS=N3IKK(ICRD,3)
                              V3DER(IJ,IIJDER(ICRD))=V3DER(IJ,IIJDER
     *                        (ICRD)) + MX2B1K(ICNT,ICRD)
                              V3DER(IJ,IJJDER(ICRD))=V3DER(IJ,IJJDER
     *                        (ICRD)) + MX1B2K(ICNT,ICRD)
                              V3DER(IJ,IIKDER(ICRD))=V3DER(IJ,IIKDER
     *                        (ICRD)) - THRMXB(ICNT,N1POS)
     *                        - MX2B1K(ICNT,ICRD)
                              V3DER(IJ,JJKDER(ICRD))=V3DER(IJ,JJKDER
     *                        (ICRD)) - THRMXK(ICNT,N1POS)
     *                        - MX1B2K(ICNT,ICRD)
                              V3DER(IJ,IKKDER(ICRD))=V3DER(IJ,IKKDER
     *                        (ICRD)) + THRMXB(ICNT,N1POS)
     *                        + MX2B1K(ICNT,N2POS) + MX2B1K(ICNT,N3POS)
     *                        + MX1B2K(ICNT,N4POS)
                              V3DER(IJ,JKKDER(ICRD))=V3DER(IJ,JKKDER
     *                        (ICRD)) + THRMXK(ICNT,N1POS)
     *                        + MX1B2K(ICNT,N2POS) + MX1B2K(ICNT,N3POS)
     *                        + MX2B1K(ICNT,N4POS)
                            END IF
                          END IF
                        END IF
                        IF(.NOT. IABCII .AND. .NOT. IABCJJ) THEN
                          N1POS=N3IJK(ICRD,1)
                          N2POS=N3IJK(ICRD,2)
                          IF(IABC .GT. II) THEN
                            N1POS=N3IJK(ICRD,5)
                            N2POS=N3IJK(ICRD,6)
                          END IF
                          IF(IABC .GT. JJ .AND. IABC .LT. II) THEN
                            N1POS=N3IJK(ICRD,3)
                            N2POS=N3IJK(ICRD,4)
                          END IF
                          V3DER(IJ,IJKDER(ICRD))=V3DER(IJ,IJKDER
     *                    (ICRD))
     *                    - MX2B1K(ICNT,N1POS) - MX1B2K(ICNT,N2POS)
                        END IF
  990                 CONTINUE
                      END IF
                      GOTO 998
  975                 CONTINUE
C
C   THIS SECTION IS FOR NOT KEEPING THE 3RD DERIVATIVES, BUT RATHER
C   PRE-MULTIPLYING THEM WITH THE DENSITY MATRIX
C
                      IF(EQUAL) THEN
                        DO 985 ICRD=1,18
                          IF(ICRD .LE. 10) THEN
                            N1POS=N3III(ICRD,1)
                            N2POS=N3III(ICRD,2)
                            N3POS=N3III(ICRD,3)
                            VALUE=THRBK(ICRD)
     *                       +   MX2B1K(ICNT,N1POS) + MX1B2K(ICNT,N1POS)
     *                       +   MX2B1K(ICNT,N2POS) + MX1B2K(ICNT,N2POS)
     *                       +   MX2B1K(ICNT,N3POS) + MX1B2K(ICNT,N3POS)
                            EONE3(IIIDER(ICRD))=EONE3(IIIDER(ICRD))
     *                       + VALUE*DEN1T(IJ)
                            EONE3(KKKDER(ICRD))=EONE3(KKKDER
     *                      (ICRD)) - VALUE*DEN1T(IJ)
                          END IF
C
C   MIXED CENTER
C
                         N1POS=N3IIK(ICRD,1)
                         N2POS=N3IIK(ICRD,2)
                         N3POS=N3IIK(ICRD,3)
                         N4POS=N3IIK(ICRD,4)
                         VALUE= THRBK(N1POS)
     *                       + MX2B1K(ICNT,N2POS) + MX1B2K(ICNT,N2POS)
     *                       + MX2B1K(ICNT,N3POS) + MX1B2K(ICNT,N3POS)
     *                       + MX2B1K(ICNT,N4POS) + MX1B2K(ICNT,N4POS)
                         EONE3(IIKDER(ICRD))=EONE3(IIKDER(ICRD))
     *                         - VALUE*DEN1T(IJ)
                         EONE3(IKKDER(ICRD))=EONE3(IKKDER(ICRD))
     *                         + VALUE*DEN1T(IJ)
  985                  CONTINUE
                     ELSE
                       DO 995 ICRD=1,27
                         IF(ICRD .LE. 10) THEN
                           IF(IABCII) THEN
                             EONE3(IIIDER(ICRD))=EONE3(IIIDER
     *                       (ICRD))  - THRMXK(ICNT,ICRD)*DEN1T(IJ)
                           ELSE
                             EONE3(IIIDER(ICRD))=EONE3(IIIDER
     *                       (ICRD)) +  THRMXB(ICNT,ICRD)*DEN1T(IJ)
                             IF(IABCJJ) THEN
                               EONE3(JJJDER(ICRD))=EONE3(JJJDER
     *                         (ICRD)) - THRMXB(ICNT,ICRD)*DEN1T(IJ)
                             ELSE
                               N1POS=N3III(ICRD,1)
                               N2POS=N3III(ICRD,2)
                               N3POS=N3III(ICRD,3)
                               VALUE=THRBK(ICRD)
     *                         + MX2B1K(ICNT,N1POS) + MX1B2K(ICNT,N1POS)
     *                         + MX2B1K(ICNT,N2POS) + MX1B2K(ICNT,N2POS)
     *                         + MX2B1K(ICNT,N3POS) + MX1B2K(ICNT,N3POS)
                               EONE3(KKKDER(ICRD))=EONE3(KKKDER
     *                         (ICRD)) - VALUE*DEN1T(IJ)
                             END IF
                           END IF
                           IF(.NOT. IABCJJ) THEN
                             EONE3(JJJDER(ICRD))=EONE3(JJJDER
     *                       (ICRD)) +  THRMXK(ICNT,ICRD)*DEN1T(IJ)
                           END IF
                        END IF
                        IF(ICRD .LE. 18) THEN
                          N1POS=N3IIK(ICRD,1)
                          N4POS=N3IIK(ICRD,4)
                          IF(IABCII) THEN
                            EONE3(IIJDER(ICRD))=EONE3(IIJDER
     *                      (ICRD)) + THRMXK(ICNT,N1POS)*DEN1T(IJ)
                            EONE3(IJJDER(ICRD))=EONE3(IJJDER
     *                      (ICRD)) - THRMXK(ICNT,N1POS)*DEN1T(IJ)
                          ELSE
                            IF(IABCJJ) THEN
                              EONE3(IIJDER(ICRD))=EONE3(IIJDER
     *                        (ICRD)) - THRMXB(ICNT,N1POS)*DEN1T(IJ)
                              EONE3(IJJDER(ICRD))=EONE3(IJJDER
     *                        (ICRD)) + THRMXB(ICNT,N1POS)*DEN1T(IJ)
                            ELSE
                              N2POS=N3IKK(ICRD,1)
                              N3POS=N3IKK(ICRD,2)
                              N4POS=N3IKK(ICRD,3)
                              EONE3(IIJDER(ICRD))=EONE3(IIJDER
     *                        (ICRD)) + MX2B1K(ICNT,ICRD)*DEN1T(IJ)
                              EONE3(IJJDER(ICRD))=EONE3(IJJDER
     *                        (ICRD)) + MX1B2K(ICNT,ICRD)*DEN1T(IJ)
                              EONE3(IIKDER(ICRD))=EONE3(IIKDER
     *                        (ICRD)) + (-THRMXB(ICNT,N1POS)
     *                        - MX2B1K(ICNT,ICRD))*DEN1T(IJ)
                              EONE3(JJKDER(ICRD))=EONE3(JJKDER
     *                        (ICRD)) + (-THRMXK(ICNT,N1POS)
     *                        - MX1B2K(ICNT,ICRD))*DEN1T(IJ)
                              EONE3(IKKDER(ICRD))=EONE3(IKKDER
     *                        (ICRD)) + (THRMXB(ICNT,N1POS)
     *                        + MX2B1K(ICNT,N2POS) + MX2B1K(ICNT,N3POS)
     *                        + MX1B2K(ICNT,N4POS))*DEN1T(IJ)
                              EONE3(JKKDER(ICRD))=EONE3(JKKDER
     *                        (ICRD)) + (THRMXK(ICNT,N1POS)
     *                        + MX1B2K(ICNT,N2POS) + MX1B2K(ICNT,N3POS)
     *                        + MX2B1K(ICNT,N4POS))*DEN1T(IJ)
                            END IF
                          END IF
                        END IF
                        IF(.NOT. IABCII .AND. .NOT. IABCJJ) THEN
                          N1POS=N3IJK(ICRD,1)
                          N2POS=N3IJK(ICRD,2)
                          IF(IABC .GT. II) THEN
                            N1POS=N3IJK(ICRD,5)
                            N2POS=N3IJK(ICRD,6)
                          END IF
                          IF(IABC .GT. JJ .AND. IABC .LT. II) THEN
                            N1POS=N3IJK(ICRD,3)
                            N2POS=N3IJK(ICRD,4)
                          END IF
                          EONE3(IJKDER(ICRD))=EONE3(IJKDER(ICRD))
     *                    + (-MX2B1K(ICNT,N1POS) - MX1B2K(ICNT,N2POS))
     *                    *DEN1T(IJ)
                        END IF
  995                 CONTINUE
                      END IF
  998               CONTINUE
 5500               CONTINUE
C
 6000             CONTINUE
C
      RETURN
      END
