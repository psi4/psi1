      SUBROUTINE ABORTS
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      WRITE(NOUT,*) ' ABORTS CALLED '
      WRITE(ICHK,*) ' ABORTS CALLED '
      STOP
      END
      SUBROUTINE ALLOC(ORBTBF,JCODE,IJORD,IOFF,IJDEP,
     .                 ORBSYM,DOFF,DADD,NMA1)
      IMPLICIT INTEGER (A-Z)
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ SYMORB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /FUNCS/ IOCC,JOCC,KOCC,NTYPES,NBSET,NAT
      COMMON /OCCS/ NSPE,NSA,NSB,NALP,NOP,NDOC,LFERM,NUOC,IJIND,IJIND3
      COMMON/OCCS2/NUMCOR,NCOR,FDOC,CORDOC,NUMVIR,FVIR,LUOC,NUMDEP,VUOC
      COMMON/DEP/IJDC,IFZC,IFZV,IZDIM
      DIMENSION ORBTBF(NORBS),JCODE(NORBS),IJORD(NUMIJ),IOFF(NUMIJ)
      DIMENSION IJDEP(NUMIJ)
      DIMENSION ITYP(9)
      DIMENSION ORBSYM(NORBS),DOFF(NUMIJ),DADD(NUMIJ)
C
      WRITE(ICHK,2222)
 2222 FORMAT(/'  IN ALLOC')
      DO 313 I=1,9
        ITYP(I)=0
  313 CONTINUE
C
      DO 314 I=1,NUMIJ
        IOFF(I)=I*(I-1)/2
  314 CONTINUE
C
      DO 315 IORB=1,NORBS
        NTYP=JCODE(IORB)
        IF (NTYP.GT.9 .OR. NTYP.LE.0) THEN
          WRITE(NOUT,201) IORB,NTYP
 201      FORMAT(/'   JCODE(',I3,')=',I4/
     1    '   I DO NOT RECOGNIZE THIS TYPE.')
          CALL ABORTS
        END IF
        ITYP(NTYP)=ITYP(NTYP)+1
  315 CONTINUE
      IF (ITYP(1).NE.0 .OR. ITYP(2).NE.0) THEN
        WRITE(NOUT,202)
 202    FORMAT(/'  THERE ARE SOME FZC OR FZV IN THE DRT'/
     1  '  I CAN NOT RUN A GRADIENT FROM THIS.')
        CALL ABORTS
      END IF
      NUOC=ITYP(4)+ITYP(6)
      LFERM=NUOC+1
      NDOC=NUOC+ITYP(3)+ITYP(5)
CTJL
      NUMVIR = ITYP(4)
      VUOC = NUMVIR*ITYP(6)
      FVIR = ITYP(6) + 1
      LUOC = FVIR - 1
      NUMCOR = ITYP(3)
      NCOR = LFERM + NUMCOR - 1
      FDOC = LFERM + NUMCOR
      IF(NUMCOR.EQ.0) NCOR = -999
      CORDOC = ITYP(5)*NUMCOR
      NUMDEP = VUOC + CORDOC
COUT  WRITE(*,*) ' NUMDEP,CORDOC,VUOC',NUMDEP,CORDOC,VUOC
C     DO 9240 IJ = 1,NUMIJ
C     IJDEP(IJ) = NUMDEP + 1
C9240 CONTINUE
      IJDC = 0
      DO 9200 I = FDOC,NDOC
      DO 9210 J = LFERM,NCOR
      IJ = IOFF(I) + J
      IJDC = IJDC + 1
      IJDEP(IJ) = IJDC
 9210 CONTINUE
 9200 CONTINUE
      IFZC  = FDOC-LFERM
cets  WRITE(*,*) ' THE NUMBER OF FZCOR   ORBITALS IS',IFZC
      DO 9220 I = FVIR,NUOC
      DO 9230 J = 1,LUOC
      IJ = IOFF(I) + J
      IJDC = IJDC + 1
      IJDEP(IJ) = IJDC
 9230 CONTINUE
 9220 CONTINUE
      IFZV  = NUOC-FVIR +1
cets  WRITE(*,*) ' THE NUMBER OF FZVIR   ORBITALS IS',IFZV
cets  WRITE(*,*) ' THE NUMBER OF EXTRA INDEPENDENT  PAIRS IS',IJDC
      IF(NUMDEP.EQ.0) NUMDEP = 1
COUT  WRITE(*,*) ' NUMCOR,NCOR,FDOC,CORDOC',NUMCOR,NCOR,FDOC,CORDOC
CTJL
      NOP=NDOC+1
      NALP=NDOC+ITYP(7)
      NSA=NALP+1
      NSB=NALP+ITYP(9)
      NSPE=ITYP(9)
      IF (NSB.NE.NORBS) THEN
        WRITE(NOUT,203) NSB,NORBS
 203    FORMAT(/'   ORBITALS MISCOUNTED IN ALLOC',2I5)
        CALL ABORTS
      END IF
C
C     WRITE(NOUT,"('  IORB  IBF JCODE')")
C     DO IORB=1,NORBS
C     IBF=ORBTBF(IORB)
C     NTYP=JCODE(IBF)
C     WRITE(NOUT,"(3I5)") IORB,IBF,NTYP
C     END DO
      IF (ITYP(3)+ITYP(5) .EQ. 0) THEN
        WRITE(NOUT,204)
 204    FORMAT(/'  THERE ARE NO DOUBLY OCCUPIED ORBITALS.'/
     1  '  IT IS NECESSARY TO MODIFY THE PROGRAM. ')
        CALL ABORTS
      END IF
C
C  CHECK TO SEE IF THE ORDER OF THE DRT ORBS IS AS EXPECTED
C
CGES  DO 316 IORB=1,NUOC
C       IBF=ORBTBF(IORB)
C       NTYP=JCODE(IBF)
C       IF(NTYP.NE.6 .AND. NTYP.NE.4) GOTO 10
C 316 CONTINUE
C     DO 317 IORB=LFERM,NDOC
C       IBF=ORBTBF(IORB)
C       NTYP=JCODE(IBF)
C       IF(NTYP.NE.3 .AND. NTYP.NE.5) GOTO 10
C 317 CONTINUE
      IF (ITYP(7).EQ.0) THEN
        NOP=0
        NALP=0
      ELSE
        DO 318 IORB=NOP,NALP
          IBF=ORBTBF(IORB)
          IF (JCODE(IBF).NE.7) GOTO 10
  318   CONTINUE
      END IF
      IF (NSPE.EQ.0) THEN
        NSA=0
        NSB=0
      ELSE
        DO 319 IORB=NSA,NSB
          IBF=ORBTBF(IORB)
          IF (JCODE(IBF).NE.9) GOTO 10
  319   CONTINUE
      END IF
      GOTO 12
 10   WRITE(NOUT,205) IORB,IBF,JCODE(IBF)
 205  FORMAT(/'  THE DRT ORBITALS ARE OUT OF ORDER.'/
     1'  IORB=',I5,'  IBF=',I5,'  NTYPE=',I5)
      CALL ABORTS
 12   CONTINUE
      WRITE(NOUT,206) 1,NUOC,LFERM,NDOC
 206  FORMAT(/'  THE UNOCCUPIED ORBITALS:     ',2I5/
     1'  THE DOUBLY OCCUPIED ORBITALS:',2I5/)
      IF (NOP.NE.0) WRITE(NOUT,207) NOP,NALP
 207  FORMAT('  THE SINGLY OCCUPIED ORBITALS:',2I5/)
      IF (NSPE.NE.0) WRITE(NOUT,208) NSA,NSB
 208  FORMAT('  THE SPECIAL ORBITALS:        ',2I5/)
C
C  CONSRTUCT DRT TO INDEP PAIR ORDERING ARRAY
      DO 320 II=1,NUMIJ
        IJORD(II)=0
  320 CONTINUE
      IJIND=0
      DO 321 I=LFERM,NDOC
        IO=IOFF(I)
        DO 322 J=1,NUOC
          IJ=IO+J
          IJIND=IJIND+1
          IJORD(IJ)=IJIND
  322   CONTINUE
  321 CONTINUE
      IF (NOP.EQ.0) GOTO 14
      DO 323 I=NOP,NALP
        IO=IOFF(I)
        DO 324 J=1,NDOC
          IJ=IO+J
          IJIND=IJIND+1
          IJORD(IJ)=IJIND
  324   CONTINUE
  323 CONTINUE
 14   CONTINUE
      IF (NSPE.EQ.0) GOTO 16
      DO 325 I=NSA,NSB
        IO=IOFF(I)
        DO 326 J=1,I-1
          IJ=IO+J
          IJIND=IJIND+1
          IJORD(IJ)=IJIND
  326   CONTINUE
  325 CONTINUE
 16   CONTINUE
      WRITE(NOUT,209) IJIND,IJIND+2
 209  FORMAT('  THE NUMBER OF INDEPENDENT PAIRS IS',I5/
     1'  PLUS THE TWO CI COEFFICIENTS MAKES',I5/)
      IEXC=IFZC*(NDOC-NUOC-IFZC)
cets  WRITE(*,*)'THE NUMBER OF INDEPENDENT COR-DOC ROTATIONS IS', IEXC
      IEXV=IFZV*(NUOC-IFZV)
cets  WRITE(*,*)'THE NUMBER OF INDEPENDENT VIR-UOC ROTATIONS IS', IEXV
      IZDIM=IJIND+IEXC+IEXV
CGES
C     CONSTRUCT SYMMETRY-PACKING ARRAY
C
      NOFF=0
      KTSYM=0
      DO 561 I=LFERM,NDOC
      ISYM=ORBSYM(I)-1
      DO 560 J=1,NUOC
      JSYM=ORBSYM(J)-1
      IJSYM=IEOR(ISYM,JSYM)+1
      IF(IJSYM.NE.1) GO TO 560
      NADD=0
      IJ=IOFF(I)+J
      DOFF(IJ)=NOFF
      DO 530 K=LFERM,NDOC
      KSYM=ORBSYM(K)-1
      DO 520 L=1,NUOC
      LSYM=ORBSYM(L)-1
      KL=IOFF(K)+L
      KLSYM=IEOR(KSYM,LSYM)+1
      IF(KLSYM.NE.1)GO TO 510
      NOFF=NOFF+1
      NADD=NADD+1
      KTSYM=KTSYM+1
      DADD(KL)=NADD
      ITOT=DOFF(IJ)+DADD(KL)
C     WRITE(6,657)I,J,DOFF(IJ),K,L,DADD(KL),ITOT
  657 FORMAT(' I=',I3,' J=',I3,' DOFF=',I6,' K=',I3,' L=',I3,' DADD=',I6
     .       ,'  TOT=',I6)
  510 CONTINUE
  520 CONTINUE
  530 CONTINUE
      IF(NOP.EQ.0)GO TO 541
      DO 531 K=NOP,NALP
      KSYM=ORBSYM(K)-1
      DO 521 L=1,NDOC
      LSYM=ORBSYM(L)-1
      KL=IOFF(K)+L
      KLSYM=IEOR(KSYM,LSYM)+1
      IF(KLSYM.NE.1)GO TO 511
      NOFF=NOFF+1
      NADD=NADD+1
      KTSYM=KTSYM+1
      DADD(KL)=NADD
      ITOT=DOFF(IJ)+DADD(KL)
C     WRITE(6,657)I,J,DOFF(IJ),K,L,DADD(KL),ITOT
  511 CONTINUE
  521 CONTINUE
  531 CONTINUE
  541 CONTINUE
      IF(NSPE.EQ.0)GO TO 542
      DO 532 K=NSA,NSB
      KSYM=ORBSYM(K)-1
      DO 522 L=1,K-1
      LSYM=ORBSYM(L)-1
      KL=IOFF(K)+L
      KLSYM=IEOR(KSYM,LSYM)+1
      IF(KLSYM.NE.1)GO TO 512
      NOFF=NOFF+1
      NADD=NADD+1
      KTSYM=KTSYM+1
      DADD(KL)=NADD
      ITOT=DOFF(IJ)+DADD(KL)
C     WRITE(6,657)I,J,DOFF(IJ),K,L,DADD(KL),ITOT
  512 CONTINUE
  522 CONTINUE
  532 CONTINUE
  542 CONTINUE
  560 CONTINUE
  561 CONTINUE
C
      IF(NOP.EQ.0)GO TO 662
      DO 661 I=NOP,NALP
      ISYM=ORBSYM(I)-1
      DO 660 J=1,NDOC
      JSYM=ORBSYM(J)-1
      IJSYM=IEOR(ISYM,JSYM)+1
      IF(IJSYM.NE.1) GO TO 660
      NADD=0
      IJ=IOFF(I)+J
      DOFF(IJ)=NOFF
      DO 630 K=LFERM,NDOC
      KSYM=ORBSYM(K)-1
      DO 620 L=1,NUOC
      LSYM=ORBSYM(L)-1
      KL=IOFF(K)+L
      KLSYM=IEOR(KSYM,LSYM)+1
      IF(KLSYM.NE.1)GO TO 610
      NOFF=NOFF+1
      NADD=NADD+1
      KTSYM=KTSYM+1
      DADD(KL)=NADD
      ITOT=DOFF(IJ)+DADD(KL)
C     WRITE(6,657)I,J,DOFF(IJ),K,L,DADD(KL),ITOT
  610 CONTINUE
  620 CONTINUE
  630 CONTINUE
      IF(NOP.EQ.0)GO TO 641
      DO 631 K=NOP,NALP
      KSYM=ORBSYM(K)-1
      DO 621 L=1,NDOC
      LSYM=ORBSYM(L)-1
      KL=IOFF(K)+L
      KLSYM=IEOR(KSYM,LSYM)+1
      IF(KLSYM.NE.1)GO TO 611
      NOFF=NOFF+1
      NADD=NADD+1
      KTSYM=KTSYM+1
      DADD(KL)=NADD
      ITOT=DOFF(IJ)+DADD(KL)
C     WRITE(6,657)I,J,DOFF(IJ),K,L,DADD(KL),ITOT
  611 CONTINUE
  621 CONTINUE
  631 CONTINUE
  641 CONTINUE
      IF(NSPE.EQ.0)GO TO 642
      DO 632 K=NSA,NSB
      KSYM=ORBSYM(K)-1
      DO 622 L=1,K-1
      LSYM=ORBSYM(L)-1
      KL=IOFF(K)+L
      KLSYM=IEOR(KSYM,LSYM)+1
      IF(KLSYM.NE.1)GO TO 612
      NOFF=NOFF+1
      NADD=NADD+1
      KTSYM=KTSYM+1
      DADD(KL)=NADD
      ITOT=DOFF(IJ)+DADD(KL)
C     WRITE(6,657)I,J,DOFF(IJ),K,L,DADD(KL),ITOT
  612 CONTINUE
  622 CONTINUE
  632 CONTINUE
  642 CONTINUE
  660 CONTINUE
  661 CONTINUE
  662 CONTINUE
C
      IF(NSPE.EQ.0) GO TO 762
      DO 761 I=NSA,NSB
      ISYM=ORBSYM(I)-1
      DO 760 J=1,I-1
      JSYM=ORBSYM(J)-1
      IJSYM=IEOR(ISYM,JSYM)+1
      IF(IJSYM.NE.1) GO TO 760
      NADD=0
      IJ=IOFF(I)+J
      DOFF(IJ)=NOFF
      DO 730 K=LFERM,NDOC
      KSYM=ORBSYM(K)-1
      DO 720 L=1,NUOC
      LSYM=ORBSYM(L)-1
      KL=IOFF(K)+L
      KLSYM=IEOR(KSYM,LSYM)+1
      IF(KLSYM.NE.1)GO TO 710
      NOFF=NOFF+1
      NADD=NADD+1
      KTSYM=KTSYM+1
      DADD(KL)=NADD
      ITOT=DOFF(IJ)+DADD(KL)
C     WRITE(6,657)I,J,DOFF(IJ),K,L,DADD(KL),ITOT
  710 CONTINUE
  720 CONTINUE
  730 CONTINUE
      IF(NOP.EQ.0)GO TO 741
      DO 731 K=NOP,NALP
      KSYM=ORBSYM(K)-1
      DO 721 L=1,NDOC
      LSYM=ORBSYM(L)-1
      KL=IOFF(K)+L
      KLSYM=IEOR(KSYM,LSYM)+1
      IF(KLSYM.NE.1)GO TO 711
      NOFF=NOFF+1
      NADD=NADD+1
      KTSYM=KTSYM+1
      DADD(KL)=NADD
      ITOT=DOFF(IJ)+DADD(KL)
C     WRITE(6,657)I,J,DOFF(IJ),K,L,DADD(KL),ITOT
  711 CONTINUE
  721 CONTINUE
  731 CONTINUE
  741 CONTINUE
      IF(NSPE.EQ.0)GO TO 742
      DO 732 K=NSA,NSB
      KSYM=ORBSYM(K)-1
      DO 722 L=1,K-1
      LSYM=ORBSYM(L)-1
      KL=IOFF(K)+L
      KLSYM=IEOR(KSYM,LSYM)+1
      IF(KLSYM.NE.1)GO TO 712
      NOFF=NOFF+1
      NADD=NADD+1
      KTSYM=KTSYM+1
      DADD(KL)=NADD
      ITOT=DOFF(IJ)+DADD(KL)
C     WRITE(6,657)I,J,DOFF(IJ),K,L,DADD(KL),ITOT
  712 CONTINUE
  722 CONTINUE
  732 CONTINUE
  742 CONTINUE
  760 CONTINUE
  761 CONTINUE
  762 CONTINUE
C
      NMA1=INT(SQRT(KTSYM+0.))
cets  WRITE(*,*)
cets  WRITE(*,*)'NUMBER OF A TERMS IN A1 SYMMETRY ',KTSYM
cets  WRITE(*,*)'NUMBER OF TRANSITIONS NEEDED IS  ',NMA1
      RETURN
      END
      SUBROUTINE B0MAT(ALPHA,BETA,EPS,EPA,U,SS,W,ZETA,CC,OCC,EIG,
     1INTS,BUF,IJORD,IOFF,KADD,LADD,IJGRP,IJADD,ORBSYM,ORBTBF,JCODE,
     2JT1C,E11,E22,E12,LG,BOX,C,X,IOUT,EX,RS,IJDEP,VEC,DIP,EAVF,
     3LSTEPA,EX2,CCSD,ZZ,IDIMZZ,DOFF,DADD,NMA1,IDIMCC)
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER DOFF(NUMIJ),DADD(NUMIJ)
cets  REAL*16 DET
      real*8 det
      REAL*8 INTS(NMAX),E11(1),E22(1),E12(1),LG(NORBS,NORBS),BOXX(9)
      REAL*8 CDIP(3),A2,DEBYE,FAC,A1,A1S2,EAVF(NUMIJ),LSTEPA(NUMIJ)
      REAL*8 EX2(IJIND),CIDT(3)
      LOGICAL IVIR,JVIR,CCSD
      INTEGER FDOC,CORDOC,IJDEP(NUMIJ),FVIR,VUOC
      DIMENSION ZZ(IDIMZZ)
      DIMENSION ALPHA(NUMIJ),BETA(NUMIJ),EPS(NUMIJ),EPA(NORBS,NORBS),
     1U(NORBS,NORBS),SS(NUMIJ,NDF),W(NORBS,NORBS,NDF),BUF(NUMIJ),
     2ZETA(NUMIJ,NORBS),CC(IDIMCC,1),OCC(NORBS),EIG(NORBS),
     3BOX(NDF),X(NDF),c(iJIND,NDF),XCIJA(28),EX(IJIND),RS(NUMDEP,NDF),
     4 VEC(NORBS,NORBS),DIP(NUMIJ,3)
      INTEGER IJORD(NUMIJ),IOFF(NUMIJ),KADD(1),LADD(1),IJGRP(1),
     1IJADD(1),ORBSYM(NORBS),ORBTBF(1),JCODE(1),IA47(192),
     2JT1C(1),IOUT(NORBS),IAJT(20)
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ ISYMRB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /POINT/ FOCC(5),IPOINT(5),JPOINT(5),NSORB(5)
      COMMON /FUNCS/ IOCC,JOCC,KOCC,NTYPES,NBSET,NAT
      COMMON /IEXT/ IPRINT,IGRP,ICIDIP
      COMMON /OCCS/ NSPE,NSA,NSB,NALP,NOP,NDOC,LFERM,NUOC,IJIND,IJIND3
      COMMON/OCCS2/NUMCOR,NCOR,FDOC,CORDOC,NUMVIR,FVIR,LUOC,NUMDEP,VUOC
      COMMON /LOC42/ IA42(100),IBF2AT(284)
      COMMON /CALCJ/ ICALT,IDERT,ICIT
C
      WRITE(ICHK,2222)
C     WRITE(*   ,2222)
 2222 FORMAT(/'  IN B0MAT')
      NORBSQ=NORBS*NORBS
      A1S2=0.50D+00
      A2 = 2.0D+00
      A1 = 1.0D+00
      DEBYE = 2.541765480D+00
      IT98=98
C
C  READ BACK IN S DERIVATIVE INTEGRALS
C
      IS=1
      DO 101 IDF=1,NDF
        CALL WREADW(IT94,SS(1,IDF),INTOWP(NUMIJ),IS,IS)
        IF (IAND(IPRINT,64) .NE. 0) THEN
          WRITE(NOUT,1101) IDF
 1101     FORMAT(/'  THE SA MATRIX FOR DEGREE ',I5,'  AS READ IN B0MAT')
          CALL PRINT(SS(1,IDF),NUMIJ,NORBS,NOUT)
        END IF
 101  CONTINUE
CTJL
C  INITIALIZE ROUTINE FOR CALCULATION OF A MATRIX.
C
      IDIMCC=NMA1*(NMA1+1)
      CALL GETA(CC,EPS,ZETA,ALPHA,BETA,DOFF,DADD,NUMIJ,IDIMCC)
      CALL GETB(C ,EPS,ZETA,ALPHA,BETA,SS)
      CALL GETCV(RS,EX,EAVF,LG,SS)
C
C  CONSTRUCT ETA,ZETA,W,A,B0
C
      CALL GETINT(CC,EPS,ZETA,OCC,ALPHA,BETA,IJORD,KADD,LADD,IJADD,
     1IJGRP,ORBSYM,INTS,SS,EPA,JT1C,IOFF,EAVF,CCSD)
C
      IF (ICIT.EQ.1) GOTO 2300
C
C     READ LAGRANGIAN  AND ZERO OUT BOX
C
      CALL ZERO(BOX,NDF)
      CALL WREADW(IT47,IA47,192,1,JUNK)
      WRITE(ICHK,9014) IA47(120)
9014  FORMAT(' IA47(120) ',I8)
      CALL WREADW(IT47,LG,INTOWP(NORBS*NORBS),IA47(120),
     1 JUNK)
C
C   CALL FOR CI FIRST DERIVATIVE
C
      CALL GTINTS(CC,EPS,ZETA,OCC,ALPHA,BETA,IJORD,KADD,LADD,IJADD,
     1IJGRP,ORBSYM,INTS,SS,EPA,JT1C,IOFF,EX,RS,LG,IJDEP,BOX,EAVF,
     2LSTEPA,c,eps,doff,dadd,numij,idimcc)
CGES
      CALL GTINT2(C,EPS,ZETA,OCC,ALPHA,BETA,IJORD,KADD,LADD,IJADD,
     1IJGRP,ORBSYM,INTS,SS,EPA,JT1C,IOFF,EX,RS,LG,IJDEP,BOX,EAVF,
     2LSTEPA,EX2,cc,eps,doff,dadd,numij,idimcc)
CGES  WRITE(*,*)'BO MATRIX AFTER GTINT2'
C     CALL MATOUT(C,IJIND,NDF,IJIND,NDF,NOUT)
C
C2231   FORMAT(/'  THE A MATRIX AS CONSTRUCTED IN GTINT2:')
C       WRITE(NOUT,2231)
C       CALL MATOUT(CC,IJIND,IJIND ,IJIND,IJIND ,NOUT)
C
C     STORE B0 ON IT96
C
      IC=1
      CALL WWRITW(IT96,C,INTOWP(IJIND*NDF),IC,JUNK)
      WRITE(ICHK,9011)
9011  FORMAT(' C WRITTEN TO IT96 ')
      CALL ZERO(C,IJIND)
C
      DO 400 IXDF=1,NDF
CGES  WRITE(*,*) 'BOX,IDF',BOX(IXDF),IXDF
      DO 410 I=1,NORBS
      DO 420 kR=1,I-1
      IR=IOFF(I)+kR
      BOX(IXDF)=BOX(IXDF)-SS(IR,IXDF)*(LG(I,kR)+LG(kR,I))
 420  CONTINUE
      II=IOFF(I)+I
      BOX(IXDF)=BOX(IXDF)-SS(II,IXDF)*LG(I,I)
 410  CONTINUE
CGES  WRITE(*,*) 'BOX,IDF',BOX(IXDF),IXDF
 400  CONTINUE
      DO 120 I=LFERM,NDOC
      IO=IOFF(I)
      DO 130 J=1,NUOC
      FAC = OCC(J)-OCC(I)
      IJ=IO+J
      IJND=IJORD(IJ)
      C(IJND,1)=((LG(J,I)-LG(I,J)) + FAC*EX(IJND) + EX2(IJND))
  130 CONTINUE
  120 CONTINUE
      IF (NOP.EQ.0) GOTO 200
      DO 140 I=NOP,NALP
      IO=IOFF(I)
      DO 150 J=1,NDOC
      FAC = OCC(J)-OCC(I)
      IJ=IO+J
      IJND=IJORD(IJ)
      C(IJND,1)=((LG(J,I)-LG(I,J)) + FAC*EX(IJND) + EX2(IJND))
  150 CONTINUE
  140 CONTINUE
  200 CONTINUE
      IF (NSPE.EQ.0) GOTO 110
      DO 160 I=NSA,NSB
      IO=IOFF(I)
      DO 170 J=1,I-1
      FAC = OCC(J)-OCC(I)
      IJ=IO+J
      IJND=IJORD(IJ)
      C(IJND,1)=((LG(J,I)-LG(I,J)) + FAC*EX(IJND) + EX2(IJND))
  170 CONTINUE
  160 CONTINUE
  110 CONTINUE
CGES
C     SORT PERTURBATION TO PACKED-SYMMETRY ORDERING
C
      IADR=1
      IADR=IADR+NMA1*NMA1
      DO 918 I=LFERM,NDOC
      ISYM=ORBSYM(I)-1
      DO 916 J=1,NUOC
      JSYM=ORBSYM(J)-1
      IJSYM=IEOR(ISYM,JSYM)+1
      IF(IJSYM.NE.1)GO TO 915
      IJ=IOFF(I)+J
      IJND=IJORD(IJ)
CGES  WRITE(*,*)'STORING',C(IJND,1),'IN POSITION',IADR
      CC(IADR,1)=C(IJND,1)
      IADR=IADR+1
  915 CONTINUE
  916 CONTINUE
  918 CONTINUE
      IF(NOP.EQ.0)GO TO 929
      DO 928 I=NOP,NALP
      ISYM=ORBSYM(I)-1
      DO 926 J=1,NDOC
      JSYM=ORBSYM(J)-1
      IJSYM=IEOR(ISYM,JSYM)+1
      IF(IJSYM.NE.1)GO TO 925
      IJ=IOFF(I)+J
      IJND=IJORD(IJ)
CGES  WRITE(*,*)'STORING',C(IJND,1),'IN POSITION',IADR
      CC(IADR,1)=C(IJND,1)
      IADR=IADR+1
  925 CONTINUE
  926 CONTINUE
  928 CONTINUE
  929 CONTINUE
C
      IF(NSPE.EQ.0)GO TO 939
      DO 938 I=NSA,NSB
      ISYM=ORBSYM(I)-1
      DO 936 J=1,I-1
      JSYM=ORBSYM(J)-1
      IJSYM=IEOR(ISYM,JSYM)+1
      IF(IJSYM.NE.1)GO TO 935
      IJ=IOFF(I)+J
      IJND=IJORD(IJ)
CGES  WRITE(*,*)'STORING',C(IJND,1),'IN POSITION',IADR
      CC(IADR,1)=C(IJND,1)
      IADR=IADR+1
  935 CONTINUE
  936 CONTINUE
  938 CONTINUE
  939 CONTINUE
CGES
C     INVERT ONLY IRREP A1*A1
C
CGES  CALL MATOUT (CC,NMA1,NMA1+1,NMA1,NMA1+1,6)
      CALL FLINX(CC,NMA1,NMA1,1,DET)
CGES  CALL MATOUT (CC,NMA1,NMA1+1,NMA1,NMA1+1,6)
CGES
C     UNPACK SOLUTION
C
      CALL ZERO(C(1,1),IJIND)
      IADR=1
      IADR=IADR+NMA1*NMA1
      DO 948 I=LFERM,NDOC
      ISYM=ORBSYM(I)-1
      DO 946 J=1,NUOC
      JSYM=ORBSYM(J)-1
      IJSYM=IEOR(ISYM,JSYM)+1
      IF(IJSYM.NE.1)GO TO 945
      IJ=IOFF(I)+J
      IJND=IJORD(IJ)
      C(IJND,1)=CC(IADR,1)
      IADR=IADR+1
  945 CONTINUE
  946 CONTINUE
  948 CONTINUE
C
      IF(NOP.EQ.0)GO TO 959
      DO 958 I=NOP,NALP
      ISYM=ORBSYM(I)-1
      DO 956 J=1,NDOC
      JSYM=ORBSYM(J)-1
      IJSYM=IEOR(ISYM,JSYM)+1
      IF(IJSYM.NE.1)GO TO 955
      IJ=IOFF(I)+J
      IJND=IJORD(IJ)
      C(IJND,1)=CC(IADR,1)
      IADR=IADR+1
  955 CONTINUE
  956 CONTINUE
  958 CONTINUE
  959 CONTINUE
C
      IF(NSPE.EQ.0) GO TO 969
      DO 968 I=NSA,NSB
      ISYM=ORBSYM(I)-1
      DO 966 J=1,I-1
      JSYM=ORBSYM(J)-1
      IJSYM=IEOR(ISYM,JSYM)+1
      IF(IJSYM.NE.1)GO TO 965
      IJ=IOFF(I)+J
      IJND=IJORD(IJ)
      C(IJND,1)=CC(IADR,1)
      IADR=IADR+1
  965 CONTINUE
  966 CONTINUE
  968 CONTINUE
  969 CONTINUE
C
CGES
      DO 331 I=1,IJIND
      CC(I,1)=C(I,1)
  331 CONTINUE
C
C     READ IN B0
C
      CALL WREADW(IT96,C,INTOWP(IJIND*NDF),IC,JUNK)
CGES  WRITE(NOUT,9021)
9021  FORMAT(/' B0 MATRIX FROM IT96')
CGES    CALL MATOUT(C,IJIND,NDF,IJIND,NDF,NOUT)
      DO 332 IIJ=1,IJIND
      DO 333 IDF=1,NDF
      BOX(IDF)=BOX(IDF)+C(IIJ,IDF)*CC(IIJ,1)
  333 CONTINUE
  332 CONTINUE
      DO 334 IDF=1,NDF
      BOX(IDF)=BOX(IDF)*A1S2
      WRITE(ICHK,9023) BOX(IDF),IDF
9023  FORMAT(/' BOX = ',F20.8,' FOR DEGREE OF FREEDOM ',I8)
  334 CONTINUE
C
      CALL WREADW(IT42,IA42,100,1,JUNK)
      CALL WREADW(IT42,X,INTOWP(NDF),IA42(15),JUNK)
      DO 335 IDF=1,NDF
      BOX(IDF)=BOX(IDF)+X(IDF)
C
      WRITE(ICHK,3000) IDF,BOX(IDF)
3000  FORMAT(/' GRADIENT FOR ',I6,' DEGREE OF FREEDOM = ',F20.10)
 335  CONTINUE
C
C  LET'S CALCULATE THE CI DIPOLE MOMENT IF DESIRED.
C
      IF(ICIDIP.EQ.1) CALL CIDIP(DIP,VEC,E11,EPA,CC,IOFF,IJORD,IJDEP,
     1  EAVF,LG,OCC,ORBSYM,ZZ,IDIMZZ,CIDT)
C
      CALL PRN11(BOX,NDF,CCSD,CIDT)
C
C
      RETURN
C
C
C
C  SOLVE FOR U IN A*U=B0
C
2300  CALL GTINT3(CC,EPS,ZETA,OCC,ALPHA,BETA,IJORD,KADD,LADD,IJADD,
     1IJGRP,ORBSYM,INTS,BUF,ORBTBF,JCODE,EIG,SS,EPA,W,JT1C,IOFF,
     2E11,E22,E12)
      CALL GTINT4(CC,EPS,ZETA,OCC,ALPHA,BETA,IJORD,KADD,LADD,IJADD,
     1IJGRP,ORBSYM,INTS,BUF,ORBTBF,JCODE,EIG,SS,EPA,W,JT1C,IOFF,
     2E11,E22,E12)
CJ    IF (IAND(IPRINT,16) .NE. 0) THEN
CTJL    WRITE(NOUT,2231)
CTJL    CALL MATOUT(CC,IJIND,IJIND3,IJIND,IJIND3,NOUT)
CJ    END IF
      WRITE(ICHK,2224)
 2224 FORMAT(/'  CALLING FLIN')
      CALL FLINX(CC,IJIND,IJIND,NDF,DET)
      WRITE(NOUT,301) DET
 301  FORMAT(/'  DETERMINANT FROM FLIN    =',G18.8)
C
C  FILL OUT U ARRAY FOR EACH DEGREE OF FREEDOM
C
      CALL RFILE(IT98)
CIBM  CALL SREW(IT98)
      IU=1
      DO 201 IDF=1,NDF
C
        DO 202 I=1,NORBS
          DO 202 J=1,NORBS
 202    U(I,J)=0.0D+00
C
        IJ=0
        NCVIRT=0
        DO 203 I=1,NORBS
          IVIR=.FALSE.
          IF (I.LT.LFERM) NCVIRT=NCVIRT+1
          DO 203 J=1,I
            JVIR=.FALSE.
            IF (J.LT.LFERM) NCVIRT=NCVIRT+1
            IJ=IJ+1
            INDEX=IJORD(IJ)
            IF (INDEX .NE. 0) U(I,J)=CC(INDEX,IDF+IJIND)
            U(J,I)= -U(I,J)-SS(IJ,IDF)
            IF (NCVIRT.EQ.1) THEN
C           IF (IVIR.XOR.JVIR) THEN
              TEMP=U(I,J)
              U(I,J)=U(J,I)
              U(J,I)=TEMP
            END IF
 203    CONTINUE
C
        DO 204 I=1,NORBS
          II=IOFF(I)+I
 204    U(I,I)=-A1S2*SS(II,IDF)
C
        IF (IAND(IPRINT,16) .NE. 0) THEN
          WRITE(NOUT,1001) IDF
 1001     FORMAT(/'  THE U MATRIX FOR DEGREE OF FREEDOM ',I4)
          CALL MATOUT(U,NORBS,NORBS,NORBS,NORBS,NOUT)
        END IF
C
        CALL WWRITW(IT98,U,INTOWP(NORBSQ),IU,IU)
 201  CONTINUE
C
      RETURN
      END
C
      SUBROUTINE CIDIP(DIPINT,VEC,SCR1,SCR2,Z,IOFF,IJORD,IJDEP,EAVF,LG,
     1 OCC,ORBSYM,ZZ,IDIMZZ,CIDT)
      IMPLICIT INTEGER (A-Z)
C
      REAL*8 ZZ(IDIMZZ)
      REAL*8 DIPINT(NUMIJ,3),VEC(NORBS,NORBS),SCR1(NORBS,NORBS)
      REAL*8 SCR2(NORBS,NORBS),Z(IJIND),CIDM(3),CIDC(3),CIDT(3)
      REAL*8 EAVF(NUMIJ),LG(NBF,NBF),OCC(NBF)
      REAL*8 DEBYE,FAC,A0,A1,A1S2,CITM,FAC2,NORM
      INTEGER IOFF(NUMIJ),IJORD(NUMIJ),IJDEP(NUMIJ),ORBSYM(NBF)
C
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ ISYMRB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /FUNCS/ IOCC,JOCC,KOCC,NTYPES,NBSET,NAT
      COMMON /IEXT/ IPRINT,IGRP,ICIDIP
      COMMON /OCCS/ NSPE,NSA,NSB,NALP,NOP,NDOC,LFERM,NUOC,IJIND,IJIND3
      COMMON/OCCS2/NUMCOR,NCOR,FDOC,CORDOC,NUMVIR,FVIR,LUOC,NUMDEP,VUOC
      COMMON/DEP/IJDC,IFZC,IFZV,IZDIM
C
      DATA DEBYE / 2.541765480D+00 /
      DATA A0,A1,A1S2 / 0.0D+00,1.0D+00,0.5D+00 /
C
    1 FORMAT(5X,'THE CI DIPOLE MOMENT ',10X,3F20.10)
    2 FORMAT(5X,'CORRECTION TO CI D.M.',10X,3F20.10)
    3 FORMAT(5X,'THE TOTAL CI DIPOLE MOMENT',5X,3F20.10)
    4 FORMAT(5X,'MAGNITUDE OF THE CI D.M.',7X,F20.10,5X,'DEBYES')
C
      DIPTAP = 59
      WPOINT = 1
      CALL RFILE(DIPTAP)
      CALL WREADW(DIPTAP,DIPINT,INTOWP(3*NUMIJ),WPOINT,WPOINT)
      CALL WREADW(DIPTAP,CIDM,INTOWP(3),WPOINT,WPOINT)
C
      CALL ZERO(CIDC,3)
CTJL  CALL MATOUT(VEC,NORBS,NORBS,NORBS,NORBS,6)
      DO 110 IDIP = 1,3
      CALL SQUR(DIPINT(1,IDIP),SCR1,NBF)
CTJL  CALL PRINT(DIPINT(1,IDIP),NUMIJ,NORBS,6)
CTJL  CALL MATOUT(SCR1,NORBS,NORBS,NORBS,NORBS,6)
      CALL ZERO(SCR2,NBF*NBF)
      CALL MXMB(VEC,NBF,1,SCR1,1,NBF,SCR2,1,NBF,NBF,NBF,NBF)
      CALL ZERO(SCR1,NBF*NBF)
      CALL MXMB(SCR2,1,NBF,VEC,1,NBF,SCR1,1,NBF,NBF,NBF,NBF)
C     WRITE(*,*) ' IDIP = ',IDIP
C     CALL MATOUT(SCR1,NORBS,NORBS,NORBS,NORBS,6)
CTJL  FAC = A1
COUT  WRITE(*,*)
COUT  WRITE(*,*)
COUT  WRITE(*,*)'DIMENSION OF Z (NM PART)=IJIND=',IJIND
COUT  WRITE(*,*)'LFERM=',LFERM,'   NDOC=',NDOC,'   NUOC=',NUOC
C     WRITE(*,*)'I  ,J,  FAC,  IO,  IJ,  IJND,  Z(IJND)'
      DO 120 I=LFERM,NDOC
      IO=IOFF(I)
C     ISM = ORBSYM(I)
      DO 130 J=1,NUOC
      FAC = OCC(I) - OCC(J)
      IJ=IO+J
      IJND=IJORD(IJ)
CGES  IF (IDIP.EQ.1)WRITE(*,645)I,J,FAC,IO,IJ,IJND,Z(IJND)
  645 FORMAT (1X,I3,2X,I3,2X,F4.2,3(1X,I5),2X,F12.6)
C     JSM = ORBSYM(J)
C     IF(IDIP.EQ.2)WRITE(*,*)' DI,HY,Z ',CIDC(IDIP),SCR1(I,J),Z(IJND)
C     IF(IDIP.EQ.2)WRITE(*,*)' ISM,JSM ',ISM,JSM
      CIDC(IDIP) = CIDC(IDIP) + SCR1(I,J)*Z(IJND)*FAC
  130 CONTINUE
  120 CONTINUE
C     WRITE(*,*)
COUT  WRITE(*,*)'NOP ',NOP
      IF (NOP.EQ.0) GOTO 200
COUT  WRITE(*,*)'INSIDE NOP PART'
COUT  WRITE(*,*)'LOOP GOES FROM NOP=',NOP,' TO NALP=',NALP
COUT  WRITE(*,*)'      AND FROM 1 TO NDOC=',NDOC
      DO 140 I=NOP,NALP
      IO=IOFF(I)
      DO 150 J=1,NDOC
C     FAC =  A1S2
C     IF(J.GE.LFERM) FAC = -A1S2
      FAC = OCC(I) - OCC(J)
      IJ=IO+J
      IJND=IJORD(IJ)
C     IF(IDIP.EQ.2)WRITE(*,*)' DI,HY,Z ',CIDC(IDIP),SCR1(I,J),Z(IJND)
      CIDC(IDIP) = CIDC(IDIP) + SCR1(I,J)*Z(IJND)*FAC
CGES  IF (IDIP.EQ.1)WRITE(*,645)I,J,FAC,IO,IJ,IJND,Z(IJND)
  150 CONTINUE
  140 CONTINUE
  200 CONTINUE
CGES
C     WRITE(*,*)
COUT  WRITE(*,*)'NSPE',NSPE
      IF (NSPE.EQ.0) GOTO 520
COUT  WRITE(*,*)'INSIDE NSPE PART'
CTJL  FAC = ?????
      DO 160 I=NSA,NSB
      IO=IOFF(I)
      DO 170 J=1,I-1
      FAC = OCC(I) - OCC(J)
      IJ=IO+J
      IJND=IJORD(IJ)
      CIDC(IDIP) = CIDC(IDIP) + SCR1(I,J)*Z(IJND)*FAC
  170 CONTINUE
  160 CONTINUE
  520 CONTINUE
CTJL
      IJ = 0
      DO 500 I = 1,NBF
      II = IOFF(I) + I
      DO 510 J = 1,I
      JJ = IOFF(J) + J
      IJ = IJ + 1
      IJCV = IJDEP(IJ)
C     WRITE(*,*)'IJ',IJ,'  IJDEP(IJ)',IJDEP(IJ)
      IF(IJCV.EQ.0) GO TO 510
      FAC = A1/(EAVF(II)-EAVF(JJ))
CTJL  FAC = A1/(EAVF(JJ)-EAVF(II))
C     IF(IDIP.EQ.2)WRITE(*,*)' DI,HY ',CIDC(IDIP),SCR1(I,J)
C     FAC2 = (LG(J,I)-LG(I,J))
C     IF(IDIP.EQ.2)WRITE(*,*)' FAC,X ',FAC,FAC2
C     WRITE(*,*)' I',I,' J',J,' IJ',IJ,' Z(IJ)',(LG(J,I)-LG(I,J))
      CIDC(IDIP) = CIDC(IDIP) + FAC*(LG(J,I)-LG(I,J))*SCR1(I,J)
C     IF (IDIP.EQ.1)WRITE(*,645)I,J,FAC,IO,IJ,IJND,Z(IJND)
  510 CONTINUE
  500 CONTINUE
CTJL
  110 CONTINUE
      DO 210 I=1,3
      CIDC(I) = CIDC(I)*DEBYE
      CIDT(I) = CIDC(I) + CIDM(I)
  210 CONTINUE
cets  WRITE(*,*)
cets  WRITE(*,*)
cets  WRITE(*,1) (CIDM(I),I=1,3)
cets  WRITE(*,2) (CIDC(I),I=1,3)
cets  WRITE(*,3) (CIDT(I),I=1,3)
cets  WRITE(*,*)
cets  WRITE(*,*)
      CITM = CIDT(1)*CIDT(1) + CIDT(2)*CIDT(2) + CIDT(3)*CIDT(3)
      CITM = DSQRT(CITM)
cets  WRITE(*,4) CITM
CGES
      ITAP86=86
      ITAP87=87
      ITAP88=88
      IDIMZ=IJIND+IJDC
cets  WRITE(*,*)
COUT  WRITE(*,*)
COUT  WRITE(*,*)
COUT  WRITE(*,*)'IDIMZ',IDIMZ
C
      DO 697 I=1,IJIND
      ZZ(I)=Z(I)
  697 CONTINUE
      IJ = 0
      IK = 0
      DO 700 I = 1,NBF
      II = IOFF(I) + I
      DO 710 J = 1,I
      JJ = IOFF(J) + J
      IJ = IJ + 1
      IJCV = IJDEP(IJ)
      IF(IJCV.EQ.0) GO TO 710
      IK = IK + 1
      FAC=1.0D0/(EAVF(II)-EAVF(JJ))
C     ZZ(IJIND+IK) =(LG(J,I)-LG(I,J))*2.D0
C     ZZ(IJIND+IK) =(LG(J,I)-LG(I,J))/(EAVF(II)-EAVF(JJ))
      ZZ(IJIND+IK) =(LG(J,I)-LG(I,J))
CGES  WRITE(*,645)I,J,FAC,IJ,IK,IJIND+IK,ZZ(IJIND+IK)
C     WRITE(*,*)' I',I,' J',J,' IJ',IJ,' Z(IK)',ZZ(IJIND+IK)
  710 CONTINUE
  700 CONTINUE
COUT  WRITE(*,*)IK,'  EXTRA PAIRS ADDED TO Z VECTOR'
C     WRITE(*,*)   '  EXTRA PAIRS DIVIDED BY EAVF  '
C
      ND=NDOC-NUOC
      NY=NUOC
cets  WRITE(*,*)'          '
cets  WRITE(*,*)'Z VECTOR NO*NV PART'
cets1 CALL MATOUT(ZZ,NY,ND,NY,ND,6)
      IF(NOP.NE.0)THEN
cets  WRITE(*,*)'Z VECTOR OPEN SHELLS'
      WRITE(6,6123)(ZZ(ND*NY+I),I=1,ND+NY)
      END IF
      IF(IJDC.NE.0)THEN
cets  WRITE(*,*)'Z VECTOR COR-DOC AND VIR-UOC ROTATIONS'
      WRITE(6,6123)(ZZ(IJIND+I),I=1,IJDC)
 6123 FORMAT(7X,10F12.7)
      END IF
C
      CALL LOCATE (5,'# MONGO ###',IERR)
      IF(IERR.NE.0) THEN
      WRITE (6,6007)
C     WRITE ( 4,6007)
 6007 FORMAT(//,2X,'NO INPUT TO MONGO HAS BEEN FOUND.',/)
      FLAG=0
      ELSE
      READ(5,6004)FLAG
 6004 FORMAT(I5)
CGES
C  ITAP86 MOVED FROM ABOVE. NOT CHECKED. 11-5-87.
      CALL RFILE (ITAP86)
      CALL WWRITW(ITAP86,IDIMZ,1,1     ,IVEC86)
      CALL WWRITW(ITAP86,NDOC-NUOC,1,IVEC86,IVEC86)
      CALL WWRITW(ITAP86,NUOC,1,IVEC86,IVEC86)
      CALL WWRITW(ITAP86,IFZC,1,IVEC86,IVEC86)
      CALL WWRITW(ITAP86,IFZV,1,IVEC86,IVEC86)
      CALL WWRITW(ITAP86,NOP ,1,IVEC86,IVEC86)
      CALL WWRITW(ITAP86,NALP,1,IVEC86,IVEC86)
      CALL WWRITW(ITAP86,IJDC,1,IVEC86,IVEC86)
      CALL WWRITW(ITAP86,IJIND,1,IVEC86,IVEC86)
      CALL WWRITW(ITAP86,ZZ,INTOWP(IDIMZ),IVEC86,IVEC86)
C     LEAVE PLACE FOR FOCK MATRIX IN THE MO BASIS (CCSD)
      IVEC86=IVEC86+INTOWP(NUMIJ)
      CALL WWRITW(ITAP86,IJDEP,NUMIJ,IVEC86,IVEC86)
      CALL RCLOSE(ITAP86,3)
cets  WRITE(*,*)'Z VECTOR HAS BEEN WRITTEN TO FILE86'
cets  WRITE(*,*)'IJDEP OF DIM ',NUMIJ,' HAS BEEN WRITTEN TO FILE 86'
CGES
      IF(FLAG.EQ.0)THEN
cets  WRITE(*,*)
cets  WRITE(*,*)
cets  WRITE(*,*)
cets  WRITE(*,*)' FLAG EQ ZERO   FILE 87 IS INITIALIZED'
cets  WRITE(*,*)' AND U=Z WRITTEN                      '
      CALL RFILE (ITAP87)
      IDUM=1
      CALL WWRITW(ITAP87,IDUM,1,1     ,LOCVEC)
      CALL WWRITW(ITAP87,IDIMZ,1,LOCVEC,LOCVEC)
      CALL WWRITW(ITAP87,ZZ,INTOWP(IDIMZ),LOCVEC,LOCVEC)
      CALL RCLOSE(ITAP87,3)
cets  WRITE(*,*)' FLAG EQ ZERO   FILE 88 IS INITIALIZED'
      CALL RFILE (ITAP88)
      IDUM=0
      CALL WWRITW(ITAP88,IDUM,1,1     ,LOCVEC)
      CALL WWRITW(ITAP88,IDIMZ,1,LOCVEC,LOCVEC)
      CALL RCLOSE(ITAP88,3)
      ELSE
cets  WRITE(*,*)' FLAG NE ZERO   FILE 87 ALREADY IN DISK'
cets  WRITE(*,*)' FLAG NE ZERO   FILE 88 ALREADY IN DISK'
      ENDIF
      CALL RFILE (ITAP88)
      CALL WREADW(ITAP88,NUMBER,1,1,LOCVEC)
      CALL WREADW(ITAP88,IDIM  ,1,LOCVEC,LOCVEC)
      LOCVEC=LOCVEC+NUMBER*INTOWP(IDIM)
      CALL WWRITW(ITAP88,ZZ,INTOWP(IDIMZ),LOCVEC,LOCVEC)
      NUMBER=NUMBER+1
      CALL WWRITW(ITAP88,NUMBER,1,1,LOCVEC)
      CALL RCLOSE(ITAP88,3)
cets  WRITE(*,*)'Z VECTOR HAS BEEN WRITTEN TO FILE 88'
      NORM=0.0D0
      DO 1344 I=1,IDIMZ
      NORM=NORM+ZZ(I)*ZZ(I)
 1344 CONTINUE
      NORM=DSQRT((NORM))
cets  WRITE(*,*)
cets  WRITE(*,*) 'NORM OF Z VECTOR',NORM
cets  WRITE(*,*)
      NORM=NORM/IDIMZ
cets  WRITE(*,*) 'STANDARD NORM = ',NORM
      ENDIF
CGES
      RETURN
      END
cets The following is called by a C program which handles dynamic
cets allocation of memory.
      subroutine fentry(z,iz,maxcor)
cets  PROGRAM CPHFL
C======================================================================
C   GES VERSION: OCTOBER 6, 1987                                      =
C   INCLUDE OPEN-SHELLS AND TCSCF CASES.                              =
C======================================================================
C   GES VERSION: JUNE 26, 1987                                        =
C   INVERTING ONLY A1 -A1 COMPONENT OF A MATRIX!                      =
C======================================================================
C   GES VERSION: MAY 6, 1987                                          =
C   CC SYMM GRADS AND MONGO                                           =
C======================================================================
C**********************************************************************
C GENERAL COUPLED-PERTURBED HARTREE-FOCK PROGRAM FOR SCF 2ND          *
C**********************************************************************
c
C**********************************************************************
C*   NOTICE OF PROGRAM MODIFICATION                                   *
C**********************************************************************
C*  BY:  RICHARD REMINGTON                         search:  c5-22-88  *
C*  DATE:  MAY   22,   1988                                           *
C*  REASON: DECREASE CORE TO RUN IN 7MB ON 9370                       *
C**********************************************************************
C                                                                     *
C      BY:  GES                                                       *
C    DATE:  MARCH 4, 1988                                             *
C  REASON:  ADD DIPOLE MOMENTS TO FILE11                              *
C                                                                     *
C      BY:  GES                                                       *
C    DATE:  JANUARY 7, 1988                                           *
C  REASON:  GET RID OF BLANK LINE IN FILE11                           *
C                                                                     *
C      BY:  ACS                                                       *
C    DATE:  JANUARY 2, 1988                                           *
C  REASON:  WRITE CC ENERGY TO FILE 11                                *
C      BY:  TJL                                                       *
C    DATE:  NOVEMBER 1, 1986                                          *
C  REASON:  CORRECT BUG IN DEPENDENT PAIR CONTRIBUTION TO THE CI      *
C  REASON:  DIPOLE MOMENT, THIS IS A MINOR CORRECTION AND SHOULD NOT  *
C  REASON:  AFFECT MOST CASES,  HIGHER EXCITATIONS MAY BE AFFECTED    *
C  REASON:  (I.E., WHEN THE CPHF CONTRIBUTION SHOULD GO TO ZERO.)     *
C      BY:  TJL                                                       *
C    DATE:  AUGUST 3, 1985                                            *
C  REASON:  WRITE CI ENERGY TO FILE 11                                *
C      BY:  TJL                                                       *
C    DATE:  APRIL 14, 1985                                            *
C  REASON:  IMPLEMENT COR'S AND VIR'S FOR OPEN SHELL                  *
C  REASON:  OPEN SHELL SINGLETS STILL DO NOT WORK; WITH OR WITHOUT C/V*
C  REASON:  COR'S AND VIR'S FOR DIPOLE MOMENTS HAVE ALSO BEEN IMPL.   *
C  REASON:  THESE HAVE NOT BEEN TESTED.                               *
C     UNIT 3 TO CHECK                                                 *
C  REASON:  CHANGE UNIT NUMBERS !! 2=>52, 82=>56, 21=>55,  JTAP1=>94  *
C  REASON:  CHANGE UNIT NUMBERS !! 8=>58, 20=>53, 22=>42,  JTAP2=>96  *
C  REASON:  CHANGE UNIT NUMBERS !!12=>54, 57=>47         , IUTAP=>98  *
C      BY:  RICHARD REMINGTON                                         *
C    DATE:  FEBRUARY 22, 1985                                         *
C  REASON:  ADD SUBROUTINE PRN11 IN ORDER TO WRITE CI GRADIENTS INTO  *
C           FILES 11, 30, AND THE OUTPUT (FILE6).                     *
C**********************************************************************
C
C5-22-88  REAL*8 Z(1700000)
cets  REAL*8 Z(400000)
cets  INTEGER IZ(1)
cets  EQUIVALENCE (IZ(1), Z(1))
      real*8 z(maxcor)
      integer iz(intowp(maxcor))
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /FILES/ IT54
C
 1000 FORMAT(///,10X,' >>>>> GENERAL CPHF CALCULATION COMPLETED <<<<< ')
C
C5-22-88  MAXCOR=1700000
cets  MAXCOR= 400000
      ICHK = 3
      NOUT = 6
      IT30 = 30
      IT42 = 42
      IT47 = 47
      IT52 = 52
      IT54 = 54
      IT58 = 58
      ITAP86=86
      ITAP87=87
      ITAP88=88
      IT94 = 94
      IT96 = 96
C
cets  CALL TSTART(3)
cets  CALL TSTART(6)
      CALL drum
C
      CALL MAIN(IZ,Z,MAXCOR)
C
      CALL RCLOSE(IT96,3)
CTJL  CALL RCLOSE(IT30,3)
C
      WRITE(NOUT,1000)
C
      CALL TSTOP(3)
      CALL TSTOP(6)
C
      STOP
      END
      SUBROUTINE DERMAT(VEC,SCR1,SCR2,SS,BUF1,BUF2,IOFF,JT1C)
      IMPLICIT REAL*8 (A-H,O-Z)
      DIMENSION VEC(NORBS,NORBS),SCR1(NUMIJ),SCR2(NUMIJ),
     1BUF1(NUMIJ,NDF),BUF2(NUMIJ,NDF,NBSET),SS(NUMIJ)
      INTEGER IOFF(NUMIJ),JT1C(1)
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ ISYMRB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /FUNCS/ IOCC,JOCC,KOCC,NTYPES,NBSET,NAT
      COMMON /LOC42/ IA42(100),IBF2AT(284)
      COMMON /IEXT/ IPRINT,IGRP,ICIDIP
C
C     WRITE(*,2222)
      WRITE(ICHK,2222)
 2222 FORMAT(/'  IN DERMAT')
      CALL RFILE(IT94)
CIBM  CALL SREW(IT94)
      CALL WREADW(IT42,IBF2AT,NORBS,IA42(11),JUNK)
C
C READ IN IT42 DATA; TRANSFORM TO MO BASIS; STORE ON IT94
C
C READ S DERIVATIVE INTEGRALS
      CALL WREADW(IT42,BUF1,INTOWP(NUMIJ*3),IA42(12),JUNK)
      CALL SAMAT(BUF1,NUMIJ,SS,NUMIJ,VEC,IOFF,SCR1,SCR2,JT1C)
C
C READ H DERIVATIVE INTEGRALS
CGES
C     IPRINT=4
      CALL WREADW(IT42,BUF1,INTOWP(NUMIJ*NDF),IA42(14),JUNK)
      IS=JT1C(NDF)+INTOWP(NUMIJ)
      DO 107 IABC=1,NDF
        IF (IAND(IPRINT,4) .NE. 0) THEN
          WRITE(NOUT,1001) IABC
 1001     FORMAT(/'  THE HA MATRIX FOR DEGREE OF FREEDOM ',I5)
          CALL PRINT(BUF1(1,IABC),NUMIJ,NORBS,NOUT)
        END IF
        CALL MOCONV(BUF1(1,IABC),NUMIJ,SS,NUMIJ,VEC,SCR1,SCR2)
        JT1C(IABC+NDF)=IS
        CALL WWRITW(IT94,SS,INTOWP(NUMIJ),IS,IS)
        IF (IAND(IPRINT,4) .NE. 0) THEN
          WRITE(NOUT,1002) IABC
 1002     FORMAT(/'  THE HM MATRIX FOR DEGREE OF FREEDOM ',I5)
          CALL PRINT(SS,NUMIJ,NORBS,NOUT)
          WRITE(NOUT,1003) IABC,JT1C(IABC+NDF),IS
 1003     FORMAT(/'  HM FOR DEGREE ',I5,'  WRITTEN TO WORD ',I8,
     1    '  NEXT WORD IS ',I8)
        END IF
 107  CONTINUE
C
C  READ 2E DERIVATIVE INTEGRALS (T MATRIX)
CTJL  WRITE(ICHK,*) ' IA42(17),NBSET,NDF,NUMIJ = ',
CTJL 1    IA42(17),NBSET,NDF,NUMIJ
      CALL WREADW(IT42,BUF2,INTOWP(NBSET*NDF*NUMIJ),IA42(17),JUNK)
      IJT=2*NDF
CGES
C     IPRINT =8
      DO 108 ISET=1,NBSET
        DO 108 IABC=1,NDF
          IF (IAND(IPRINT,8) .NE. 0) THEN
            WRITE(NOUT,1004) ISET,IABC
 1004       FORMAT(/'  THE TA MATRIX FOR SET ',I5,'  DEGREE ',
     *      I5)
            CALL PRINT(BUF2(1,IABC,ISET),NUMIJ,NORBS,NOUT)
          END IF
          CALL MOCONV(BUF2(1,IABC,ISET),NUMIJ,SS,NUMIJ,VEC,SCR1,
     *    SCR2)
          IJT=IJT+1
          JT1C(IJT)=IS
          CALL WWRITW(IT94,SS,INTOWP(NUMIJ),IS,IS)
          IF (IAND(IPRINT,8) .NE. 0) THEN
            WRITE(NOUT,1005) ISET,IABC
 1005       FORMAT(/'  THE TM MATRIX FOR SET ',I5,'  DEGREE ',
     *      I5)
            CALL PRINT(SS,NUMIJ,NORBS,NOUT)
            WRITE(NOUT,1006) IABC,IJT,JT1C(IJT),IS
 1006       FORMAT(/'  TM FOR DEGREE ',I5,'  IN JT1C ',I5/
     1      '  WRITTEN TO WORD',I5,'  NEXT WORD IS ',I8)
          END IF
 108  CONTINUE
      RETURN
      END
      FUNCTION DOT(A,NA,B,NB,N)
      IMPLICIT REAL*8 (A-H,O-Z)
      DIMENSION A(1),B(1)
      IAPT=1
      IBPT=1
      D=0.0
      DO 10 I=1,N
        D=D+A(IAPT)*B(IBPT)
        IAPT=IAPT+NA
        IBPT=IBPT+NB
 10   CONTINUE
      DOT=D
      RETURN
      END
      SUBROUTINE FAMAT(EPA,TA,HA,BUF,IOFF,JT1C,IOUT,DROL,LSTEPA)
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER IOFF(NUMIJ),JT1C(1),IOUT(NORBS),DROL(NORBS)
      DIMENSION EPA(NORBS,NORBS),TA(NUMIJ),HA(NUMIJ),BUF(NUMIJ,NBSET)
      REAL*8    LSTEPA(NUMIJ)
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ ISYMRB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /POINT/ FOCC(5),IPOINT(5),JPOINT(5),NSORB(5)
      COMMON /FUNCS/ IOCC,JOCC,KOCC,NTYPES,NBSET,NAT
      COMMON /IEXT/ IPRINT,IGRP,ICIDIP
      COMMON /CALCJ/ ICALT,IDERT,ICIT
C
C     WRITE(6   ,2222)
      WRITE(ICHK,2222)
 2222 FORMAT(/'  IN FAMAT')
      NORBSQ=NORBS*NORBS
      IHA=JT1C(NDF+1)
      IEA=2*NDF+NBSET*NDF
      ISEA=JT1C(IEA)+INTOWP(NUMIJ)
      DO 1 IDF=1,NDF
        IEA=IEA+1
        DO 10 I=1,NORBS
          DO 10 J=1,NORBS
 10     EPA(I,J)=0.0D+00
C
        CALL WREADW(IT94,HA,INTOWP(NUMIJ),IHA,IHA)
        IF (IAND(IPRINT,32) .NE. 0) THEN
          WRITE(NOUT,1101) IDF,IHA
 1101     FORMAT(/'  HA FOR DEGREE OF FREEDOM ',I5,'   IHA=',I8)
          CALL PRINT(HA,NUMIJ,NORBS,NOUT)
        END IF
        DO 2 IBSET=1,NBSET
          ITA=2*NDF+(IBSET-1)*NDF+IDF
          CALL WREADW(IT94,TA,INTOWP(NUMIJ),JT1C(ITA),JUNK)
          IF (IAND(IPRINT,32) .NE. 0) THEN
            WRITE(NOUT,1102) IDF,ITA,JT1C(ITA)
 1102       FORMAT(/'  TA FOR DEGREE ',I5,'   ITA=',I8,'  JT1C=',I8)
            CALL PRINT(TA,NUMIJ,NORBS,NOUT)
          END IF
          F=FOCC(IBSET)/(2.0D+00)
          DO 2 J=1,NUMIJ
C2      BUF(J,IBSET)=HA(J)*F+TA(J)
        BUF(J,IBSET)=HA(J)*F+TA(J)
C       IF(IDF.EQ.1.OR.IDF.EQ.3.AND.IBSET.EQ.2.OR.IBSET.EQ.3) THEN
C       IF(BUF(J,IBSET).GT.1.0D-6) THEN
C       WRITE(*,*) ' J,IDF ',J,IDF
C       WRITE(*,*) ' H,F,T,EA ',HA(J),F,TA(J),BUF(J,IBSET)
C       END IF
C       END IF
 2      CONTINUE
C
CGES    WRITE(*,*)'DROL',DROL
        DO 3 ITYP=1,NTYPES
          IMIN=JPOINT(ITYP)
          IMAX=JPOINT(ITYP+1)-1
CTJL    IF(IDF.EQ.1) THEN
CTJL    WRITE(*,*) ' ITYP,IMIN,IMAX ',ITYP,IMIN,IMAX
CTJL    END IF
          DO 3 IYY=IMIN,IMAX
            IBF=DROL(IYY)
            IORB=IOUT(IBF)
            DO 3 JYY=1,NORBS
              JBF=DROL(JYY)
              JORB=IOUT(JBF)
CTJL    IF(IDF.EQ.1) THEN
CTJL    WRITE(*,*) ' IBF,IORB,JBF,JORB ',IBF,IORB,JBF,JORB
CTJL    END IF
              IJMN=MIN0(IORB,JORB)
              IJMX=MAX0(IORB,JORB)
              IJ=IOFF(IJMX)+IJMN
C3      EPA(IORB,JORB)=BUF(IJ,ITYP)
        EPA(IORB,JORB)=BUF(IJ,ITYP)
C       IF(IDF.EQ.1.OR.IDF.EQ.3.AND.ITYP.EQ.2.OR.ITYP.EQ.3) THEN
C       IF(EPA(IORB,JORB).GT.1.0D-6) THEN
C       WRITE(*,*) ' IDF,I,J,EPA ',IDF,IORB,JORB,EPA(IORB,JORB)
C       END IF
C       END IF
 3      CONTINUE
C
CGES
C       IPRINT=32
        JT1C(IEA)=ISEA
        CALL WWRITW(IT94,EPA,INTOWP(NORBS*NORBS),ISEA,ISEA)
        IF (IAND(IPRINT,32) .NE. 0) THEN
          WRITE(NOUT,1103) IDF,IEA,JT1C(IEA)
 1103     FORMAT(/'  EPA FOR DEGREE ',I5,'   IEA=',I8,'  JT1C=',
     *    I8)
          CALL MATOUT(EPA,NORBS,NORBS,NORBS,NORBS,NOUT)
        END IF
 1    CONTINUE
C
C     CODE FOR NBSET EPA FOR CI FIRST
C
CJ    IF (ICIT.EQ.1) RETURN
      CALL RFILE(IT96)
      ISEA=1
      IADHA=JT1C(NDF+1)
      IADTA=JT1C(2*NDF+(NBSET-1)*NDF+1)
      DO 312 IDF=1,NDF
      CALL WREADW(IT94,HA,INTOWP(NUMIJ),IADHA,IADHA)
      CALL WREADW(IT94,TA,INTOWP(NUMIJ),IADTA,IADTA)
         DO 311 IJ=1,NUMIJ
         LSTEPA(IJ)=HA(IJ)+TA(IJ)
C
C     THIS MAY NEED TA*0.5D0
C
  311    CONTINUE
CTJL  WRITE(*,*) ' IN FAMAT; ISEA = ',ISEA,'   BEFORE'
      CALL WWRITW(IT96,LSTEPA,INTOWP(NUMIJ),ISEA,ISEA)
CTJL  WRITE(*,*) ' IN FAMAT; ISEA = ',ISEA,'   AFTER '
        IF (IAND(IPRINT,32) .NE. 0) THEN
CTJL    IF (IDF.EQ.1) THEN
          WRITE(NOUT,1104) IDF
 1104     FORMAT(/'  LSTEPA FOR DEGREE ',I5)
          CALL PRINT(LSTEPA,NUMIJ,NORBS,NOUT)
        END IF
  312 CONTINUE
      RETURN
      END
      SUBROUTINE FINAL(U,W,EPA,SA,UAWB,SAEB,DTOT,JT1C,IOFF)
      IMPLICIT REAL*8 (A-H,O-Z)
      DIMENSION U(NORBS,NORBS,NDF),W(NORBS,NORBS,NDF),SA(NUMIJ,NDF),
     1EPA(NORBS,NORBS,NDF),UAWB(NDF,NDF),SAEB(NDF,NDF),DTOT(NDF,NDF)
      INTEGER JT1C(1),IOFF(NUMIJ)
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ ISYMRB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /FUNCS/ IOCC,JOCC,KOCC,NTYPES,NBSET,NAT
      COMMON /OCCS/ NSPE,NSA,NSB,NALP,NOP,NDOC,LFERM,NUOC,IJIND,IJIND3
      COMMON /LOC42/ IA42(100),IBF2AT(284)
      COMMON /IEXT/ IPRINT,IGRP,ICIDIP
C
C  COMPUTE S(A)*EPA(B) CONTRIBUTION TO FCM
C
      WRITE(ICHK,*) '  IN SUBROUTINE FINAL'
      A2=2.0D+00
      NORBSQ=NORBS*NORBS
      IS=1
      DO 101 IDF=1,NDF
 101  CALL WREADW(IT94,SA(1,IDF),INTOWP(NUMIJ),IS,IS)
C
      IEA=2*NDF+NBSET*NDF+1
      ISEA=JT1C(IEA)
      DO 102 IDF=1,NDF
C       WRITE(NOUT,1001) IDF,ISEA
C1001   FORMAT(/'  READING EPA FOR DEGREE ',I5,'  FROM WORD ',I8)
 102  CALL WREADW(IT94,EPA(1,1,IDF),INTOWP(NORBSQ),ISEA,ISEA)
C
      DO 201 IDFA=1,NDF
        DO 201 IDFB=1,NDF
          DO 202 K=LFERM,NORBS
            KO=IOFF(K)
            DO 202 L=LFERM,K
              KL=KO+L
              SAEB(IDFA,IDFB)=SAEB(IDFA,IDFB)-A2*SA(KL,IDFA)*EPA(K,L,
     *        IDFB)
              IF (K .NE. L)
     1        SAEB(IDFA,IDFB)=SAEB(IDFA,IDFB)-A2*SA(KL,IDFA)*EPA(L,K,
     *        IDFB)
 202      CONTINUE
 201  CONTINUE
      WRITE(NOUT,*) '  FINISHED SAEB'
C
C  COMPUTE U(A)*W(B) CONTRIBUTION TO FCM
C
      IU=1
      IWA=3*NDF+NBSET*NDF+1
      ISWA=JT1C(IWA)
      DO 106 IDF=1,NDF
CC      WRITE(NOUT,1002) IDF,IU
 1002   FORMAT(/'  READING U FOR DEGREE ',I5,'  FROM WORD ',I8)
        CALL WREADW(IT98,U(1,1,IDF),INTOWP(NORBSQ),IU,IU)
CC    CALL MATOUT(U(1,1,IDF),NORBS,NORBS,NORBS,NORBS,NOUT)
CC      WRITE(NOUT,1003) IDF,ISWA
 1003   FORMAT(/'  READING W FOR DEGREE ',I5,'  FROM WORD ',I8)
        CALL WREADW(IT94,W(1,1,IDF),INTOWP(NORBSQ),ISWA,ISWA)
CC    CALL MATOUT(W(1,1,IDF),NORBS,NORBS,NORBS,NORBS,NOUT)
 106  CONTINUE
C
      DO 203 IDFA=1,NDF
        DO 203 IDFB=1,NDF
          DO 204 K=1,NORBS
            DO 204 L=LFERM,NORBS
              UAWB(IDFA,IDFB)=UAWB(IDFA,IDFB)+U(K,L,IDFB)*W(K,L,IDFA)
 204      CONTINUE
 203  CONTINUE
      WRITE(NOUT,*) '  FINISHED UAWB'
C
      WRITE(NOUT,*) '  THE SA*EB CONTRIBUTION TO FCM:'
      CALL MATOUT(SAEB,NDF,NDF,NDF,NDF,NOUT)
      WRITE(NOUT,*) '  THE UA*WB CONTRIBUTION TO FCM:'
      CALL MATOUT(UAWB,NDF,NDF,NDF,NDF,NOUT)
C
      CALL WREADW(IT42,DTOT,INTOWP(NDF*NDF),IA42(16),JUNK)
      WRITE(NOUT,*) '  THE AO CONTRIBUTIO TO FCM FROM TAPE42:'
      CALL MATOUT(DTOT,NDF,NDF,NDF,NDF,NOUT)
C
      DO 301 IDF=1,NDF
        DO 301 JDF=1,NDF
          DTOT(IDF,JDF)=DTOT(IDF,JDF)+SAEB(IDF,JDF)+UAWB(IDF,JDF)
 301  CONTINUE
C
      WRITE(NOUT,1004)
 1004 FORMAT(//'   THE TOTAL FORCE CONSTANT MATRIX:'//)
      CALL MATOUT(DTOT,NDF,NDF,NDF,NDF,NOUT)
C
      WRITE(15,'(2I5)') NAT,NAT*6
      WRITE(15,1005) ((DTOT(II,JJ), JJ=1,NDF), II=1,NDF)
 1005 FORMAT(3F20.10)
C
      RETURN
      END
      SUBROUTINE FLINX(A,IDIM,IN,IM,DET)
      IMPLICIT REAL*8 (A-H,O-Z)
C     EXTENDED DUMMY A
C
C     LINEAR SIMULTANEOUS EQUATION
C
C     A(IN*IN) * X(IN*IM) = B(IN*IM)
C
C     A & B SHOULD BE STORED ON A(IN*(IN+IM))
C     SOLUTION X WILL BE STORED ON B PART IN DIMENSION A.
C
cets  REAL*16 DET,D
      real*8 det,d
      DIMENSION A(IDIM,1)
      DATA ZERO,ONE / 0.0D+00 , 1.0D+00 /
C
      N=IN
      NR=IM
      JMAX=N+NR
      SIGN=ONE
C M IS THE STAGE OF ELIMINATION
      DO 49 M=1,N
        TEMP=ZERO
        DO 41 I=M,N
          IF(M.GT.1)A(I,M)=A(I,M)-DOT(A(I,1),IDIM,A(1,M),1,M-1)
          AVAL=A(I,M)
          IF(DABS(AVAL).LE.TEMP)GOTO 41
          TEMP=DABS(AVAL)
          IMAX=I
 41     CONTINUE
        IF(TEMP.LE.ZERO)GOTO 999
        IF(IMAX.EQ.M)GOTO 45
        SIGN=-SIGN
        DO 44 J=1,JMAX
          STOR=A(M,J)
          A(M,J)=A(IMAX,J)
          A(IMAX,J)=STOR
 44     CONTINUE
 45     CONTINUE
        JJ=M+1
        IF(JJ.GT.JMAX)GOTO 49
        IF(M.GT.1)GOTO 47
        DO 46 J=JJ,JMAX
          A(1,J)=A(1,J)/A(1,1)
 46     CONTINUE
        D=A(1,1)
        GOTO 49
 47     CONTINUE
        DO 48 J=JJ,JMAX
          A(M,J)=(A(M,J)-DOT(A(M,1),IDIM,A(1,J),1,M-1))/A(M,M)
 48     CONTINUE
CTJL    D=D*A(M,M)
 49   CONTINUE
      IF(NR.EQ.0) RETURN
      DO 59 I=1,NR
        NPI=N+I
        DO 58 K=2,N
          J=N+1-K
          A(J,NPI)=A(J,NPI)-DOT(A(J,J+1),IDIM,A(J+1,NPI),1,K-1)
 58     CONTINUE
 59   CONTINUE
C***  IF(DABS(D).GE.1.0D+36) D=1.0D+36
C***  IF(DABS(D).LE.1.0D-36) D=1.0D-36
CTJL  DET=D*SIGN
      RETURN
C ON ZERO PIVOT, SET DET=0.AND RETURN TO CALLING PROGRAM NOV 1972
 999  DET=ZERO
      RETURN
      END
      SUBROUTINE GETA(A,EPS,ZETA,ALPHA,BETA,DOFF,DADD,IDIM,IDIMA)
      IMPLICIT INTEGER (A-Z)
      INTEGER DOFF(IDIM),DADD(IDIM)
      REAL*8 A(IDIMA),EPS(NUMIJ),ZETA(NUMIJ,NORBS)
      REAL*8 ALPHA(NUMIJ),BETA(NUMIJ)
      REAL*8 A2,VAL1,VAL2,VAL3
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ SYMORB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /OCCS/ NSPE,NSA,NSB,NALP,NOP,NDOC,LFERM,NUOC,IJIND,IJIND3
      DATA A2 /2.0D+00/
C
C INITIALIZATION OF SUROUTINE GETA.
C
      RETURN
C
      ENTRY GA1(IJND,KLND,IL,JL,IK,JK,VAL2,VAL1,VAL3,
     #A,EPS,ZETA,ALPHA,BETA,DOFF,DADD,IDIM,IDIMA)
C
C     WRITE(*,*)'ENTRY GA1'
      IJKL=DOFF(IJND)+DADD(KLND)
      A(IJKL) = A2*(ALPHA(IL)-ALPHA(JL)-ALPHA(IK)+ALPHA(JK))*
     1  VAL2 + (BETA(IL)-BETA(JL)-BETA(IK)+BETA(JK))*(VAL3+VAL1)
      KLIJ=DOFF(KLND)+DADD(IJND)
      A(KLIJ) = A(IJKL)
C     A(KLND,IJND) = A(IJND,KLND)
      RETURN
C
      ENTRY GA2(IJND,JLND,IL,JL,IJ,JJ,VAL1,VAL2,JOR,
     #A,EPS,ZETA,ALPHA,BETA,DOFF,DADD,IDIM,IDIMA)
C     WRITE(*,*)'ENTRY GA2'
C
      IJJL=DOFF(IJND)+DADD(JLND)
      A(IJJL) = A2*(ALPHA(IL)-ALPHA(JL)-ALPHA(IJ)+ALPHA(JJ))*
     1  VAL1 + (BETA(IL)-BETA(JL)-BETA(IJ)+BETA(JJ))*(VAL2+VAL1)
     2  -EPS(IL) + ZETA(IL,JOR)
      JLIJ=DOFF(JLND)+DADD(IJND)
      A(JLIJ) = A(IJJL)
C     A(JLND,IJND) = A(IJND,JLND)
      RETURN
C
      ENTRY GA3(IKND,ILND,IL,KL,II,IK,VAL1,VAL2,IOR,
     #A,EPS,ZETA,ALPHA,BETA,DOFF,DADD,IDIM,IDIMA)
C     WRITE(*,*)'ENTRY GA3'
C
      IKIL=DOFF(IKND)+DADD(ILND)
      A(IKIL) = A2*(ALPHA(IL)-ALPHA(KL)-ALPHA(II)+ALPHA(IK))*
     1  VAL1 + (BETA(IL)-BETA(KL)-BETA(II)+BETA(IK))*(VAL2+VAL1)
     2  +EPS(KL) - ZETA(KL,IOR)
      ILIK=DOFF(ILND)+DADD(IKND)
      A(ILIK) = A(IKIL)
      RETURN
C
      ENTRY GA4(IKND,JKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,
     #A,EPS,ZETA,ALPHA,BETA,DOFF,DADD,IDIM,IDIMA)
C     WRITE(*,*)'ENTRY GA4'
C
      IKJK=DOFF(IKND)+DADD(JKND)
      A(IKJK) = A2*(ALPHA(IK)-ALPHA(KK)-ALPHA(IJ)+ALPHA(JK))*
     1  VAL1 + (BETA(IK)-BETA(KK)-BETA(IJ)+BETA(JK))*(VAL2+VAL1)
     2  +EPS(IJ) - ZETA(IJ,KOR)
      JKIK=DOFF(JKND)+DADD(IKND)
      A(JKIK) = A(IKJK)
C     A(JKND,IKND) = A(IKND,JKND)
      RETURN
C
      ENTRY GA6(IKND,IK,KK,II,VAL1,VAL2,IOR,KOR,
     #A,EPS,ZETA,ALPHA,BETA,DOFF,DADD,IDIM,IDIMA)
C     WRITE(*,*)'ENTRY GA6'
C
      IKIK=DOFF(IKND)+DADD(IKND)
      A(IKIK) = A2*(ALPHA(IK)-ALPHA(KK)-ALPHA(II)+ALPHA(IK))*
     1  VAL1 + (BETA(IK)-BETA(KK)-BETA(II)+BETA(IK))*(VAL2+VAL1)
     2  +EPS(II) - ZETA(II,KOR) + EPS(KK) - ZETA(KK,IOR)
      RETURN
C
      END
      SUBROUTINE GETB(A,EPS,ZETA,ALPHA,BETA,SS)
      IMPLICIT INTEGER (A-Z)
C     REAL*8 A(IJIND,IJIND3),EPS(NUMIJ),ZETA(NUMIJ,NORBS)
      REAL*8 A(IJIND,NDF   ),EPS(NUMIJ),ZETA(NUMIJ,NORBS)
      REAL*8 ALPHA(NUMIJ),BETA(NUMIJ),SS(NUMIJ,NDF)
      REAL*8 A2,VAL1,VAL2,VAL3
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ SYMORB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /OCCS/ NSPE,NSA,NSB,NALP,NOP,NDOC,LFERM,NUOC,IJIND,IJIND3
      DATA A2 /2.0D+00/
C
C INITIALIZATION OF SUROUTINE GETB.
C
      RETURN
C
      ENTRY GB1(IJND,IL,JL,IK,JK,VAL2,VAL1,VAL3,KL,
     #a,eps,zeta,alpha,beta,ss)
C
      DO 10 IDF = 1,NDF
C     XDF = IJIND + IDF
      XDF =  IDF
      A(IJND,XDF)=A(IJND,XDF)+SS(KL,IDF)*(A2*(ALPHA(IL)-ALPHA(JL) +
     1  ALPHA(IK)-ALPHA(JK))*VAL2+(BETA(IL)-BETA(JL)+BETA(IK)-BETA(JK))
     2 *(VAL1+VAL3))
   10 CONTINUE
      RETURN
C
      ENTRY GB21(JLND,JJ,JL,IJ,IL,VAL1,VAL2,JOR,
     #a,eps,zeta,alpha,beta,ss)
C
      DO 21 IDF = 1,NDF
      XDF =  IDF
      A(JLND,XDF)=A(JLND,XDF)+SS(IJ,IDF)*(A2*(ALPHA(JJ)-ALPHA(JL) +
     1  ALPHA(IJ)-ALPHA(IL))*VAL1+(BETA(JJ)-BETA(JL)+BETA(IJ)-
     2 BETA(IL))
     3 *(VAL1+VAL2)-EPS(IL)+ZETA(IL,JOR))
   21 CONTINUE
      RETURN
C
      ENTRY GB22(IJND,IL,JL,IJ,JJ,VAL1,VAL2,JOR,
     #a,eps,zeta,alpha,beta,ss)
C
      DO 20 IDF = 1,NDF
      XDF =  IDF
      A(IJND,XDF)=A(IJND,XDF)+SS(JL,IDF)*(A2*(ALPHA(IL)-ALPHA(JL) +
     1  ALPHA(IJ)-ALPHA(JJ))*VAL1+(BETA(IL)-BETA(JL)+BETA(IJ)-BETA(JJ))
     2 *(VAL1+VAL2)+EPS(IL)-ZETA(IL,JOR))
   20 CONTINUE
      RETURN
C
      ENTRY GB3(IKND,IL,KL,II,IK,VAL1,VAL2,IOR,
     #a,eps,zeta,alpha,beta,ss)
C
      DO 30 IDF = 1,NDF
      XDF =  IDF
      A(IKND,XDF)=A(IKND,XDF)+SS(IL,IDF)*(A2*(ALPHA(IL)-ALPHA(KL) +
     1  ALPHA(II)-ALPHA(IK))*VAL1+(BETA(IL)-BETA(KL)+BETA(II)-BETA(IK))
     2 *(VAL1+VAL2)-EPS(KL)+ZETA(KL,IOR))
   30 CONTINUE
      RETURN
C
      ENTRY GB4(IKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,
     #a,eps,zeta,alpha,beta,ss)
C
      DO 40 IDF = 1,NDF
      XDF =  IDF
      A(IKND,XDF)=A(IKND,XDF)+SS(JK,IDF)*(A2*(ALPHA(IK)-ALPHA(KK) +
     1  ALPHA(IJ)-ALPHA(JK))*VAL1+(BETA(IK)-BETA(KK)+BETA(IJ)-BETA(JK))
     2 *(VAL1+VAL2)+EPS(IJ)-ZETA(IJ,KOR))
   40 CONTINUE
      RETURN
C
      ENTRY GB6(IKND,II,KK,VAL1,VAL2,IK,IOR,KOR,
     #a,eps,zeta,alpha,beta,ss)
C
      DO 60 IDF = 1,NDF
      XDF =  IDF
      A(IKND,XDF)=A(IKND,XDF)+SS(IK,IDF)*(A2*(ALPHA(II)-ALPHA(KK))*
     1  VAL1+(BETA(II)-BETA(KK))*(VAL1+VAL2) +
     2  EPS(II)-ZETA(II,KOR)-EPS(KK)+ZETA(KK,IOR))
   60 CONTINUE
      RETURN
C
      ENTRY GBD(IJND,IK,JK,VAL2,VAL1,KK,
     #a,eps,zeta,alpha,beta,ss)
C
      DO 80 IDF = 1,NDF
      XDF =  IDF
      A(IJND,XDF)=A(IJND,XDF)+SS(KK,IDF)*A2*((ALPHA(IK)-ALPHA(JK))*
     1  VAL2+(BETA(IK)-BETA(JK))*VAL1)
   80 CONTINUE
      RETURN
      END
      SUBROUTINE GETCV(RS,EX,EAVF,LG,SS)
      IMPLICIT INTEGER (A-Z)
      REAL*8 LG(NBF,NBF),SS(NUMIJ,NDF),EAVF(NUMIJ)
      REAL*8 RS(NUMDEP,NDF),EX(IJIND)
      REAL*8 A1,A4,VAL1,VAL2,VAL3,FAC1,EFAC
      real*8 junk
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ SYMORB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /OCCS/ NSPE,NSA,NSB,NALP,NOP,NDOC,LFERM,NUOC,IJIND,IJIND3
      COMMON/OCCS2/NUMCOR,NCOR,FDOC,CORDOC,NUMVIR,FVIR,LUOC,NUMDEP,VUOC
      DATA A1,A4 /1.0D+00,4.0D+00/
C
C INITIALIZATION OF SUROUTINE GETCV
C
      RETURN
C
      ENTRY RS1(IJDEP,FAC1,VAL2,VAL1,VAL3,KL,rs,ss)
      DO 10 IDF = 1,NDF
      junk=ss(kl,idf)
cets  RS(IJDEP,IDF)=RS(IJDEP,IDF)+FAC1*SS(KL,IDF)*(A4*VAL2-VAL1-VAL3)
      RS(IJDEP,IDF)=RS(IJDEP,IDF)+FAC1*junk      *(A4*VAL2-VAL1-VAL3)
   10 CONTINUE
      RETURN
C
      ENTRY EX1(IJND,LL,KK,LOR,KOR,VAL2,VAL1,VAL3,ex,eavf,lg)
      EFAC = (A1/(EAVF(LL) - EAVF(KK)))*(LG(LOR,KOR)-LG(KOR,LOR))
      EX(IJND) = EX(IJND) + EFAC*(A4*VAL2-VAL1-VAL3)
      RETURN
      END
      SUBROUTINE GETDRT(KADD,LADD,IJADD,IJGRP,ORBTBF,IOUT,ORBSYM,JCODE,
     1NGROUP)
      IMPLICIT INTEGER (A-Z)
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ ISYMRB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /FUNCS/ IOCC,JOCC,KOCC,NTYPES,NBSET,NAT
      COMMON /OCCS/ NSPE,NSA,NSB,NALP,NOP,NDOC,LFERM,NUOC,IJIND,IJIND3
      COMMON /IEXT/ IPRINT,IGRP,ICIDIP
      DIMENSION KADD(ISYMRB),LADD(ISYMRB),IJADD(NUMIJ),IJGRP(NUMIJ)
      DIMENSION JCODE(NORBS),IOUT(NBF),ORBTBF(NORBS),ORBSYM(NORBS)
C
      WRITE(ICHK,2222)
 2222 FORMAT(/'  IN GETDRT')
      END=48+INTOWP(1)
      CALL WREADW(IT58,KADD,ISYMRB,END,END)
      CALL WREADW(IT58,LADD,ISYMRB,END,END)
      CALL WREADW(IT58,IJADD,NUMIJ,END,END)
      CALL WREADW(IT58,IJGRP,NUMIJ,END,END)
      END=END+4*NORBS+NGROUP
      CALL WREADW(IT58,IOUT,NBF,END,END)
      CALL WREADW(IT58,ORBSYM,NORBS,END,END)
      END=END+NBF
      CALL WREADW(IT58,JCODE,NBF,END,END)
      CALL WREADW(IT58,ORBTBF,NORBS,END,END)
COUT  WRITE(*,*)'ORBTBF FROM DRT'
COUT  WRITE(*,*) ORBTBF
      IF (IAND(IPRINT,1) .NE. 0) THEN
        WRITE(NOUT,*) '  KADD:'
        WRITE(NOUT,710)  KADD
        WRITE(NOUT,*) '  LADD:'
        WRITE(NOUT,710)  LADD
        WRITE(NOUT,*) '  IJADD:'
        WRITE(NOUT,710)  IJADD
        WRITE(NOUT,*) '  IJGRP:'
        WRITE(NOUT,710)  IJGRP
        WRITE(NOUT,*) '  IOUT:'
        WRITE(NOUT,710)  IOUT
        WRITE(NOUT,*) '  ORBSYM:'
        WRITE(NOUT,710)  ORBSYM
        WRITE(NOUT,*) '  JCODE:'
        WRITE(NOUT,710)  JCODE
        WRITE(NOUT,*) '  ORBTBF:'
        WRITE(NOUT,710)  ORBTBF
      END IF
 710  FORMAT(16I5)
C
      RETURN
      END
C**********************************************************************
C*   NOTICE OF PROGRAM MODIFICATION                                   *
C**********************************************************************
C*  BY:  RICHARD REMINGTON                         search:  c5-22-88  *
C*  DATE:  MAY   22,   1988                                           *
C*  REASON: DECREASE CORE TO RUN IN 7MB ON 9370                       *
C**********************************************************************
C     PROGRAM LAST UPDATED JULY  07, 1987                             *
C     BY: GES                                                         *
C     REASON: COMMENT LINES ZEROING A MATRIX FOR CPHFL (LOOK FOR CGES)*
C     THIS SUBROUTINE CONSTRUCTS ETA,ZETA,BETA, ETC. AND WAS ONLY     *
C     ZEROING OUT A.
C**********************************************************************
C     PROGRAM LAST UPDATED JULY  12, 1985                             *
C     BY: TJL                                                         *
C**********************************************************************
C
      SUBROUTINE GETINT(A,ETA,ZETA,F,ALPHA,BETA,IJORD,KADD,LADD,
     1IJADD,IJGRP,ORBSYM,INTS,S,EPA,JT1C,IOFF,EAVF,CCSD)
      IMPLICIT INTEGER (A-Z)
CIBM  EXTENDED DUMMY A,ETA,ZETA,F,ALPHA,BETA,INTS,BUF,EIG,S,EPA,W,
CIBM 1E11,E22,E12
      LOGICAL IJEQ,IJKEQ,JKEQ,CCSD
      INTEGER XDF,N112(112),JULIA(70)
      REAL*8 A0,A1,A2,A1S2,A4,FOCC,EAVF(NUMIJ)
      DIMENSION IJORD(NUMIJ),KADD(SYMORB),LADD(SYMORB),JT1C(1)
      DIMENSION ORBSYM(NORBS),IJADD(NUMIJ),IJGRP(NUMIJ)
      DIMENSION IOFF(NUMIJ)
      REAL*8 A(IJIND,IJIND3),F(NORBS),INTS(NMAX)
     1,S(NUMIJ,NDF),EPA(NORBS,NORBS)
      REAL*8 ZETA(NUMIJ,NORBS),ALPHA(NUMIJ),BETA(NUMIJ)
      REAL*8 C1A,C2A,C1,C2
      REAL*8 VAL1,VAL2,VAL3,ETA(NUMIJ),ESCF,REPNUC
      COMMON /CIA/ C1A(45),C2A(45),C1,C2,ESCF
C!!!  COMMON /TAPES/ IT22,IT8,NOUT,IT2,IT42,JTAP1,IUTAP,JTAP2
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ SYMORB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /POINT/ FOCC(5),IPOINT(5),JPOINT(5),NSORB(5)
      COMMON /FUNCS/ IOCC,JOCC,KOCC,NTYPES,NBSET,NAT
      COMMON /OCCS/ NSPE,NSA,NSB,NALP,NOP,NDOC,LFERM,NUOC,IJIND,IJIND3
      COMMON /LOC22/ IA22(100),IBF2AT(284)
      COMMON /IEXT/ IPRINT,IGRP,ICIDIP
      COMMON /REN/ REPNUC
C
      WRITE(ICHK,2222)
 2222 FORMAT(/'  IN GETINT')
 3001 FORMAT(10I5)
      DO 3010 IJUL=1,70
        JULIA(IJUL)=0
 3010 CONTINUE
      WRITE(ICHK,*) '   THE SPECIAL PARAMETERS '
      WRITE(ICHK,3001) NSPE,NSA,NSB,NALP,NOP,NDOC,
     +                 LFERM,NUOC,IJIND,IJIND3
CTJL  WRITE(ICHK,*) '   THE IJORD ARRAY:'
CTJL  WRITE(ICHK,3001) (IJORD(III), III=1,NUMIJ)
      IJIND2=IJIND
      A0=0.0D+00
      A1=1.0D+00
      A2=2.0D+00
      A4=4.00D+00
      A1S2=0.50D+00
CTJL  H11=A0
CTJL  H22=A0
CTJL  H12=A0
CTJL  DO 3020 I=1,NORBS
CTJL    DO 3030 J=1,NORBS
CTJL      E11(I,J)=A0
CTJL      E22(I,J)=A0
CTJL      E12(I,J)=A0
C3030   CONTINUE
C3020 CONTINUE
      DO 3040 I=1,NORBS
        F(I)=F(I)*A1S2
CTJL  WRITE(*,*) ' I,F ',I,F(I)
 3040 CONTINUE
CTJL  DO 3050 II=1,NDF
CTJL    DO 3060 I=1,NORBS
CTJL      DO 3070 J=1,NORBS
CTJL        W(I,J,II)=A0
C3070     CONTINUE
C3060   CONTINUE
C3050 CONTINUE
      ESCF=A0
C     NINR=NBF*NORBS*2
C     INTSRT=((NINR-1)/112+6)*112
C     NIJR=NUMIJ*2
C     INTSRT=INTSRT+((NIJR-1)/112+1)*224
C     NBFSQ=NBF*NBF*2
C     INTSRT=INTSRT+((NBFSQ-1)/112+2)*112
C     NKL=(NORBS*(NORBS+1))/2
C     INTSRT=INTSRT+((NKL-1)/112+1)*224
C     NIN=NSYM*NORBS
C     INTSRT=INTSRT+((NIN-1)/112+1)*224+1
C
C  NEW WAY OF OBTAINING INTSRT
      CALL RFILE(IT52)
      WRITE(ICHK,2223)
 2223 FORMAT(/'  OPENED IT52')
CTJL  CALL SREW(IT52)   THIS IS DONE IN RFILE
      IF(.NOT.CCSD)CALL SREAD(IT52,N112,112)
      CALL RGETSA(IT52,INTSRT)
CTJL  WRITE(ICHK,2224) INTSRT
C2224 FORMAT(/'  CALLED RGETSA',I8)
CIBM  CALL RSETSA(IT52,INTSRT)
CTJL  WRITE(ICHK,2225)  INTSRT
CTJL  WRITE(NOUT,2225) INTSRT
C2225 FORMAT(/'  CALLED RSETSA',I8)
      IGRP=0
C
      IIJJ=0
      DO 3080 II=1,NORBS
        DO 3090 JJ=1,II
          IIJJ=IIJJ+1
          ETA(IIJJ)=A0
          EAVF(IIJJ)=A0
          DO 3100 III=1,NORBS
            ZETA(IIJJ,III)=A0
 3100     CONTINUE
 3090   CONTINUE
 3080 CONTINUE
C
C
C  CONSTRUCT ETA AND ZETA MATRICIES
C
      DO 3110 IOR=NORBS,LFERM,-1
        IO=IOFF(IOR)
        II=IO+IOR
        ISM=ORBSYM(IOR)
        ITYP=1
        DO 3120 JOR=IOR,LFERM,-1
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IF (IGRP .NE. IJGRP(IOFF(IOR)+JOR)) THEN
            WRITE(ICHK,3002) IOR,JOR,IGRP,IJGRP(IOFF(IOR)+JOR)
 3002       FORMAT('  IOR=',I5,' JOR=',I5,' IGRP=',I5,' NEW GROUP=',I5)
CIBM        CALL RGETSA(IT52,IX)
CIBM        WRITE(NOUT,2001) IX
C2001       FORMAT('  READING FROM IT52 AT ADR ',I8)
            CALL SREAD(IT52,INTS,NMAX*2)
CCC            WRITE(NOUT,1901)
CCC            WRITE(NOUT,1902) (INTS(III), III=1,NMAX)
 1901       FORMAT(/'  HERE ARE A FEW INTEGRALS FROM IT52:')
 1902       FORMAT(10F10.6)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IOFF(IOR)+JOR)
            WRITE(ICHK,3003) IGRP
 3003       FORMAT('  NOW IGRP=',I5)
          END IF
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IJ)
          DO 3130 KOR=1,NUOC
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
            DO 3140 LOR=1,KOR
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
CTJL          IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
CTJL *        300
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 300
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,KOR,LOR,IBF,JBF,KBF,
     *          LBF,ISM,JSM,KSM,LSM
 2004           FORMAT(/'  IN GETDM, IJKLT UNKNOWN TYPE ',I5/'  ORBITALS
     * :',4I5/'  BASIS FUNCTIONS :',4I5/'   SYMMETRIES :',4I5)
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005) LAD
 2005           FORMAT(/'  IN GETDM, LAD TOO BIG :',I6)
                CALL ABORTS
              END IF
              GOTO (10,20,30,40,50,60,70)IJKLT
 10           CONTINUE
C  THIS TYPE (ALL DIFFERENT) DOES NOT CONTRIBUTE
              GOTO 300
 20           CONTINUE
              WRITE(NOUT,2006)
 2006         FORMAT(/     '  IN CONSTRUCTON OF ETA AND ZETA, J=K IS NOT
     * POSSIBLE DO THE FIRST SET OF LOOPS'/'  ERROR IN LOOPS SOMEWHERE')
              CALL ABORTS
 30           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              ETA(KL)=ETA(KL)+ALPHA(IK)*VAL2+BETA(IK)*VAL1
              EAVF(KL)=EAVF(KL)+F(IOR)*(A2*VAL2-VAL1)
              DO 3150 J2=1,NORBS
                IJ2=IOFF(MAX(IOR,J2))+MIN(IOR,J2)
                ZETA(KL,J2)=ZETA(KL,J2)+ALPHA(IJ2)*VAL2+BETA(IJ2)*
     *          VAL1
 3150         CONTINUE
              GOTO 300
 40           CONTINUE
C  THIS TYPE (K=L) DOES NOT CONTRIBUTE
              GOTO 300
 50           CONTINUE
              WRITE(NOUT,2007)
 2007         FORMAT(/     '  IN CONSTRUCTON OF ETA AND ZETA, I=J=K IS N
     *OT POSSIBLE DO THE FIRST SET OF LOOPS'/'  ERROR IN LOOPS SOMEWHERE
     *')
              CALL ABORTS
 60           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              ETA(LL)=ETA(LL)+ALPHA(IL)*VAL2+BETA(IL)*VAL1
              EAVF(LL)=EAVF(LL)+F(IOR)*(A2*VAL2-VAL1)
              DO 3160 J2=1,NORBS
                IJ2=IOFF(MAX(IOR,J2))+MIN(IOR,J2)
                ZETA(LL,J2)=ZETA(LL,J2)+ALPHA(IJ2)*VAL2+BETA(IJ2)*
     *          VAL1
 3160         CONTINUE
              GOTO 300
 70           CONTINUE
              WRITE(NOUT,2008)
 2008         FORMAT(/     '  IN CONSTRUCTON OF ETA AND ZETA,I=J=K=L IS
     *NOT POSSIBLE DO THE FIRST SET OF LOOPS'/'  ERROR IN LOOPS SOMEWHER
     *E')
              CALL ABORTS
 300          CONTINUE
 3140       CONTINUE
 3130     CONTINUE
          DO 3170 KOR=LFERM,JOR
            KSM=ORBSYM(KOR)
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
            DO 3180 LOR=1,NUOC
CTJL          IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
CTJL *        301
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 301
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004)IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005) LAD
                CALL ABORTS
              END IF
              GOTO (11,21,31,41,51,61,71)IJKLT
 11           CONTINUE
C  THIS TYPE (ALL DIFFERENT) DOES NOT CONTRIBUTE
              GOTO 301
 21           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              ETA(IL)=ETA(IL)+ALPHA(IJ)*VAL2+BETA(IJ)*VAL1
              EAVF(IL)=EAVF(IL)+F(JOR)*(A2*VAL2-VAL1)
              DO 3190 K2=1,NORBS
                KL2=IOFF(MAX(JOR,K2))+MIN(JOR,K2)
                ZETA(IL,K2)=ZETA(IL,K2)+ALPHA(KL2)*VAL2+BETA(KL2)*
     *          VAL1
 3190         CONTINUE
              GOTO 301
 31           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              ETA(KL)=ETA(KL)+ALPHA(IK)*VAL2+BETA(IK)*VAL1
              EAVF(KL)=EAVF(KL)+F(IOR)*(A2*VAL2-VAL1)
              DO 3200 J2=1,NORBS
                IJ2=IOFF(MAX(IOR,J2))+MIN(IOR,J2)
                ZETA(KL,J2)=ZETA(KL,J2)+ALPHA(IJ2)*VAL2+BETA(IJ2)*
     *          VAL1
 3200         CONTINUE
              GOTO 301
 41           CONTINUE
              WRITE(NOUT,2009)
 2009         FORMAT(/     '  IN CONSTRUCTON OF ETA AND ZETA,  K=L  IS N
     *OT POSSIBLE DO THE 2ND SET OF LOOPS'/'  ERROR IN LOOPS SOMEWHERE')
              CALL ABORTS
              GOTO 301
 51           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              ETA(IL)=ETA(IL)+ALPHA(II)*VAL1+BETA(II)*VAL1+F(IOR)*
     *        VAL3
              EAVF(IL)=EAVF(IL)+F(IOR)*(A2*VAL1-VAL1) + VAL3
              DO 3210 J2=1,NORBS
                IJ2=IOFF(MAX(IOR,J2))+MIN(IOR,J2)
                ZETA(IL,J2)=ZETA(IL,J2)+ALPHA(IJ2)*VAL1+BETA(IJ2)*
     *          VAL1+F(J2)*VAL3
 3210         CONTINUE
              GOTO 301
 61           CONTINUE
              WRITE(NOUT,2010)
 2010         FORMAT(/     '  IN CONSTRUCTON OF ETA AND ZETA,I=J=K  IS N
     *OT POSSIBLE DO THE 2ND SET OF LOOPS'/'  ERROR IN LOOPS SOMEWHERE')
              CALL ABORTS
 71           CONTINUE
              WRITE(NOUT,2011)
 2011         FORMAT(/     '  IN CONSTRUCTON OF ETA AND ZETA,I=J=K=L IS
     *NOT POSSIBLE DO THE 2ND SET OF LOOPS'/'  ERROR IN LOOPS SOMEWHERE'
     *        )
              CALL ABORTS
 301          CONTINUE
 3180       CONTINUE
            DO 3220 LOR=LFERM,KOR
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        302
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 302
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005) LAD
                CALL ABORTS
              END IF
              GOTO (12,22,32,42,52,62,72)IJKLT
 12           CONTINUE
C  THIS TYPE (ALL DIFFERENT) DOES NOT CONTRIBUTE
              GOTO 302
 22           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              ETA(IL)=ETA(IL)+ALPHA(IJ)*VAL2+BETA(IJ)*VAL1
              EAVF(IL)=EAVF(IL)+F(JOR)*(A2*VAL2-VAL1)
              DO 3230 K2=1,NORBS
                KL2=IOFF(MAX(K2,JOR))+MIN(K2,JOR)
                ZETA(IL,K2)=ZETA(IL,K2)+ALPHA(KL2)*VAL2+BETA(KL2)*
     *          VAL1
 3230         CONTINUE
              GOTO 302
 32           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              ETA(KL)=ETA(KL)+ALPHA(IK)*VAL2+BETA(IK)*VAL1
              EAVF(KL)=EAVF(KL)+F(IOR)*(A2*VAL2-VAL1)
              DO 3240 J2=1,NORBS
                IJ2=IOFF(MAX(IOR,J2))+MIN(IOR,J2)
                ZETA(KL,J2)=ZETA(KL,J2)+ALPHA(IJ2)*VAL2+BETA(IJ2)*
     *          VAL1
 3240         CONTINUE
              GOTO 302
 42           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              ETA(IJ)=ETA(IJ)+ALPHA(IL)*VAL2+BETA(IL)*VAL1
              EAVF(IJ)=EAVF(IJ)+F(KOR)*(A2*VAL2-VAL1)
              DO 3250 K2=1,NORBS
                KL2=IOFF(MAX(K2,LOR))+MIN(K2,LOR)
                ZETA(IJ,K2)=ZETA(IJ,K2)+ALPHA(KL2)*VAL2+BETA(KL2)*
     *          VAL1
 3250         CONTINUE
              GOTO 302
 52           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              ETA(IL)=ETA(IL)+(ALPHA(II)+BETA(II))*VAL1
     1        +(ALPHA(IL)+BETA(IL))*VAL2+F(IOR)*VAL3
              EAVF(IL)=EAVF(IL)+F(LOR)*(VAL2) + VAL3
              EAVF(IL)=EAVF(IL)+F(IOR)*(VAL1)
              DO 3260 J2=1,NORBS
                IJ2=IOFF(MAX(IOR,J2))+MIN(IOR,J2)
                JL2=IOFF(MAX(LOR,J2))+MIN(LOR,J2)
                ZETA(IL,J2)=ZETA(IL,J2)+(ALPHA(IJ2)+BETA(IJ2))*VAL1
     1          +(ALPHA(JL2)+BETA(JL2))*VAL2+F(J2)*VAL3
 3260         CONTINUE
              GOTO 302
 62           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              ETA(II)=ETA(II)+ALPHA(IL)*VAL2+BETA(IL)*VAL1
              EAVF(II)=EAVF(II)+F(KOR)*(A2*VAL2-VAL1)
              ETA(LL)=ETA(LL)+ALPHA(IL)*VAL2+BETA(IL)*VAL1
              EAVF(LL)=EAVF(LL)+F(IOR)*(A2*VAL2-VAL1)
              ESCF=ESCF+ALPHA(IL)*VAL2*2+BETA(IL)*VAL1*2
C     WRITE(*,*) ' I,L,A,B,V2,V1,ESCF '
C     WRITE(*,*) IOR,LOR,ALPHA(IL),BETA(IL),VAL2,VAL1,ESCF
              DO 3270 J2=1,NORBS
                JL2=IOFF(MAX(J2,LOR))+MIN(J2,LOR)
                ZETA(II,J2)=ZETA(II,J2)+ALPHA(JL2)*VAL2+BETA(JL2)*
     *          VAL1
 3270         CONTINUE
              DO 3280 J2=1,NORBS
                IJ2=IOFF(MAX(IOR,J2))+MIN(IOR,J2)
                ZETA(LL,J2)=ZETA(LL,J2)+ALPHA(IJ2)*VAL2+BETA(IJ2)*
     *          VAL1
 3280         CONTINUE
              GOTO 302
 72           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              ESCF=ESCF+(ALPHA(II)+BETA(II))*VAL1+2*F(IOR)*VAL2
C     WRITE(*,*) ' I,A,B,V1,ESCF,F,V2 '
C     WRITE(*,*) IOR,ALPHA(II),BETA(II),VAL1,ESCF,F(IOR),VAL2
              ETA(II)=ETA(II)+ALPHA(II)*VAL1+BETA(II)*VAL1+F(IOR)*
     *        VAL2
              EAVF(II)=EAVF(II)+F(IOR)*(A2*VAL1-VAL1) + VAL2
              DO 3290 J2=1,NORBS
                IJ2=IOFF(MAX(IOR,J2))+MIN(IOR,J2)
                ZETA(II,J2)=ZETA(II,J2)+ALPHA(IJ2)*VAL1+BETA(IJ2)*
     *          VAL1+F(J2)*VAL2
 3290         CONTINUE
 302          CONTINUE
 3220       CONTINUE
 3170     CONTINUE
 3120   CONTINUE
C  SKIP OVER THE  OCC,UOC / UOC,UOC  TERMS
        DO 3300 JOR=NUOC,1,-1
          IF (IGRP .NE. IJGRP(IOFF(IOR)+JOR)) THEN
CIBM        CALL RGETSA(IT52,IX)
CIBM        WRITE(NOUT,2001) IX
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IOFF(IOR)+JOR)
          END IF
 3300   CONTINUE
 3110 CONTINUE
C  GET THE TWO ELECTRON CONTRIBUTIONS TO ETA AND ZETA FROM THE EXTERNAL
      DO 3310 IOR=NUOC,1,-1
        IO=IOFF(IOR)
        II=IO+IOR
        ISM=ORBSYM(IOR)
        ITYP=1
        DO 3320 JOR=IOR,1,-1
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IF (IGRP .NE. IJGRP(IOFF(IOR)+JOR)) THEN
CIBM        CALL RGETSA(IT52,IX)
CIBM        WRITE(NOUT,2001) IX
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IOFF(IOR)+JOR)
          END IF
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IJ)
          DO 3330 KOR=1,JOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
            DO 3340 LOR=1,KOR
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        9
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO  9
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005) LAD
                CALL ABORTS
              END IF
              GOTO (9,9,9,9,5,9,7)IJKLT
C  ONLY 2 E TERMS, I.E., H(IJ), CONTRIBUTE
 5            VAL3=INTS(LAD+3)
              ETA(IL)=ETA(IL)+F(IOR)*VAL3
              EAVF(IL)=EAVF(IL) + VAL3
              DO 3350 J2=1,NORBS
                ZETA(IL,J2)=ZETA(IL,J2)+F(J2)*VAL3
 3350         CONTINUE
              GOTO 9
 7            VAL2=INTS(LAD+2)
              ETA(II)=ETA(II)+F(IOR)*VAL2
              EAVF(II)=EAVF(II) + VAL2
              DO 3360 J2=1,NORBS
                ZETA(II,J2)=ZETA(II,J2)+F(J2)*VAL2
 3360         CONTINUE
 9            CONTINUE
 3340       CONTINUE
 3330     CONTINUE
 3320   CONTINUE
 3310 CONTINUE
      WRITE(NOUT,2002) ESCF,REPNUC,ESCF+REPNUC
CTJL  WRITE(*,2003)
 2002 FORMAT(/'  ELECTRONIC ENERGY:',F16.10
     1       /'     NUCLEAR ENERGY:',F16.10
     2       /'   TOTAL SCF ENERGY:',F16.10)
 2003 FORMAT(/'  ETA AND ZETA ARE COMPLETE')
      IF (IAND(IPRINT,128) .NE. 0) THEN
        WRITE(NOUT,1904)
 1904   FORMAT(/'  ETA MATRIX:')
        CALL PRINT(ETA,NUMIJ,NORBS,NOUT)
        WRITE(NOUT,*) ' EAVF MATRIX '
        CALL PRINT(EAVF,NUMIJ,NORBS,NOUT)
CTJL  IF (IAND(IPRINT,128) .NE. 0) THEN
        DO 3370 IORB=1,NORBS
          WRITE(NOUT,1905) IORB
 1905     FORMAT(/'  THE ZETA MATRIX FOR IORB=',I5)
          CALL PRINT(ZETA(1,IORB),NUMIJ,NORBS,NOUT)
 3370   CONTINUE
      END IF
C
C  CONSTRUCT A AND B0 MATRICIES; B0 IS IN RIGHT SIDE OF A MATRIX
C
 1100 FORMAT(/'  IN THE CONSRTUCTION OF THE A MATRIX, THE CASE ',A7
     1/'  IS NOT POSSIBLE IN THE ',A11,' SET OF LOOPS.'/'  ERROR IN LOOP
     * STRUCTURE SOMEWHERE.')
      CALL SREW(IT52)
      IF(.NOT.CCSD)CALL SREAD(IT52,N112,112)
      INTSRT = 0
      CALL RGETSA(IT52,INTSRT)
      WRITE(ICHK,*) ' IN GETINT AND INTSRT = ',INTSRT
CIBM
CIBM  CALL RSETSA(IT52,INTSRT)
      IGRP=0
C
C     COMMENT OUT THESE LINES FOR CPHFL
C
CGES  DO 3380 I=1,IJIND2
CGES    DO 3390 J=1,IJIND3
C         A(I,J)=A0
C3390   CONTINUE
C3380 CONTINUE
C
      RETURN
      END
C**********************************************************************
C*   NOTICE OF PROGRAM MODIFICATION                                   *
C**********************************************************************
C*  BY:  RICHARD REMINGTON                         search:  c5-22-88  *
C*  DATE:  MAY   22,   1988                                           *
C*  REASON: DECREASE CORE TO RUN IN 7MB ON 9370                       *
C**********************************************************************
C     PROGRAM LAST UPDATED OCTOBER 6, 1987                            *
C     BY: GES                                                         *
C     REASON: INCLUDE OPEN-SHELL AND TCSCF.                           *
C**********************************************************************
C     PROGRAM LAST UPDATED JULY  7, 1987                              *
C     BY: GES                                                         *
C     REASON: VERSION FOR CPHFL  (LOOK FOR CGES)                      *
C**********************************************************************
C     PROGRAM LAST UPDATED APRIL 8, 1986                              *
C     BY: TJL                                                         *
C     REASON: FIX BUG IN D-D-D-D CASE 5.                              *
C     PROGRAM LAST UPDATED JULY 18, 1985                              *
C     BY: TJL                                                         *
C**********************************************************************
C
      SUBROUTINE GTINT2(A,ETA,ZETA,F,ALPHA,BETA,IJORD,KADD,LADD,
     1IJADD,IJGRP,ORBSYM,INTS,S,EPA,JT1C,IOFF,EX,RS,LG,IJDEP,BOX,
     2EAVF,LSTEPA,EX2,aa,eps,doff,dadd,idim,idima)
      IMPLICIT INTEGER (A-Z)
      LOGICAL IJEQ,IJKEQ,JKEQ,IKEQ,JLEQ,JKLEQ,ILEQ
      INTEGER XDF,N112(112),JULIA(70),IJDEP(NUMIJ)
      integer doff(idim),dadd(idim)
      REAL*8 A0,A1,A2,A1S2,A4,FOCC,EFAC,BOX(NDF),XFAC,SFAC,A3S2
      REAL*8 EAVF(NUMIJ),LSTEPA(NUMIJ),EX2(IJIND)
      real*8 eps(idim)
      DIMENSION IJORD(NUMIJ),KADD(SYMORB),LADD(SYMORB),JT1C(1)
      DIMENSION ORBSYM(NORBS),IJADD(NUMIJ),IJGRP(NUMIJ)
      DIMENSION IOFF(NUMIJ)
      REAL*8 A(IJIND,NDF),F(NORBS),INTS(NMAX),LG(NORBS,NORBS)
     1,S(NUMIJ,NDF),EPA(NORBS,NORBS),EX(IJIND),RS(NUMDEP,NDF)
      REAL*8 ZETA(NUMIJ,NORBS),ALPHA(NUMIJ),BETA(NUMIJ)
      REAL*8 C1A,C2A,C1,C2
      real*8 aa(ijind,ijind3)
      REAL*8 VAL1,VAL2,VAL3,ETA(NUMIJ),ESCF,REPNUC
      COMMON /CIA/ C1A(45),C2A(45),C1,C2,ESCF
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ SYMORB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /POINT/ FOCC(5),IPOINT(5),JPOINT(5),NSORB(5)
      COMMON /FUNCS/ IOCC,JOCC,KOCC,NTYPES,NBSET,NAT
      COMMON /OCCS/ NSPE,NSA,NSB,NALP,NOP,NDOC,LFERM,NUOC,IJIND,IJIND3
      COMMON/OCCS2/NUMCOR,NCOR,FDOC,CORDOC,NUMVIR,FVIR,LUOC,NUMDEP,VUOC
      COMMON /LOC22/ IA22(100),IBF2AT(284)
      COMMON /IEXT/ IPRINT,IGRP,ICIDIP
      COMMON /REN/ REPNUC
C
 1100 FORMAT(/'  IN THE CONSTRUCTION OF THE A MATRIX, THE CASE ',A7
     * /'  IS NOT POSSIBLE IN THE ',A11,'  SET OF LOOPS.'/'  ERROR
     * IN LOOP STRUCTURE SOMEWHERE.')
   2  FORMAT(/'  IN GTINT2, IJKLT UNKNOWN TYPE ',I5/'  ORBITALS: ',4I5
     * /'  BASIS FUNCTIONS: ',4I5/,'  SYMMETRIES: ',4I5)
 2005 FORMAT(/'  IN GTINT2, LAD TOO BIG: ',I6)
C
      IJIND2 = IJIND
      ITEST = 0
      A0 = 0.0D+00
      A1 = 1.0D+00
      A2 = 2.0D+00
      A4 = 4.0D+00
      A1S2 = 0.50D+00
      A3S2 = 1.5D+00
CTJL
c     WRITE(6,*) ' THE RS MATRIX '
c     CALL MATOUT(RS,NUMDEP,NDF,NUMDEP,NDF,NOUT)
C     WRITE(*,*) ' IN GTINT2 ; NOP,NBF ',NOP,NBF
C     WRITE(*,*) ' THE AVERAGED FOCK MATRIX '
C     CALL PRINT(EAVF,NUMIJ,NBF,NOUT)
CTJL
C
C THIS IS THE BEGINNING OF THE THIRD PART OF GETINT TJL 7/09/84
C
COUT  WRITE(*,*)'IN SUBROUTINE GTINT2,  NALP=',NALP
      IF (NALP.EQ.0) GOTO 540
C
      DO 4070 IOR=NALP,NOP,-1
        IO=IOFF(IOR)
        II=IO+IOR
        ISM=ORBSYM(IOR)
        ITYP=1
        DO 4080 JOR=IOR,NOP,-1
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IJND=IJORD(IJ)
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IJ)
C
          IF (IGRP.NE.IJGRP(IJ)) THEN
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IJ)
          END IF
C
          DO 4090 KOR=1,NUOC
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            IKSYM=IEOR((ISM-1),(KSM-1))
            JKSYM=IEOR((JSM-1),(KSM-1))
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
C
C  ALP-ALP-UOC-UOC
C
            DO 4100 LOR=1,KOR
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO  406
              LSM=ORBSYM(LOR)
              ILSYM=IEOR((ISM-1),(LSM-1))
              JLSYM=IEOR((JSM-1),(LSM-1))
              IF ((LSM-1) .NE. IJKSYM) GOTO 406
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
              JULIA(IJKLT)=JULIA(IJKLT)+1
CTJL
         KLVU = IJDEP(KL)
CTJL
              GOTO (116,126,136,146,156,166,176)IJKLT
 116          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
      IF(IKSYM.EQ.0.AND.JLSYM.EQ.0)
     .CALL GA1(IK  ,JL  ,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      IF(ILSYM.EQ.0.AND.JKSYM.EQ.0)
     .CALL GA1(IL  ,JK  ,IK,KL,IJ,JL,VAL3,VAL2,VAL1,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(JKND,IJ,IK,JL,KL,VAL3,VAL2,VAL1,IL,a,eps,zeta,
     #alpha,beta,s)
C
      IF(KLVU.NE.0) CALL RS1(KLVU,A1,VAL2,VAL1,VAL3,IJ,rs,s)
C
 4110      CONTINUE
           GO TO 406
 126          CONTINUE
              WRITE(NOUT,1100) 'J=K    ','THIRTEENTH '
              CALL MABORT
 136          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      IF(IKSYM.EQ.0.AND.ILSYM.EQ.0)
     .CALL GA3(IK  ,IL  ,IL,KL,II,IK,VAL1,VAL2,IOR,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB3(IKND,IL,KL,II,IK,VAL1,VAL2,IOR,a,eps,zeta,
     #alpha,beta,s)
      CALL GB3(ILND,IK,KL,II,IL,VAL1,VAL2,IOR,a,eps,zeta,
     #alpha,beta,s)
C
      IF(KLVU.NE.0) CALL RS1(KLVU,A1S2,VAL2,VAL1,VAL1,IJ,rs,s)
C
 4120      CONTINUE
              GOTO 406
 146          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      IF(IKSYM.EQ.0.AND.JKSYM.EQ.0)
     .CALL GA4(IK  ,JK  ,IK,KK,IJ,JK,VAL1,VAL2,KOR,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB4(IKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,a,eps,zeta,
     #alpha,beta,s)
      CALL GB4(JKND,JK,KK,IJ,IK,VAL1,VAL2,KOR,a,eps,zeta,
     #alpha,beta,s)
              GOTO 406
 156          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','THIRTEENTH '
              CALL MABORT
 166          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      IF(IKSYM.EQ.0)
     .CALL GA6(IK  ,IK,KK,II,VAL1,VAL2,IOR,KOR,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB6(IKND,II,KK,VAL1,VAL2,IK,IOR,KOR,a,eps,zeta,
     #alpha,beta,s)
              GOTO 406
 176          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','THIRTEENTH '
              CALL MABORT
 406          CONTINUE
 4100       CONTINUE
 4090     CONTINUE
          DO 4150 KOR=LFERM,NDOC
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            IKSYM=IEOR((ISM-1),(KSM-1))
            JKSYM=IEOR((JSM-1),(KSM-1))
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
C
C  ALP-ALP-DOC-UOC
C
            DO 4160 LOR=1,NUOC
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 407
              LSM=ORBSYM(LOR)
              ILSYM=IEOR((ISM-1),(LSM-1))
              JLSYM=IEOR((JSM-1),(LSM-1))
              IF ((LSM-1) .NE. IJKSYM) GOTO 407
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
              JULIA(IJKLT+7)=JULIA(IJKLT+7)+1
              GOTO (117,127,137,147,157,167,177)IJKLT
 117          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
      IF(IKSYM.EQ.0.AND.JLSYM.EQ.0)
     .CALL GA1(IK  ,JL  ,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      IF(ILSYM.EQ.0.AND.JKSYM.EQ.0)
     .CALL GA1(IL  ,JK  ,IK,KL,IJ,JL,VAL3,VAL2,VAL1,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(KLND,IK,IL,JK,JL,VAL2,VAL1,VAL3,IJ,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(JKND,IJ,IK,JL,KL,VAL3,VAL2,VAL1,IL,a,eps,zeta,
     #alpha,beta,s)
              GOTO 407
 127          CONTINUE
              WRITE(NOUT,1100) 'J=K    ','FOURTEENTH '
              CALL MABORT
 137          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      IF(IKSYM.EQ.0.AND.ILSYM.EQ.0)
     .CALL GA3(IK  ,IL  ,IL,KL,II,IK,VAL1,VAL2,IOR,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GBD(KLND,IK,IL,VAL2,VAL1,II,a,eps,zeta,
     #alpha,beta,s)
      CALL GB3(IKND,IL,KL,II,IK,VAL1,VAL2,IOR,a,eps,zeta,
     #alpha,beta,s)
      CALL GB3(ILND,IK,KL,II,IL,VAL1,VAL2,IOR,a,eps,zeta,
     #alpha,beta,s)
              GOTO 407
 147          CONTINUE
              WRITE(NOUT,1100) 'K=L    ','FOURTEENTH '
              CALL MABORT
 157          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','FOURTEENTH '
              CALL MABORT
 167          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','FOURTEENTH '
              CALL MABORT
 177          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','FOURTEENTH '
              CALL MABORT
 407          CONTINUE
 4160       CONTINUE
C
C ALP-ALP-DOC-DOC
C
            DO 4190 LOR=LFERM,KOR
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 408
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 408
              ILSYM=IEOR((ISM-1),(LSM-1))
              JLSYM=IEOR((JSM-1),(LSM-1))
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
              JULIA(IJKLT+14)=JULIA(IJKLT+14)+1
CTJL
            KLDC = IJDEP(KL)
CTJL
              GOTO (118,128,138,148,158,168,178)IJKLT
 118          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
      IF(IKSYM.EQ.0.AND.JLSYM.EQ.0)
     .CALL GA1(IK  ,JL  ,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      IF(ILSYM.EQ.0.AND.JKSYM.EQ.0)
     .CALL GA1(IL  ,JK  ,IK,KL,IJ,JL,VAL3,VAL2,VAL1,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(JKND,IJ,IK,JL,KL,VAL3,VAL2,VAL1,IL,a,eps,zeta,
     #alpha,beta,s)
C
      IF(KLDC.NE.0) CALL RS1(KLDC,A1,VAL2,VAL1,VAL3,IJ,rs,s)
C
 4200      CONTINUE
              GOTO 408
 128          CONTINUE
              WRITE(NOUT,1100) 'J=K    ','FIFTEENTH  '
              CALL MABORT
 138          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      IF(IKSYM.EQ.0.AND.ILSYM.EQ.0)
     .CALL GA3(IK  ,IL  ,IL,KL,II,IK,VAL1,VAL2,IOR,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB3(IKND,IL,KL,II,IK,VAL1,VAL2,IOR,a,eps,zeta,
     #alpha,beta,s)
      CALL GB3(ILND,IK,KL,II,IL,VAL1,VAL2,IOR,a,eps,zeta,
     #alpha,beta,s)
C
      IF(KLDC.NE.0) CALL RS1(KLDC,A1S2,VAL2,VAL1,VAL1,IJ,rs,s)
C
 4210      CONTINUE
              GOTO 408
 148          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      IF(IKSYM.EQ.0.AND.JKSYM.EQ.0)
     .CALL GA4(IK  ,JK  ,IK,KK,IJ,JK,VAL1,VAL2,KOR,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB4(IKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,a,eps,zeta,
     #alpha,beta,s)
      CALL GB4(JKND,JK,KK,IJ,IK,VAL1,VAL2,KOR,a,eps,zeta,
     #alpha,beta,s)
              GOTO 408
 158          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','FIFTEENTH '
              CALL MABORT
 168          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      IF(IKSYM.EQ.0)
     .CALL GA6(IK  ,IK,KK,II,VAL1,VAL2,IOR,KOR,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB6(IKND,II,KK,VAL1,VAL2,IK,IOR,KOR,a,eps,zeta,
     #alpha,beta,s)
              GOTO 408
 178          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','FIFTEENTH '
              CALL MABORT
 408          CONTINUE
 4190       CONTINUE
 4150     CONTINUE
          DO 4240 KOR=NOP,JOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
C
C  ALP-ALP-ALP-UOC/DOC
C
            DO 4250 LOR=1,NDOC
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 607
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 607
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
              JULIA(IJKLT+21)=JULIA(IJKLT+21)+1
              GOTO (717,727,737,747,757,767,777)IJKLT
 717          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
      CALL GB1(KLND,IK,IL,JK,JL,VAL2,VAL1,VAL3,IJ,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,a,eps,zeta,
     #alpha,beta,s)
              GOTO 607
 727          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
      CALL GBD(ILND,IJ,JL,VAL2,VAL1,JJ,a,eps,zeta,
     #alpha,beta,s)
      CALL GB21(JLND,JJ,JL,IJ,IL,VAL1,VAL2,JOR,a,eps,zeta,
     #alpha,beta,s)
              GOTO 607
 737          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
      CALL GBD(KLND,IK,IL,VAL2,VAL1,II,a,eps,zeta,
     #alpha,beta,s)
      CALL GB3(ILND,IK,KL,II,IL,VAL1,VAL2,IOR,a,eps,zeta,
     #alpha,beta,s)
              GOTO 607
 747          CONTINUE
              WRITE(NOUT,1100) 'K=L    ','FIFTEENTH+1'
              CALL MABORT
 757          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
      CALL GBD(ILND,II,IL,VAL1,VAL1,II,a,eps,zeta,
     #alpha,beta,s)
      IF(LOR.GT.NUOC) CALL GBD(ILND,IL,LL,VAL2,VAL2,LL,a,eps,zeta,
     #alpha,beta,s)
CTJL  IF(LOR.GT.NUOC) CALL GBD(ILND,II,IL,VAL2,VAL2,LL,a,eps,zeta,
cets #alpha,beta,s)
              GOTO 607
 767          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','FIFTEENTH+1'
              CALL MABORT
 777          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','FIFTEENTH+1'
              CALL MABORT
 607          CONTINUE
 4250       CONTINUE
 4240     CONTINUE
 4080   CONTINUE
C
        DO 4300 JOR=NDOC,LFERM,-1
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IJND=IJORD(IJ)
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IJ)
C
          IF (IGRP.NE.IJGRP(IJ)) THEN
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IJ)
          END IF
C
          DO 4310 KOR=1,NUOC
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            IKSYM=IEOR((ISM-1),(KSM-1))
            JKSYM=IEOR((JSM-1),(KSM-1))
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
C
C  ALP-DOC-UOC-UOC
C
            DO 4320 LOR=1,KOR
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 409
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 409
              ILSYM=IEOR((ISM-1),(LSM-1))
              JLSYM=IEOR((JSM-1),(LSM-1))
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
              JULIA(IJKLT+28)=JULIA(IJKLT+28)+1
CTJL
         KLVU = IJDEP(KL)
CTJL
              GOTO (119,129,139,149,159,169,179)IJKLT
 119          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
CTJL
      IF(KLVU.NE.0) CALL EX1(IJND,LL,KK,LOR,KOR,VAL2,VAL1,VAL3,
     #ex,eavf,lg)
C
      IF(IKSYM.EQ.0.AND.JLSYM.EQ.0)
     .CALL GA1(IK  ,JL  ,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      IF(ILSYM.EQ.0.AND.JKSYM.EQ.0)
     .CALL GA1(IL  ,JK  ,IK,KL,IJ,JL,VAL3,VAL2,VAL1,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(JKND,IJ,IK,JL,KL,VAL3,VAL2,VAL1,IL,a,eps,zeta,
     #alpha,beta,s)
C
      IF(KLVU.NE.0) CALL RS1(KLVU,A3S2,VAL2,VAL1,VAL3,IJ,rs,s)
C
 4330     CONTINUE
              GOTO 409
 129          CONTINUE
              WRITE(NOUT,1100) 'J=K    ','SIXTEENTH  '
              CALL MABORT
 139          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','SIXTEENTH  '
              CALL MABORT
 149          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      IF(IKSYM.EQ.0.AND.JKSYM.EQ.0)
     .CALL GA4(IK  ,JK  ,IK,KK,IJ,JK,VAL1,VAL2,KOR,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB4(IKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,a,eps,zeta,
     #alpha,beta,s)
      CALL GB4(JKND,JK,KK,IJ,IK,VAL1,VAL2,KOR,a,eps,zeta,
     #alpha,beta,s)
              GOTO 409
 159          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','SIXTEENTH  '
              CALL MABORT
 169          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','SIXTEENTH  '
              CALL MABORT
 179          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','SIXTEENTH  '
              CALL MABORT
 409          CONTINUE
 4320       CONTINUE
 4310     CONTINUE
          DO 4350 KOR=LFERM,JOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            IKSYM=IEOR((ISM-1),(KSM-1))
            JKSYM=IEOR((JSM-1),(KSM-1))
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
CTJL
          JKDC = IJDEP(JK)
CTJL
C
C  ALP-DOC-DOC-UOC
C
            DO 4360 LOR=1,NUOC
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 410
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 410
              ILSYM=IEOR((ISM-1),(LSM-1))
              JLSYM=IEOR((JSM-1),(LSM-1))
              KLSYM=IEOR((KSM-1),(LSM-1))
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
              JULIA(IJKLT+35)=JULIA(IJKLT+35)+1
              GOTO (211,221,231,241,251,261,271)IJKLT
 211          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
      IF(JKDC.NE.0) CALL EX1(ILND,KK,JJ,KOR,JOR,VAL3,VAL1,VAL2,
     #ex,eavf,lg)
C
      IF(IJSYM.EQ.0.AND.KLSYM.EQ.0)
     .CALL GA1(IJ  ,KL  ,IL,JL,IK,JK,VAL2,VAL1,VAL3,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      IF(IKSYM.EQ.0.AND.JLSYM.EQ.0)
     .CALL GA1(IK  ,JL  ,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(IJND,IL,JL,IK,JK,VAL2,VAL1,VAL3,KL,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(KLND,IK,IL,JK,JL,VAL2,VAL1,VAL3,IJ,a,eps,zeta,
     #alpha,beta,s)
C
      IF(JKDC.NE.0) CALL RS1(JKDC,A1S2,VAL3,VAL1,VAL2,IL,rs,s)
C
 4370      CONTINUE
              GOTO 410
 221          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      IF(IJSYM.EQ.0.AND.JLSYM.EQ.0)
     .CALL GA2(IJ  ,JL  ,IL,JL,IJ,JJ,VAL1,VAL2,JOR,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GBD(ILND,IJ,JL,VAL2,VAL1,JJ,a,eps,zeta,
     #alpha,beta,s)
      CALL GB22(IJND,IL,JL,IJ,JJ,VAL1,VAL2,JOR,a,eps,zeta,
     #alpha,beta,s)
      CALL GB21(JLND,JJ,JL,IJ,IL,VAL1,VAL2,JOR,a,eps,zeta,
     #alpha,beta,s)
              GOTO 410
 231          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','SEVENTEENTH'
              CALL MABORT
 241          CONTINUE
              WRITE(NOUT,1100) 'K=L    ','SEVENTEENTH'
              CALL MABORT
 251          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','SEVENTEENTH'
              CALL MABORT
 261          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','SEVENTEENTH'
              CALL MABORT
 271          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','SEVENTEENTH'
              CALL MABORT
 410          CONTINUE
 4360       CONTINUE
C
C ALP-DOC-DOC-DOC
C
            DO 4390 LOR=LFERM,KOR
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 710
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 710
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
              JULIA(IJKLT+42)=JULIA(IJKLT+42)+1
CTJL
            JLDC = IJDEP(JL)
            KLDC = IJDEP(KL)
CTJL
              GOTO (711,721,731,741,751,761,771)IJKLT
 711          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
      CALL GB1(IJND,IL,JL,IK,JK,VAL2,VAL1,VAL3,KL,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,a,eps,zeta,
     #alpha,beta,s)
CTJL
      IF(JKDC.NE.0) CALL EX1(ILND,KK,JJ,KOR,JOR,VAL3,VAL1,VAL2,
     #ex,eavf,lg)
      IF(JLDC.NE.0) CALL EX1(IKND,LL,JJ,LOR,JOR,VAL1,VAL3,VAL2,
     #ex,eavf,lg)
      IF(KLDC.NE.0) CALL EX1(IJND,LL,KK,LOR,KOR,VAL2,VAL1,VAL3,
     #ex,eavf,lg)
C
      IF(JKDC.NE.0) CALL RS1(JKDC,A3S2,VAL3,VAL1,VAL2,IL,rs,s)
      IF(JLDC.NE.0) CALL RS1(JLDC,A3S2,VAL1,VAL3,VAL2,IK,rs,s)
      IF(KLDC.NE.0) CALL RS1(KLDC,A3S2,VAL2,VAL1,VAL3,IJ,rs,s)
C
 4400      CONTINUE
              GOTO 710
 721          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
      CALL GBD(ILND,IJ,JL,VAL2,VAL1,JJ,a,eps,zeta,
     #alpha,beta,s)
      CALL GB22(IJND,IL,JL,IJ,JJ,VAL1,VAL2,JOR,a,eps,zeta,
     #alpha,beta,s)
CTJL
      IF(JLDC.NE.0) CALL EX1(IKND,LL,JJ,LOR,JOR,VAL1,VAL1,VAL2,
     #ex,eavf,lg)
C
      IF(JLDC.NE.0) CALL RS1(JLDC,A3S2,VAL1,VAL1,VAL2,IK,rs,s)
 4410      CONTINUE
              GOTO 710
 731          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','SEVENTNTH+1'
              CALL MABORT
 741          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
      CALL GBD(IJND,IK,JK,VAL2,VAL1,KK,a,eps,zeta,
     #alpha,beta,s)
      CALL GB4(IKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,a,eps,zeta,
     #alpha,beta,s)
C
      IF(JLDC.NE.0) CALL EX1(IKND,LL,JJ,LOR,JOR,VAL1,VAL1,VAL2,
     #ex,eavf,lg)
C
      IF(JLDC.NE.0) CALL RS1(JLDC,A3S2,VAL1,VAL1,VAL2,IK,rs,s)
C
 4420      CONTINUE
              GOTO 710
 751          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','SEVENTNTH+1'
              CALL MABORT
 761          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','SEVENTNTH+1'
              CALL MABORT
 771          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','SEVENTNTH+1'
              CALL MABORT
 710          CONTINUE
 4390       CONTINUE
 4350     CONTINUE
 4300   CONTINUE
        DO 4430 JOR=NUOC,1,-1
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IJND=IJORD(IJ)
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IJ)
C
          IF (IGRP.NE.IJGRP(IJ)) THEN
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IJ)
          END IF
C
       ISKIP3 = 0
       IF(ISKIP3.EQ.1) GOTO 8400
          DO 8410 KOR=1,JOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
CTJL
            JKVU = IJDEP(JK)
CTJL
C
C     ALP-UOC-UOC-UOC
C
            DO 8420 LOR=1,KOR
          IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO  8430
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 8430
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
              JULIA(IJKLT+56)=JULIA(IJKLT+56)+1
CTJL
          JLVU = IJDEP(JL)
          KLVU = IJDEP(KL)
CTJL
              GOTO (8412,8422,8432,8442,8452,8462,8472)IJKLT
 8412         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
CTJL
      IF(JKVU.NE.0) CALL EX1(ILND,KK,JJ,KOR,JOR,VAL3,VAL1,VAL2,
     #ex,eavf,lg)
      IF(JLVU.NE.0) CALL EX1(IKND,LL,JJ,LOR,JOR,VAL1,VAL3,VAL2,
     #ex,eavf,lg)
      IF(KLVU.NE.0) CALL EX1(IJND,LL,KK,LOR,KOR,VAL2,VAL1,VAL3,
     #ex,eavf,lg)
C
      IF(JKVU.NE.0) CALL RS1(JKVU,A1S2,VAL3,VAL2,VAL1,IL,rs,s)
      IF(JLVU.NE.0) CALL RS1(JLVU,A1S2,VAL1,VAL2,VAL3,IK,rs,s)
      IF(KLVU.NE.0) CALL RS1(KLVU,A1S2,VAL2,VAL1,VAL3,IJ,rs,s)
C
              GOTO 8430
 8422         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
      IF(JLVU.NE.0) CALL EX1(IKND,LL,JJ,LOR,JOR,VAL1,VAL1,VAL2,
     #ex,eavf,lg)
C
      IF(JLVU.NE.0) CALL RS1(JLVU,A1S2,VAL1,VAL1,VAL2,IK,rs,s)
C
              GOTO 8430
 8432      WRITE(*,*) ' HIT I=J IN D-U-U-U ERROR IN LOOPS'
              GOTO 8430
 8442         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
      IF(JKVU.NE.0) CALL EX1(ILND,KK,JJ,KOR,JOR,VAL1,VAL1,VAL2,
     #ex,eavf,lg)
C
      IF(JKVU.NE.0) CALL RS1(JKVU,A1S2,VAL1,VAL1,VAL2,IL,rs,s)
C
              GOTO 8430
 8452      WRITE(*,*) ' HIT CASE 5 IN D-U-U-U ERROR IN LOOPS'
CTJL
CTJL THIS TERM , EITHER I=J=K OR J=K=L, DOES NOT CONTRIBUTE.
CTJL
              GOTO 8430
 8462      WRITE(*,*) ' HIT CASE 6 IN D-U-U-U ERROR IN LOOPS'
              GOTO 8430
 8472         CONTINUE
      WRITE(*,*) ' I=K=J=L ERROR IN LOOPS',IOR,JOR,KOR,LOR
CTJL          WRITE(NOUT,1100) 'I=J=K=L','NINTEENTH+1'
CTJL   I=J=J=L DOES NOT CONTRIBUTE
CTJL          CALL MABORT
 8430         CONTINUE
 8420       CONTINUE
 8410       CONTINUE
 8400       CONTINUE
CTJL
 4430   CONTINUE
 4070 CONTINUE
C
 540  CONTINUE
C
      DO 4440 IOR=NDOC,LFERM,-1
        IO=IOFF(IOR)
        II=IO+IOR
        ISM=ORBSYM(IOR)
        ITYP=1
        DO 4450 JOR=IOR,LFERM,-1
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IJND=IJORD(IJ)
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IJ)
C
          IF (IGRP.NE.IJGRP(IJ)) THEN
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IJ)
          END IF
C
CTJL
        IJDC = IJDEP(IJ)
CTJL
          DO 4460 KOR=1,NUOC
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            IKSYM=IEOR((ISM-1),(KSM-1))
            JKSYM=IEOR((JSM-1),(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
C
C  DOC-DOC-UOC-UOC
C
            DO 4470 LOR=1,KOR
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 411
              LSM=ORBSYM(LOR)
              ILSYM=IEOR((ISM-1),(LSM-1))
              JLSYM=IEOR((JSM-1),(LSM-1))
              IF ((LSM-1) .NE. IJKSYM) GOTO 411
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
              JULIA(IJKLT+49)=JULIA(IJKLT+49)+1
CTJL
             KLVU = IJDEP(KL)
CTJL
              GOTO (212,222,232,242,252,262,272)IJKLT
 212          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
CGES
C     CONSTRUCT A MATRIX ONLY IF BOTH PAIRS ARE TOTALLY SYMMETRIC
C
CGES  CALL GA1(IKND,JLND,IL,KL,IJ,JK,VAL1,VAL2,VAL3)
CGES  CALL GA1(ILND,JKND,IK,KL,IJ,JL,VAL3,VAL2,VAL1)
C
      IF(IKSYM.EQ.0.AND.JLSYM.EQ.0)
     .CALL GA1(IK  ,JL  ,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      IF(ILSYM.EQ.0.AND.JKSYM.EQ.0)
     .CALL GA1(IL  ,JK  ,IK,KL,IJ,JL,VAL3,VAL2,VAL1,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(JKND,IJ,IK,JL,KL,VAL3,VAL2,VAL1,IL,a,eps,zeta,
     #alpha,beta,s)
C
      IF(KLVU.NE.0) CALL RS1(KLVU,A2,VAL2,VAL1,VAL3,IJ,rs,s)
C
              GOTO 411
 222          CONTINUE
              WRITE(NOUT,1100) 'J=K    ','EIGHTEENTH '
              CALL MABORT
 232          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      IF(IKSYM.EQ.0.AND.ILSYM.EQ.0)
     .CALL GA3(IK  ,IL  ,IL,KL,II,IK,VAL1,VAL2,IOR,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB3(IKND,IL,KL,II,IK,VAL1,VAL2,IOR,a,eps,zeta,
     #alpha,beta,s)
      CALL GB3(ILND,IK,KL,II,IL,VAL1,VAL2,IOR,a,eps,zeta,
     #alpha,beta,s)
C
      IF(KLVU.NE.0) CALL RS1(KLVU,A1,VAL2,VAL1,VAL1,IJ,rs,s)
C
              GOTO 411
 242          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      IF(IKSYM.EQ.0.AND.JKSYM.EQ.0)
     .CALL GA4(IK  ,JK  ,IK,KK,IJ,JK,VAL1,VAL2,KOR,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB4(IKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,a,eps,zeta,
     #alpha,beta,s)
      CALL GB4(JKND,JK,KK,IJ,IK,VAL1,VAL2,KOR,a,eps,zeta,
     #alpha,beta,s)
              GOTO 411
 252          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','EIGHTEENTH '
              CALL MABORT
 262          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      IF(IKSYM.EQ.0)
     .CALL GA6(IK  ,IK,KK,II,VAL1,VAL2,IOR,KOR,
     #aa,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB6(IKND,II,KK,VAL1,VAL2,IK,IOR,KOR,a,eps,zeta,
     #alpha,beta,s)
              GOTO 411
 272          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','EIGHTEENTH '
              CALL MABORT
 411          CONTINUE
 4470       CONTINUE
 4460     CONTINUE
          DO 4520 KOR=LFERM,JOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
CTJL
            IKDC = IJDEP(IK)
            JKDC = IJDEP(JK)
CTJL
C
C  DOC-DOC-DOC-DOC
C
       ISKIP = 0
       IF(ISKIP.EQ.1) GOTO 9220
CTJL
            DO 9530 LOR=LFERM,KOR
            IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 9811
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 9811
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
              JULIA(IJKLT+56)=JULIA(IJKLT+56)+1
CTJL
          ILDC = IJDEP(IL)
          JLDC = IJDEP(JL)
          KLDC = IJDEP(KL)
CTJL
              GOTO (9712,9722,9732,9742,9752,9762,9772)IJKLT
 9712         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
CTJL
C
      IF(IJDC.NE.0) CALL RS1(IJDC,A2,VAL2,VAL1,VAL3,KL,rs,s)
      IF(IKDC.NE.0) CALL RS1(IKDC,A2,VAL1,VAL3,VAL2,JL,rs,s)
      IF(ILDC.NE.0) CALL RS1(ILDC,A2,VAL3,VAL1,VAL2,JK,rs,s)
      IF(JKDC.NE.0) CALL RS1(JKDC,A2,VAL3,VAL1,VAL2,IL,rs,s)
      IF(JLDC.NE.0) CALL RS1(JLDC,A2,VAL1,VAL3,VAL2,IK,rs,s)
      IF(KLDC.NE.0) CALL RS1(KLDC,A2,VAL2,VAL1,VAL3,IJ,rs,s)
C
              GOTO 9811
 9722         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
CTJL
C
      IF(IJDC.NE.0) CALL RS1(IJDC,A2,VAL1,VAL1,VAL2,KL,rs,s)
      IF(ILDC.NE.0) CALL RS1(ILDC,A1,VAL2,VAL1,VAL1,JK,rs,s)
      IF(JLDC.NE.0) CALL RS1(JLDC,A2,VAL1,VAL1,VAL2,IK,rs,s)
C
              GOTO 9811
 9732         VAL1 = INTS(LAD+1)
              VAL2 = INTS(LAD+2)
CTJL
C
      IF(IKDC.NE.0) CALL RS1(IKDC,A2,VAL1,VAL1,VAL2,JL,rs,s)
      IF(ILDC.NE.0) CALL RS1(ILDC,A2,VAL1,VAL1,VAL2,JK,rs,s)
      IF(KLDC.NE.0) CALL RS1(KLDC,A1,VAL2,VAL1,VAL1,IJ,rs,s)
C
              GOTO 9811
 9742         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
CTJL
C
      IF(IJDC.NE.0) CALL RS1(IJDC,A1,VAL2,VAL1,VAL1,KL,rs,s)
      IF(IKDC.NE.0) CALL RS1(IKDC,A2,VAL1,VAL1,VAL2,JL,rs,s)
      IF(JKDC.NE.0) CALL RS1(JKDC,A2,VAL1,VAL1,VAL2,IL,rs,s)
C
              GOTO 9811
 9752         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
CTJL
CTJL THIS TERM , EITHER I=J=K OR J=K=L, DOES NOT CONTRIBUTE.
CTJL
C
CTJL  IF(IJDC.NE.0) CALL RS1(IJDC,A1,VAL2,VAL2,VAL2,KL,rs,s)
      IF(ILDC.NE.0) CALL RS1(ILDC,A1,VAL2,VAL2,VAL2,LL,rs,s)
      IF(ILDC.NE.0) CALL RS1(ILDC,A1,VAL1,VAL1,VAL1,JK,rs,s)
C
              GOTO 9811
 9762         VAL1 = INTS(LAD+1)
              VAL2 = INTS(LAD+2)
CTJL
C
      IF(IKDC.NE.0) CALL RS1(IKDC,A2,VAL1,VAL1,VAL2,JL,rs,s)
C
              GOTO 9811
 9772         CONTINUE
CTJL          WRITE(NOUT,1100) 'I=J=K=L','NINTEENTH+1'
CTJL   I=J=J=L DOES NOT CONTRIBUTE
CTJL          CALL MABORT
 9811         CONTINUE
 9530       CONTINUE
 9220       CONTINUE
C
C  DOC-DOC-DOC-UOC
C
            DO 4530 LOR=1,NUOC
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 811
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 811
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
              JULIA(IJKLT+63)=JULIA(IJKLT+63)+1
              GOTO (712,722,732,742,752,762,772)IJKLT
 712          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
      IF(IJDC.NE.0) CALL EX1(KLND,JJ,II,JOR,IOR,VAL2,VAL1,VAL3,
     #ex,eavf,lg)
      IF(IKDC.NE.0) CALL EX1(JLND,KK,II,KOR,IOR,VAL1,VAL3,VAL2,
     #ex,eavf,lg)
      IF(JKDC.NE.0) CALL EX1(ILND,KK,JJ,KOR,JOR,VAL3,VAL1,VAL2,
     #ex,eavf,lg)
C
      IF(IJDC.NE.0) CALL RS1(IJDC,A1,VAL2,VAL1,VAL3,KL,rs,s)
      IF(IKDC.NE.0) CALL RS1(IKDC,A1,VAL1,VAL3,VAL2,JL,rs,s)
      IF(JKDC.NE.0) CALL RS1(JKDC,A1,VAL3,VAL1,VAL2,IL,rs,s)
C
      CALL GB1(KLND,IK,IL,JK,JL,VAL2,VAL1,VAL3,IJ,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,a,eps,zeta,
     #alpha,beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,a,eps,zeta,
     #alpha,beta,s)
              GOTO 811
 722          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      IF(IJDC.NE.0) CALL EX1(KLND,JJ,II,JOR,IOR,VAL1,VAL1,VAL2,
     #ex,eavf,lg)
C
      IF(IJDC.NE.0) CALL RS1(IJDC,A1,VAL1,VAL2,VAL1,KL,rs,s)
C
      CALL GBD(ILND,IJ,JL,VAL2,VAL1,JJ,a,eps,zeta,
     #alpha,beta,s)
      CALL GB21(JLND,JJ,JL,IJ,IL,VAL1,VAL2,JOR,a,eps,zeta,
     #alpha,beta,s)
              GOTO 811
 732          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      IF(IKDC.NE.0) CALL EX1(JLND,KK,II,KOR,IOR,VAL1,VAL1,VAL2,
     #ex,eavf,lg)
C
      IF(IKDC.NE.0) CALL RS1(IKDC,A1,VAL1,VAL1,VAL2,JL,rs,s)
C
      CALL GBD(KLND,IK,IL,VAL2,VAL1,II,a,eps,zeta,
     #alpha,beta,s)
      CALL GB3(ILND,IK,KL,II,IL,VAL1,VAL2,IOR,a,eps,zeta,
     #alpha,beta,s)
              GOTO 811
 742          CONTINUE
              WRITE(NOUT,1100) 'K=L    ','NINTEENTH  '
              CALL MABORT
 752          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
      CALL GBD(ILND,II,IL,VAL1,VAL1,II,a,eps,zeta,
     #alpha,beta,s)
              GOTO 811
 762          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','NINETEENTH '
              CALL MABORT
 772          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','NINETEENTH '
              CALL MABORT
 811          CONTINUE
 4530       CONTINUE
 4520     CONTINUE
 4450   CONTINUE
        DO 4580 JOR=NUOC,1,-1
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IJND=IJORD(IJ)
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IJ)
C
          IF (IGRP.NE.IJGRP(IJ)) THEN
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IJ)
          END IF
C
C     DOC-UOC-UOC-UOC
C
       ISKIP2 = 0
       IF(ISKIP2.EQ.1) GOTO 9400
          DO 9410 KOR=1,JOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
CTJL
            JKVU = IJDEP(JK)
CTJL
            DO 9420 LOR=1,KOR
          IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO  9430
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 9430
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
              JULIA(IJKLT+56)=JULIA(IJKLT+56)+1
          JLVU = IJDEP(JL)
          KLVU = IJDEP(KL)
CTJL
              GOTO (9412,9422,9432,9442,9452,9462,9472)IJKLT
 9412         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
CTJL
      IF(JKVU.NE.0) CALL EX1(ILND,KK,JJ,KOR,JOR,VAL3,VAL1,VAL2,
     #ex,eavf,lg)
      IF(JLVU.NE.0) CALL EX1(IKND,LL,JJ,LOR,JOR,VAL1,VAL3,VAL2,
     #ex,eavf,lg)
      IF(KLVU.NE.0) CALL EX1(IJND,LL,KK,LOR,KOR,VAL2,VAL1,VAL3,
     #ex,eavf,lg)
C
      IF(JKVU.NE.0) CALL RS1(JKVU,A1,VAL3,VAL1,VAL2,IL,rs,s)
      IF(JLVU.NE.0) CALL RS1(JLVU,A1,VAL1,VAL3,VAL2,IK,rs,s)
      IF(KLVU.NE.0) CALL RS1(KLVU,A1,VAL2,VAL1,VAL3,IJ,rs,s)
C
              GOTO 9430
 9422         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
      IF(JLVU.NE.0) CALL EX1(IKND,LL,JJ,LOR,JOR,VAL1,VAL1,VAL2,
     #ex,eavf,lg)
C
      IF(JLVU.NE.0) CALL RS1(JLVU,A1,VAL1,VAL2,VAL1,IK,rs,s)
C
              GOTO 9430
 9432      WRITE(*,*) ' HIT I=J IN D-U-U-U ERROR IN LOOPS'
              GOTO 9430
 9442         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
      IF(JKVU.NE.0) CALL EX1(ILND,KK,JJ,KOR,JOR,VAL1,VAL1,VAL2,
     #ex,eavf,lg)
C
      IF(JKVU.NE.0) CALL RS1(JKVU,A1,VAL1,VAL2,VAL1,IL,rs,s)
C
              GOTO 9430
 9452      WRITE(*,*) ' HIT CASE 5 IN D-U-U-U ERROR IN LOOPS'
CTJL
CTJL THIS TERM , EITHER I=J=K OR J=K=L, DOES NOT CONTRIBUTE.
CTJL
              GOTO 9430
 9462      WRITE(*,*) ' HIT CASE 6 IN D-U-U-U ERROR IN LOOPS'
CTJL
              GOTO 9430
 9472         CONTINUE
      WRITE(*,*) ' I=K=J=L ERROR IN LOOPS',IOR,JOR,KOR,LOR
CTJL          WRITE(NOUT,1100) 'I=J=K=L','NINTEENTH+1'
CTJL   I=J=J=L DOES NOT CONTRIBUTE
CTJL          CALL MABORT
 9430         CONTINUE
 9420       CONTINUE
 9410       CONTINUE
 9400       CONTINUE
CTJL
 4580   CONTINUE
 4440 CONTINUE
CC    JT4=104
CC    CALL SREW(JT4)
C     WRITE(*,*) ' THE A AND B MATRICES BEFORE ADDING EPA '
C     CALL MATOUT(A,IJIND2,IJIND3,IJIND2,IJIND3,NOUT)
      IEA=2*NDF+NBSET*NDF+1
      ISEA=JT1C(IEA)
      DO 4590 II=1,NDF
        CALL WREADW(IT94,EPA,INTOWP(NORBS*NORBS),ISEA,ISEA)
        IF (IAND(IPRINT,256) .NE. 0) THEN
          WRITE(NOUT,3014) II,ISEA
 3014     FORMAT(/'  EPA FOR DEGREE ',I5,'  AS READ FROM ADDRESS ',I8)
          CALL MATOUT(EPA,NORBS,NORBS,NORBS,NORBS,NOUT)
        END IF
        IJ=0
        DO 4600 I=1,NORBS
          DO 4610 J=1,I
            IJ=IJ+1
            INDEX=IJORD(IJ)
            IF(INDEX.NE.0)THEN
CGES     A(INDEX,II+IJIND2)=A(INDEX,II+IJIND2)-A2*(EPA(I,J)-EPA(J,I))
         A(INDEX,II       )=A(INDEX,II       )-A2*(EPA(I,J)-EPA(J,I))
            END IF
 4610     CONTINUE
 4600   CONTINUE
 4590 CONTINUE
CTJL
CTJLNEW
C       WRITE(*,*) ' THE AVERAGED FOCK OPERATOR FOCK MATRIX '
C       CALL PRINT(EAVF,NUMIJ,NORBS,NOUT)
        DO 9750 IDF = 1,NDF
        DO 9760 I = 1,NBF
         IO = IOFF(I)
         II = IO + I
         DO 9770 J = 1,I
         JO = IOFF(J)
          JJ = JO + J
          IJ = IO + J
          IJDC = IJDEP(IJ)
          IF(IJDC.EQ.0) GOTO 9770
C         DO 9780 M = 1,NUOC
C         MI = IO + M
C         MJ = JO + M
C         RS(IJDC,IDF) = RS(IJDC,IDF) + (S(MI,IDF)*EAVF(MJ) +
C    1  S(MJ,IDF)*EAVF(MI))
C         WRITE(*,*) ' IN VIRTUAL PART; I,J,M,MI,MJ,F1,F2 '
C         WRITE(*,*) I,J,M,MI,MJ,EAVF(MI),EAVF(MJ)
 9780     CONTINUE
          IF(NOP.EQ.0) GOTO 9771
          DO 9790 M = NOP,NBF
          MO = IOFF(M)
          MI = MO + I
          MJ = MO + J
          RS(IJDC,IDF) = RS(IJDC,IDF) + (S(MI,IDF)*EAVF(MJ) +
     1  S(MJ,IDF)*EAVF(MI))
 9790     CONTINUE
 9771     CONTINUE
          IF(NSPE.EQ.0) GOTO 9770
          DO 9791 M = NSA,NBF
          MO = IOFF(M)
          MI = MO + I
          MJ = MO + J
          RS(IJDC,IDF) = RS(IJDC,IDF) + (S(MI,IDF)*EAVF(MJ) +
     1  S(MJ,IDF)*EAVF(MI))
 9791     CONTINUE
 9770     CONTINUE
 9760     CONTINUE
 9750     CONTINUE
CTJLOLD
C     WRITE(*,*) ' BEFORE END ',IJIND
      ISEA = 1
      DO 5590 IDF=1,NDF
        CALL WREADW(IT96,LSTEPA,INTOWP(NUMIJ),ISEA,ISEA)
CTJL      WRITE(*,*) ' IT96,ISEA ',IT96,ISEA
CTJL    CALL PRINT(LSTEPA,NUMIJ,NORBS,NOUT)
        DO 9600 I = 1,NBF
         IO = IOFF(I)
         II = IO + I
         DO 9610 J = 1,I
         JO = IOFF(J)
          JJ = JO + J
          IJ = IO + J
          IJDC = IJDEP(IJ)
          IF(IJDC.EQ.0) GOTO 9610
          EFAC = A1/(EAVF(JJ)-EAVF(II))
          SFAC = (EAVF(II)+EAVF(JJ))*(-EFAC)
          XFAC = (LG(J,I)-LG(I,J))
          BOX(IDF)=BOX(IDF)+XFAC*((A2*LSTEPA(IJ)-RS(IJDC,IDF))*EFAC +
     1 SFAC*S(IJ,IDF))
CTJL      WRITE(*,*) ' IT96,ISEA ',IT96,ISEA
 9650     CONTINUE
 9610     CONTINUE
 9600     CONTINUE
 5590 CONTINUE
CTJL
CTJL
      CALL ZERO(EX2,IJIND)
      I = 0
      IF(I.EQ.1) RETURN
        DO 9660 I = 1,NBF
         IO = IOFF(I)
         II = IO + I
         DO 9670 J = 1,I
         JO = IOFF(J)
          JJ = JO + J
          IJ = IO + J
          IJDC = IJDEP(IJ)
          IF(IJDC.EQ.0) GOTO 9670
          EFAC = A1/(EAVF(JJ)-EAVF(II))
          XFAC = (LG(J,I)-LG(I,J))*EFAC
CTJL      WRITE(*,*) ' IN ALPHA PART; EFAC,XFAC ',EFAC,XFAC
C         DO 9680 M = 1,NUOC
C         MI = IO + M
C         MJ = JO + M
C         MJND = IJORD(MJ)
C         MIND = IJORD(MI)
C         EX2(MJND) = EX2(MJND) - XFAC*EAVF(MI)
C         EX2(MIND) = EX2(MIND) - XFAC*EAVF(MJ)
CTJL      WRITE(*,*) ' IN VIRTUAL PART; M,EX2 ',M,EX2(MJND),EX2(MIND)
C9680     CONTINUE
CTJL      WRITE(*,*) ' IN EX2 PART ; NOP,NBF ',NOP,NBF
          IF(NOP.EQ.0) GOTO 9671
          DO 9690 M = NOP,NBF
          MO = IOFF(M)
          MI = MO + I
          MJ = MO + J
          MJND = IJORD(MJ)
          MIND = IJORD(MI)
          EX2(MJND) = EX2(MJND) + XFAC*EAVF(MI)
          EX2(MIND) = EX2(MIND) + XFAC*EAVF(MJ)
CTJL      WRITE(*,*) ' IN ALPHA PART; M,EX2 ',M,EX2(MJND),EX2(MIND)
 9690     CONTINUE
 9671     CONTINUE
          IF(NSPE.EQ.0) GOTO 9670
          DO 9691 M = NSA,NBF
          MO = IOFF(M)
          MI = MO + I
          MJ = MO + J
          MJND = IJORD(MJ)
          MIND = IJORD(MI)
          EX2(MJND) = EX2(MJND) + XFAC*EAVF(MI)
          EX2(MIND) = EX2(MIND) + XFAC*EAVF(MJ)
CTJL      WRITE(*,*) ' IN ALPHA PART; M,EX2 ',M,EX2(MJND),EX2(MIND)
 9691     CONTINUE
 9670     CONTINUE
 9660     CONTINUE
C     WRITE(*,*) ' THE A AND B MATRICES AS CONSTRUCTED IN GETINT '
C     CALL MATOUT(A,IJIND2,IJIND3,IJIND2,IJIND3,NOUT)
CTJL  CALL MATOUT(B0,IJIND,NDF,IJIND,NDF,NOUT)
      RETURN
CTJL
 9902 CONTINUE
      WRITE(NOUT,2005)LAD
      CALL MABORT
 9903 CONTINUE
      WRITE(NOUT,2)IJKLT,IOR,JOR,KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
      CALL MABORT
CTJL
      END
C    LIBRARY 3 OF GRCPHF
C**********************************************************************
C*   NOTICE OF PROGRAM MODIFICATION                                   *
C**********************************************************************
C*  BY:  RICHARD REMINGTON                         SEARCH:  C3-24-88  *
C*  DATE:  MARCH  24,  1988                                           *
C*  REASON: MIGRATION TO RUN IN 7MB ON 9370                           *
C**********************************************************************
C     PROGRAM LAST UPDATED FEBRUARY 21, 1985                          *
C     BY: RICHARD REMINGTON                                           *
C**********************************************************************
      SUBROUTINE GTINT3(A,ETA,ZETA,F,ALPHA,BETA,IJORD,KADD,LADD,
     1IJADD,IJGRP,ORBSYM,INTS,BUF,ORBTBF,JCODE,EIG,S,EPA,W,JT1C,
     1IOFF,E11,E22,E12)
      IMPLICIT INTEGER (A-Z)
CJ    EXTENDED DUMMY A,ETA,ZETA,F,ALPHA,BETA,INTS,BUF,EIG,S,EPA,W,
CJ   1E11,E22,E12
      LOGICAL IJEQ,IJKEQ,JKEQ
      INTEGER XDF,N112(112),FCB2(16),JULIA(70)
      REAL*8 A0,A1,A2,A1S2,A4,FOCC
      DIMENSION IJORD(NUMIJ),KADD(SYMORB),LADD(SYMORB),JT1C(1)
      DIMENSION ORBSYM(NORBS),IJADD(NUMIJ),IJGRP(NUMIJ)
      DIMENSION ORBTBF(NORBS),JCODE(NORBS),IOFF(NUMIJ)
      REAL*8 A(IJIND,IJIND3),F(NORBS),INTS(NMAX),EIG(NORBS)
     1,S(NUMIJ,NDF),EPA(NORBS,NORBS),E11(NORBS,NORBS),
     2E22(NORBS,NORBS),E12(NORBS,NORBS)
      REAL*8 ZETA(NUMIJ,NORBS),ALPHA(NUMIJ),BETA(NUMIJ)
      REAL*8 W(NORBS,NORBS,NDF),SIG,H11,H22,H12,HD,C1,C2
      REAL*8 C1A,C2A,HA1,HA12,HA2
      REAL*8 VAL1,VAL2,VAL3,BUF(NUMIJ),ETA(NUMIJ),ESCF,REPNUC
      COMMON /CIA/ C1A(45),C2A(45),C1,C2,ESCF
      COMMON /CIDERS/ HA1(45),HA12(45),HA2(45),H11,H12,H22
C!!!  COMMON /TAPES/     ,   ,NOUT,IT2,    ,     ,     ,   OLD TAPS USED
C!!!  COMMON /TAPES/ IT22,IT8,NOUT,IT2,IT42,JTAP1,IUTAP,JTAP2
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ SYMORB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /POINT/ FOCC(5),IPOINT(5),JPOINT(5),NSORB(5)
      COMMON /FUNCS/ IOCC,JOCC,KOCC,NTYPES,NBSET,NAT
      COMMON /OCCS/ NSPE,NSA,NSB,NALP,NOP,NDOC,LFERM,NUOC,IJIND,IJIND3
      COMMON /LOC22/ IA22(100),IBF2AT(284)
      COMMON /IEXT/ IPRINT,IGRP
      COMMON /REN/ REPNUC
C
      WRITE(ICHK,2222)
 2222 FORMAT(/'  IN GTINT3')
      WRITE(NOUT,2222)
 3001 FORMAT(10I5)
      DO 4000 IJUL=1,70
        JULIA(IJUL)=0
 4000 CONTINUE
      WRITE(NOUT,*) '   THE SPECIAL PARAMETERS '
      WRITE(NOUT,3001) NSPE,NSA,NSB,NALP,NOP,NDOC,
     +                 LFERM,NUOC,IJIND,IJIND3
      WRITE(NOUT,*) '   THE IJORD ARRAY:'
      WRITE(NOUT,3001) (IJORD(III), III=1,NUMIJ)
      IJIND2=IJIND
      A0=0.0D+00
      A1=1.0D+00
      A2=2.0D+00
      A4=4.00D+00
      A1S2=0.50D+00
      H11=A0
      H22=A0
      H12=A0
      DO 3010 I=1,NORBS
        DO 3020 J=1,NORBS
          E11(I,J)=A0
          E22(I,J)=A0
          E12(I,J)=A0
 3020   CONTINUE
 3010 CONTINUE
      ESCF=A0
C
 2001       FORMAT('  READING FROM IT52 AT ADR ',I8)
 2004           FORMAT(/'  IN GETDM, IJKLT UNKNOWN TYPE ',I5/'  ORBITALS
     * :',4I5/'  BASIS FUNCTIONS :',4I5/'   SYMMETRIES :',4I5)
 2005           FORMAT(/'  IN GETDM, LAD TOO BIG :',I6)
C  CONSTRUCT A AND B0 MATRICIES; B0 IS IN RIGHT SIDE OF A MATRIX
C
 1100 FORMAT(/'  IN THE CONSRTUCTION OF THE A MATRIX, THE CASE ',A7
     1/'  IS NOT POSSIBLE IN THE ',A11,' SET OF LOOPS.'/'  ERROR IN LOOP
     * STRUCTURE SOMEWHERE.')
CIBM  CALL RSETSA(IT52,INTSRT)
      IF (NSPE.EQ.0) GOTO 510
      DO 4030 IOR=NSB,NSA,-1
        IO=IOFF(IOR)
        II=IO+IOR
        IIND=IJORD(II)
        ISM=ORBSYM(IOR)
        ITYP=1
        DO 4040 JOR=IOR,NSA,-1
          IF (IAND(IPRINT,1024) .NE. 0) WRITE(NOUT,1510) IOR,JOR
 1510     FORMAT('  IOR,JOR:',2I5)
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IJND=IJORD(IJ)
          JJND=IJORD(JJ)
          IF (IGRP .NE. IJGRP(IOFF(IOR)+JOR)) THEN
CIBM        CALL RGETSA(IT52,IX)
            WRITE(NOUT,2001) IX
CIBM        CALL LREADW(IT52,INTS,NMAX*2)
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IOFF(IOR)+JOR)
          END IF
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
CCC   IJSYM=(ISM-1).XOR.(JSM-1)
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IOFF(IOR)+JOR)
          DO 4050 K=1,NUOC
            IF(IAND(IPRINT,1024).NE.0) WRITE(NOUT,1503) KOR
 1503       FORMAT('  KOR:',I5)
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KKND=IJORD(KK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
CCC   IJKSYM=IJSYM.XOR.(KSM-1)
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
            DO 4060 LOR=1,KOR
              IF (IAND(IPRINT,1024).NE.0) WRITE(NOUT,1504) LOR
 1504         FORMAT('  LOR:',I5)
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        303
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 303
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005) LAD
                CALL ABORTS
              END IF
              GOTO (13,23,33,43,53,63,73)IJKLT
 13           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              A(IKND,JLND)=2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JK
     *        ))*VAL1+(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(JLND,IKND)=A(IKND,JLND)
              A(ILND,JKND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL3+(BETA(IK)-BETA(KL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)
              A(JKND,ILND)=A(ILND,JKND)
              GOTO 303
 23           CONTINUE
              WRITE(NOUT,2012)
 2012         FORMAT(/     '  IN CONSTRUCTON OF A, J=K IS NOT POSSIBLE I
     *N THE FIRST SET OF LOOPS'/'  ERROR IN LOOPS SOMEWHERE')
              CALL ABORTS
 33           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              A(IKND,ILND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(II)+ALPHA(IL
     *        ))*VAL1+(BETA(IK)-BETA(KL)-BETA(II)+BETA(IL))*(VAL1+
     *        VAL2)+ETA(KL)-ZETA(KL,IOR)
              A(ILND,IKND)=A(IKND,ILND)
              GOTO 303
 43           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4070 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(JL,IDF)*(ETA(IJ)-ZETA(IJ,
     *          LOR))
                A(JLND,XDF)=A(JLND,XDF)-S(IL,IDF)*(ETA(IJ)-ZETA(IJ,
     *          LOR))
 4070         CONTINUE
              A(ILND,JLND)=2*(ALPHA(IL)-ALPHA(LL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL1+(BETA(IL)-BETA(LL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)+ETA(IJ)-ZETA(IJ,LOR)
              A(JLND,ILND)=A(ILND,JLND)
              GOTO 303
 53           CONTINUE
              WRITE(NOUT,2013)
 2013         FORMAT(/     '  IN CONSTRUCTON OF THE A MATRIX, I=J=K IS N
     *OT POSSIBLE DO THE FIRST SET OF LOOPS'/'  ERROR IN LOOPS SOMEWHERE
     *')
              CALL ABORTS
 63           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4080 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(IL,IDF)*(ETA(II)-ZETA(II,
     *          LOR))
 4080         CONTINUE
              A(ILND,ILND)=ETA(LL)-ZETA(LL,IOR)+ETA(II)-ZETA(II,LOR)
     1        +2*(ALPHA(IL)+ALPHA(IL)-ALPHA(II)-ALPHA(LL))*VAL1
     2        +(BETA(IL)+BETA(IL)-BETA(II)-BETA(LL))*(VAL1+VAL2)
              GOTO 303
 73           CONTINUE
              WRITE(NOUT,2014)
 2014         FORMAT(/     '  IN CONSTRUCTON OF THE A MATRIX,I=J=K=L IS
     *NOT POSSIBLE DO THE FIRST SET OF LOOPS'/'  ERROR IN LOOPS SOMEWHER
     *E')
              CALL ABORTS
 303          CONTINUE
 4060       CONTINUE
 4050     CONTINUE
          DO 4090 KOR=LFERM,NDOC
            IF (IAND(IPRINT,1024).NE.0) WRITE(NOUT,1503) KOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KKND=IJORD(KKND)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            KSM=ORBSYM(KOR)
CCC   IJKSYM=IJSYM.XOR.(KSM-1)
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
            DO 4100 LOR=1,NUOC
              IF(IAND(IPRINT,1024).NE.0) WRITE(NOUT,1504) LOR
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        304
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 304
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005) LAD
                CALL ABORTS
              END IF
              GOTO (14,24,34,44,54,64,74)IJKLT
 14           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 4200 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)-S(IK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL3))
                A(KLND,XDF)=A(KLND,XDF)-S(IJ,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(IL))*VAL2+(BETA(IK)-BETA(IL))*(VAL1+VAL3))
 4200         CONTINUE
              A(IJND,KLND)=-2*(ALPHA(IL)-ALPHA(JL)-ALPHA(IK)+ALPHA(
     *        JK))*VAL2-(BETA(IL)-BETA(JL)-BETA(IK)+BETA(JK))*(VAL1+
     *        VAL3)
              A(KLND,IJND)=A(IJND,KLND)
              A(IKND,JLND)=-2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(
     *        JK))*VAL1-(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(JLND,IKND)=A(IKND,JLND)
              A(ILND,JKND)=-2*(ALPHA(IK)-ALPHA(KL)-ALPHA(IJ)+ALPHA(
     *        JL))*VAL3-(BETA(IK)-BETA(KL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)
              A(JKND,ILND)=A(ILND,JKND)
              GOTO 304
 24           CONTINUE
              WRITE(NOUT,1100) 'J=K    ','SECOND     '
              CALL ABORTS
  34          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4300 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(IK,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IL))*VAL1+(BETA(II)-BETA(IL))*(VAL1+VAL2)
     2          -ETA(KL)+ZETA(KL,IOR))
                A(KLND,XDF)=A(KLND,XDF)-S(II,IDF)*((ALPHA(IK)-ALPHA
     *          (IL))*VAL2+(BETA(IK)-BETA(IL))*VAL1)
 4300         CONTINUE
              A(IKND,ILND)=-2*(ALPHA(IK)-ALPHA(KL)-ALPHA(II)+ALPHA(
     *        IL))*VAL1-(BETA(IK)-BETA(KL)-BETA(II)+BETA(IL))*(VAL1+
     *        VAL2)-ETA(KL)+ZETA(KL,IOR)
              A(ILND,IKND)=A(IKND,ILND)
              IF(IOR.EQ.NSB)THEN
                E22(LOR,KOR)=E22(LOR,KOR)+A2*VAL2-VAL1
              ELSE
                E11(LOR,KOR)=E11(LOR,KOR)+A2*VAL2-VAL1
              END IF
              GOTO 304
 44           CONTINUE
              WRITE(NOUT,1100) 'K=L    ','SECOND     '
              CALL ABORTS
 54           CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','SECOND     '
              CALL ABORTS
 64           CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','SECOND     '
              CALL ABORTS
 74           CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','SECOND     '
              CALL ABORTS
 304          CONTINUE
 4100       CONTINUE
            DO 4110 LOR=LFERM,KOR
              IF(IAND(IPRINT,1024).NE.0) WRITE(NOUT,1504) LOR
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        305
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 305
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005) LAD
                CALL ABORTS
              END IF
              GOTO (15,25,35,45,55,65,75)IJKLT
 15           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 4120 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(KL,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(JK))*VAL2+(BETA(IK)-BETA(JK))*(VAL1+VAL3))
                A(IKND,XDF)=A(IKND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JK))*VAL1+(BETA(IJ)-BETA(JK))*(VAL2+VAL3))
                A(ILND,XDF)=A(ILND,XDF)+S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JKND,XDF)=A(JKND,XDF)+S(IL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IK))*VAL3+(BETA(IJ)-BETA(IK))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)+S(IK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL3))
4120          CONTINUE
              A(IKND,JLND)=2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JK
     *        ))*VAL1+(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(JLND,IKND)=A(IKND,JLND)
              A(ILND,JKND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL3+(BETA(IK)-BETA(KL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)
              A(JKND,ILND)=A(ILND,JKND)
              GOTO 305
 25           CONTINUE
              WRITE(NOUT,1100) 'J=K    ','THIRD      '
              CALL ABORTS
 35           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4130 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IKND,XDF)=A(IKND,XDF)+S(IL,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IK))*VAL1+(BETA(II)-BETA(IK))*(VAL1+VAL2)
     2          -ETA(KL)+ZETA(KL,IOR))
                A(ILND,XDF)=A(ILND,XDF)+S(IK,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IL))*VAL1+(BETA(II)-BETA(IL))*(VAL1+VAL2)
     2          -ETA(KL)+ZETA(KL,IOR))
 4130         CONTINUE
              A(IKND,ILND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(II)+ALPHA(IL
     *        ))*VAL1+(BETA(IK)-BETA(KL)-BETA(II)+BETA(IL))*(VAL1+
     *        VAL2)+ETA(KL)-ZETA(KL,IOR)
              A(ILND,IKND)=A(IKND,ILND)
              IF(IOR.EQ.NSB)THEN
                E22(KOR,LOR)=E22(KOR,LOR)+A2*VAL2-VAL1
                E22(LOR,KOR)=E22(LOR,KOR)+A2*VAL2-VAL1
              ELSE
                E11(KOR,LOR)=E11(KOR,LOR)+A2*VAL2-VAL1
                E11(LOR,KOR)=E11(LOR,KOR)+A2*VAL2-VAL1
              END IF
              GOTO 305
 45           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4140 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(LL,IDF)*((ALPHA(IL)-ALPHA
     *          (JL))*VAL2+(BETA(IL)-BETA(JL))*VAL1)
                A(ILND,XDF)=A(ILND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL1+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)+S(IL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL1+VAL2))
4140          CONTINUE
              A(ILND,JLND)=2*(ALPHA(IL)-ALPHA(LL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL1+(BETA(IL)-BETA(LL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)+ETA(IJ)-ZETA(IJ,LOR)
              A(JLND,ILND)=A(ILND,JLND)
              E11(IOR,JOR)=E11(IOR,JOR)+A2*VAL2-VAL1
              E22(JOR,IOR)=E22(JOR,IOR)+A2*VAL2-VAL1
              GOTO 305
 55           CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','THIRD     '
              CALL ABORTS
 65           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4150 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)+S(IL,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IL))*VAL1+(BETA(II)-BETA(IL))*(VAL1+VAL2)
     2          -ETA(LL)+ZETA(LL,IOR))
4150          CONTINUE
              A(ILND,ILND)=ETA(LL)-ZETA(LL,IOR)+ETA(II)-ZETA(II,LOR)
     1        +2*(ALPHA(IL)+ALPHA(IL)-ALPHA(II)-ALPHA(LL))*VAL1
     2        +(BETA(IL)+BETA(IL)-BETA(II)-BETA(LL))*(VAL1+VAL2)
              IF(IOR.EQ.NSB)THEN
                H22=H22+A4*VAL2-A2*VAL1
                E22(IOR,IOR)=E22(IOR,IOR)+A2*VAL2-VAL1
                E22(KOR,KOR)=E22(KOR,KOR)+A2*VAL2-VAL1
              ELSE
                H11=H11+A4*VAL2-A2*VAL1
                E11(IOR,IOR)=E11(IOR,IOR)+A2*VAL2-VAL1
                E11(KOR,KOR)=E11(KOR,KOR)+A2*VAL2-VAL1
              END IF
              GOTO 305
 75           CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','THIRD     '
              CALL ABORTS
 305          CONTINUE
 4110       CONTINUE
 4090     CONTINUE
          IF(IAND(IPRINT,1024).NE.0) WRITE(NOUT,1505)
 1505     FORMAT(/'  ABOUT TO JUMP TO 520')
C
          IF (NALP.EQ.0) GOTO 520
C
          DO 8150 KOR=NOP,NALP
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KKND=IJORD(KK)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            KSM=ORBSYM(KOR)
CCC   IJKSYM=IJSYM.XOR.(KSM-1)
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
            DO 4160 LOR=1,NDOC
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        306
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 306
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005) LAD
                CALL ABORTS
              END IF
              GOTO (16,26,36,46,56,66,76)IJKLT
 16           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 4170 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(KL,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(JK))*VAL2+(BETA(IK)-BETA(JK))*(VAL1+VAL3))
                A(IKND,XDF)=A(IKND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JK))*VAL1+(BETA(IJ)-BETA(JK))*(VAL2+VAL3))
                A(ILND,XDF)=A(ILND,XDF)+S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JKND,XDF)=A(JKND,XDF)+S(IL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IK))*VAL3+(BETA(IJ)-BETA(IK))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)+S(IK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL3))
                A(KLND,XDF)=A(KLND,XDF)+S(IJ,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(IL))*VAL2+(BETA(IK)-BETA(IL))*(VAL1+VAL3))
 4170         CONTINUE
              A(IJND,KLND)=2*(ALPHA(IL)-ALPHA(JL)-ALPHA(IK)+ALPHA(JK
     *        ))*VAL2+(BETA(IL)-BETA(JL)-BETA(IK)+BETA(JK))*(VAL1+
     *        VAL3)
              A(KLND,IJND)=A(IJND,KLND)
              A(IKND,JLND)=2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JK
     *        ))*VAL1+(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(JLND,IKND)=A(IKND,JLND)
              A(ILND,JKND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL3+(BETA(IK)-BETA(KL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)
              A(JKND,ILND)=A(ILND,JKND)
              GOTO 306
 26           CONTINUE
              WRITE(NOUT,1100) 'J=K    ','FOURTH     '
              CALL ABORTS
  36          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4180 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IKND,XDF)=A(IKND,XDF)+S(IL,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IK))*VAL1+(BETA(II)-BETA(IK))*(VAL1+VAL2)
     2          -ETA(KL)+ZETA(KL,IOR))
                A(ILND,XDF)=A(ILND,XDF)+S(IK,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IL))*VAL1+(BETA(II)-BETA(IL))*(VAL1+VAL2)
     2          -ETA(KL)+ZETA(KL,IOR))
                A(KLND,XDF)=A(KLND,XDF)+S(II,IDF)*((ALPHA(IK)-ALPHA
     *          (IL))*VAL2+(BETA(IK)-BETA(IL))*VAL1)
 4180         CONTINUE
              A(IKND,ILND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(II)+ALPHA(IL
     *        ))*VAL1+(BETA(IK)-BETA(KL)-BETA(II)+BETA(IL))*(VAL1+
     *        VAL2)+ETA(KL)-ZETA(KL,IOR)
              A(ILND,IKND)=A(IKND,ILND)
              GOTO 306
 46           CONTINUE
              WRITE(NOUT,1100) 'K=L    ','FOURTH     '
              CALL ABORTS
 56           CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','FOURTH     '
              CALL ABORTS
 66           CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','FOURTH     '
              CALL ABORTS
 76           CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','FOURTH     '
              CALL ABORTS
 306          CONTINUE
 4160       CONTINUE
            DO 4190 LOR=NOP,KOR
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        307
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 307
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              GOTO (17,27,37,47,57,67,77)IJKLT
 17           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 4210 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(KL,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(JK))*VAL2+(BETA(IK)-BETA(JK))*(VAL1+VAL3))
                A(IKND,XDF)=A(IKND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JK))*VAL1+(BETA(IJ)-BETA(JK))*(VAL2+VAL3))
                A(ILND,XDF)=A(ILND,XDF)+S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JKND,XDF)=A(JKND,XDF)+S(IL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IK))*VAL3+(BETA(IJ)-BETA(IK))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)+S(IK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL3))
4210          CONTINUE
              A(IKND,JLND)=2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JK
     *        ))*VAL1+(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(JLND,IKND)=A(IKND,JLND)
              A(ILND,JKND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL3+(BETA(IK)-BETA(KL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)
              A(JKND,ILND)=A(ILND,JKND)
              GOTO 307
 27           CONTINUE
              WRITE(NOUT,1100) 'J=K    ','FIFTH      '
              CALL ABORTS
 37           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4220 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IKND,XDF)=A(IKND,XDF)+S(IL,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IK))*VAL1+(BETA(II)-BETA(IK))*(VAL1+VAL2)
     2          -ETA(KL)+ZETA(KL,IOR))
                A(ILND,XDF)=A(ILND,XDF)+S(IK,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IL))*VAL1+(BETA(II)-BETA(IL))*(VAL1+VAL2)
     2          -ETA(KL)+ZETA(KL,IOR))
4220          CONTINUE
              A(IKND,ILND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(II)+ALPHA(IL
     *        ))*VAL1+(BETA(IK)-BETA(KL)-BETA(II)+BETA(IL))*(VAL1+
     *        VAL2)+ETA(KL)-ZETA(KL,IOR)
              A(ILND,IKND)=A(IKND,ILND)
              GOTO 307
 47           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4230 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(LL,IDF)*((ALPHA(IL)-ALPHA
     *          (JL))*VAL2+(BETA(IL)-BETA(JL))*VAL1)
                A(ILND,XDF)=A(ILND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL1+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)+S(IL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL1+VAL2))
4230          CONTINUE
              A(ILND,JLND)=2*(ALPHA(IL)-ALPHA(LL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL1+(BETA(IL)-BETA(LL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)+ETA(IJ)-ZETA(IJ,LOR)
              A(JLND,ILND)=A(ILND,JLND)
              GOTO 307
 57           CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','FIFTH     '
              CALL ABORTS
 67           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4240 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)+S(IL,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IL))*VAL1+(BETA(II)-BETA(IL))*(VAL1+VAL2)
     2          -ETA(LL)+ZETA(LL,IOR))
4240          CONTINUE
              A(ILND,ILND)=ETA(LL)-ZETA(LL,IOR)+ETA(II)-ZETA(II,LOR)
     1        +2*(ALPHA(IL)+ALPHA(IL)-ALPHA(II)-ALPHA(LL))*VAL1
     2        +(BETA(IL)+BETA(IL)-BETA(II)-BETA(LL))*(VAL1+VAL2)
              GOTO 307
 77           CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','FIFTH     '
              CALL ABORTS
 307          CONTINUE
4190        CONTINUE
8150      CONTINUE
C
 520      CONTINUE
          DO 4250 KOR=NSA,JOR
            IF(IAND(IPRINT,1024).NE.0) WRITE(NOUT,1503) KOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KKND=IJORD(KK)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            KSM=ORBSYM(KOR)
CCC   IJKSYM=IJSYM.XOR.(KSM-1)
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
            DO 4260 LOR=NSA,KOR
              IF(IAND(IPRINT,1024).NE.0) WRITE(NOUT,1504) LOR
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        6090
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 6090
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              GOTO (6090,6090,6090,6090,6095,6096,6097)IJKLT
 6095         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              E12(IOR,LOR)=E12(IOR,LOR)+VAL1*A1S2
              E22(LOR,IOR)=E22(LOR,IOR)+VAL1+VAL3
              E11(IOR,LOR)=E11(IOR,LOR)+VAL2+VAL3
              E12(LOR,IOR)=E12(LOR,IOR)+VAL2*A1S2
              GOTO 6090
 6096         VAL1=INTS(LAD+1)
              H12=VAL1
              E12(IOR,IOR)=E12(IOR,IOR)+A1S2*VAL1
              E12(KOR,KOR)=E12(KOR,KOR)+A1S2*VAL1
              GOTO 6090
 6097         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              IF(IOR.EQ.NSB)THEN
                H22=H22+VAL1+A2*VAL2
                E22(IOR,IOR)=E22(IOR,IOR)+VAL1+VAL2
              ELSE
                H11=H11+VAL1+A2*VAL2
                E11(IOR,IOR)=E11(IOR,IOR)+VAL1+VAL2
              END IF
 6090         CONTINUE
 4260       CONTINUE
            DO 4270 LOR=LFERM,NDOC
              IF(IAND(IPRINT,1024).NE.0) WRITE(NOUT,1504) LOR
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        6070
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 6070
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              GOTO (6070,6072,6073,6070,6075,6070,6070)IJKLT
 6072         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              E11(IOR,LOR)=E11(IOR,LOR)+A2*VAL2-VAL1
              E12(LOR,IOR)=E12(LOR,IOR)+A1S2*VAL1
              GOTO6070
 6073         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              E22(KOR,LOR)=E22(KOR,LOR)+A2*VAL2-VAL1
              E12(LOR,KOR)=E12(LOR,KOR)+A1S2*VAL1
              GOTO6070
 6075         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              E11(IOR,LOR)=E11(IOR,LOR)+VAL3+VAL2
              E22(IOR,LOR)=E22(IOR,LOR)+VAL3+VAL2
              E11(LOR,IOR)=E11(LOR,IOR)+VAL3+VAL2
              E22(LOR,IOR)=E22(LOR,IOR)+VAL3+VAL2
              IF(IOR.EQ.NSB)THEN
                E22(IOR,LOR)=E22(IOR,LOR)+VAL1
                E22(LOR,IOR)=E22(LOR,IOR)+VAL1
              ELSE
                E11(IOR,LOR)=E11(IOR,LOR)+VAL1
                E11(LOR,IOR)=E11(LOR,IOR)+VAL1
              END IF
              GOTO 6070
 6070         CONTINUE
 4270       CONTINUE
            DO 4280 LOR=1,NUOC
              IF(IAND(IPRINT,1024).NE.0) WRITE(NOUT,1504) LOR
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        308
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 308
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              GOTO (18,28,38,48,58,68,78)IJKLT
 18           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 4290 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)-S(IK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL3))
                A(KLND,XDF)=A(KLND,XDF)-S(IJ,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(IL))*VAL2+(BETA(IK)-BETA(IL))*(VAL1+VAL3))
 4290         CONTINUE
              A(IJND,KLND)=-2*(ALPHA(IL)-ALPHA(JL)-ALPHA(IK)+ALPHA(
     *        JK))*VAL2-(BETA(IL)-BETA(JL)-BETA(IK)+BETA(JK))*(VAL1+
     *        VAL3)
              A(KLND,IJND)=A(IJND,KLND)
              A(IKND,JLND)=-2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(
     *        JK))*VAL1-(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(JLND,IKND)=A(IKND,JLND)
              A(ILND,JKND)=-2*(ALPHA(IK)-ALPHA(KL)-ALPHA(IJ)+ALPHA(
     *        JL))*VAL3-(BETA(IK)-BETA(KL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)
              A(JKND,ILND)=A(ILND,JKND)
              GOTO 308
 28           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4310 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(JJ,IDF)*((ALPHA(IJ)-ALPHA
     *          (JL))*VAL2+(BETA(IJ)-BETA(JL))*VAL1)
                A(JLND,XDF)=A(JLND,XDF)-S(IJ,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL1))
4310          CONTINUE
              A(IJND,JLND)=-2*(ALPHA(IL)-ALPHA(JL)-ALPHA(IJ)+ALPHA(
     *        JJ))*VAL1-(BETA(IL)-BETA(JL)-BETA(IJ)+BETA(JJ))*(VAL1+
     *        VAL2)+ETA(IL)-ZETA(IL,JOR)
              A(JLND,IJND)=A(IJND,JLND)
              E12(LOR,IOR)=E12(LOR,IOR)+A1S2*VAL1
              GOTO308
 38           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4320 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(IK,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IL))*VAL1+(BETA(II)-BETA(IL))*(VAL1+VAL2)
     2          -ETA(KL)+ZETA(KL,IOR))
                A(KLND,XDF)=A(KLND,XDF)-S(II,IDF)*((ALPHA(IK)-ALPHA
     *          (IL))*VAL2+(BETA(IK)-BETA(IL))*VAL1)
4320          CONTINUE
              A(IKND,ILND)=-2*(ALPHA(IK)-ALPHA(KL)-ALPHA(II)+ALPHA(
     *        IL))*VAL1-(BETA(IK)-BETA(KL)-BETA(II)+BETA(IL))*(VAL1+
     *        VAL2)-ETA(KL)+ZETA(KL,IOR)
              A(ILND,IKND)=A(IKND,ILND)
              E12(LOR,KOR)=E12(LOR,KOR)+A1S2*VAL1
              GOTO 308
 48           CONTINUE
              WRITE(NOUT,2015) '  48'
 2015         FORMAT(/'  CONTINUE',A4,' NOT ALLOWED')
              CALL ABORTS
              VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4330 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(JL,IDF)*(ETA(IJ)-ZETA(IJ,
     *          LOR))
                A(JLND,XDF)=A(JLND,XDF)-S(IL,IDF)*(ETA(IJ)-ZETA(IJ,
     *          LOR))
4330          CONTINUE
              A(ILND,JLND)=-2*(ALPHA(IL)-ALPHA(LL)-ALPHA(IJ)+ALPHA(
     *        JL))*VAL1-(BETA(IL)-BETA(LL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)-ETA(IJ)+ZETA(IJ,LOR)
              A(JLND,ILND)=A(ILND,JLND)
              GOTO 308
 58           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 4340 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(II,IDF)*((ALPHA(II)-ALPHA
     *          (IL))*VAL1+(BETA(II)-BETA(IL))*VAL1)
 4340         CONTINUE
              IF(IOR.EQ.NSB)THEN
                E22(LOR,IOR)=E22(LOR,IOR)+VAL1+VAL3
              ELSE
                E11(LOR,IOR)=E11(LOR,IOR)+VAL1+VAL3
              END IF
              GOTO 308
 68           CONTINUE
              WRITE(NOUT,2015) '  68'
              CALL ABORTS
              VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4350 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(IL,IDF)*(ETA(II)-ZETA(II,
     *          LOR))
 4350         CONTINUE
              A(ILND,ILND)=   -A1*(ETA(LL)-ZETA(LL,IOR)+ETA(II)-ZETA
     *        (II,LOR)+2*(ALPHA(IL)+ALPHA(IL)-ALPHA(II)-ALPHA(LL))*
     *        VAL1+(BETA(IL)+BETA(IL)-BETA(II)-BETA(LL))*(VAL1+VAL2)
     *        )
              GOTO 308
 78           CONTINUE
              WRITE(NOUT,2015) '  78'
              CALL ABORTS
C  THIS TYPE (I=J=K=L) DOES NOT CONTRIBUTE
 308          CONTINUE
 4280       CONTINUE
            DO 4360 LOR=LFERM,KOR
              IF(IAND(IPRINT,1024).NE.0) WRITE(NOUT,1504) LOR
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        508
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 508
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              GOTO (518,528,538,548,558,568,578)IJKLT
518           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 4370 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(KL,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(JK))*VAL2+(BETA(IK)-BETA(JK))*(VAL1+VAL3))
                A(IKND,XDF)=A(IKND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JK))*VAL1+(BETA(IJ)-BETA(JK))*(VAL2+VAL3))
                A(ILND,XDF)=A(ILND,XDF)+S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JKND,XDF)=A(JKND,XDF)+S(IL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IK))*VAL3+(BETA(IJ)-BETA(IK))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)+S(IK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL3))
                A(KLND,XDF)=A(KLND,XDF)+S(IJ,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(IL))*VAL2+(BETA(IK)-BETA(IL))*(VAL1+VAL3))
 4370         CONTINUE
              A(IJND,KLND)=2*(ALPHA(IL)-ALPHA(JL)-ALPHA(IK)+ALPHA(JK
     *        ))*VAL2+(BETA(IL)-BETA(JL)-BETA(IK)+BETA(JK))*(VAL1+
     *        VAL3)
              A(KLND,IJND)=A(IJND,KLND)
              A(IKND,JLND)=2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JK
     *        ))*VAL1+(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(JLND,IKND)=A(IKND,JLND)
              A(ILND,JKND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL3+(BETA(IK)-BETA(KL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)
              A(JKND,ILND)=A(ILND,JKND)
              GOTO 508
528           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4380 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JJ))*VAL1+(BETA(IJ)-BETA(JJ))*(VAL1+VAL2)
     2          +ETA(IL)-ZETA(IL,JOR))
                A(ILND,XDF)=A(ILND,XDF)+S(JJ,IDF)*((ALPHA(IJ)-ALPHA
     *          (JL))*VAL2+(BETA(IJ)-BETA(JL))*VAL1)
                A(JLND,XDF)=A(JLND,XDF)+S(IJ,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL1))
4380          CONTINUE
              A(IJND,JLND)=2*(ALPHA(IL)-ALPHA(JL)-ALPHA(IJ)+ALPHA(JJ
     *        ))*VAL1+(BETA(IL)-BETA(JL)-BETA(IJ)+BETA(JJ))*(VAL1+
     *        VAL2)-ETA(IL)+ZETA(IL,JOR)
              A(JLND,IJND)=A(IJND,JLND)
              GOTO 508
538           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4390 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IKND,XDF)=A(IKND,XDF)+S(IL,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IK))*VAL1+(BETA(II)-BETA(IK))*(VAL1+VAL2)
     2          -ETA(KL)+ZETA(KL,IOR))
                A(ILND,XDF)=A(ILND,XDF)+S(IK,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IL))*VAL1+(BETA(II)-BETA(IL))*(VAL1+VAL2)
     2          -ETA(KL)+ZETA(KL,IOR))
                A(KLND,XDF)=A(KLND,XDF)+S(II,IDF)*((ALPHA(IK)-ALPHA
     *          (IL))*VAL2+(BETA(IK)-BETA(IL))*VAL1)
 4390         CONTINUE
              A(IKND,ILND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(II)+ALPHA(IL
     *        ))*VAL1+(BETA(IK)-BETA(KL)-BETA(II)+BETA(IL))*(VAL1+
     *        VAL2)+ETA(KL)-ZETA(KL,IOR)
              A(ILND,IKND)=A(IKND,ILND)
              GOTO 508
548           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4400 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(LL,IDF)*((ALPHA(IL)-ALPHA
     *          (JL))*VAL2+(BETA(IL)-BETA(JL))*VAL1)
                A(ILND,XDF)=A(ILND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL1+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)+S(IL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL1+VAL2))
4400          CONTINUE
              A(ILND,JLND)=2*(ALPHA(IL)-ALPHA(LL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL1+(BETA(IL)-BETA(LL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)+ETA(IJ)-ZETA(IJ,LOR)
              A(JLND,ILND)=A(ILND,JLND)
              GOTO 508
558           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4410 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)+S(II,IDF)*((ALPHA(II)-ALPHA
     *          (IL))*VAL1+(BETA(II)-BETA(IL))*VAL1)
                A(ILND,XDF)=A(ILND,XDF)+S(LL,IDF)*((ALPHA(IL)-ALPHA
     *          (LL))*VAL2+(BETA(IL)-BETA(LL))*VAL2)
 4410         CONTINUE
              GOTO 508
568           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4420 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)+S(IL,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IL))*VAL1+(BETA(II)-BETA(IL))*(VAL1+VAL2)
     2          -ETA(LL)+ZETA(LL,IOR))
 4420         CONTINUE
              A(ILND,ILND)=ETA(LL)-ZETA(LL,IOR)+ETA(II)-ZETA(II,LOR)
     1        +2*(ALPHA(IL)+ALPHA(IL)-ALPHA(II)-ALPHA(LL))*VAL1
     2        +(BETA(IL)+BETA(IL)-BETA(II)-BETA(LL))*(VAL1+VAL2)
              GOTO 508
578           CONTINUE
C  THIS TYPE (I=J=K=L) DOES NOT CONTRIBUTE
 508          CONTINUE
 4360       CONTINUE
 4250     CONTINUE
 4040   CONTINUE
C
        IF (NALP.EQ.0) GOTO 530
        DO 4430 JOR=NALP,NOP,-1
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IJND=IJORD(IJ)
          JJND=IJORD(JJ)
          IF (IGRP .NE. IJGRP(IOFF(IOR)+JOR)) THEN
CIBM        CALL RGETSA(IT52,IX)
            WRITE(NOUT,2001) IX
CIBM        CALL LREADW(IT52,INTS,NMAX*2)
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IOFF(IOR)+JOR)
          END IF
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
CCC   IJSYM=(ISM-1).XOR.(JSM-1)
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IOFF(IOR)+JOR)
          DO 4440 KOR=1,NUOC
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KKND=IJORD(KK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
CCC   IJKSYM=IJSYM.XOR.(KSM-1)
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
            DO 4450 LOR=1,KOR
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        309
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 309
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              GOTO (19,29,39,49,59,69,79)IJKLT
 19           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 4460 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IKND,XDF)=A(IKND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JK))*VAL1+(BETA(IJ)-BETA(JK))*(VAL2+VAL3))
                A(ILND,XDF)=A(ILND,XDF)+S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JKND,XDF)=A(JKND,XDF)+S(IL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IK))*VAL3+(BETA(IJ)-BETA(IK))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)+S(IK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL3))
4460          CONTINUE
              A(IKND,JLND)=2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JK
     *        ))*VAL1+(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(JLND,IKND)=A(IKND,JLND)
              A(ILND,JKND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL3+(BETA(IK)-BETA(KL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)
              A(JKND,ILND)=A(ILND,JKND)
              GOTO 309
 29           CONTINUE
              WRITE(NOUT,1100) 'J=K    ','SEVENTH    '
              CALL ABORTS
 39           CONTINUE
              WRITE(NOUT,1100) 'I=J    ','SEVENTH    '
              CALL ABORTS
 49           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4470 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL1+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)+S(IL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL1+VAL2))
 4470         CONTINUE
              A(ILND,JLND)=2*(ALPHA(IL)-ALPHA(LL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL1+(BETA(IL)-BETA(LL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)+ETA(IJ)-ZETA(IJ,LOR)
              A(JLND,ILND)=A(ILND,JLND)
              GOTO 309
 59           CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','SEVENTH    '
              CALL ABORTS
 69           CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','SEVENTH    '
              CALL ABORTS
 79           CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','SEVENTH    '
              CALL ABORTS
 309          CONTINUE
 4450       CONTINUE
 4440     CONTINUE
          DO 4480 KOR=LFERM,NDOC
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KKND=IJORD(KK)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            KSM=ORBSYM(KOR)
CCC   IJKSYM=IJSYM.XOR.(KSM-1)
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
            DO 4490 LOR=1,NUOC
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        401
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 401
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              GOTO (111,121,131,141,151,161,171)IJKLT
 111          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 5000 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(KL,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(JK))*VAL2+(BETA(IK)-BETA(JK))*(VAL1+VAL3))
                A(IKND,XDF)=A(IKND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JK))*VAL1+(BETA(IJ)-BETA(JK))*(VAL2+VAL3))
                A(ILND,XDF)=A(ILND,XDF)+S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JKND,XDF)=A(JKND,XDF)+S(IL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IK))*VAL3+(BETA(IJ)-BETA(IK))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)+S(IK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL3))
                A(KLND,XDF)=A(KLND,XDF)+S(IJ,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(IL))*VAL2+(BETA(IK)-BETA(IL))*(VAL1+VAL3))
 5000         CONTINUE
              A(IJND,KLND)=2*(ALPHA(IL)-ALPHA(JL)-ALPHA(IK)+ALPHA(JK
     *        ))*VAL2+(BETA(IL)-BETA(JL)-BETA(IK)+BETA(JK))*(VAL1+
     *        VAL3)
              A(KLND,IJND)=A(IJND,KLND)
              A(IKND,JLND)=2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JK
     *        ))*VAL1+(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(JLND,IKND)=A(IKND,JLND)
              A(ILND,JKND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL3+(BETA(IK)-BETA(KL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)
              A(JKND,ILND)=A(ILND,JKND)
              GOTO 401
 121          CONTINUE
              WRITE(NOUT,1100) 'J=K    ','EIGHTH     '
              CALL ABORTS
 131          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','EIGHTH     '
              CALL ABORTS
 141          CONTINUE
              WRITE(NOUT,1100) 'K=L    ','EIGHTH     '
              CALL ABORTS
 151          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','EIGHTH     '
              CALL ABORTS
 161          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','EIGHTH     '
              CALL ABORTS
 171          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','EIGHTH     '
              CALL ABORTS
 401          CONTINUE
 4490       CONTINUE
            DO 4500 LOR=LFERM,KOR
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        402
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 402
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              GOTO (112,122,132,142,152,162,172)IJKLT
 112          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 4510 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(KL,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(JK))*VAL2+(BETA(IK)-BETA(JK))*(VAL1+VAL3))
                A(IKND,XDF)=A(IKND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JK))*VAL1+(BETA(IJ)-BETA(JK))*(VAL2+VAL3))
                A(ILND,XDF)=A(ILND,XDF)+S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JKND,XDF)=A(JKND,XDF)+S(IL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IK))*VAL3+(BETA(IJ)-BETA(IK))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)+S(IK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL3))
4510          CONTINUE
              A(IKND,JLND)=2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JK
     *        ))*VAL1+(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(JLND,IKND)=A(IKND,JLND)
              A(ILND,JKND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL3+(BETA(IK)-BETA(KL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)
              A(JKND,ILND)=A(ILND,JKND)
              GOTO 402
 122          CONTINUE
              WRITE(NOUT,1100) 'J=K    ','NINTH      '
              CALL ABORTS
 132          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','NINTH      '
              CALL ABORTS
 142          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4520 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(LL,IDF)*((ALPHA(IL)-ALPHA
     *          (JL))*VAL2+(BETA(IL)-BETA(JL))*VAL1)
                A(ILND,XDF)=A(ILND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL1+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)+S(IL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL1+VAL2))
 4520         CONTINUE
              A(ILND,JLND)=2*(ALPHA(IL)-ALPHA(LL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL1+(BETA(IL)-BETA(LL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)+ETA(IJ)-ZETA(IJ,LOR)
              A(JLND,ILND)=A(ILND,JLND)
              GOTO 402
152           CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','NINTH      '
              CALL ABORTS
162           CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','NINTH      '
              CALL ABORTS
172           CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','NINTH      '
              CALL ABORTS
 402          CONTINUE
 4500       CONTINUE
 4480     CONTINUE
C
          DO 4530 KOR=NOP,JOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KKND=IJORD(KK)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            KSM=ORBSYM(KOR)
CCC   IJKSYM=IJSYM.XOR.(KSM-1)
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
            DO 4540 LOR=1,NDOC
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        403
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 403
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              GOTO (113,123,133,143,153,163,173)IJKLT
 113          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 4550 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(KL,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(JK))*VAL2+(BETA(IK)-BETA(JK))*(VAL1+VAL3))
                A(IKND,XDF)=A(IKND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JK))*VAL1+(BETA(IJ)-BETA(JK))*(VAL2+VAL3))
                A(ILND,XDF)=A(ILND,XDF)+S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)+S(IK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL3))
                A(KLND,XDF)=A(KLND,XDF)+S(IJ,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(IL))*VAL2+(BETA(IK)-BETA(IL))*(VAL1+VAL3))
 4550         CONTINUE
              A(IJND,KLND)=2*(ALPHA(IL)-ALPHA(JL)-ALPHA(IK)+ALPHA(JK
     *        ))*VAL2+(BETA(IL)-BETA(JL)-BETA(IK)+BETA(JK))*(VAL1+
     *        VAL3)
              A(KLND,IJND)=A(IJND,KLND)
              A(IKND,JLND)=2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JK
     *        ))*VAL1+(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(JLND,IKND)=A(IKND,JLND)
              GOTO 403
 123          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4560 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JJ))*VAL1+(BETA(IJ)-BETA(JJ))*(VAL1+VAL2)
     2          +ETA(IL)-ZETA(IL,JOR))
                A(ILND,XDF)=A(ILND,XDF)+S(JJ,IDF)*((ALPHA(IJ)-ALPHA
     *          (JL))*VAL2+(BETA(IJ)-BETA(JL))*VAL1)
                A(JLND,XDF)=A(JLND,XDF)+S(IJ,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL1))
 4560         CONTINUE
              A(IJND,JLND)=2*(ALPHA(IL)-ALPHA(JL)-ALPHA(IJ)+ALPHA(JJ
     *        ))*VAL1+(BETA(IL)-BETA(JL)-BETA(IJ)+BETA(JJ))*(VAL1+
     *        VAL2)-ETA(IL)+ZETA(IL,JOR)
              A(JLND,IJND)=A(IJND,JLND)
              GOTO 403
 133          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','TENTH      '
              CALL ABORTS
 143          CONTINUE
              WRITE(NOUT,1100) 'K=L    ','TENTH      '
              CALL ABORTS
 153          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','TENTH      '
              CALL ABORTS
 163          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','TENTH      '
              CALL ABORTS
 173          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','TENTH      '
              CALL ABORTS
 403          CONTINUE
 4540       CONTINUE
            DO 4570 LOR=1,KOR
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        603
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 603
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              GOTO (613,623,633,643,653,663,673)IJKLT
 613          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 4580 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(KL,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(JK))*VAL2+(BETA(IK)-BETA(JK))*(VAL1+VAL3))
                A(IKND,XDF)=A(IKND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JK))*VAL1+(BETA(IJ)-BETA(JK))*(VAL2+VAL3))
                A(ILND,XDF)=A(ILND,XDF)+S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
 4580         CONTINUE
              GOTO 603
 623          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4590 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JJ))*VAL1+(BETA(IJ)-BETA(JJ))*(VAL1+VAL2)
     2          +ETA(IL)-ZETA(IL,JOR))
                A(ILND,XDF)=A(ILND,XDF)+S(JJ,IDF)*((ALPHA(IJ)-ALPHA
     *          (JL))*VAL2+(BETA(IJ)-BETA(JL))*VAL1)
4590          CONTINUE
              GOTO 603
 633          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','TENTH+1    '
              CALL ABORTS
 643          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4600 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(LL,IDF)*((ALPHA(IL)-ALPHA
     *          (JL))*VAL2+(BETA(IL)-BETA(JL))*VAL1)
                A(ILND,XDF)=A(ILND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL1+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
 4600         CONTINUE
              GOTO 603
 653          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','TENTH+1    '
              CALL ABORTS
 663          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','TENTH+1    '
              CALL ABORTS
 673          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','TENTH+1    '
              CALL ABORTS
 603          CONTINUE
 4570         CONTINUE
 4530     CONTINUE
 4430   CONTINUE
C
 530    CONTINUE
C
        DO 4610 JOR=NDOC,LFERM,-1
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IJND=IJORD(IJ)
          JJND=IJORD(JJ)
          IF (IGRP .NE. IJGRP(IOFF(IOR)+JOR)) THEN
CIBM        CALL RGETSA(IT52,IX)
CIBM        WRITE(NOUT,2001) IX
CIBM        CALL LREADW(IT52,INTS,NMAX*2)
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IOFF(IOR)+JOR)
          END IF
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
CCC   IJSYM=(ISM-1).XOR.(JSM-1)
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IOFF(IOR)+JOR)
          DO 4620 KOR=1,NUOC
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KKND=IJORD(KK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
CCC   IJKSYM=IJSYM.XOR.(KSM-1)
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
            DO 4630 LOR=1,KOR
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        404
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 404
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004)  IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              GOTO (114,124,134,144,154,164,174)IJKLT
 114          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              A(IKND,JLND)=2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JK
     *        ))*VAL1+(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(JLND,IKND)=A(IKND,JLND)
              A(ILND,JKND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL3+(BETA(IK)-BETA(KL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)
              A(JKND,ILND)=A(ILND,JKND)
              GOTO 404
 124          CONTINUE
              WRITE(NOUT,1100) 'J=K    ','ELEVENTH   '
              CALL ABORTS
 134          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','ELEVENTH   '
              CALL ABORTS
 144          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4640 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(JL,IDF)*(ETA(IJ)-ZETA(IJ,
     *          LOR))
                A(JLND,XDF)=A(JLND,XDF)-S(IL,IDF)*(ETA(IJ)-ZETA(IJ,
     *          LOR))
 4640         CONTINUE
              A(ILND,JLND)=2*(ALPHA(IL)-ALPHA(LL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL1+(BETA(IL)-BETA(LL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)+ETA(IJ)-ZETA(IJ,LOR)
              A(JLND,ILND)=A(ILND,JLND)
              GOTO 404
 154          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','ELEVENTH   '
              CALL ABORTS
 164          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','ELEVENTH   '
              CALL ABORTS
 174          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','ELEVENTH   '
              CALL ABORTS
 404          CONTINUE
 4630         CONTINUE
 4620     CONTINUE
          DO 4650 KOR=LFERM,JOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KKND=IJORD(KK)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            KSM=ORBSYM(KOR)
CCC   IJKSYM=IJSYM.XOR.(KSM-1)
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
            DO 4660 LOR=1,NUOC
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        405
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 405
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004)  IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              GOTO (115,125,135,145,155,165,175)IJKLT
 115          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 4670 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)-S(IK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL3))
                A(KLND,XDF)=A(KLND,XDF)-S(IJ,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(IL))*VAL2+(BETA(IK)-BETA(IL))*(VAL1+VAL3))
4670          CONTINUE
              A(IJND,KLND)=-2*(ALPHA(IL)-ALPHA(JL)-ALPHA(IK)+ALPHA(
     *        JK))*VAL2-(BETA(IL)-BETA(JL)-BETA(IK)+BETA(JK))*(VAL1+
     *        VAL3)
              A(KLND,IJND)=A(IJND,KLND)
              A(IKND,JLND)=-2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(
     *        JK))*VAL1-(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(JLND,IKND)=A(IKND,JLND)
              GOTO 405
 125          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4680 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(JJ,IDF)*((ALPHA(IJ)-ALPHA
     *          (JL))*VAL2+(BETA(IJ)-BETA(JL))*VAL1)
                A(JLND,XDF)=A(JLND,XDF)-S(IJ,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL1))
4680          CONTINUE
              A(IJND,JLND)=-2*(ALPHA(IL)-ALPHA(JL)-ALPHA(IJ)+ALPHA(
     *        JJ))*VAL1-(BETA(IL)-BETA(JL)-BETA(IJ)+BETA(JJ))*(VAL1+
     *        VAL2)+ETA(IL)-ZETA(IL,JOR)
              A(JLND,IJND)=A(IJND,JLND)
              IF(IOR.EQ.NSB)THEN
                E22(LOR,IOR)=E22(LOR,IOR)+A2*VAL2-VAL1
              ELSE
                E11(LOR,IOR)=E11(LOR,IOR)+A2*VAL2-VAL1
              END IF
              GOTO 405
 135          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','TWELVTH    '
              CALL ABORTS
 145          CONTINUE
              WRITE(NOUT,1100) 'K=L    ','TWELVTH    '
              CALL ABORTS
 155          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','TWELVTH    '
              CALL ABORTS
 165          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','TWELVTH    '
              CALL ABORTS
 175          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','TWELVTH    '
              CALL ABORTS
 405          CONTINUE
 4660       CONTINUE
            DO 4690 LOR=LFERM,KOR
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        605
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 605
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              GOTO (615,625,635,645,655,665,675)IJKLT
 615          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 4700 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(KL,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(JK))*VAL2+(BETA(IK)-BETA(JK))*(VAL1+VAL3))
                A(IKND,XDF)=A(IKND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JK))*VAL1+(BETA(IJ)-BETA(JK))*(VAL2+VAL3))
                A(ILND,XDF)=A(ILND,XDF)+S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
4700          CONTINUE
              GOTO 605
 625          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4710 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JJ))*VAL1+(BETA(IJ)-BETA(JJ))*(VAL1+VAL2)
     2          +ETA(IL)-ZETA(IL,JOR))
                A(ILND,XDF)=A(ILND,XDF)+S(JJ,IDF)*((ALPHA(IJ)-ALPHA
     *          (JL))*VAL2+(BETA(IJ)-BETA(JL))*VAL1)
 4710         CONTINUE
              E11(IOR,LOR)=E11(IOR,LOR)+A2*VAL2-VAL1
              E11(LOR,IOR)=E11(LOR,IOR)+A2*VAL2-VAL1
              E22(IOR,LOR)=E22(IOR,LOR)+A2*VAL2-VAL1
              E22(LOR,IOR)=E22(LOR,IOR)+A2*VAL2-VAL1
              GOTO 605
 635          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','TWELVTH+1  '
              CALL ABORTS
 645          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4720 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(LL,IDF)*((ALPHA(IL)-ALPHA
     *          (JL))*VAL2+(BETA(IL)-BETA(JL))*VAL1)
                A(ILND,XDF)=A(ILND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL1+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
 4720         CONTINUE
              E11(IOR,JOR)=E11(IOR,JOR)+VAL2*A2-VAL1
              E11(JOR,IOR)=E11(JOR,IOR)+VAL2*A2-VAL1
              E22(IOR,JOR)=E22(IOR,JOR)+VAL2*A2-VAL1
              E22(JOR,IOR)=E22(JOR,IOR)+VAL2*A2-VAL1
              GOTO 605
 655          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','TWELVTH+1  '
              CALL ABORTS
 665          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','TWELVTH+1  '
              CALL ABORTS
 675          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','TWELVTH    '
              CALL ABORTS
 605          CONTINUE
 4690       CONTINUE
 4650     CONTINUE
 4610   CONTINUE
C     SKIP I,UOC,UOC,UOC PART
        DO 4730 JOR=NUOC,1,-1
          IF(IGRP.NE.IJGRP(IOFF(IOR)+JOR))THEN
CIBM        CALL RGETSA(IT52,IX)
CIBM        WRITE(NOUT,2016) IX
C2016       FORMAT(/'  SKIPPING AT ADR',I8)
CIBM        CALL LREADW(IT52,INTS,NMAX*2)
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IOFF(IOR)+JOR)
          END IF
4730    CONTINUE
4030  CONTINUE
C
 510  CONTINUE
      IF (NALP.EQ.0) GOTO 540
C
      DO 4740 IOR=NALP,NOP,-1
        IO=IOFF(IOR)
        II=IO+IOR
        IIND=IJORD(II)
        ISM=ORBSYM(IOR)
        ITYP=1
        DO 4750 JOR=IOR,NOP,-1
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IJND=IJORD(IJ)
          JJND=IJORD(JJ)
          IF (IGRP .NE. IJGRP(IOFF(IOR)+JOR)) THEN
CIBM        CALL RGETSA(IT52,IX)
CIBM        WRITE(NOUT,2001) IX
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IOFF(IOR)+JOR)
          END IF
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
CCC   IJSYM=(ISM-1).XOR.(JSM-1)
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IOFF(IOR)+JOR)
          DO 4760 KOR=1,NUOC
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KKND=IJORD(KK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
CCC   IJKSYM=IJSYM.XOR.(KSM-1)
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
C
C  ALP-ALP-VIR-VIR
C
            DO 4770 LOR=1,KOR
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        406
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 406
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              JULIA(IJKLT)=JULIA(IJKLT)+1
              GOTO (116,126,136,146,156,166,176)IJKLT
 116          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              A(IKND,JLND)=2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JK
     *        ))*VAL1+(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(JLND,IKND)=A(IKND,JLND)
              A(ILND,JKND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL3+(BETA(IK)-BETA(KL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)
              A(JKND,ILND)=A(ILND,JKND)
              GOTO 406
 126          CONTINUE
              WRITE(NOUT,1100) 'J=K    ','THIRTEENTH '
              CALL ABORTS
 136          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              A(IKND,ILND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(II)+ALPHA(IL
     *        ))*VAL1+(BETA(IK)-BETA(KL)-BETA(II)+BETA(IL))*(VAL1+
     *        VAL2)+ETA(KL)-ZETA(KL,IOR)
              A(ILND,IKND)=A(IKND,ILND)
              GOTO 406
 146          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4780 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(JL,IDF)*(ETA(IJ)-ZETA(IJ,
     *          LOR))
                A(JLND,XDF)=A(JLND,XDF)-S(IL,IDF)*(ETA(IJ)-ZETA(IJ,
     *          LOR))
4780            CONTINUE
              A(ILND,JLND)=2*(ALPHA(IL)-ALPHA(LL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL1+(BETA(IL)-BETA(LL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)+ETA(IJ)-ZETA(IJ,LOR)
              A(JLND,ILND)=A(ILND,JLND)
              GOTO 406
 156          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','THIRTEENTH '
              CALL ABORTS
 166          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4790 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(IL,IDF)*(ETA(II)-ZETA(II,
     *          LOR))
4790          CONTINUE
              A(ILND,ILND)=ETA(LL)-ZETA(LL,IOR)+ETA(II)-ZETA(II,LOR)
     1        +2*(ALPHA(IL)+ALPHA(IL)-ALPHA(II)-ALPHA(LL))*VAL1
     2        +(BETA(IL)+BETA(IL)-BETA(II)-BETA(LL))*(VAL1+VAL2)
              GOTO 406
 176          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','THIRTEENTH '
              CALL ABORTS
 406          CONTINUE
 4770       CONTINUE
 4760     CONTINUE
          DO 4800 KOR=LFERM,NDOC
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            KSM=ORBSYM(KOR)
CCC   IJKSYM=IJSYM.XOR.(KSM-1)
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
C
C  ALP-ALP-DOC-VIR
C
            DO 4810 LOR=1,NUOC
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        407
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 407
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              JULIA(IJKLT+7)=JULIA(IJKLT+7)+1
              GOTO (117,127,137,147,157,167,177)IJKLT
 117          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 4820 IDF=1,NDF
                XDF=IDF+IJIND2
C     A(IKND,XDF)=A(IKND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-ALPHA(JK))*VAL1
C    1                               +(BETA(IJ)-BETA(JK))*(VAL2+VAL3))
                A(ILND,XDF)=A(ILND,XDF)-S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
C     A(JKND,XDF)=A(JKND,XDF)+S(IL,IDF)*(2*(ALPHA(IJ)-ALPHA(IK))*VAL3
C    1                               +(BETA(IJ)-BETA(IK))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)-S(IK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL3))
                A(KLND,XDF)=A(KLND,XDF)-S(IJ,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(IL))*VAL2+(BETA(IK)-BETA(IL))*(VAL1+VAL3))
4820          CONTINUE
              A(IKND,JLND)=2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JK
     *        ))*VAL1+(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(IKND,JLND)=-A(IKND,JLND)
              A(JLND,IKND)=A(IKND,JLND)
              A(ILND,JKND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL3+(BETA(IK)-BETA(KL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)
              A(ILND,JKND)=-A(ILND,JKND)
              A(JKND,ILND)=A(ILND,JKND)
              GOTO 407
 127          CONTINUE
              WRITE(NOUT,1100) 'J=K    ','FOURTEENTH '
              CALL ABORTS
 137          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4830 IDF=1,NDF
                XDF=IDF+IJIND2
C     A(IKND,XDF)=A(IKND,XDF)+S(IL,IDF)*(2*(ALPHA(II)-ALPHA(IK))*VAL1
C    1                               +(BETA(II)-BETA(IK))*(VAL1+VAL2)
C    2                               -ETA(KL)+ZETA(KL,IOR))
                A(ILND,XDF)=A(ILND,XDF)-S(IK,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IL))*VAL1+(BETA(II)-BETA(IL))*(VAL1+VAL2)
     2          -ETA(KL)+ZETA(KL,IOR))
                A(KLND,XDF)=A(KLND,XDF)-S(II,IDF)*((ALPHA(IK)-ALPHA
     *          (IL))*VAL2+(BETA(IK)-BETA(IL))*VAL1)
 4830         CONTINUE
              A(IKND,ILND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(II)+ALPHA(IL
     *        ))*VAL1+(BETA(IK)-BETA(KL)-BETA(II)+BETA(IL))*(VAL1+
     *        VAL2)+ETA(KL)-ZETA(KL,IOR)
              A(IKND,ILND)=-A(IKND,ILND)
              A(ILND,IKND)=A(IKND,ILND)
              GOTO 407
 147          CONTINUE
              WRITE(NOUT,1100) 'K=L    ','FOURTEENTH '
              CALL ABORTS
 157          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','FOURTEENTH '
              CALL ABORTS
 167          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','FOURTEENTH '
              CALL ABORTS
 177          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','FOURTEENTH '
              CALL ABORTS
 407          CONTINUE
 4810       CONTINUE
C
C ALP-ALP-DOC-DOC
C
            DO 4840 LOR=LFERM,KOR
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        408
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 408
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              JULIA(IJKLT+14)=JULIA(IJKLT+14)+1
              GOTO (118,128,138,148,158,168,178)IJKLT
 118          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 4850 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IKND,XDF)=A(IKND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JK))*VAL1+(BETA(IJ)-BETA(JK))*(VAL2+VAL3))
                A(ILND,XDF)=A(ILND,XDF)+S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JKND,XDF)=A(JKND,XDF)+S(IL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IK))*VAL3+(BETA(IJ)-BETA(IK))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)+S(IK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL3))
4850          CONTINUE
              A(IKND,JLND)=2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JK
     *        ))*VAL1+(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(JLND,IKND)=A(IKND,JLND)
              A(ILND,JKND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL3+(BETA(IK)-BETA(KL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)
              A(JKND,ILND)=A(ILND,JKND)
              GOTO 408
 128          CONTINUE
              WRITE(NOUT,1100) 'J=K    ','FIFTEENTH  '
              CALL ABORTS
 138          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4860 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IKND,XDF)=A(IKND,XDF)+S(IL,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IK))*VAL1+(BETA(II)-BETA(IK))*(VAL1+VAL2)
     2          -ETA(KL)+ZETA(KL,IOR))
                A(ILND,XDF)=A(ILND,XDF)+S(IK,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IL))*VAL1+(BETA(II)-BETA(IL))*(VAL1+VAL2)
     2          -ETA(KL)+ZETA(KL,IOR))
 4860         CONTINUE
              A(IKND,ILND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(II)+ALPHA(IL
     *        ))*VAL1+(BETA(IK)-BETA(KL)-BETA(II)+BETA(IL))*(VAL1+
     *        VAL2)+ETA(KL)-ZETA(KL,IOR)
              A(ILND,IKND)=A(IKND,ILND)
              GOTO 408
 148          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4870 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL1+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)+S(IL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL1+VAL2))
 4870         CONTINUE
              A(ILND,JLND)=2*(ALPHA(IL)-ALPHA(LL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL1+(BETA(IL)-BETA(LL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)+ETA(IJ)-ZETA(IJ,LOR)
              A(JLND,ILND)=A(ILND,JLND)
              GOTO 408
 158          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','FIFTEENTH '
              CALL ABORTS
 168          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 4880 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)+S(IL,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IL))*VAL1+(BETA(II)-BETA(IL))*(VAL1+VAL2)
     2          -ETA(LL)+ZETA(LL,IOR))
4880          CONTINUE
              A(ILND,ILND)=ETA(LL)-ZETA(LL,IOR)+ETA(II)-ZETA(II,LOR)
     1        +2*(ALPHA(IL)+ALPHA(IL)-ALPHA(II)-ALPHA(LL))*VAL1
     2        +(BETA(IL)+BETA(IL)-BETA(II)-BETA(LL))*(VAL1+VAL2)
              GOTO 408
 178          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','FIFTEENTH '
              CALL ABORTS
 408          CONTINUE
 4840       CONTINUE
 4800     CONTINUE
          DO 4890 KOR=NOP,JOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            KSM=ORBSYM(KOR)
CCC   IJKSYM=IJSYM.XOR.(KSM-1)
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
C
C  ALP-ALP-DOC-(VIR+DOC)
C
            DO 4900 LOR=1,NDOC
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        607
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 607
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              JULIA(IJKLT+21)=JULIA(IJKLT+21)+1
              GOTO (717,727,737,747,757,767,777)IJKLT
 717          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 5010 IDF=1,NDF
                XDF=IDF+IJIND2
                IF(LOR.GT.NUOC)THEN
                  SIG=A1
                ELSE
                  SIG=-A1
                END IF
                A(ILND,XDF)=A(ILND,XDF)+S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
     2          *SIG
                A(JLND,XDF)=A(JLND,XDF)+S(IK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL3))
     2          *SIG
                A(KLND,XDF)=A(KLND,XDF)+S(IJ,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(IL))*VAL2+(BETA(IK)-BETA(IL))*(VAL1+VAL3))
     2          *SIG
 5010         CONTINUE
              GOTO 607
 727          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 5020 IDF=1,NDF
                XDF=IDF+IJIND2
                IF(LOR.GT.NUOC)THEN
                  SIG=A1
                ELSE
                  SIG=-A1
                END IF
                A(ILND,XDF)=A(ILND,XDF)+S(JJ,IDF)*((ALPHA(IJ)-ALPHA
     *          (JL))*VAL2+(BETA(IJ)-BETA(JL))*VAL1)
     2          *SIG
                A(JLND,XDF)=A(JLND,XDF)+S(IJ,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL1))
     2          *SIG
5020          CONTINUE
              GOTO 607
 737          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 5030 IDF=1,NDF
                XDF=IDF+IJIND2
                IF(LOR.GT.NUOC)THEN
                  SIG=A1
                ELSE
                  SIG=-A1
                END IF
                A(ILND,XDF)=A(ILND,XDF)+S(IK,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IL))*VAL1+(BETA(II)-BETA(IL))*(VAL1+VAL2)
     1          -ETA(KL)+ZETA(KL,IOR))*SIG
                A(KLND,XDF)=A(KLND,XDF)+S(II,IDF)*((ALPHA(IK)-ALPHA
     *          (IL))*VAL2+(BETA(IK)-BETA(IL))*VAL1)*SIG
 5030         CONTINUE
              GOTO 607
 747          CONTINUE
              WRITE(NOUT,1100) 'K=L    ','FIFTEENTH+1'
              CALL ABORTS
 757          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 5040 IDF=1,NDF
                XDF=IDF+IJIND2
                IF(LOR.GT.NUOC)THEN
                  SIG=A1
                ELSE
                  SIG=-A1
                END IF
                A(ILND,XDF)=A(ILND,XDF)+S(II,IDF)*((ALPHA(II)-ALPHA
     *          (IL))*VAL1+(BETA(II)-BETA(IL))*VAL1)*SIG
                IF(LOR.GT.NUOC)THEN
                  A(ILND,XDF)=A(ILND,XDF)+S(LL,IDF)*((ALPHA(IL)-
     *            ALPHA(LL))*VAL2+(BETA(IL)-BETA(LL))*VAL2)
                END IF
5040          CONTINUE
              GOTO 607
 767          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','FIFTEENTH+1'
              CALL ABORTS
 777          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','FIFTEENTH+1'
              CALL ABORTS
 607          CONTINUE
 4900       CONTINUE
 4890     CONTINUE
 4750  CONTINUE
C
        DO 5050 JOR=NDOC,LFERM,-1
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IJND=IJORD(IJ)
          JJND=IJORD(JJ)
          IF (IGRP .NE. IJGRP(IOFF(IOR)+JOR)) THEN
CIBM        CALL RGETSA(IT52,IX)
CIBM        WRITE(NOUT,2001) IX
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IOFF(IOR)+JOR)
          END IF
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
CCC   IJSYM=(ISM-1).XOR.(JSM-1)
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IOFF(IOR)+JOR)
          DO 5060 KOR=1,NUOC
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KKND=IJORD(KK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
CCC   IJKSYM=IJSYM.XOR.(KSM-1)
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
C
C  ALP-DOC-VIR-VIR
C
            DO 5070 LOR=1,KOR
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        409
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 409
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              JULIA(IJKLT+28)=JULIA(IJKLT+28)+1
              GOTO (119,129,139,149,159,169,179)IJKLT
 119          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              A(IKND,JLND)=2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JK
     *        ))*VAL1+(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(JLND,IKND)=A(IKND,JLND)
              A(ILND,JKND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL3+(BETA(IK)-BETA(KL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)
              A(JKND,ILND)=A(ILND,JKND)
              GOTO 409
 129          CONTINUE
              WRITE(NOUT,1100) 'J=K    ','SIXTEENTH  '
              CALL ABORTS
 139          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','SIXTEENTH  '
              CALL ABORTS
 149          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 5080 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(JL,IDF)*(ETA(IJ)-ZETA(IJ,
     *          LOR))
                A(JLND,XDF)=A(JLND,XDF)-S(IL,IDF)*(ETA(IJ)-ZETA(IJ,
     *          LOR))
5080          CONTINUE
              A(ILND,JLND)=2*(ALPHA(IL)-ALPHA(LL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL1+(BETA(IL)-BETA(LL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)+ETA(IJ)-ZETA(IJ,LOR)
              A(JLND,ILND)=A(ILND,JLND)
              GOTO 409
 159          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','SIXTEENTH  '
              CALL ABORTS
 169          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','SIXTEENTH  '
              CALL ABORTS
 179          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','SIXTEENTH  '
              CALL ABORTS
 409          CONTINUE
 5070       CONTINUE
 5060     CONTINUE
          DO 5090 KOR=LFERM,JOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            KSM=ORBSYM(KOR)
CCC   IJKSYM=IJSYM.XOR.(KSM-1)
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
C
C  ALP-DOC-DOC-VIR
C
            DO 6100 LOR=1,NUOC
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        410
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 410
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              JULIA(IJKLT+35)=JULIA(IJKLT+35)+1
              GOTO (211,221,231,241,251,261,271)IJKLT
 211          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 6110 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)-S(IK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL3))
                A(KLND,XDF)=A(KLND,XDF)-S(IJ,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(IL))*VAL2+(BETA(IK)-BETA(IL))*(VAL1+VAL3))
 6110         CONTINUE
              A(IJND,KLND)=2*(ALPHA(IL)-ALPHA(JL)-ALPHA(IK)+ALPHA(JK
     *        ))*VAL2+(BETA(IL)-BETA(JL)-BETA(IK)+BETA(JK))*(VAL1+
     *        VAL3)
              A(IJND,KLND)=-A(IJND,KLND)
              A(KLND,IJND)=A(IJND,KLND)
              A(IKND,JLND)=2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JK
     *        ))*VAL1+(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(IKND,JLND)=-A(IKND,JLND)
              A(JLND,IKND)=A(IKND,JLND)
              GOTO 410
 221          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 6120 IDF=1,NDF
                XDF=IDF+IJIND2
C     A(IJND,XDF)=A(IJND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-ALPHA(JJ))*VAL1
C    1                               +(BETA(IJ)-BETA(JJ))*(VAL1+VAL2)
C    2                               +ETA(IL)-ZETA(IL,JOR))
                A(ILND,XDF)=A(ILND,XDF)-S(JJ,IDF)*((ALPHA(IJ)-ALPHA
     *          (JL))*VAL2+(BETA(IJ)-BETA(JL))*VAL1)
                A(JLND,XDF)=A(JLND,XDF)-S(IJ,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL1))
 6120         CONTINUE
              A(IJND,JLND)=2*(ALPHA(IL)-ALPHA(JL)-ALPHA(IJ)+ALPHA(JJ
     *        ))*VAL1+(BETA(IL)-BETA(JL)-BETA(IJ)+BETA(JJ))*(VAL1+
     *        VAL2)-ETA(IL)+ZETA(IL,JOR)
              A(IJND,JLND)=-A(IJND,JLND)
              A(JLND,IJND)=A(IJND,JLND)
              GOTO 410
 231          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','SEVENTEENTH'
              CALL ABORTS
 241          CONTINUE
              WRITE(NOUT,1100) 'K=L    ','SEVENTEENTH'
              CALL ABORTS
 251          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','SEVENTEENTH'
              CALL ABORTS
 261          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','SEVENTEENTH'
              CALL ABORTS
 271          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','SEVENTEENTH'
              CALL ABORTS
 410          CONTINUE
 6100       CONTINUE
C
C ALP-DOC-DOC-DOC
C
            DO 6130 LOR=LFERM,KOR
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        710
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 710
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              JULIA(IJKLT+42)=JULIA(IJKLT+42)+1
              GOTO (711,721,731,741,751,761,771)IJKLT
 711          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 6140 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(KL,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(JK))*VAL2+(BETA(IK)-BETA(JK))*(VAL1+VAL3))
                A(IKND,XDF)=A(IKND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JK))*VAL1+(BETA(IJ)-BETA(JK))*(VAL2+VAL3))
                A(ILND,XDF)=A(ILND,XDF)+S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
 6140         CONTINUE
              GOTO 710
 721          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 6150 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JJ))*VAL1+(BETA(IJ)-BETA(JJ))*(VAL1+VAL2)
     2          +ETA(IL)-ZETA(IL,JOR))
                A(ILND,XDF)=A(ILND,XDF)+S(JJ,IDF)*((ALPHA(IJ)-ALPHA
     *          (JL))*VAL2+(BETA(IJ)-BETA(JL))*VAL1)
 6150         CONTINUE
              GOTO 710
 731          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','SEVENTNTH+1'
              CALL ABORTS
 741          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 6160 IDF=1,NDF
                XDF=IDF+IJIND2
                A(IJND,XDF)=A(IJND,XDF)+S(LL,IDF)*((ALPHA(IL)-ALPHA
     *          (JL))*VAL2+(BETA(IL)-BETA(JL))*VAL1)
                A(ILND,XDF)=A(ILND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL1+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
 6160         CONTINUE
              GOTO 710
 751          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','SEVENTNTH+1'
              CALL ABORTS
 761          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','SEVENTNTH+1'
              CALL ABORTS
 771          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','SEVENTNTH+1'
              CALL ABORTS
 710          CONTINUE
 6130       CONTINUE
 5090     CONTINUE
 5050   CONTINUE
C     SKIP I,UOC,UOC,UOC PART
        DO 6170 JOR=NUOC,1,-1
          IF(IGRP.NE.IJGRP(IOFF(IOR)+JOR))THEN
CIBM        CALL RGETSA(IT52,IX)
CIBM        WRITE(NOUT,2016) IX
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IOFF(IOR)+JOR)
          END IF
6170    CONTINUE
4740  CONTINUE
C
 540  CONTINUE
C
      RETURN
      END
 
C    LIBRARY 4 OF GRCPHF
C**********************************************************************
C*   NOTICE OF PROGRAM MODIFICATION                                   *
C**********************************************************************
C*  BY:  RICHARD REMINGTON                         SEARCH:  C3-24-88  *
C*  DATE:  MARCH  24,  1988                                           *
C*  REASON: MIGRATION TO RUN IN 7MB ON 9370                           *
C**********************************************************************
C     PROGRAM LAST UPDATED FEBRUARY 21, 1985                          *
C     BY: RICHARD REMINGTON                                           *
C**********************************************************************
      SUBROUTINE GTINT4(A,ETA,ZETA,F,ALPHA,BETA,IJORD,KADD,LADD,
     1IJADD,IJGRP,ORBSYM,INTS,BUF,ORBTBF,JCODE,EIG,S,EPA,W,JT1C,
     1IOFF,E11,E22,E12)
      IMPLICIT INTEGER (A-Z)
CJ    EXTENDED DUMMY A,ETA,ZETA,F,ALPHA,BETA,INTS,BUF,EIG,S,EPA,W,
CJ   1E11,E22,E12
      LOGICAL IJEQ,IJKEQ,JKEQ
      INTEGER XDF,N112(112),FCB2(16),JULIA(70)
      REAL*8 A0,A1,A2,A1S2,A4,FOCC
      DIMENSION IJORD(NUMIJ),KADD(SYMORB),LADD(SYMORB),JT1C(1)
      DIMENSION ORBSYM(NORBS),IJADD(NUMIJ),IJGRP(NUMIJ)
      DIMENSION ORBTBF(NORBS),JCODE(NORBS),IOFF(NUMIJ)
      REAL*8 A(IJIND,IJIND3),F(NORBS),INTS(NMAX),EIG(NORBS)
     1,S(NUMIJ,NDF),EPA(NORBS,NORBS),E11(NORBS,NORBS),
     2E22(NORBS,NORBS),E12(NORBS,NORBS)
      REAL*8 ZETA(NUMIJ,NORBS),ALPHA(NUMIJ),BETA(NUMIJ)
      REAL*8 W(NORBS,NORBS,NDF),SIG,H11,H22,H12,HD,C1,C2
      REAL*8 C1A,C2A,HA1,HA12,HA2
      REAL*8 VAL1,VAL2,VAL3,BUF(NUMIJ),ETA(NUMIJ),ESCF,REPNUC
      COMMON /CIA/ C1A(45),C2A(45),C1,C2,ESCF
      COMMON /CIDERS/ HA1(45),HA12(45),HA2(45),H11,H12,H22
C!!!  COMMON /TAPES/     ,   ,NOUT,IT2,    ,JTAP1,     ,   OLD TAPS USED
C!!!  COMMON /TAPES/ IT22,IT8,NOUT,IT2,IT42,JTAP1,IUTAP,JTAP2
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ SYMORB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /POINT/ FOCC(5),IPOINT(5),JPOINT(5),NSORB(5)
      COMMON /FUNCS/ IOCC,JOCC,KOCC,NTYPES,NBSET,NAT
      COMMON /OCCS/ NSPE,NSA,NSB,NALP,NOP,NDOC,LFERM,NUOC,IJIND,IJIND3
      COMMON /LOC22/ IA22(100),IBF2AT(284)
      COMMON /IEXT/ IPRINT,IGRP
      COMMON /REN/ REPNUC
C
      WRITE(ICHK,2222)
 2222 FORMAT(/'  IN GTINT4')
      WRITE(NOUT,2222)
 3001 FORMAT(10I5)
      DO 4000 IJUL=1,70
        JULIA(IJUL)=0
 4000 CONTINUE
      WRITE(NOUT,*) '   THE SPECIAL PARAMETERS '
      WRITE(NOUT,3001) NSPE,NSA,NSB,NALP,NOP,NDOC,
     +                 LFERM,NUOC,IJIND,IJIND3
      WRITE(NOUT,*) '   THE IJORD ARRAY:'
      WRITE(NOUT,3001) (IJORD(III), III=1,NUMIJ)
      IJIND2=IJIND
      A0=0.0D+00
      A1=1.0D+00
      A2=2.0D+00
      A4=4.00D+00
      A1S2=0.50D+00
      DO 3030 II=1,NDF
        DO 3040 I=1,NORBS
          DO 3050 J=1,NORBS
            W(I,J,II)=A0
 3050     CONTINUE
 3040   CONTINUE
 3030 CONTINUE
      ESCF=A0
C
 1100 FORMAT(/'  IN THE CONSRTUCTION OF THE A MATRIX, THE CASE ',A7
     1/'  IS NOT POSSIBLE IN THE ',A11,' SET OF LOOPS.'/'  ERROR IN LOOP
     * STRUCTURE SOMEWHERE.')
      DO 6180 IOR=NDOC,LFERM,-1
        IO=IOFF(IOR)
        II=IO+IOR
        IIND=IJORD(II)
        ISM=ORBSYM(IOR)
        ITYP=1
        DO 6190 JOR=IOR,LFERM,-1
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IJND=IJORD(IJ)
          JJND=IJORD(JJ)
          IF (IGRP .NE. IJGRP(IOFF(IOR)+JOR)) THEN
CIBM        CALL RGETSA(IT52,IX)
CIBM        WRITE(NOUT,2001) IX
            PRINT *,' SREAD 1'
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IOFF(IOR)+JOR)
          END IF
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
CCC   IJSYM=(ISM-1).XOR.(JSM-1)
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IOFF(IOR)+JOR)
          DO 6200 KOR=1,NUOC
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KKND=IJORD(KK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
CCC   IJKSYM=IJSYM.XOR.(KSM-1)
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
C
C  DOC-DOC-VIR-VIR
C
            DO 6210 LOR=1,KOR
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        411
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 411
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              JULIA(IJKLT+49)=JULIA(IJKLT+49)+1
              GOTO (212,222,232,242,252,262,272)IJKLT
 212          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C     DO IDF=1,NDF
C     XDF=IDF+IJIND2
C     A(IKND,XDF)=A(IKND,XDF)+S(JL,IDF)*(2*(ALPHA(IJ)-ALPHA(JK))*VAL1
C    1                               +(BETA(IJ)-BETA(JK))*(VAL2+VAL3))
C     A(ILND,XDF)=A(ILND,XDF)+S(JK,IDF)*(2*(ALPHA(IJ)-ALPHA(JL))*VAL3
C    1                               +(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
C     A(JKND,XDF)=A(JKND,XDF)+S(IL,IDF)*(2*(ALPHA(IJ)-ALPHA(IK))*VAL3
C    1                               +(BETA(IJ)-BETA(IK))*(VAL1+VAL2))
C     A(JLND,XDF)=A(JLND,XDF)+S(IK,IDF)*(2*(ALPHA(IJ)-ALPHA(IL))*VAL1
C    1                               +(BETA(IJ)-BETA(IL))*(VAL2+VAL3))
C     END DO
              A(IKND,JLND)=2*(ALPHA(IL)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JK
     *        ))*VAL1+(BETA(IL)-BETA(KL)-BETA(IJ)+BETA(JK))*(VAL2+
     *        VAL3)
              A(JLND,IKND)=A(IKND,JLND)
              A(ILND,JKND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL3+(BETA(IK)-BETA(KL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)
              A(JKND,ILND)=A(ILND,JKND)
              GOTO 411
 222          CONTINUE
              WRITE(NOUT,1100) 'J=K    ','EIGHTEENTH '
              CALL ABORTS
 232          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              A(IKND,ILND)=2*(ALPHA(IK)-ALPHA(KL)-ALPHA(II)+ALPHA(IL
     *        ))*VAL1+(BETA(IK)-BETA(KL)-BETA(II)+BETA(IL))*(VAL1+
     *        VAL2)+ETA(KL)-ZETA(KL,IOR)
              A(ILND,IKND)=A(IKND,ILND)
              GOTO 411
 242          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 6220 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(JL,IDF)*(ETA(IJ)-ZETA(IJ,
     *          LOR))
                A(JLND,XDF)=A(JLND,XDF)-S(IL,IDF)*(ETA(IJ)-ZETA(IJ,
     *          LOR))
6220          CONTINUE
              A(ILND,JLND)=2*(ALPHA(IL)-ALPHA(LL)-ALPHA(IJ)+ALPHA(JL
     *        ))*VAL1+(BETA(IL)-BETA(LL)-BETA(IJ)+BETA(JL))*(VAL1+
     *        VAL2)+ETA(IJ)-ZETA(IJ,LOR)
              A(JLND,ILND)=A(ILND,JLND)
              GOTO 411
 252          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','EIGHTEENTH '
              CALL ABORTS
 262          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 6230 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(IL,IDF)*(ETA(II)-ZETA(II,
     *          LOR))
 6230         CONTINUE
              A(ILND,ILND)=ETA(LL)-ZETA(LL,IOR)+ETA(II)-ZETA(II,LOR)
     1        +2*(ALPHA(IL)+ALPHA(IL)-ALPHA(II)-ALPHA(LL))*VAL1
     2        +(BETA(IL)+BETA(IL)-BETA(II)-BETA(LL))*(VAL1+VAL2)
              GOTO 411
 272          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','EIGHTEENTH '
              CALL ABORTS
 411          CONTINUE
 6210       CONTINUE
 6200     CONTINUE
          DO 6240 KOR=LFERM,JOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KKND=IJORD(KK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
CCC   IJKSYM=IJSYM.XOR.(KSM-1)
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
C
C  DOC-DOC-DOC-DOC
C
            DO 6250 LOR=LFERM,KOR
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        6080
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 6080
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=IOFF(LOR)+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              JULIA(IJKLT+56)=JULIA(IJKLT+56)+1
              GOTO (6080,6082,6083,6084,6085,6086,6087)IJKLT
 6082         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              E11(IOR,LOR)=E11(IOR,LOR)+A2*VAL2-VAL1
              E22(IOR,LOR)=E22(IOR,LOR)+A2*VAL2-VAL1
              E11(LOR,IOR)=E11(LOR,IOR)+A2*VAL2-VAL1
              E22(LOR,IOR)=E22(LOR,IOR)+A2*VAL2-VAL1
              GOTO 6080
 6083         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              E11(LOR,KOR)=E11(LOR,KOR)+A2*VAL2-VAL1
              E22(LOR,KOR)=E22(LOR,KOR)+A2*VAL2-VAL1
              E11(KOR,LOR)=E11(KOR,LOR)+A2*VAL2-VAL1
              E22(KOR,LOR)=E22(KOR,LOR)+A2*VAL2-VAL1
              GOTO 6080
 6084         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              E11(IOR,JOR)=E11(IOR,JOR)+A2*VAL2-VAL1
              E22(IOR,JOR)=E22(IOR,JOR)+A2*VAL2-VAL1
              E11(JOR,IOR)=E11(JOR,IOR)+A2*VAL2-VAL1
              E22(JOR,IOR)=E22(JOR,IOR)+A2*VAL2-VAL1
              GOTO 6080
 6085         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              E11(IOR,LOR)=E11(IOR,LOR)+VAL2+VAL1+VAL3
              E22(IOR,LOR)=E22(IOR,LOR)+VAL2+VAL1+VAL3
              E11(LOR,IOR)=E11(LOR,IOR)+VAL2+VAL1+VAL3
              E22(LOR,IOR)=E22(LOR,IOR)+VAL2+VAL1+VAL3
              GOTO 6080
 6086         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              H11=H11+A4*VAL2-A2*VAL1
              H22=H22+A4*VAL2-A2*VAL1
              E11(IOR,IOR)=E11(IOR,IOR)+A2*VAL2-VAL1
              E22(IOR,IOR)=E22(IOR,IOR)+A2*VAL2-VAL1
              E11(KOR,KOR)=E11(KOR,KOR)+A2*VAL2-VAL1
              E22(KOR,KOR)=E22(KOR,KOR)+A2*VAL2-VAL1
              GOTO6080
 6087         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              H22=H22+VAL1+A2*VAL2
              H11=H11+VAL1+A2*VAL2
              E11(IOR,IOR)=E11(IOR,IOR)+VAL1+VAL2
              E22(IOR,IOR)=E22(IOR,IOR)+VAL1+VAL2
 6080         CONTINUE
 6250         CONTINUE
C
C  DOC-DOC-DOC-VIR
C
            DO 6260 LOR=1,NUOC
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              LLND=IJORD(LL)
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        811
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 811
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              JULIA(IJKLT+63)=JULIA(IJKLT+63)+1
              GOTO (712,722,732,742,752,762,772)IJKLT
 712          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 6270 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(JK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(JL))*VAL3+(BETA(IJ)-BETA(JL))*(VAL1+VAL2))
                A(JLND,XDF)=A(JLND,XDF)-S(IK,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL3))
                A(KLND,XDF)=A(KLND,XDF)-S(IJ,IDF)*(2*(ALPHA(IK)-
     *          ALPHA(IL))*VAL2+(BETA(IK)-BETA(IL))*(VAL1+VAL3))
6270          CONTINUE
              GOTO 811
 722          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 8037 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(JJ,IDF)*((ALPHA(IJ)-ALPHA
     *          (JL))*VAL2+(BETA(IJ)-BETA(JL))*VAL1)
                A(JLND,XDF)=A(JLND,XDF)-S(IJ,IDF)*(2*(ALPHA(IJ)-
     *          ALPHA(IL))*VAL1+(BETA(IJ)-BETA(IL))*(VAL2+VAL1))
8037          CONTINUE
              E11(LOR,IOR)=E11(LOR,IOR)+A2*VAL2-VAL1
              E22(LOR,IOR)=E22(LOR,IOR)+A2*VAL2-VAL1
              GOTO 811
 732          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 6280 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(IK,IDF)*(2*(ALPHA(II)-
     *          ALPHA(IL))*VAL1+(BETA(II)-BETA(IL))*(VAL1+VAL2)
     2          -ETA(KL)+ZETA(KL,IOR))
                A(KLND,XDF)=A(KLND,XDF)-S(II,IDF)*((ALPHA(IK)-ALPHA
     *          (IL))*VAL2+(BETA(IK)-BETA(IL))*VAL1)
6280          CONTINUE
              E11(LOR,KOR)=E11(LOR,KOR)+A2*VAL2-VAL1
              E22(LOR,KOR)=E22(LOR,KOR)+A2*VAL2-VAL1
              GOTO 811
 742          CONTINUE
              WRITE(NOUT,1100) 'K=L    ','NINTEENTH  '
              CALL ABORTS
 752          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 6290 IDF=1,NDF
                XDF=IDF+IJIND2
                A(ILND,XDF)=A(ILND,XDF)-S(II,IDF)*((ALPHA(II)-ALPHA
     *          (IL))*VAL1+(BETA(II)-BETA(IL))*VAL1)
6290          CONTINUE
              E11(LOR,IOR)=E11(LOR,IOR)+VAL1+VAL3
              E22(LOR,IOR)=E22(LOR,IOR)+VAL1+VAL3
              GOTO 811
 762          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','NINETEENTH '
              CALL ABORTS
 772          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','NINETEENTH '
              CALL ABORTS
 811          CONTINUE
 6260       CONTINUE
 6240     CONTINUE
 6190   CONTINUE
C     SKIP I,UOC,UOC,UOC PART
        DO 6300 JOR=NUOC,1,-1
          IF(IGRP.NE.IJGRP(IOFF(IOR)+JOR))THEN
CIBM        CALL RGETSA(IT52,IX)
CIBM       WRITE(NOUT,2016) IX
            PRINT *,' SREAD 2'
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IOFF(IOR)+JOR)
          END IF
6300    CONTINUE
6180  CONTINUE
      IF (IAND(IPRINT,128) .NE. 0) THEN
 1630 FORMAT(/'  JULIA ARRAY FOR TYPE ',A15/7I8)
      WRITE(NOUT,1630) 'ALP-ALP-VIR-VIR',(JULIA(IJUL),IJUL=1,7)
      WRITE(NOUT,1630) 'ALP-ALP-DOC-VIR',(JULIA(IJUL),IJUL=8,14)
      WRITE(NOUT,1630) 'ALP-ALP-DOC-DOC',(JULIA(IJUL),IJUL=15,21)
      WRITE(NOUT,1630) 'ALP-ALP-ALP-ALL',(JULIA(IJUL),IJUL=22,28)
      WRITE(NOUT,1630) 'ALP-DOC-VIR-VIR',(JULIA(IJUL),IJUL=29,35)
      WRITE(NOUT,1630) 'ALP-DOC-DOC-VIR',(JULIA(IJUL),IJUL=36,42)
      WRITE(NOUT,1630) 'ALP-DOC-DOC-DOC',(JULIA(IJUL),IJUL=43,49)
      WRITE(NOUT,1630) 'DOC-DOC-VIR-VIR',(JULIA(IJUL),IJUL=50,56)
      WRITE(NOUT,1630) 'DOC-DOC-DOC-DOC',(JULIA(IJUL),IJUL=57,63)
      WRITE(NOUT,1630) 'DOC-DOC-DOC-VIR',(JULIA(IJUL),IJUL=64,70)
      END IF
 2001       FORMAT('  READING FROM IT52 AT ADR ',I8)
 2004           FORMAT(/'  IN GETDM, IJKLT UNKNOWN TYPE ',I5/'  ORBITALS
     * :',4I5/'  BASIS FUNCTIONS :',4I5/'   SYMMETRIES :',4I5)
 2005           FORMAT(/'  IN GETDM, LAD TOO BIG :',I6)
C
C     CONSTRUCTION OF W
C
CIBM CALL RSETSA(IT52,INTSRT)
      CALL SREW(IT52)
      CALL SREAD(IT52,N112,112)
      IGRP=0
      DO 6310 IOR=NORBS,LFERM,-1
        I=IOR
        IO=IOFF(IOR)
        II=IO+IOR
        ISM=ORBSYM(IOR)
        ITYP=1
        DO 6320 JOR=IOR,LFERM,-1
          J=JOR
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IF (IGRP .NE. IJGRP(IOFF(IOR)+JOR)) THEN
CIBM        CALL RGETSA(IT52,IX)
CIBM       WRITE(NOUT,2001) IX
            PRINT *,' SREAD 3'
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IOFF(IOR)+JOR)
          END IF
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
CCC   IJSYM=(ISM-1).XOR.(JSM-1)
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IOFF(IOR)+JOR)
          DO 6330 KOR=LFERM,JOR
            K=KOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
CCC   IJKSYM=IJSYM.XOR.(KSM-1)
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
            DO 6340 LOR=LFERM,KOR
              L=LOR
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        399
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 399
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              GOTO (9001,9002,9003,9004,9005,9006,9007)IJKLT
 9001         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 6350 IDF=1,NDF
                W(I,J,IDF)=W(I,J,IDF)+S(KL,IDF)*(-4*(ALPHA(JK)+
     *          ALPHA(JL))*VAL2-2*(BETA(JK)+BETA(JL))*(VAL1+VAL3))
                W(J,I,IDF)=W(J,I,IDF)+S(KL,IDF)*(-4*(ALPHA(IK)+
     *          ALPHA(IL))*VAL2-2*(BETA(IK)+BETA(IL))*(VAL1+VAL3))
                W(I,K,IDF)=W(I,K,IDF)+S(JL,IDF)*(-4*(ALPHA(JK)+
     *          ALPHA(KL))*VAL1-2*(BETA(JK)+BETA(KL))*(VAL2+VAL3))
                W(K,I,IDF)=W(K,I,IDF)+S(JL,IDF)*(-4*(ALPHA(IJ)+
     *          ALPHA(IL))*VAL1-2*(BETA(IJ)+BETA(IL))*(VAL2+VAL3))
                W(I,L,IDF)=W(I,L,IDF)+S(JK,IDF)*(-4*(ALPHA(JL)+
     *          ALPHA(KL))*VAL3-2*(BETA(JL)+BETA(KL))*(VAL1+VAL2))
                W(L,I,IDF)=W(L,I,IDF)+S(JK,IDF)*(-4*(ALPHA(IJ)+
     *          ALPHA(IK))*VAL3-2*(BETA(IJ)+BETA(IK))*(VAL1+VAL2))
                W(J,K,IDF)=W(J,K,IDF)+S(IL,IDF)*(-4*(ALPHA(IK)+
     *          ALPHA(KL))*VAL3-2*(BETA(IK)+BETA(KL))*(VAL1+VAL2))
                W(K,J,IDF)=W(K,J,IDF)+S(IL,IDF)*(-4*(ALPHA(IJ)+
     *          ALPHA(JL))*VAL3-2*(BETA(IJ)+BETA(JL))*(VAL1+VAL2))
                W(J,L,IDF)=W(J,L,IDF)+S(IK,IDF)*(-4*(ALPHA(IL)+
     *          ALPHA(KL))*VAL1-2*(BETA(IL)+BETA(KL))*(VAL2+VAL3))
                W(L,J,IDF)=W(L,J,IDF)+S(IK,IDF)*(-4*(ALPHA(IJ)+
     *          ALPHA(JK))*VAL1-2*(BETA(IJ)+BETA(JK))*(VAL2+VAL3))
                W(K,L,IDF)=W(K,L,IDF)+S(IJ,IDF)*(-4*(ALPHA(IL)+
     *          ALPHA(JL))*VAL2-2*(BETA(IL)+BETA(JL))*(VAL1+VAL3))
                W(L,K,IDF)=W(L,K,IDF)+S(IJ,IDF)*(-4*(ALPHA(IK)+
     *          ALPHA(JK))*VAL2-2*(BETA(IK)+BETA(JK))*(VAL1+VAL3))
 6350         CONTINUE
              GOTO 399
 9002         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 6360 IDF=1,NDF
                W(I,J,IDF)=W(I,J,IDF)+S(KL,IDF)*(-4*(ALPHA(JK)+
     *          ALPHA(JL))*VAL1-2*(BETA(JK)+BETA(JL))*(VAL1+VAL2))
                W(J,I,IDF)=W(J,I,IDF)+S(KL,IDF)*(-4*(ALPHA(IK)+
     *          ALPHA(IL))*VAL1-2*(BETA(IK)+BETA(IL))*(VAL1+VAL2))
                W(J,L,IDF)=W(J,L,IDF)+S(IK,IDF)*(-4*(ALPHA(IL)+
     *          ALPHA(KL))*VAL1-2*(BETA(IL)+BETA(KL))*(VAL1+VAL2))
                W(L,J,IDF)=W(L,J,IDF)+S(IK,IDF)*(-4*(ALPHA(IJ)+
     *          ALPHA(JK))*VAL1-2*(BETA(IJ)+BETA(JK))*(VAL1+VAL2))
                W(I,L,IDF)=W(I,L,IDF)+S(JK,IDF)*(-4*ALPHA(JL)*VAL2-
     *          4*BETA(JL)*VAL1)
                W(L,I,IDF)=W(L,I,IDF)+S(JK,IDF)*(-4*ALPHA(IJ)*VAL2-
     *          4*BETA(IJ)*VAL1)
                W(J,K,IDF)=W(J,K,IDF)+S(IL,IDF)*(-4*(ALPHA(IK)+
     *          ALPHA(KL))*VAL2-4*(BETA(IK)+BETA(KL))*VAL1)
 6360         CONTINUE
              GOTO399
 9003         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 6370 IDF=1,NDF
                W(I,J,IDF)=W(I,J,IDF)+S(KL,IDF)*(-4*(ALPHA(JK)+
     *          ALPHA(JL))*VAL2-4*(BETA(JK)+BETA(JL))*VAL1)
                W(I,K,IDF)=W(I,K,IDF)+S(JL,IDF)*(-4*(ALPHA(JK)+
     *          ALPHA(KL))*VAL1-2*(BETA(JK)+BETA(KL))*(VAL1+VAL2))
                W(K,I,IDF)=W(K,I,IDF)+S(JL,IDF)*(-4*(ALPHA(IJ)+
     *          ALPHA(IL))*VAL1-2*(BETA(IJ)+BETA(IL))*(VAL1+VAL2))
                W(I,L,IDF)=W(I,L,IDF)+S(JK,IDF)*(-4*(ALPHA(JL)+
     *          ALPHA(KL))*VAL1-2*(BETA(JL)+BETA(KL))*(VAL1+VAL2))
                W(L,I,IDF)=W(L,I,IDF)+S(JK,IDF)*(-4*(ALPHA(IJ)+
     *          ALPHA(IK))*VAL1-2*(BETA(IJ)+BETA(IK))*(VAL1+VAL2))
                W(K,L,IDF)=W(K,L,IDF)+S(IJ,IDF)*(-4*ALPHA(IL)*VAL2-
     *          4*BETA(IL)*VAL1)
                W(L,K,IDF)=W(L,K,IDF)+S(IJ,IDF)*(-4*ALPHA(IK)*VAL2-
     *          4*BETA(IK)*VAL1)
 6370         CONTINUE
              GOTO 399
 9004         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 6380 IDF=1,NDF
                W(I,J,IDF)=W(I,J,IDF)+S(KL,IDF)*(-4*ALPHA(JK)*VAL2-
     *          4*BETA(JK)*VAL1)
                W(J,I,IDF)=W(J,I,IDF)+S(KL,IDF)*(-4*ALPHA(IK)*VAL2
     1          -4*BETA(IK)*VAL1)
                W(I,K,IDF)=W(I,K,IDF)+S(JL,IDF)*(-4*(ALPHA(JK)+
     *          ALPHA(KL))*VAL1-2*(BETA(JK)+BETA(KL))*(VAL1+VAL2))
                W(K,I,IDF)=W(K,I,IDF)+S(JL,IDF)*(-4*(ALPHA(IJ)+
     *          ALPHA(IL))*VAL1-2*(BETA(IJ)+BETA(IL))*(VAL1+VAL2))
                W(J,K,IDF)=W(J,K,IDF)+S(IL,IDF)*(-4*(ALPHA(IK)+
     *          ALPHA(KL))*VAL1-2*(BETA(IK)+BETA(KL))*(VAL1+VAL2))
                W(K,J,IDF)=W(K,J,IDF)+S(IL,IDF)*(-4*(ALPHA(IJ)+
     *          ALPHA(JL))*VAL1-2*(BETA(IJ)+BETA(JL))*(VAL1+VAL2))
                W(K,L,IDF)=W(K,L,IDF)+S(IJ,IDF)*(-4*(ALPHA(IL)+
     *          ALPHA(JL))*VAL2-4*(BETA(IL)+BETA(JL))*VAL1)
 6380         CONTINUE
              GOTO 399
 9005         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 6390 IDF=1,NDF
                W(I,J,IDF)=W(I,J,IDF)+S(KL,IDF)*(-4*(ALPHA(JK)+
     *          ALPHA(JL))*VAL1-4*(BETA(JK)+BETA(JL))*VAL1)
                W(I,L,IDF)=W(I,L,IDF)+S(JK,IDF)*(-4*ALPHA(JL)*VAL1-
     *          4*BETA(JL)*VAL1)
                W(L,I,IDF)=W(L,I,IDF)+S(JK,IDF)*(-4*ALPHA(IJ)*VAL1
     1          -4*BETA(IJ)*VAL1)
                W(I,L,IDF)=W(I,L,IDF)+S(LL,IDF)*(-4*ALPHA(LL)*VAL2-
     *          4*BETA(LL)*VAL2)
                W(L,I,IDF)=W(L,I,IDF)+S(LL,IDF)*(-4*ALPHA(IL)*VAL2-
     *          4*BETA(IL)*VAL2)
                W(L,L,IDF)=W(L,L,IDF)+S(IL,IDF)*(-4*(ALPHA(IL)+
     *          ALPHA(LL))*VAL2-4*(BETA(IL)+BETA(LL))*VAL2)
 6390         CONTINUE
              GOTO 399
 9006         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 6400 IDF=1,NDF
                W(I,J,IDF)=W(I,J,IDF)+S(KL,IDF)*(-4*ALPHA(JK)*VAL2-
     *          4*BETA(JK)*VAL1)
                W(I,K,IDF)=W(I,K,IDF)+S(JL,IDF)*(-4*(ALPHA(JK)+
     *          ALPHA(KL))*VAL1-2*(BETA(JK)+BETA(KL))*(VAL2+VAL1))
                W(K,I,IDF)=W(K,I,IDF)+S(JL,IDF)*(-4*(ALPHA(IJ)+
     *          ALPHA(IL))*VAL1-2*(BETA(IJ)+BETA(IL))*(VAL2+VAL1))
                W(K,L,IDF)=W(K,L,IDF)+S(IJ,IDF)*(-4*ALPHA(IL)*VAL2-
     *          4*BETA(IL)*VAL1)
 6400         CONTINUE
              GOTO 399
 9007         VAL1=INTS(LAD+1)
              DO 6410 IDF=1,NDF
                W(I,J,IDF)=W(I,J,IDF)+S(KL,IDF)*(-4*ALPHA(JK)*VAL1-
     *          4*BETA(JK)*VAL1)
 6410         CONTINUE
 399          CONTINUE
 6340       CONTINUE
            DO 6420 LOR=1,NUOC
              L=LOR
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO
     *        9999
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO9999
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) THEN
                WRITE(NOUT,2004) IJKLT,IOR,JOR,
     *          KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
                CALL ABORTS
              END IF
              IF (LAD .GT. NMAX) THEN
                WRITE(NOUT,2005)LAD
                CALL ABORTS
              END IF
              GOTO (9011,9012,9013,9014,9015,9016,9017)IJKLT
 9011         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
              DO 6430 IDF=1,NDF
                W(L,I,IDF)=W(L,I,IDF)+S(JK,IDF)*(-4*(ALPHA(IJ)+
     *          ALPHA(IK))*VAL3-2*(BETA(IJ)+BETA(IK))*(VAL1+VAL2))
                W(L,J,IDF)=W(L,J,IDF)+S(IK,IDF)*(-4*(ALPHA(IJ)+
     *          ALPHA(JK))*VAL1-2*(BETA(IJ)+BETA(JK))*(VAL2+VAL3))
                W(L,K,IDF)=W(L,K,IDF)+S(IJ,IDF)*(-4*(ALPHA(IK)+
     *          ALPHA(JK))*VAL2-2*(BETA(IK)+BETA(JK))*(VAL1+VAL3))
 6430         CONTINUE
              GOTO9999
 9012         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 6440 IDF=1,NDF
                W(L,J,IDF)=W(L,J,IDF)+S(IK,IDF)*(-4*(ALPHA(IJ)+
     *          ALPHA(JK))*VAL1-2*(BETA(IJ)+BETA(JK))*(VAL1+VAL2))
                W(L,I,IDF)=W(L,I,IDF)+S(JK,IDF)*(-4*ALPHA(IJ)*VAL2-
     *          4*BETA(IJ)*VAL1)
 6440         CONTINUE
              GOTO9999
 9013         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 6450 IDF=1,NDF
                W(L,I,IDF)=W(L,I,IDF)+S(JK,IDF)*(-4*(ALPHA(IJ)+
     *          ALPHA(IK))*VAL1-2*(BETA(IJ)+BETA(IK))*(VAL1+VAL2))
                W(L,K,IDF)=W(L,K,IDF)+S(IJ,IDF)*(-4*ALPHA(IK)*VAL2-
     *          4*BETA(IK)*VAL1)
6450          CONTINUE
              GOTO9999
 9014         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              GOTO9999
 9015         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              DO 6460 IDF=1,NDF
                W(L,I,IDF)=W(L,I,IDF)+S(JK,IDF)*(-4*ALPHA(IJ)*VAL1-
     *          4*BETA(IJ)*VAL1)
 6460         CONTINUE
              GOTO9999
 9016         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              GOTO9999
 9017         VAL1=INTS(LAD+1)
 9999         CONTINUE
 6420       CONTINUE
 6330     CONTINUE
 6320   CONTINUE
C     SKIP I,UOC,UOC,UOC PART
        DO 6470 JOR=NUOC,1,-1
          IF(IGRP.NE.IJGRP(IOFF(IOR)+JOR))THEN
CIBM        CALL RGETSA(IT52,IX)
CIBM        WRITE(NOUT,2016) IX
C2016       FORMAT(' SKIPPING AT ADR ',I8)
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IOFF(IOR)+JOR)
          END IF
 6470   CONTINUE
 6310 CONTINUE
CC    JT4=104
CC    CALL SREW(JT4)
      IEA=2*NDF+NBSET*NDF+1
      ISEA=JT1C(IEA)
      DO 6480 II=1,NDF
CC       CALL LREADW(JT4,EPA,NORBS*NORBS*2)
        CALL WREADW(IT94,EPA,INTOWP(NORBS*NORBS),ISEA,ISEA)
        IF (IAND(IPRINT,256) .NE. 0) THEN
          WRITE(NOUT,3014) II,ISEA-INTOWP(NORBS*NORBS)
 3014     FORMAT(/'  EPA FOR DEGREE ',I5,'  AS READ FROM ADDRESS ',I8)
          CALL MATOUT(EPA,NORBS,NORBS,NORBS,NORBS,NOUT)
        END IF
        IJ=0
        DO 6490 I=1,NORBS
          DO 6500 J=1,I
            IJ=IJ+1
            INDEX=IJORD(IJ)
            IF(INDEX.NE.0)THEN
              IF(J.GT.NUOC)THEN
                SIG=A1
              ELSE
                SIG=-A1
              END IF
              A(INDEX,II+IJIND2)=A(INDEX,II+IJIND2)-(EPA(I,J)-EPA(J,
     *        I))*SIG
            END IF
6500        CONTINUE
6490      CONTINUE
6480  CONTINUE
C     CALL MATOUT(A,IJIND2,IJIND3,IJIND2,IJIND3)
CCC   CALL MATOUT(B0,IJIND,NDF,IJIND,NDF)
      DO 6510 I=NORBS,1,-1
        DO 6520 J=NORBS,LFERM,-1
          IJ=IOFF(MAX0(I,J))+MIN0(I,J)
          DO 6530 K=NORBS,LFERM,-1
            IK=IOFF(MAX0(I,K))+MIN0(I,K)
            JK=IOFF(MAX0(J,K))+MIN0(J,K)
            DO 6540 IDF=1,NDF
              W(I,J,IDF)=W(I,J,IDF)-4*S(IK,IDF)*ETA(JK)-2*(ETA(IK)+
     1        ZETA(IK,J))*S(JK,IDF)
6540        CONTINUE
6530      CONTINUE
6520    CONTINUE
6510  CONTINUE
CCC   CALL SREW(JT4)
      ISEA=JT1C(IEA)
      DO 6550 II=1,NDF
CCC      CALL LREADW(JT4,EPA,NORBS*NORBS*2)
        CALL WREADW(IT94,EPA,INTOWP(NORBS*NORBS),ISEA,ISEA)
        DO 6560 I=NORBS,1,-1
          DO 6570 J=NORBS,LFERM,-1
            IJ=IOFF(MAX0(I,J))+MIN0(I,J)
            W(I,J,II)=W(I,J,II)+EPA(J,I)*A4
6570      CONTINUE
6560    CONTINUE
6550  CONTINUE
C     WRITE(NOUT,'(" W MATRIX")')
C     DO I=1,NDF
C     DO II=1,NORBS
C     DO JJ=1,NORBS
C     EPA(II,JJ)=W(II,JJ,I)
C     END DO
C     END DO
C     CALL MATOUT(EPA,NORBS,NORBS,NORBS,NORBS)
C     END DO
      DO 6580 I=1,NORBS
        E11(I,NSB)=A0
        E22(I,NSA)=A0
 6580 CONTINUE
C     WRITE(NOUT,"(/,50(1H*),' H MATRIX')")
C     WRITE(NOUT,"(' H11=',F20.10,' H22=',F20.10,' H12=',F20.10)")
C    1H11,H22,H12
C     WRITE(NOUT,'(//,50(1H*)," E11 MATRIX")')
C     CALL MATOUT(E11,NORBS,NORBS,NORBS,NORBS)
C     WRITE(NOUT,'(//,50(1H*)," E22 MATRIX")')
C     CALL MATOUT(E22,NORBS,NORBS,NORBS,NORBS)
C     WRITE(NOUT,'(//,50(1H*)," E12 MATRIX")')
C     CALL MATOUT(E12,NORBS,NORBS,NORBS,NORBS)
      IWA=3*NDF+NBSET*NDF
      ISWA=JT1C(IWA)+INTOWP(NORBS*NORBS)
      DO 6590 IDF=1,NDF
        IWA=IWA+1
        JT1C(IWA)=ISWA
        CALL WWRITW(IT94,W(1,1,IDF),INTOWP(NORBS*NORBS),ISWA,ISWA)
        IF (IAND(IPRINT,512) .NE. 0) THEN
          WRITE(NOUT,8010) IDF,JT1C(IWA),IWA
          CALL MATOUT(W(1,1,IDF),NORBS,NORBS,NORBS,NORBS,6)
 8010     FORMAT(/'  W MATRIX FOR DEGREE ',I5,'  WRITTEN TO WORD',I8,
     1    '  IN JT1C ',I5)
        END IF
 6590 CONTINUE
      RETURN
      END
 
      SUBROUTINE GTINTS(A,ETA,ZETA,F,ALPHA,BETA,IJORD,KADD,LADD,
     1IJADD,IJGRP,ORBSYM,INTS,S,EPA,JT1C,IOFF,EX,RS,LG,IJDEP,BOX,
     2EAVF,LSTEPA,aa,eps,doff,dadd,idim,idima)
      IMPLICIT INTEGER (A-Z)
      LOGICAL IJEQ,IJKEQ,JKEQ
      INTEGER XDF,N112(112),JULIA(70),IJDEP(NUMIJ)
      integer doff(idim),dadd(idim)
      real*8 eps(idim)
      REAL*8 A0,A1,A2,A1S2,A4,FOCC,BOX(NDF),A3S2
      REAL*8 EAVF(NUMIJ),LSTEPA(NUMIJ)
      DIMENSION IJORD(NUMIJ),KADD(SYMORB),LADD(SYMORB),JT1C(1)
      DIMENSION ORBSYM(NORBS),IJADD(NUMIJ),IJGRP(NUMIJ)
      DIMENSION IOFF(NUMIJ)
      REAL*8 A(IJIND,IJIND3),F(NORBS),INTS(NMAX),LG(NORBS,NORBS)
      real*8 aa(ijind,ndf)
     1,S(NUMIJ,NDF),EPA(NORBS,NORBS),EX(IJIND),RS(NUMDEP,NDF)
      REAL*8 ZETA(NUMIJ,NORBS),ALPHA(NUMIJ),BETA(NUMIJ)
      REAL*8 C1A,C2A,C1,C2
      REAL*8 VAL1,VAL2,VAL3,ETA(NUMIJ),ESCF,REPNUC
      COMMON /CIA/ C1A(45),C2A(45),C1,C2,ESCF
C!!!  COMMON /TAPES/     ,   ,NOUT,IT2,    ,JTAP1,     ,  OLD TAPES USED
C!!!  COMMON /TAPES/ IT22,IT8,NOUT,IT2,IT42,JTAP1,IUTAP,JTAP2
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ SYMORB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /POINT/ FOCC(5),IPOINT(5),JPOINT(5),NSORB(5)
      COMMON /FUNCS/ IOCC,JOCC,KOCC,NTYPES,NBSET,NAT
      COMMON /OCCS/ NSPE,NSA,NSB,NALP,NOP,NDOC,LFERM,NUOC,IJIND,IJIND3
      COMMON/OCCS2/NUMCOR,NCOR,FDOC,CORDOC,NUMVIR,FVIR,LUOC,NUMDEP,VUOC
      COMMON /LOC22/ IA22(100),IBF2AT(284)
      COMMON /IEXT/ IPRINT,IGRP,ICIDIP
      COMMON /REN/ REPNUC
C
 3001 FORMAT(10I5)
 1100 FORMAT(/'  IN THE CONSTRUCTION OF THE A MATRIX, THE CASE ',A7
     * /'  IS NOT POSSIBLE IN THE ',A11,'  SET OF LOOPS.'/'  ERROR
     * IN LOOP STRUCTURE SOMEWHERE.')
   2  FORMAT(/'  IN GTINT2, IJKLT UNKNOWN TYPE ',I5/'  ORBITALS: ',4I5
     * /'  BASIS FUNCTIONS: ',4I5/,'  SYMMETRIES: ',4I5)
 2005 FORMAT(/'  IN GTINT2, LAD TOO BIG: ',I6)
      IJIND2=IJIND
      A0=0.0D+00
      A1=1.0D+00
      A2=2.0D+00
      A4=4.00D+00
      A1S2=0.50D+00
      A3S2=1.50D+00
C
C THIS IS THE BEGINNING OF THE SECOND PART OF GETINT TJL 11/24/84
C
      IF (NSPE.EQ.0) RETURN
      DO 3400 IOR=NSB,NSA,-1
        IO=IOFF(IOR)
        II=IO+IOR
        ISM=ORBSYM(IOR)
        ITYP=1
        DO 3410 JOR=IOR,NSA,-1
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IJND=IJORD(IJ)
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IJ)
          IF (IGRP .NE. IJGRP(IJ)) THEN
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IJ)
          END IF
          DO 3420 KOR=1,NUOC
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
CTJL
C      I1FL = 0
C      IF(I1FL.EQ.1) GOTO 3431
            DO 3430 LOR=1,KOR
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 303
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 303
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
CTJL
         KLVU = IJDEP(KL)
CTJL
C
C     SPE-SPE-UOC-UOC
C
              GOTO (13,23,33,43,53,63,73)IJKLT
 13           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
      CALL GA1(IKND,JLND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      CALL GA1(ILND,JKND,IK,KL,IJ,JL,VAL3,VAL2,VAL1,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JKND,IJ,IK,JL,KL,VAL3,VAL2,VAL1,IL,aa,eps,zeta,alpha,
     #beta,s)
C
      IF(KLVU.NE.0) CALL EX1(IJND,LL,KK,LOR,KOR,VAL2,VAL1,VAL3,
     #ex,eavf,lg)
      IF(KLVU.NE.0) CALL RS1(KLVU,A1,VAL2,VAL1,VAL3,IJ,rs,s)
C
              GOTO 303
 23           CONTINUE
              WRITE(NOUT,2012)
 2012         FORMAT(/     '  IN CONSTRUCTON OF A, J=K IS NOT POSSIBLE I
     *N THE FIRST SET OF LOOPS'/'  ERROR IN LOOPS SOMEWHERE')
              CALL MABORT
 33           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA3(IKND,ILND,IL,KL,II,IK,VAL1,VAL2,IOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB3(IKND,IL,KL,II,IK,VAL1,VAL2,IOR,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB3(ILND,IK,KL,II,IL,VAL1,VAL2,IOR,aa,eps,zeta,alpha,
     #beta,s)
C
      IF(KLVU.NE.0) CALL RS1(KLVU,A1S2,VAL2,VAL1,VAL1,IJ,rs,s)
C
              GOTO 303
 43           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA4(IKND,JKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB4(IKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB4(JKND,JK,KK,IJ,IK,VAL1,VAL2,KOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 303
 53           CONTINUE
              WRITE(NOUT,2013)
 2013         FORMAT(/     '  IN CONSTRUCTON OF THE A MATRIX, I=J=K IS N
     *OT POSSIBLE DO THE FIRST SET OF LOOPS'/'  ERROR IN LOOPS SOMEWHERE
     *')
              CALL MABORT
 63           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA6(IKND,IK,KK,II,VAL1,VAL2,IOR,KOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB6(IKND,II,KK,VAL1,VAL2,IK,IOR,KOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 303
 73           CONTINUE
              WRITE(NOUT,2014)
 2014         FORMAT(/     '  IN CONSTRUCTON OF THE A MATRIX,I=J=K=L IS
     *NOT POSSIBLE DO THE FIRST SET OF LOOPS'/'  ERROR IN LOOPS SOMEWHER
     *E')
              CALL MABORT
 303          CONTINUE
 3430       CONTINUE
C3431 CONTINUE
 3420     CONTINUE
          DO 3480 KOR=LFERM,NDOC
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
CTJL
       I2FL = 0
       IF(I2FL.EQ.1) GOTO 3491
            DO 3490 LOR=1,NUOC
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 304
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 304
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
C
C   SPE-SPE-DOC-UOC
C
              GOTO (14,24,34,44,54,64,74)IJKLT
 14           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
      CALL GA1(IJND,KLND,IL,JL,IK,JK,VAL2,VAL1,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      CALL GA1(IKND,JLND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      CALL GA1(ILND,JKND,IK,KL,IJ,JL,VAL3,VAL2,VAL1,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(IJND,IL,JL,IK,JK,VAL2,VAL1,VAL3,KL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(KLND,IK,IL,JK,JL,VAL2,VAL1,VAL3,IJ,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JKND,IJ,IK,JL,KL,VAL3,VAL2,VAL1,IL,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 304
 24           CONTINUE
              WRITE(NOUT,1100) 'J=K    ','SECOND     '
              CALL MABORT
  34          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA3(IKND,ILND,IL,KL,II,IK,VAL1,VAL2,IOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GBD(KLND,IK,IL,VAL2,VAL1,II,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB3(IKND,IL,KL,II,IK,VAL1,VAL2,IOR,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB3(ILND,IK,KL,II,IL,VAL1,VAL2,IOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 304
 44           CONTINUE
              WRITE(NOUT,1100) 'K=L    ','SECOND     '
              CALL MABORT
 54           CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','SECOND     '
              CALL MABORT
 64           CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','SECOND     '
              CALL MABORT
 74           CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','SECOND     '
              CALL MABORT
 304          CONTINUE
 3490       CONTINUE
 3491 CONTINUE
CTJL
       I3FL = 0
       IF(I3FL.EQ.1) GOTO 3521
            DO 3520 LOR=LFERM,KOR
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 305
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 305
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
CTJL
         KLDC = IJDEP(KL)
CTJL
C
C    SPE-SPE-DOC-DOC
C
              GOTO (15,25,35,45,55,65,75)IJKLT
 15           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
      CALL GA1(IKND,JLND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      CALL GA1(ILND,JKND,IK,KL,IJ,JL,VAL3,VAL2,VAL1,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(IJND,IL,JL,IK,JK,VAL2,VAL1,VAL3,KL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JKND,IJ,IK,JL,KL,VAL3,VAL2,VAL1,IL,aa,eps,zeta,alpha,
     #beta,s)
C
      IF(KLDC.NE.0) CALL EX1(IJND,LL,KK,LOR,KOR,VAL2,VAL1,VAL3,
     #ex,eavf,lg)
      IF(KLDC.NE.0) CALL RS1(KLDC,A1,VAL2,VAL1,VAL3,IJ,rs,s)
C
              GOTO 305
 25           CONTINUE
              WRITE(NOUT,1100) 'J=K    ','THIRD      '
              CALL MABORT
 35           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA3(IKND,ILND,IL,KL,II,IK,VAL1,VAL2,IOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB3(IKND,IL,KL,II,IK,VAL1,VAL2,IOR,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB3(ILND,IK,KL,II,IL,VAL1,VAL2,IOR,aa,eps,zeta,alpha,
     #beta,s)
C
      IF(KLDC.NE.0) CALL RS1(KLDC,A1S2,VAL2,VAL1,VAL1,IJ,rs,s)
C
              GOTO 305
 45           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA4(IKND,JKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GBD(IJND,IK,JK,VAL2,VAL1,KK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB4(IKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB4(JKND,JK,KK,IJ,IK,VAL1,VAL2,KOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 305
 55           CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','THIRD     '
              CALL MABORT
 65           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA6(IKND,IK,KK,II,VAL1,VAL2,IOR,KOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB6(IKND,II,KK,VAL1,VAL2,IK,IOR,KOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 305
 75           CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','THIRD     '
              CALL MABORT
 305          CONTINUE
 3520       CONTINUE
 3521 CONTINUE
 3480     CONTINUE
          IF(IAND(IPRINT,1024).NE.0) WRITE(NOUT,1505)
 1505     FORMAT(/'  ABOUT TO JUMP TO 520')
C
          IF (NALP.EQ.0) GOTO 520
C
          DO 3570 KOR=NOP,NALP
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
            DO 3580 LOR=1,NDOC
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 306
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 306
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
C
C    SPE-SPE-ALP-UOC/DOC
C
              GOTO (16,26,36,46,56,66,76)IJKLT
 16           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
      CALL GA1(IJND,KLND,IL,JL,IK,JK,VAL2,VAL1,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      CALL GA1(IKND,JLND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      CALL GA1(ILND,JKND,IK,KL,IJ,JL,VAL3,VAL2,VAL1,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(IJND,IL,JL,IK,JK,VAL2,VAL1,VAL3,KL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(KLND,IK,IL,JK,JL,VAL2,VAL1,VAL3,IJ,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JKND,IJ,IK,JL,KL,VAL3,VAL2,VAL1,IL,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 306
 26           CONTINUE
              WRITE(NOUT,1100) 'J=K    ','FOURTH     '
              CALL MABORT
  36          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA3(IKND,ILND,IL,KL,II,IK,VAL1,VAL2,IOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GBD(KLND,IK,IL,VAL2,VAL1,II,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB3(IKND,IL,KL,II,IK,VAL1,VAL2,IOR,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB3(ILND,IK,KL,II,IL,VAL1,VAL2,IOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 306
 46           CONTINUE
              WRITE(NOUT,1100) 'K=L    ','FOURTH     '
              CALL MABORT
 56           CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','FOURTH     '
              CALL MABORT
 66           CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','FOURTH     '
              CALL MABORT
 76           CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','FOURTH     '
              CALL MABORT
 306          CONTINUE
 3580       CONTINUE
            DO 3610 LOR=NOP,KOR
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 307
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 307
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
C
C     SPE-SPE-ALP-ALP
C
              GOTO (17,27,37,47,57,67,77)IJKLT
 17           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
      CALL GA1(IKND,JLND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      CALL GA1(ILND,JKND,IK,KL,IJ,JL,VAL3,VAL2,VAL1,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(IJND,IL,JL,IK,JK,VAL2,VAL1,VAL3,KL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JKND,IJ,IK,JL,KL,VAL3,VAL2,VAL1,IL,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 307
 27           CONTINUE
              WRITE(NOUT,1100) 'J=K    ','FIFTH      '
              CALL MABORT
 37           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA3(IKND,ILND,IL,KL,II,IK,VAL1,VAL2,IOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB3(IKND,IL,KL,II,IK,VAL1,VAL2,IOR,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB3(ILND,IK,KL,II,IL,VAL1,VAL2,IOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 307
 47           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA4(IKND,JKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GBD(IJND,IK,JK,VAL2,VAL1,KK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB4(IKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB4(JKND,JK,KK,IJ,IK,VAL1,VAL2,KOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 307
 57           CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','FIFTH     '
              CALL MABORT
 67           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA6(IKND,IK,KK,II,VAL1,VAL2,IOR,KOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB6(IKND,II,KK,VAL1,VAL2,IK,IOR,KOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 307
 77           CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','FIFTH     '
              CALL MABORT
 307          CONTINUE
 3610       CONTINUE
 3570     CONTINUE
C
 520      CONTINUE
          DO 3660 KOR=NSA,JOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
CTJL
       I6FL = 0
       IF(I6FL.EQ.1) GOTO 3671
            DO 3670 LOR=1,KOR
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 508
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 508
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
C
C       SPE-SPE-SPE-UOC/DOC/ALP/SPE
C
              GOTO (518,528,538,548,558,568,578)IJKLT
518           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
      CALL GA1(IJND,KLND,IL,JL,IK,JK,VAL2,VAL1,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      CALL GA1(IKND,JLND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      CALL GA1(ILND,JKND,IK,KL,IJ,JL,VAL3,VAL2,VAL1,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(IJND,IL,JL,IK,JK,VAL2,VAL1,VAL3,KL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(KLND,IK,IL,JK,JL,VAL2,VAL1,VAL3,IJ,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JKND,IJ,IK,JL,KL,VAL3,VAL2,VAL1,IL,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 508
528           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA2(IJND,JLND,IL,JL,IJ,JJ,VAL1,VAL2,JOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GBD(ILND,IJ,JL,VAL2,VAL1,JJ,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB22(IJND,IL,JL,IJ,JJ,VAL1,VAL2,JOR,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB21(JLND,JJ,JL,IJ,IL,VAL1,VAL2,JOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 508
538           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA3(IKND,ILND,IL,KL,II,IK,VAL1,VAL2,IOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GBD(KLND,IK,IL,VAL2,VAL1,II,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB3(IKND,IL,KL,II,IK,VAL1,VAL2,IOR,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB3(ILND,IK,KL,II,IL,VAL1,VAL2,IOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 508
548           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA4(IKND,JKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GBD(IJND,IK,JK,VAL2,VAL1,KK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB4(IKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB4(JKND,JK,KK,IJ,IK,VAL1,VAL2,KOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 508
558           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
      CALL GBD(ILND,II,IL,VAL1,VAL1,II,aa,eps,zeta,alpha,
     #beta,s)
      IF(LOR.GT.NUOC) CALL GBD(ILND,IL,LL,VAL2,VAL2,LL,aa,eps,zeta,
     #alpha,beta,s)
C
              GOTO 508
568           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA6(IKND,IK,KK,II,VAL1,VAL2,IOR,KOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB6(IKND,II,KK,VAL1,VAL2,IK,IOR,KOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 508
578           CONTINUE
C  THIS TYPE (I=J=K=L) DOES NOT CONTRIBUTE
 508          CONTINUE
 3670       CONTINUE
 3671 CONTINUE
 3660     CONTINUE
 3410   CONTINUE
C
        IF (NALP.EQ.0) GOTO 530
        DO 3740 JOR=NALP,NOP,-1
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IJND=IJORD(IJ)
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IJ)
          IF (IGRP .NE. IJGRP(IJ)) THEN
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IJ)
          END IF
          DO 3750 KOR=1,NUOC
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
            DO 3760 LOR=1,KOR
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 309
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 309
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
CTJL
         KLVU = IJDEP(KL)
CTJL
C
C    SPE-ALP-UOC-UOC
C
              GOTO (19,29,39,49,59,69,79)IJKLT
 19           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
      CALL GA1(IKND,JLND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      CALL GA1(ILND,JKND,IK,KL,IJ,JL,VAL3,VAL2,VAL1,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JKND,IJ,IK,JL,KL,VAL3,VAL2,VAL1,IL,aa,eps,zeta,alpha,
     #beta,s)
C
      IF(KLVU.NE.0) CALL EX1(IJND,LL,KK,LOR,KOR,VAL2,VAL1,VAL3,
     #ex,eavf,lg)
      IF(KLVU.NE.0) CALL RS1(KLVU,A1,VAL2,VAL1,VAL3,IJ,rs,s)
C
              GOTO 309
 29           CONTINUE
              WRITE(NOUT,1100) 'J=K    ','SEVENTH    '
              CALL MABORT
 39           CONTINUE
              WRITE(NOUT,1100) 'I=J    ','SEVENTH    '
              CALL MABORT
 49           VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA4(IKND,JKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB4(IKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB4(JKND,JK,KK,IJ,IK,VAL1,VAL2,KOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 309
 59           CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','SEVENTH    '
              CALL MABORT
 69           CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','SEVENTH    '
              CALL MABORT
 79           CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','SEVENTH    '
              CALL MABORT
 309          CONTINUE
 3760       CONTINUE
 3750     CONTINUE
          DO 3790 KOR=LFERM,NDOC
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
            DO 3800 LOR=1,NUOC
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 401
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 401
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
C
C    SPE-ALP-DOC-UOC
C
              GOTO (111,121,131,141,151,161,171)IJKLT
 111          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
      CALL GA1(IJND,KLND,IL,JL,IK,JK,VAL2,VAL1,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      CALL GA1(IKND,JLND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      CALL GA1(ILND,JKND,IK,KL,IJ,JL,VAL3,VAL2,VAL1,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(IJND,IL,JL,IK,JK,VAL2,VAL1,VAL3,KL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(KLND,IK,IL,JK,JL,VAL2,VAL1,VAL3,IJ,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JKND,IJ,IK,JL,KL,VAL3,VAL2,VAL1,IL,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 401
 121          CONTINUE
              WRITE(NOUT,1100) 'J=K    ','EIGHTH     '
              CALL MABORT
 131          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','EIGHTH     '
              CALL MABORT
 141          CONTINUE
              WRITE(NOUT,1100) 'K=L    ','EIGHTH     '
              CALL MABORT
 151          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','EIGHTH     '
              CALL MABORT
 161          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','EIGHTH     '
              CALL MABORT
 171          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','EIGHTH     '
              CALL MABORT
 401          CONTINUE
 3800       CONTINUE
            DO 3820 LOR=LFERM,KOR
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 402
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 402
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
CTJL
         KLDC = IJDEP(KL)
CTJL
C
C   SPE-ALP-DOC-DOC
C
              GOTO (112,122,132,142,152,162,172)IJKLT
 112          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
      CALL GA1(IKND,JLND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      CALL GA1(ILND,JKND,IK,KL,IJ,JL,VAL3,VAL2,VAL1,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(IJND,IL,JL,IK,JK,VAL2,VAL1,VAL3,KL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JKND,IJ,IK,JL,KL,VAL3,VAL2,VAL1,IL,aa,eps,zeta,alpha,
     #beta,s)
C
      IF(KLDC.NE.0) CALL EX1(IJND,LL,KK,LOR,KOR,VAL2,VAL1,VAL3,
     #ex,eavf,lg)
      IF(KLDC.NE.0) CALL RS1(KLDC,A1,VAL2,VAL1,VAL3,IJ,rs,s)
C
              GOTO 402
 122          CONTINUE
              WRITE(NOUT,1100) 'J=K    ','NINTH      '
              CALL MABORT
 132          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','NINTH      '
              CALL MABORT
 142          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA4(IKND,JKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GBD(IJND,IK,JK,VAL2,VAL1,KK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB4(IKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB4(JKND,JK,KK,IJ,IK,VAL1,VAL2,KOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 402
152           CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','NINTH      '
              CALL MABORT
162           CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','NINTH      '
              CALL MABORT
172           CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','NINTH      '
              CALL MABORT
 402          CONTINUE
 3820       CONTINUE
 3790     CONTINUE
C
          DO 3850 KOR=NOP,JOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
            DO 3860 LOR=1,NDOC
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 403
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 403
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
C
C     SPE-ALP-ALP-UOC/DOC
C
              GOTO (113,123,133,143,153,163,173)IJKLT
 113          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
      CALL GA1(IJND,KLND,IL,JL,IK,JK,VAL2,VAL1,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      CALL GA1(IKND,JLND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(IJND,IL,JL,IK,JK,VAL2,VAL1,VAL3,KL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(KLND,IK,IL,JK,JL,VAL2,VAL1,VAL3,IJ,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 403
 123          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA2(IJND,JLND,IL,JL,IJ,JJ,VAL1,VAL2,JOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GBD(ILND,IJ,JL,VAL2,VAL1,JJ,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB22(IJND,IL,JL,IJ,JJ,VAL1,VAL2,JOR,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB21(JLND,JJ,JL,IJ,IL,VAL1,VAL2,JOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 403
 133          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','TENTH      '
              CALL MABORT
 143          CONTINUE
              WRITE(NOUT,1100) 'K=L    ','TENTH      '
              CALL MABORT
 153          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','TENTH      '
              CALL MABORT
 163          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','TENTH      '
              CALL MABORT
 173          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','TENTH      '
              CALL MABORT
 403          CONTINUE
 3860       CONTINUE
C
            DO 3890 LOR=NOP,KOR
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 603
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 603
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
C
C    SPE-ALP-ALP-ALP
C
              GOTO (613,623,633,643,653,663,673)IJKLT
 613          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
      CALL GB1(IJND,IL,JL,IK,JK,VAL2,VAL1,VAL3,KL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 603
 623          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
      CALL GBD(ILND,IJ,JL,VAL2,VAL1,JJ,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB22(IJND,IL,JL,IJ,JJ,VAL1,VAL2,JOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 603
 633          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','TENTH+1    '
              CALL MABORT
 643          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
      CALL GBD(IJND,IK,JK,VAL2,VAL1,KK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB4(IKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 603
 653          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','TENTH+1    '
              CALL MABORT
 663          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','TENTH+1    '
              CALL MABORT
 673          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','TENTH+1    '
              CALL MABORT
 603          CONTINUE
 3890       CONTINUE
 3850     CONTINUE
 3740   CONTINUE
C
 530    CONTINUE
C
        DO 3930 JOR=NDOC,LFERM,-1
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IJND=IJORD(IJ)
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IJ)
          IF (IGRP .NE. IJGRP(IJ)) THEN
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IJ)
          END IF
          DO 3940 KOR=1,NUOC
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
CTJL
       I12FL = 0
       IF(I12FL.EQ.1) GOTO 3951
            DO 3950 LOR=1,KOR
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 404
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 404
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
CTJL
         KLVU = IJDEP(KL)
CTJL
C
C   SPE-DOC-UOC-UOC
C
              GOTO (114,124,134,144,154,164,174)IJKLT
 114          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
      CALL GA1(IKND,JLND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      CALL GA1(ILND,JKND,IK,KL,IJ,JL,VAL3,VAL2,VAL1,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JKND,IJ,IK,JL,KL,VAL3,VAL2,VAL1,IL,aa,eps,zeta,alpha,
     #beta,s)
C
      IF(KLVU.NE.0) CALL EX1(IJND,LL,KK,LOR,KOR,VAL2,VAL1,VAL3,
     #ex,eavf,lg)
      IF(KLVU.NE.0) CALL RS1(KLVU,A3S2,VAL2,VAL1,VAL3,IJ,rs,s)
C
              GOTO 404
 124          CONTINUE
              WRITE(NOUT,1100) 'J=K    ','ELEVENTH   '
              CALL MABORT
 134          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','ELEVENTH   '
              CALL MABORT
 144          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA4(IKND,JKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB4(IKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB4(JKND,JK,KK,IJ,IK,VAL1,VAL2,KOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 404
 154          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','ELEVENTH   '
              CALL MABORT
 164          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','ELEVENTH   '
              CALL MABORT
 174          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','ELEVENTH   '
              CALL MABORT
 404          CONTINUE
 3950       CONTINUE
 3951 CONTINUE
 3940     CONTINUE
          DO 3980 KOR=LFERM,JOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
CTJL
         JKDC = IJDEP(JK)
CTJL
       I13FL = 0
       IF(I13FL.EQ.1) GOTO 3991
            DO 3990 LOR=1,NUOC
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 405
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 405
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
C
C   SPE-DOC-DOC-UOC
C
              GOTO (115,125,135,145,155,165,175)IJKLT
 115          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
C
      CALL GA1(IJND,KLND,IL,JL,IK,JK,VAL2,VAL1,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
      CALL GA1(IKND,JLND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GB1(IJND,IL,JL,IK,JK,VAL2,VAL1,VAL3,KL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(JLND,JK,KL,IJ,IL,VAL1,VAL2,VAL3,IK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(KLND,IK,IL,JK,JL,VAL2,VAL1,VAL3,IJ,aa,eps,zeta,alpha,
     #beta,s)
C
      IF(JKDC.NE.0) CALL RS1(JKDC,A1S2,VAL3,VAL1,VAL2,IL,rs,s)
      IF(JKDC.NE.0) CALL EX1(ILND,KK,JJ,KOR,JOR,VAL3,VAL1,VAL2,
     #ex,eavf,lg)
C
              GOTO 405
 125          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
C
      CALL GA2(IJND,JLND,IL,JL,IJ,JJ,VAL1,VAL2,JOR,
     #a,eps,zeta,alpha,beta,doff,dadd,idim,idima)
C
      CALL GBD(ILND,IJ,JL,VAL2,VAL1,JJ,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB21(JLND,JJ,JL,IJ,IL,VAL1,VAL2,JOR,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB22(IJND,IL,JL,IJ,JJ,VAL1,VAL2,JOR,aa,eps,zeta,alpha,
     #beta,s)
C
              GOTO 405
 135          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','TWELVTH    '
              CALL MABORT
 145          CONTINUE
              WRITE(NOUT,1100) 'K=L    ','TWELVTH    '
              CALL MABORT
 155          CONTINUE
              WRITE(NOUT,1100) 'I=J=K  ','TWELVTH    '
              CALL MABORT
 165          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','TWELVTH    '
              CALL MABORT
 175          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','TWELVTH    '
              CALL MABORT
 405          CONTINUE
 3990       CONTINUE
 3991 CONTINUE
CTJL
       I14FL = 0
       IF(I14FL.EQ.1) GOTO 4021
            DO 4020 LOR=LFERM,KOR
         IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO 605
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 605
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
CTJL
         JLDC = IJDEP(JL)
         KLDC = IJDEP(KL)
CTJL
C
C    SPE-DOC-DOC-DOC
C
              GOTO (615,625,635,645,655,665,675)IJKLT
 615          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
      CALL GB1(IJND,IL,JL,IK,JK,VAL2,VAL1,VAL3,KL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(IKND,IL,KL,IJ,JK,VAL1,VAL2,VAL3,JL,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB1(ILND,IJ,JL,IK,KL,VAL3,VAL2,VAL1,JK,aa,eps,zeta,alpha,
     #beta,s)
C
      IF(JKDC.NE.0) CALL RS1(JKDC,A2,VAL3,VAL1,VAL2,IL,rs,s)
      IF(JLDC.NE.0) CALL RS1(JLDC,A2,VAL1,VAL1,VAL2,IK,rs,s)
      IF(KLDC.NE.0) CALL RS1(KLDC,A2,VAL2,VAL1,VAL3,IJ,rs,s)
      IF(JKDC.NE.0) CALL EX1(ILND,KK,JJ,KOR,JOR,VAL3,VAL1,VAL2,
     #ex,eavf,lg)
      IF(JLDC.NE.0) CALL EX1(IKND,LL,JJ,LOR,JOR,VAL1,VAL3,VAL2,
     #ex,eavf,lg)
      IF(KLDC.NE.0) CALL EX1(IJND,LL,KK,LOR,KOR,VAL2,VAL1,VAL3,
     #ex,eavf,lg)
C
              GOTO 605
 625          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
      CALL GBD(ILND,IJ,JL,VAL2,VAL1,JJ,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB22(IJND,IL,JL,IJ,JJ,VAL1,VAL2,JOR,aa,eps,zeta,alpha,
     #beta,s)
C
      IF(JLDC.NE.0) CALL RS1(JLDC,A1,VAL1,VAL1,VAL2,IK,rs,s)
      IF(JLDC.NE.0) CALL EX1(IKND,LL,JJ,LOR,JOR,VAL1,VAL1,VAL2,
     #ex,eavf,lg)
C
              GOTO 605
 635          CONTINUE
              WRITE(NOUT,1100) 'I=J    ','TWELVTH+1  '
              CALL MABORT
 645          VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
      CALL GBD(IJND,IK,JK,VAL2,VAL1,KK,aa,eps,zeta,alpha,
     #beta,s)
      CALL GB4(IKND,IK,KK,IJ,JK,VAL1,VAL2,KOR,aa,eps,zeta,alpha,
     #beta,s)
C
      IF(JKDC.NE.0) CALL RS1(JKDC,A1,VAL1,VAL1,VAL2,IL,rs,s)
      IF(JLDC.NE.0) CALL EX1(IKND,LL,JJ,LOR,JOR,VAL1,VAL1,VAL2,
     #ex,eavf,lg)
C
              GOTO 605
 655       CONTINUE
C THERE IS NO CONTRIBUTION HERE; DONE IN SPE-SPE-SPE-ALL SECTION
              WRITE(NOUT,1100) 'I=J=K  ','TWELVTH+1  '
              CALL MABORT
              GOTO 605
 665          CONTINUE
              WRITE(NOUT,1100) 'I=J;K=L','TWELVTH+1  '
              CALL MABORT
 675          CONTINUE
              WRITE(NOUT,1100) 'I=J=K=L','TWELVTH    '
              CALL MABORT
 605          CONTINUE
 4020       CONTINUE
 4021 CONTINUE
 3980     CONTINUE
 3930   CONTINUE
C     SKIP I,UOC,UOC,UOC PART
        DO 4060 JOR=NUOC,1,-1
          JO=IOFF(JOR)
          IJ=IO+JOR
          JJ=JO+JOR
          IJND=IJORD(IJ)
          JSM=ORBSYM(JOR)
          IJEQ=IOR.EQ.JOR
          IJT=ITYP
          IF (IJEQ) IJT=IJT+2
          IJSYM=IEOR((ISM-1),(JSM-1))
          KOFF=IJSYM*NORBS
          JAD=IJADD(IJ)
CTJL
       I20FL = 0
       IF(I20FL.EQ.1) GOTO 8411
C
          IF(IGRP.NE.IJGRP(IJ)) THEN
            CALL SREAD(IT52,INTS,NMAX*2)
            SRIN=SRIN+NMAX*2/112
            IGRP=IJGRP(IJ)
          END IF
C
          DO 8410 KOR=1,JOR
            KO=IOFF(KOR)
            IK=IO+KOR
            JK=JO+KOR
            KK=KO+KOR
            IKND=IJORD(IK)
            JKND=IJORD(JK)
            KSM=ORBSYM(KOR)
            JKEQ=JOR.EQ.KOR
            IJKT=IJT
            IF (JKEQ) IJKT=IJKT+1
            IJKEQ=IJEQ.AND.JKEQ
            IJKSYM=IEOR(IJSYM,(KSM-1))
            LOFF=IJKSYM*NORBS
            KAD=JAD+KADD(KOFF+KOR)
CTJL
            JKVU = IJDEP(JK)
CTJL
C
C     SPE-UOC-UOC-UOC
C
            DO 8420 LOR=1,KOR
          IF (JOR.EQ.KOR .AND. KOR.EQ.LOR .AND. LOR.LT.IOR) GOTO  8430
              LSM=ORBSYM(LOR)
              IF ((LSM-1) .NE. IJKSYM) GOTO 8430
              LO=IOFF(LOR)
              IL=IO+LOR
              JL=JO+LOR
              KL=KO+LOR
              LL=LO+LOR
              ILND=IJORD(IL)
              JLND=IJORD(JL)
              KLND=IJORD(KL)
              IJKLT=IJKT
              IF (IJKEQ .AND. KOR.GT.LOR) IJKLT=IJKLT+1
              IF (KOR.EQ.LOR) IJKLT=IJKLT+3
              LAD=KAD+LADD(LOFF+LOR)
              IF (IJKLT.GT.7 .OR. IJKLT.LT.1) GOTO 9903
              IF (LAD .GT. NMAX) GOTO 9902
              JULIA(IJKLT+56)=JULIA(IJKLT+56)+1
CTJL
          JLVU = IJDEP(JL)
          KLVU = IJDEP(KL)
CTJL
              GOTO (8412,8422,8432,8442,8452,8462,8472)IJKLT
 8412         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
              VAL3=INTS(LAD+3)
CTJL
      IF(JKVU.NE.0) CALL EX1(ILND,KK,JJ,KOR,JOR,VAL3,VAL1,VAL2,
     #ex,eavf,lg)
      IF(JLVU.NE.0) CALL EX1(IKND,LL,JJ,LOR,JOR,VAL1,VAL3,VAL2,
     #ex,eavf,lg)
      IF(KLVU.NE.0) CALL EX1(IJND,LL,KK,LOR,KOR,VAL2,VAL1,VAL3,
     #ex,eavf,lg)
C
      IF(JKVU.NE.0) CALL RS1(JKVU,A1S2,VAL3,VAL2,VAL1,IL,rs,s)
      IF(JLVU.NE.0) CALL RS1(JLVU,A1S2,VAL1,VAL2,VAL3,IK,rs,s)
      IF(KLVU.NE.0) CALL RS1(KLVU,A1S2,VAL2,VAL1,VAL3,IJ,rs,s)
C
              GOTO 8430
 8422         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
      IF(JLVU.NE.0) CALL EX1(IKND,LL,JJ,LOR,JOR,VAL1,VAL1,VAL2,
     #ex,eavf,lg)
C
      IF(JLVU.NE.0) CALL RS1(JLVU,A1S2,VAL1,VAL1,VAL2,IK,rs,s)
C
              GOTO 8430
 8432      WRITE(*,*) ' HIT I=J IN D-U-U-U ERROR IN LOOPS'
              GOTO 8430
 8442         VAL1=INTS(LAD+1)
              VAL2=INTS(LAD+2)
      IF(JKVU.NE.0) CALL EX1(ILND,KK,JJ,KOR,JOR,VAL1,VAL1,VAL2,
     #ex,eavf,lg)
C
      IF(JKVU.NE.0) CALL RS1(JKVU,A1S2,VAL1,VAL1,VAL2,IL,rs,s)
C
              GOTO 8430
 8452      WRITE(*,*) ' HIT CASE 5 IN D-U-U-U ERROR IN LOOPS'
CTJL
CTJL THIS TERM , EITHER I=J=K OR J=K=L, DOES NOT CONTRIBUTE.
CTJL
              GOTO 8430
 8462      WRITE(*,*) ' HIT CASE 6 IN D-U-U-U ERROR IN LOOPS'
              GOTO 8430
 8472         CONTINUE
      WRITE(*,*) ' I=K=J=L ERROR IN LOOPS',IOR,JOR,KOR,LOR
CTJL          WRITE(NOUT,1100) 'I=J=K=L','NINTEENTH+1'
CTJL   I=J=J=L DOES NOT CONTRIBUTE
CTJL          CALL MABORT
 8430         CONTINUE
 8420       CONTINUE
 8410       CONTINUE
 8411   CONTINUE
 4060   CONTINUE
 3400 CONTINUE
CTJL
CTJL  WRITE(*,*) ' THE A AND B MATRICES AFTER GTINTS '
C     CALL MATOUT(A,IJIND2,IJIND3,IJIND2,IJIND3,NOUT)
C
      RETURN
CTJL
 9902 CONTINUE
      WRITE(NOUT,2005)LAD
      CALL MABORT
 9903 CONTINUE
      WRITE(NOUT,2)IJKLT,IOR,JOR,KOR,LOR,IBF,JBF,KBF,LBF,ISM,JSM,KSM,LSM
      CALL MABORT
CTJL
      END
      SUBROUTINE MAIN(IZ,Z,MAXCOR)
      IMPLICIT INTEGER (A-Z)
      REAL*8 Z(MAXCOR),FOCC,DRTVER
      INTEGER IZ(1),IA47(192),LABEL(26)
      LOGICAL CCSD
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ SYMORB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /POINT/ FOCC(5),IPOINT(5),JPOINT(5),NSORB(5)
      COMMON /FUNCS/ IOCC,JOCC,KOCC,NTYPES,NBSET,NAT
      COMMON /OCCS/ NSPE,NSA,NSB,NALP,NOP,NDOC,LFERM,NUOC,IJIND,IJIND3
      COMMON/OCCS2/NUMCOR,NCOR,FDOC,CORDOC,NUMVIR,FVIR,LUOC,NUMDEP,VUOC
      COMMON /LOC42/ IA42(100),IBF2AT(284)
CTJL  COMMON /DRTI/ IA(30000)
      COMMON /IEXT/ IPRINT,IGRP,ICIDIP
      COMMON /CALCJ/ ICALT,IDERT,ICIT
      COMMON/DEP/IJDC,IFZC,IFZV,IZDIM
C
      WRITE(NOUT,1000)
 1000 FORMAT(//10X,'THE GENERAL COUPLED PERTURBED HARTREE-FOCK PROGRAM',
     +       /,10X,'          BASED ON LUCK AND A GOOD GUESS         ',
     +      //,10X,'            GRCPHF PROGRAM WRITTEN BY            ',
     +       /,10X,'          PATIENT BUT FRUSTRATED PEOPLE          ',
     +      //,10X,'    MODIFIED FOR COUPLED CLUSTER GRADIENTS,     ',/
     +        ,10X,'          LARGE CI CASES AND MCSCF         ',/
     +        ,10X,'             BY GUSTAVO SCUSERIA         ',/
     +        ,10X,'           VERSION: OCTOBER 6, 1987.    ',//)
C
C  READ IN SOME CONSTANTS FROM TAPES 42,47,58
C
C     WRITE(ICHK,2222)
C2222 FORMAT(/'  IN MAIN')
CTJL  DRTTOP=30000
      open(unit=11,file='file11',status='unknown')
      open(unit=15,file='file15',status='unknown')
C
      INPUT=5
      CALL LOCATE(INPUT,'# GRCPHF #',IERR)
      IF (IERR .EQ. 0) THEN
        READ(INPUT,'(3I5)') IPRINT,ICIDIP,ICCSD
      ELSE
        WRITE(NOUT,990)
        ICCSD = 0
        IPRINT = 0
        ICIDIP = 0
 990    FORMAT(/' # GRCPHF # NOT FOUND IN INPUT FILE; USING DEFAULTS')
      END IF
CGES
      ICIDIP=1
      CCSD=.FALSE.
      IF(ICCSD.NE.0) CCSD=.TRUE.
C     WRITE(ICHK,2300) IPRINT
C2300 FORMAT(/'  IPRINT=',I5)
      CALL RFILE(IT30)
      CALL RFILE(IT42)
      CALL RFILE(IT47)
      CALL RFILE(IT58)
CTJL  WRITE(ICHK,9002)
9002  FORMAT(' BEFORE TAPE47 READ')
      CALL WREADW(IT47,IA47,192,1,JUNK)
CTJL  WRITE(ICHK,9003)
9003  FORMAT(' BEFORE TAPE42 READ ')
      CALL WREADW(IT42,IA42,100,1,JUNK)
CTJL  WRITE(ICHK,9004)
9004  FORMAT(' AFTER TAPE 42 READ')
      NBF=IA47(1)
      IOCC=IA47(2)
      JOCC=IA47(3)
      KOCC=IA47(4)
      NIJ=IA47(5)
      NAT=IA47(6)
      NDF=NAT*3
      NTYPES=IA47(7)
      ICALT=IA47(8)
      IDERT=IA47(9)
      ICIT=IA47(10)
CGES
CGES  WRITE(*,*)'ICIT=',ICIT
C
C  CHECK FOR ERRORS ON 47
C
      IF (ICALT .EQ. 3) THEN
        ITCSCF=0
      ELSE IF (ICALT .EQ. 4) THEN
        ITCSCF=1
      ELSE
        WRITE(NOUT,1001) ICALT
        CALL ABORTS
 1001   FORMAT(/'  THIS PROGRAM DOES GENERAL SCF OR TCSCF'
     1  /'  CAN NOT HANDLE YOUR CALTYP OF :',I5)
      END IF
CTJL  WRITE(ICHK,9005)
9005  FORMAT(' FIRST TEST')
      IF (ITCSCF .EQ. 1) THEN
        WRITE(NOUT,1002)
 1002   FORMAT(/'  TEMPORARILY CANNOT DO SCF 2ND OF TCSCF')
        CALL ABORTS
      END IF
      IF (IA47(10).EQ.1) THEN
         IF (IA47(9).NE.2) THEN
             WRITE(NOUT,1003) IA47(9)
1003         FORMAT(/' THIS IS SCF SECOND . YOUR DERTYP IS : ',I5)
             CALL ABORTS
         END IF
      ELSE IF (IA47(10).EQ.2) THEN
         IF (IA47(9).NE.1) THEN
            WRITE(NOUT,1004) IA47(9)
1004        FORMAT(/' THIS IS CI FIRST . YOUR DERTYP IS : ',I5)
            CALL ABORTS
         END IF
      ELSE
         WRITE(NOUT,1005) IA47(10)
1005     FORMAT(/' THIS IS CI OR SCF . YOUR CITYP IS : ',I5)
         CALL ABORTS
      END IF
C
      NAT42=IA42(2)
      NUM=IA42(3)
      NBSET=IA42(8)
cets  WRITE(*,*) ' NBSET ' ,NBSET
      ISALC=IA42(12)
      ISA2LC=IA42(13)
      IHALC=IA42(14)
      ITALC=IA42(17)
C
C  COMPARE 22 DATA TO 47 DATA AS A CHECK
C
CTJL  IF (NAT42 .NE. NAT) THEN
C       WRITE(NOUT,1006) NAT42,NAT
C       CALL ABORTS
C1006   FORMAT(/'  THE NUMBER OF ATOMS IS INCONSISTANT: ',2I5)
C     END IF
C     IF (NUM .NE. NBF) THEN
C       WRITE(NOUT,1007) NUM,NBF
C       CALL ABORTS
C1007   FORMAT(/'  THE NUMBER OF BASIS FUNCTIONS IS INCONSISTANT: ',
C    *  2I5)
C     END IF
C
      CALL WREADW(IT58,DRTVER,INTOWP(1),1,END)
      CALL WREADW(IT58,LABEL,26,END,END)
      CALL WREADW(IT58,NBF,1,END,END)
      CALL WREADW(IT58,NSYM,1,END,END)
      CALL WREADW(IT58,NORBS,1,END,END)
      END=END+3
      CALL WREADW(IT58,NREFS,1,END,END)
      END=END+5
      CALL WREADW(IT58,ORBSYM,1,END,END)
      CALL WREADW(IT58,SYMORB,1,END,END)
      CALL WREADW(IT58,NUMIJ,1,END,END)
      CALL WREADW(IT58,NGROUP,1,END,END)
      END=END+1
      CALL WREADW(IT58,NMAX,1,END,END)
      WRITE(NOUT,1008) DRTVER,LABEL,NBF,NSYM,NORBS,NREFS,ORBSYM,NUMIJ,
     1NGROUP,NMAX
 1008 FORMAT(/'  READING DATA FROM DRT TAPE, VERSION=',F10.6
     1/'  LABEL FROM DRT: ',26A3/
     2/'  DRT INFORMATION:'/'  NBF=',I5,'  NSYM=',I5,'  NORBS=',I5,
     3/'  NREFS=',I5,'  ORBSYM=',I5,' NUMIJ=',I5,'  NGROUP=',I5,
     4'  NMAX=',I5)
      IF (NORBS .NE. NBF) THEN
        WRITE(NOUT,1009) NORBS,NBF
        CALL ABORTS
 1009   FORMAT(/'  THIS DRT CONTAINS FROZEN ORBITALS.'
     1  /'  NORBS=',I6,'   NBF=',I6)
      END IF
      IF (NORBS .NE. IA47(1)) THEN
        WRITE(NOUT,1010) NORBS,IA47(1)
        CALL ABORTS
 1010   FORMAT(/'  THE NUMBER OF ORBITALS BETWEEN TAPES 47 AND 8 IS INCO
     *N SISTANT.'/'  NORBS=',I6,'  FROM IT47=',I6)
      END IF
      IF (NREFS .NE. 1) THEN
        WRITE(NOUT,1011) NREFS
        CALL ABORTS
 1011   FORMAT(/'  THE NUMBER OF REFERENCES IS: ',I5,
     1  /'  THIS PROGRAM HANDLES ONLY SINGLE REFERENCES!')
      END IF
C
C  ALLOCATE CORE FOR DRT ARRAYS
C
      IOFF=1
      IJORD=IOFF+NUMIJ
CTJL
      IJDEP = IJORD + NUMIJ
CTJL  KADD=IJORD+NUMIJ
      KADD=IJDEP+NUMIJ
      LADD=KADD+SYMORB
      IJADD=LADD+SYMORB
      IJGRP=IJADD+NUMIJ
      ORBTBF=IJGRP+NUMIJ
      IOUT=ORBTBF+NORBS
      ORBSYM=IOUT+NORBS
      DOFF=ORBSYM+NORBS
      DADD=DOFF+NUMIJ
      JCODE=DADD+NUMIJ
      JT1C=JCODE+NORBS
      DROL=JT1C+4*NDF+NBSET*NDF
      ITOP=DROL+NORBS
CTJL  WRITE(NOUT,2012) ITOP,DRTTOP
C2012 FORMAT(/'  THERE ARE ',I5,'  WORDS NEEDED ',I5,'  AVAILABLE')
CTJL  IF (ITOP .GT. DRTTOP) THEN
      IF (ITOP .GT. INTOWP(MAXCOR)) THEN
        WRITE(NOUT,1012) ITOP,INTOWP(MAXCOR)
        CALL ABORTS
 1012   FORMAT(/'  FOR DRT ARRAYS, PROGRAM REQUESTS ',I8,'  WORDS.'
     1  /'  ONLY ',I8,'  ARE AVAILABLE. INCREASE MAXCOR')
      END IF
      CALL ZERO(IZ,ITOP)
C
      CALL GETDRT(IZ(KADD),IZ(LADD),IZ(IJADD),IZ(IJGRP),IZ(ORBTBF),
     1IZ(IOUT),IZ(ORBSYM),IZ(JCODE),NGROUP)
      CALL ALLOC(IZ(ORBTBF),IZ(JCODE),IZ(IJORD),IZ(IOFF),IZ(IJDEP),
     .           IZ(ORBSYM),IZ(DOFF),IZ(DADD),NMA1)
C
      IF (ITCSCF .EQ. 1) IJIND=IJIND+2
      IJIND2=IJIND
      IJIND3=IJIND2+NDF
C
C  READ IN DATA FOR SHELL TYPES
C
      CALL WREADW(IT47,FOCC,INTOWP(5),IA47(104),JUNK)
      CALL WREADW(IT47,NSORB,5,IA47(105),JUNK)
      WRITE(ICHK,1050) (FOCC(III), III=1,5), (NSORB(JJJ),JJJ=1,5)
 1050 FORMAT(/'  FOCC:',5F5.3/'  NSORB:',5I5)
      CALL REGIST
C
C ALLOCATE CORE FOR PRELIMINARY ARRAYS
C
      EIG = IADTWP(ITOP)
CTJL  EIG=1
      OCC=EIG+NORBS
      ALPHA=OCC+NORBS
      BETA=ALPHA+NUMIJ
      EPS=BETA+NUMIJ
      VEC=EPS+NUMIJ
      SCR=VEC+NORBS*NORBS
      TOP=SCR+NORBS*NORBS
      CALL ZERO(Z(EIG),TOP-EIG)
C
C  GET SOME ARRAYS FROM IT47 AND ROTATE TO DRT ORDER
C
      CALL READ47(IA47,IZ(IOFF),IZ(DROL),IZ(ORBTBF),Z(EIG),Z(OCC),
     1Z(ALPHA),Z(BETA),Z(EPS),Z(VEC),Z(SCR),CCSD)
CGES  WRITE(*,*)'EIGENVECTOR FROM TAPE 47'
CGES  CALL MATOUT (Z(VEC),NORBS,NORBS,NORBS,NORBS,6)
C
C  GET DERIVATIVE INTEGRALS FROM TAPE42; TRANSFORM TO MO BASIS
C
      SS=SCR
      SCR1=SS+NUMIJ
      SCR2=SCR1+NUMIJ
      BUF=SCR2+NUMIJ
      ITOP=BUF+NDF*NUMIJ*NBSET
      IF (ITOP .GT. MAXCOR) THEN
        WRITE(NOUT,1020) ITOP,MAXCOR
        CALL ABORTS
 1020   FORMAT(/'  REQUIRE ',I8,'  WORDS OF CORE FOR DERMAT.'
     1  /'  ONLY ',I8,'  WORDS ARE AVAILABLE.')
      END IF
      CALL ZERO(Z(SS),ITOP-SS)
CTJL  DO 301 II=SA,ITOP
C301  Z(II)=0.0D+00
      CALL DERMAT(Z(VEC),Z(SCR1),Z(SCR2),Z(SS),Z(BUF),Z(BUF),
     1IZ(IOFF),IZ(JT1C))
C
C  CONSTRUCT DERIV FOCK MATRIX
C
CTJL  EPA=VEC
      EPA=SS
C
C     LSTEPA IS FOR THE NBSET DERIV LAGRANGIAN FOR CI FIRST
C     (LENGTH NUMIJ)
C
      LSTEPA=EPA
      TA=EPA+NORBS*NORBS
      HA=TA+NUMIJ
      BUF=HA+NUMIJ
      ITOP=BUF+NBSET*NUMIJ
      CALL ZERO(Z(EPA),ITOP-EPA)
CTJL  DO 302 II=EPA,ITOP
C302  Z(II)=0.0D+00
C
CGES  DROL IS SCRATCHED TO C1 SYMMETRY FOR COUPLED CLUSTER
C
      IF(CCSD)THEN
      DO 9156 J=1,NORBS
 9156 IZ(DROL+J-1)=J
      ENDIF
      CALL FAMAT(Z(EPA),Z(TA),Z(HA),Z(BUF),IZ(IOFF),IZ(JT1C),
     1IZ(IOUT),IZ(DROL),Z(LSTEPA))
C
C  CONSTRUCT A AND B0 MATRICIES IN 'CC' AND SOLVE A*U=B0
C
C
C  THE EXTRA ARRAYS ECIJA(NUMIJ,NDF),BOX(NDF),X(NDF)
C  ARE ALLOCATED FOR CONVENIENCE OVER THE TOP OF SOME OF THESE
C  ARRAYS FOR CI FIRST
C  ( U(NORBS,NORBS) IS STILL UNUSED IN CI FIRST)
C
CJ    LG=EPA
CJ    U=LG+NORBS*NORBS
CJ    SS=U+NORBS*NORBS
CJ    W=SS+NUMIJ*NDF
CJ    ECIJA=W
CJ    BOX=W+NUMIJ*NDF
CJ    X=W
CTJL
      EX = EPA + NORBS*NORBS
      EX2 = EX + IJIND
      RS = EX2 + IJIND
      EAVF = RS + (NUMDEP)*NDF
      DIP = EAVF + NUMIJ
      U = DIP + NUMIJ*3
CTJL
CTJL  U=EPA+NORBS*NORBS
      LG=U
      SS=LG+NORBS*NORBS
      W=SS+NUMIJ*NDF
      BOX=W
      X=BOX+NDF
      ZETA=W+NORBS*NORBS*NDF
C     CC=ZETA+NUMIJ*NORBS
      ZZ=ZETA+NUMIJ*NORBS
CG    DIMZZ=(NDOC-NUOC)*NUOC+NOP*NDOC+IJDC
      DIMZZ= IZDIM
C     WRITE(*,*)'DIMENSION Z VECTOR IS',IJIND*IJIND
cets  WRITE(*,*)'       '
cets  WRITE(*,*)'DIMENSION OF ZZ IS   ',DIMZZ
      CC=ZZ+DIMZZ
CGESA
      IDIMCC=NMA1*(NMA1+1)
C     C=CC+IJIND*IJIND
C     INTS=CC+IJIND*IJIND3
      C=CC+IDIMCC
      INTS=C+IJIND*NDF
cets  WRITE(*,*)'DIMENSION OF B LAMDA ',IJIND*NDF
cets  WRITE(*,*)'DIMENSION OF A MATRIX',NMA1*NMA1
cets  WRITE(*,*)'DIMENSION OF Z VECTOR',NMA1
      BUF=INTS+NMAX
      E11=BUF+NORBS*NORBS
      E22=E11+NORBS*NORBS
      E12=E22+NORBS*NORBS
      ITOP=E12+NORBS*NORBS
      IF (ITOP .GT. MAXCOR) THEN
        WRITE(NOUT,1030) ITOP,MAXCOR
        CALL ABORTS
 1030   FORMAT(/'  PROGRAM REQUESTED ',I8,'  WORDS BEFORE B0MAT.'
     1  /'  THERE ARE ONLY ',I8,'  WORDS AVAILABLE.')
      END IF
CTJL
      CALL ZERO(Z(EX),ITOP-EX)
CTJL
      CALL B0MAT(Z(ALPHA),Z(BETA),Z(EPS),Z(EPA),Z(U),Z(SS),Z(W),
     1Z(ZETA),Z(CC),Z(OCC),Z(EIG),Z(INTS),Z(BUF),IZ(IJORD),IZ(IOFF),
     2IZ(KADD),IZ(LADD),IZ(IJGRP),IZ(IJADD),IZ(ORBSYM),IZ(ORBTBF),
     3IZ(JCODE),IZ(JT1C),Z(E11),Z(E22),Z(E12),Z(LG),Z(BOX),
     4Z(C),Z(X),IZ(IOUT),Z(EX),Z(RS),IZ(IJDEP),Z(VEC),Z(DIP),Z(EAVF),
     5Z(LSTEPA),Z(EX2),CCSD,Z(ZZ),DIMZZ,IZ(DOFF),IZ(DADD),NMA1,IDIMCC)
      IF (ICIT.EQ.2) RETURN
      U=1
      W=U+NORBS*NORBS*NDF
      EPA=U
      SA=EPA+NORBS*NORBS*NDF
      UAWB=W+NORBS*NORBS*NDF
      SAEB=UAWB+NDF*NDF
      DTOT=SAEB+NDF*NDF
      ITOP=DTOT+NDF*NDF
      IF (ITOP .GT. MAXCOR) THEN
        WRITE(NOUT,1031) ITOP,MAXCOR
 1031   FORMAT(/'  FOR FINAL ',I8,'  WORDS ARE REQUIRED.'
     1  /'  ONLY ',I8,'  WORDS AVAILABLE.')
        CALL ABORTS
      END IF
      CALL ZERO(Z,ITOP)
      CALL FINAL(Z(U),Z(W),Z(EPA),Z(SA),Z(UAWB),Z(SAEB),Z(DTOT),
     1IZ(JT1C),IZ(IOFF))
      RETURN
      END
 
      SUBROUTINE MOCONV(SA,NNA,SM,NNM,EAO,U,T)
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER P,Q,PQ
      DIMENSION SA(NNA),SM(NNM),EAO(NBF,NORBS),U(NORBS),T(NNA)
      COMMON /DIMSG/ ISYMRB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
C
      A0=0.0D+00
      A1=1.0D+00
      A1S2=0.50D+00
      DO 101 IJ=1,NNA
 101  T(IJ)=SA(IJ)
      DO 102 IJ=1,NNM
 102  SM(IJ)=A0
C
      PQ=0
      DO 40 P=1,NBF
        DO 5 II=1,NORBS
 5      U(II)=A0
        E=A1
        DO 20 Q=1,P
          PQ=PQ+1
          IF (P .EQ. Q) E=A1S2
          F=T(PQ)*E
          DO 10 J=1,NORBS
 10       U(J)=U(J)+EAO(Q,J)*F
 20     CONTINUE
        IJ=0
        DO 30 I=1,NORBS
          U1I=U(I)
          DO 25 J=1,I
            IJ=IJ+1
            SM(IJ)=SM(IJ)+U1I*EAO(P,J)+U(J)*EAO(P,I)
 25       CONTINUE
 30     CONTINUE
 40   CONTINUE
      RETURN
      END
 
      SUBROUTINE ORDER(A,SCR,ORBTBF,DROL,CCSD)
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER ORBTBF(NORBS),DROL(NORBS)
      DIMENSION A(NORBS),SCR(NORBS)
      LOGICAL CCSD
      COMMON /DIMSG/ ISYMRB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
CGES  WRITE(*,*)'IN ORDER',ORBTBF
C
      DO 101 I=1,NORBS
        SCR(I)=A(I)
 101  A(I)=0.0D+00
C
      IF (CCSD)THEN
      DO 102 IOR=1,NORBS
        IBF=DROL(ORBTBF(IOR))
 102  A(IOR)=SCR(IBF)
      ELSE
      DO 103 IOR=1,NORBS
        IBF=ORBTBF(IOR)
 103  A(IOR)=SCR(IBF)
      ENDIF
      RETURN
      END
 
      SUBROUTINE ORDER1(A,SCR,IOFF,ORBTBF,DROL,CCSD)
      IMPLICIT REAL*8 (A-H,O-Z)
      DIMENSION A(NUMIJ),SCR(NUMIJ)
      INTEGER ORBTBF(NORBS),IOFF(NUMIJ),DROL(NORBS)
      LOGICAL CCSD
      COMMON /DIMSG/ ISYMRB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
C
      DO 101 IJ=1,NUMIJ
        SCR(IJ)=A(IJ)
 101  A(IJ)=0.0D+00
C
      IF(CCSD)THEN
      IJ=0
      DO 102 IOR=1,NORBS
        IBF=DROL(ORBTBF(IOR))
        DO 102 JOR=1,IOR
          IJ=IJ+1
          JBF=DROL(ORBTBF(JOR))
          IBM=MAX0(IBF,JBF)
          JBM=MIN0(IBF,JBF)
          IJBF=IOFF(IBM)+JBM
 102  A(IJ)=SCR(IJBF)
      ELSE
      IJ=0
      DO 103 IOR=1,NORBS
        IBF=ORBTBF(IOR)
        DO 103 JOR=1,IOR
          IJ=IJ+1
          JBF=ORBTBF(JOR)
          IBM=MAX0(IBF,JBF)
          JBM=MIN0(IBF,JBF)
          IJBF=IOFF(IBM)+JBM
 103  A(IJ)=SCR(IJBF)
      ENDIF
      RETURN
      END
 
      SUBROUTINE ORDER2(A,SCR,ORBTBF)
      IMPLICIT REAL*8 (A-H,O-Z)
      DIMENSION A(NORBS,NORBS),SCR(NORBS,NORBS)
      INTEGER ORBTBF(NORBS)
      COMMON /DIMSG/ ISYMRB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
C
      DO 101 I=1,NORBS
        DO 101 J=1,NORBS
          SCR(I,J)=A(I,J)
 101  A(I,J)=0.0D+00
C
      DO 102 IOR=1,NORBS
        IBF=ORBTBF(IOR)
        DO 102 J=1,NORBS
 102  A(J,IOR)=SCR(J,IBF)
C
      RETURN
      END
 
      SUBROUTINE PRN11(DER1,NAT,CCSD,CIDT)
C
      IMPLICIT REAL*8 (A-H,O-Z)
C
      REAL*8 DER1(3,NAT),A30(100),CIDT(3)
      INTEGER IA30(400),IPTR30(400)
      INTEGER IALBEL(20),IBLBEL(20),LBLDRT(26)
      CHARACTER*52 TITLE,TITLC
CCCC  CHARACTER*8  SCFTYP,CALTYP
      CHARACTER*1 LET(3)
      LOGICAL OPEN,CCSD
C
      DIMENSION ZAN(50),GEOM(3,50)
C
      EQUIVALENCE (IA30,A30)
cets
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /CALCJ/ ICALT,IDERT,ICIT
      COMMON /FILES/ IT54
C
      DATA LET   /'X','Y','Z'/
      DATA TITLE /'---------- CI GRADIENTS PLUS CPHF TERMS ----------'/
      DATA TITLC /'---------- CC GRADIENTS PLUS CPHF TERMS ----------'/
C
cets  EQUIVALENCE (IA30,A30)
      ITAP11 = 11
      ITAP69 = 69
C
CC      IF (CALTYP.NE.'SCF  '.AND.CALTYP.NE.'CI   '.AND.
CC   #  CALTYP.NE.'MCSCF') THEN
CC        WRITE (NOUT,902) CALTYP,LEVEL,IPRINT
CC902     FORMAT (//,' UNKNOWN CALCULATION TYPE: ',A5,1X,A5,I5,//)
CC        STOP
CC      END IF
C
C     ----- GET CONSTANTS FROM TAPE30 -----
C
      CALL SREW(IT30)
      CALL WREADW(IT30,IA30,200,101,JUNK)
C
      IEND   =  IA30(1)
      MPOINT =  IA30(2)
      MCONST =  IA30(3)
      MCALCS =  IA30(4)
      NCALCS =  IA30(5)
      NAT    = IA30(19)
      NUM    = IA30(22)
      NNP    = IA30(23)
      NSHELL = IA30(27)
      NIRRED = IA30(28)
      NT     = IA30(29)
      NPRIM  = IA30(32)
      MXT    = IA30(36)
      NISO   = IA30(40)
C
C     ----- READ POINTERS FROM TAPE30 -----
C
      JUNK   = 101+MCONST
      CALL WREADW(IT30,IPTR30,MPOINT,JUNK,JUNK)
C
C     ----- NOW GO FOR THE GUSTO -----
C
      CALL WREADW(IT30,   ZAN,    INTOWP(NAT),IPTR30(1),JUNK)
C
C     ----- AND GET LOCATION OF INDIVIDUAL CALCULATION TO GET GEOM
C
      JUNK   = 101+MCONST+MPOINT+NCALCS-1
      CALL WREADW(IT30, LOCCAL, 1,JUNK,JUNK)
C
      CALL WREADW(IT30, IA30, 60,LOCCAL,LOCCAL)
C
      DO 500  ILBL=1,20
         IALBEL(ILBL) =  IA30(ILBL)
CCCC     CALL ITC(IA30(ILBL),0,ALABEL(ILBL))
  500 CONTINUE
C
      WRITE(3,*) ' ICALT =',ICALT,' IDERT = ',IDERT,' ICIT = ',ICIT
CCCC  IF(CITYP.NE.'CI    ' .AND. DERTYP.EQ.'FIRST ') THEN
CC    WRITE (ITAP11,899) (IA30(I),I=1,20)
C 899 FORMAT (20A4,/)
CC    WRITE (NOUT,900) (IA30(I),I=1,20)
C 900 FORMAT (/,(1X,20A4)/)
CCCC  END IF
C
      LOCCAL=LOCCAL+20
      CALL WREADW(IT30,  GEOM,  INTOWP(3*NAT),LOCCAL,LOCCAL)
C
C     ----- GET ENERGIES AND WRITE OUT -----
C
      CALL WREADW(IT30,   IA30,     INTOWP(10),LOCCAL,LOCCAL)
C
      ESCF = A30(2)
C
C    GET CI OR CC ENERGY
C
      IF(.NOT.CCSD)THEN
      CALL RFILE(IT54)
      CALL DCDLBL(IT54,LBLDRT,LBLDRT,IX,IX,IX,EGUESS,ECI,CZERO)
      ELSE
      CALL RFILE(ITAP69)
      CALL SREAD(ITAP69,NM,1)
      CALL SREAD(ITAP69,NDIMT2,1)
      CALL RGETSA(ITAP69,ISECT1)
      ISECT2=I2SEC(INTOWP(NM))+ISECT1
      ISECE=I2SEC(INTOWP(NDIMT2))+ISECT2
      CALL RSETSA(ITAP69,ISECE)
      CALL SREAD(ITAP69,EREF,INTOWP(1))
      CALL SREAD(ITAP69,XE,INTOWP(1))
      CALL RCLOSE(ITAP69,3)
      ECI=EREF+XE
      ENDIF
C
      WRITE (NOUT,901) A30(1)
  901 FORMAT (/,1X,' NUCLEAR REPULSION ENERGY =',F20.10)
      WRITE (NOUT,902) ESCF
  902 FORMAT (  1X,' SCF ENERGY               =',F20.10)
      WRITE (NOUT,903) ECI
  903 FORMAT( 1X,'  + CORRELATION ENERGY    =',F20.10,/)
C
C     -------  NOW WRITE CI GRADIENTS TO FILE11  --------
C     -------       AND DIPOLE MOMENT            --------
C
  111 FORMAT (20A4)
C 111 FORMAT (20A4,/) GET RID OF BLANK LINE AFTER TITLE. GES. JAN-7-88.
  112 FORMAT (I5,F20.10,F15.10,5X,F15.10,5X,F15.10)
C 112 FORMAT (I5,F20.10)
  113 FORMAT (4F20.10)
  114 FORMAT (20X,3F20.10)
C
      WRITE (11,111) (IALBEL(I),I=1,20)
      WRITE (11,112) NAT,ECI,CIDT(1),CIDT(2),CIDT(3)
      DO 100  NG = 1,NAT
        WRITE (11,113)  ZAN(NG),GEOM(1,NG),GEOM(2,NG),GEOM(3,NG)
  100 CONTINUE
      DO 200  ND = 1,NAT
        WRITE (11,114)  DER1(1,ND),DER1(2,ND),DER1(3,ND)
  200 CONTINUE
C
C     -----  NOW WRITE CI GRADIENTS TO OUTPUT FILE  -----
C
      IF(.NOT.CCSD)THEN
      WRITE (NOUT,61) TITLE
      ELSE
      WRITE (NOUT,61) TITLC
      ENDIF
   61 FORMAT (//,T11,A50,//,' CENTER',T15,'X',T35,'Y',T55,'Z')
      DO 63  IC=1,NAT
        WRITE (NOUT,62) IC,DER1(1,IC),DER1(2,IC),DER1(3,IC)
   62   FORMAT (/,1X,I4,3F20.12)
   63 CONTINUE
C
C     -------  NOW WRITE CI GRADIENTS TO FILE30  --------
C
      JUNK=101+MCONST+MPOINT+NCALCS-1
      CALL WREADW(IT30,LOCCAL,1,JUNK,JUNK)
C
      LOCCAL=LOCCAL+61
      CALL WREADW(IT30,LOCDER,1,LOCCAL,JUNK)
      IF (LOCDER.LE.0) THEN
        LOCDER=IEND
        IEND=IEND+INTOWP(3*NAT)
        CALL WWRITW(IT30,LOCDER,1,LOCCAL,JUNK)
        CALL WWRITW(IT30,IEND,1,101,JUNK)
      END IF
C
      CALL WWRITW(IT30,DER1,INTOWP(3*NAT),LOCDER,JUNK)
C
      CALL RCLOSE(IT30,3)
C
C
      RETURN
      END
 
      SUBROUTINE READ47(IA47,IOFF,DROL,ORBTBF,EIG,OCC,ALPHA,BETA,
     1EPS,VEC,SCR,CCSD)
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER IOFF(NUMIJ),ORBTBF(NORBS),IA47(192),DROL(NORBS),IREP(2)
      DIMENSION EIG(NORBS),OCC(NORBS),ALPHA(NUMIJ),BETA(NUMIJ)
      DIMENSION EPS(NUMIJ),VEC(NORBS,NORBS),SCR(2,NORBS)
      LOGICAL CCSD
      EQUIVALENCE (IREP(1),REPN)
      COMMON /REN/ REPNUC
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ ISYMRB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /IEXT/ IPRINT,IGRP,ICIDIP
CGES
C     IPRINT = 2
C
C READ DATA FROM IT47
CTJL  WRITE(ICHK,2222)
C2222 FORMAT(/'  IN READ47')
      IREP(1)=IA47(12)
      IREP(2)=IA47(13)
      REPNUC=REPN
      WRITE(ICHK,3333)REPNUC
      WRITE(NOUT,3333) REPNUC
 3333 FORMAT(/'  THE NUCLEAR REPULSION ENERGY FROM TAPE47 =',F20.10)
      CALL WREADW(IT47,EIG,INTOWP(NORBS),IA47(103),JUNK)
      IF (IAND(IPRINT,2) .NE. 0) THEN
CGES
C       WRITE(*,*) 'EIG IS ZEROED OUT BECAUSE IT IS DUMMY !'
C       CALL ZERO(EIG,NORBS)
        WRITE(NOUT,101) 'EIG  '
        WRITE(NOUT,102) (EIG(III),III=1,NORBS)
      END IF
C
      CALL WREADW(IT47,ALPHA,INTOWP(NUMIJ),IA47(106),JUNK)
      IF (IAND(IPRINT,2) .NE. 0) THEN
        WRITE(NOUT,101) 'ALPHA'
        CALL PRINT(ALPHA,NUMIJ,NORBS,NOUT)
      END IF
C
      CALL WREADW(IT47,BETA,INTOWP(NUMIJ),IA47(107),JUNK)
      IF (IAND(IPRINT,2) .NE. 0) THEN
        WRITE(NOUT,101) 'BETA '
        CALL PRINT(BETA,NUMIJ,NORBS,NOUT)
      END IF
C
      NORBSQ=NORBS*NORBS
      CALL WREADW(IT47,VEC,INTOWP(NORBSQ),IA47(110),JUNK)
      IF (IAND(IPRINT,2) .NE. 0) THEN
        WRITE(NOUT,101) 'VEC  '
        CALL MATOUT(VEC,NORBS,NORBS,NORBS,NORBS,NOUT)
      END IF
C
      CALL WREADW(IT47,EPS,INTOWP(NUMIJ),IA47(111),JUNK)
      IF (IAND(IPRINT,2) .NE. 0) THEN
CGES
C       WRITE(*,*) 'EPS IS BEING ZEROED OUT '
C       CALL ZERO(EPS,NUMIJ)
        WRITE(NOUT,101) 'EPS  '
        CALL PRINT(EPS,NUMIJ,NORBS,NOUT)
      END IF
C
      CALL WREADW(IT47,SCR,INTOWP(2*NORBS),IA47(113),JUNK)
      DO 301 I=1,NORBS
 301  OCC(I)=SCR(1,I)+SCR(2,I)
      IF (IAND(IPRINT,2) .NE. 0) THEN
        WRITE(NOUT,101) 'OCC  '
        WRITE(NOUT,102) (OCC(III),III=1,NORBS)
      END IF
C
      CALL WREADW(IT47,DROL,NORBS,IA47(117),JUNK)
      IF (IAND(IPRINT,2) .NE. 0) THEN
        WRITE(NOUT,101) 'DROL '
        WRITE(NOUT,104) (DROL(III),III=1,NORBS)
      END IF
C
C RE-ORDER TO DRT ORDERING
CGES  CALL ORDER(EIG,SCR,ORBTBF)
      CALL ORDER(EIG,SCR,ORBTBF,DROL,CCSD)
      IF (IAND(IPRINT,2) .NE. 0) THEN
        WRITE(NOUT,103) 'EIG  '
        WRITE(NOUT,102) (EIG(III),III=1,NORBS)
      END IF
C
CGES  CALL ORDER(OCC,SCR,ORBTBF)
      CALL ORDER(OCC,SCR,ORBTBF,DROL,CCSD)
      IF (IAND(IPRINT,2) .NE. 0) THEN
        WRITE(NOUT,103) 'OCC  '
        WRITE(NOUT,102) (OCC(III),III=1,NORBS)
      END IF
C
CGES  CALL ORDER1(ALPHA,SCR,IOFF,ORBTBF)
      CALL ORDER1(ALPHA,SCR,IOFF,ORBTBF,DROL,CCSD)
      IF (IAND(IPRINT,2) .NE. 0) THEN
        WRITE(NOUT,103) 'ALPHA'
        CALL PRINT(ALPHA,NUMIJ,NORBS,NOUT)
      END IF
C
CGES  CALL ORDER1(BETA,SCR,IOFF,ORBTBF)
      CALL ORDER1(BETA,SCR,IOFF,ORBTBF,DROL,CCSD)
      IF (IAND(IPRINT,2) .NE. 0) THEN
        WRITE(NOUT,103) 'BETA '
        CALL PRINT(BETA,NUMIJ,NORBS,NOUT)
      END IF
C
      CALL ORDER2(VEC,SCR,ORBTBF)
      IF (IAND(IPRINT,2) .NE. 0) THEN
        WRITE(NOUT,103) 'VEC  '
        CALL MATOUT(VEC,NORBS,NORBS,NORBS,NORBS,NOUT)
      END IF
C
 101  FORMAT(3X,A5,'  ARRAY AS READ FROM TAPE47:')
 102  FORMAT(5F15.6)
 103  FORMAT(3X,A5,'  ARRAY AFTER RE-ORDERING TO DRT:')
 104  FORMAT(10I5)
      RETURN
      END
 
      SUBROUTINE REGIST
      IMPLICIT INTEGER (A-Z)
      REAL*8 FOCC
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ SYMORB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /POINT/ FOCC(5),IPOINT(5),JPOINT(5),NSORB(5)
      COMMON /FUNCS/ IOCC,JOCC,KOCC,NTYPES,NBSET,NAT
      COMMON /OCCS/ NSPE,NSA,NSB,NALP,NOP,NDOC,LFERM,NUOC,IJIND,IJIND3
C
CTJL  WRITE(ICHK,2222)
C2222 FORMAT(/'  IN REGIST')
      IPOINT(1)=IOCC+1
      JPOINT(1)=1
      DO 10 I=2,NTYPES+1
        JPOINT(I)=JPOINT(I-1)+NSORB(I-1)
 10   IPOINT(I)=IPOINT(I-1)+NSORB(I)
      IT1=NTYPES+1
      WRITE(ICHK,101)
      WRITE(ICHK,99) (IPOINT(I), I=1,IT1)
      WRITE(ICHK,102)
      WRITE(ICHK,99) (JPOINT(I), I=1,IT1)
  99  FORMAT(2X,5I5)
 101  FORMAT('  THE IPOINT ARRAY:')
 102  FORMAT('  THE JPOINT ARRAY:')
      RETURN
      END
 
      SUBROUTINE SAMAT(SA,NNA,SS,NNM,VEC,IOFF,U,T,JT1C)
      IMPLICIT REAL*8 (A-H,O-Z)
      DIMENSION SA(NNA,NDF),SS(NNM),VEC(NORBS,NORBS),U(1),T(1)
      INTEGER IOFF(NUMIJ),JT1C(1)
      COMMON /TAPES/ NOUT,ICHK,IT30,IT42,IT47,IT52,IT58,IT94,IT96,IT98
      COMMON /DIMSG/ ISYMRB,NUMIJ,NBF,NMAX,NBFORB,NSYM,NDF,NORBS
      COMMON /FUNCS/ IOCC,JOCC,KOCC,NTYPES,NBSET,NAT
      COMMON /LOC42/ IA42(100),IBF2AT(284)
      COMMON /IEXT/ IPRINT,IGRP,ICIDIP
      DATA ZERO,ONE / 0.0D+00 , 1.0D+00 /
    1 FORMAT(//,2X,' SA (MO BASIS) MATRIX, IABC = ',I5,' IXYZ = ',I5/)
C
C   TRANSFORM SA INTEGRALS FROM AO TO MO BASIS
      WRITE(ICHK,2222)
 2222 FORMAT(/'  IN SAMAT')
CGES
C     IPRINT=4
      IS=1
      KABC=0
      IF (IAND(IPRINT,4) .NE. 0) THEN
        DO 1010 IABC=1,3
          WRITE(NOUT,1011) IABC
 1011     FORMAT(/'  THE S MATRIX AS READ FROM 42 FOR XYZ = ',I5)
          CALL PRINT(SA(1,IABC),NUMIJ,NORBS,NOUT)
 1010   CONTINUE
        WRITE(NOUT,1012) (IBF2AT(III), III=1,NORBS)
 1012   FORMAT(/'  IBF2AT:',10I5)
      END IF
C
      DO 105 IABC=1,NAT
        DO 104 IXYZ=1,3
          KABC=KABC+1
C
          DO 101 I=1,NUMIJ
  101     SS(I)=ZERO
C
          DO 103 I=1,NORBS
            IA=IOFF(I)
            DO 102 J=1,I
              IF(IBF2AT(I).NE.IABC.AND.IBF2AT(J).NE.IABC)
     *        GO TO 102
              IJ=IA+J
              SX=SA(IJ,IXYZ)
              IF(IBF2AT(I).NE.IABC) SX=-SX
              SS(IJ)=SX
  102       CONTINUE
  103     CONTINUE
C
          IF (IAND(IPRINT,4) .NE. 0) THEN
            WRITE(NOUT,1001) KABC
 1001       FORMAT(/'  THE SA MATRIX FOR DEGREE OF FREEDOM',I5)
            CALL PRINT(SS,NUMIJ,NORBS,NOUT)
          END IF
C
          CALL MOCONV(SS,NNM,SS,NNM,VEC,U,T)
          JT1C(KABC)=IS
          CALL WWRITW(IT94,SS,INTOWP(NUMIJ),IS,IS)
C
          IF (IAND(IPRINT,4) .NE. 0) THEN
            WRITE(NOUT,1002) KABC
 1002       FORMAT(/'  THE SM MATRIX FOR DEGREE OF FREEDOM',I5)
            CALL PRINT(SS,NUMIJ,NORBS,NOUT)
            WRITE(NOUT,1003) KABC,JT1C(KABC),IS
 1003       FORMAT(/'  MO S MATRIX ',I5,'  WRITTEN TO POSITION ',I8,'  N
     *EXT POSITION ',I8)
          END IF
  104   CONTINUE
  105 CONTINUE
C
      RETURN
      END
 
      SUBROUTINE SQUR(T,SQ,N)
      IMPLICIT REAL*8 (A-H,O-Z)
      DIMENSION SQ(2),T(2)
      IJ=0
      II=0
      DO 20 I=1,N
      JJ=0
      DO 10 J=1,I
      IJ=IJ+1
      SQ(II+J)=T(IJ)
      SQ(JJ+I)=T(IJ)
10    JJ=JJ+N
20    II=II+N
      RETURN
      END
 
